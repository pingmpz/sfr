<!DOCTYPE html>
{% load static %}
{% load extra %}
<!--
* CoreUI Pro based Bootstrap Admin Template
* @version v3.2.0
* @link https://coreui.io/pro/
* Copyright (c) 2020 creativeLabs Łukasz Holeczek
* License (https://coreui.io/pro/license)
-->
<html lang="en">
  <head>
    <base href="./">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description" content="CoreUI - Open Source Bootstrap Admin Template">
    <meta name="author" content="Łukasz Holeczek">
    <meta name="keyword" content="Bootstrap,Admin,Template,Open,Source,jQuery,CSS,HTML,RWD,Dashboard">
    <title>AB Graph | Shopfloor Reporting Application</title>
    <!-- Main styles for this application-->
    <link rel="stylesheet" href="{% static "css/style.css" %}">
    <!-- Icon CSS -->
    <link href="{% static "vendors/@coreui/icons/css/free.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/@coreui/icons/css/brand.min.css" %}" rel="stylesheet">
    <!-- Select CSS -->
    <link href="{% static "vendors/select2/css/select2.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/select2/css/select2-coreui.min.css" %}" rel="stylesheet">
    <!-- Data Table CSS -->
    <link href="{% static "vendors/datatables.net-bs4/css/dataTables.bootstrap4.css" %}" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static "customize/css/decorate.css" %}" rel="stylesheet">
    <!-- Chart CSS -->
    <link href="{% static "vendors/@coreui/chartjs/css/coreui-chartjs.css" %}" rel="stylesheet" >
  </head>
  <body class="c-app c-no-layout-transition">
    <!-- *** LEFT SIDE BAR *** -->
    {% include 'sidebar.html' %}
    <!-- *** RIGHT SIDE BAR *** -->
    <div class="c-wrapper">
      <!-- *** HEADER *** -->
      <header class="c-header c-header-light c-header-fixed">
        {% include 'header.html' %}
        <div class="c-subheader justify-content-between px-3">
          <!-- Breadcrumb-->
          <ol class="breadcrumb border-0 m-0 px-0 px-md-3">
            <li class="breadcrumb-item">AB Graph</li>
            <!-- Breadcrumb Menu-->
            <!-- <li class="breadcrumb-item active"></li> -->
          </ol>
          <div class="c-subheader-nav d-md-down-none mfe-2">
            <select class="form-control" id="fwctype">
              <option value="WC" {% if fwctype == 'WC' %}style="color:blue" selected{% endif %}>WorkCenter</option>
              <option value="WCG" {% if fwctype == 'WCG' %}style="color:blue" selected{% endif %}>WorkCenterGroup</option>
            </select>&nbsp;
            <select class="form-control" id="fwc">
              {% for wc in workCenterList %}
              <option value="{{wc.WorkCenterNo}}" {% if fwc == wc.WorkCenterNo %}style="color:blue" selected{% endif %}>{{wc.WorkCenterNo}}</option>
              {% endfor %}
            </select>
            <select class="form-control" id="fwcg">
              {% for wcg in workCenterGroupList %}
              <option value="{{wcg.WorkCenterGroup}}" {% if fwcg == wcg.WorkCenterGroup %}style="color:blue" selected{% endif %}>{{wcg.WorkCenterGroup}}</option>
              {% endfor %}
            </select>
            &nbsp;
            <select class="form-control" id="ftype">
              <option value="MONTHLY" {% if ftype == 'MONTHLY' %}style="color:blue" selected{% endif %}>Monthly</option>
              <option value="YEARLY" {% if ftype == 'YEARLY' %}style="color:blue" selected{% endif %}>Yearly</option>
            </select>&nbsp;
            <input type="month" class="form-control" id="fmonth" value="{{fmonth}}" onkeydown="return false" required>
            <input type="number" class="form-control" id="fyear" value="{{fyear}}" onkeydown="return false" required>
            <button type="button" class="btn btn-sm btn-link text-primary" style="padding-top: 3px;" onclick="window.scrollTo(0,0);"><i class="c-icon c-icon-sm cil-chevron-double-up"></i></a>
            <button type="button" class="btn btn-sm btn-link text-primary" style="padding-top: 3px;" onclick="window.scrollTo(0,document.body.scrollHeight);"><i class="c-icon c-icon-sm cil-chevron-double-down"></i></a>
          </div>
        </div>
      </header>
      <!-- *** BODY *** -->
      <div class="c-body">
        <main class="c-main">
          <div class="container-fluid">
            <div class="fade-in">
              <div class="row">
                <div class="col-md-12">
                  <div class="card">
                    <div class="card-body">
                      <input type="text" id="data_len" value="{{data_len}}" hidden>
                      {% if ftype == 'MONTHLY' %}
                      <canvas id="monthly_chart" width="400" height="180"></canvas>
                      {% else %}
                      <canvas id="yearly_chart" width="400" height="180"></canvas>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
      <!-- *** FOOTER *** -->
      {% include 'footer.html' %}
    </div>
    <!-- CoreUI and necessary plugins-->
    <script src="{% static "vendors/@coreui/coreui-pro/js/coreui.bundle.min.js" %}"></script>
    <!--[if IE]><!-->
    <script src="{% static "vendors/@coreui/icons/js/svgxuse.min.js" %}"></script>
    <!--<![endif]-->
    <script src="{% static "vendors/jquery/js/jquery.min.js" %}"></script>
    <script src="{% static "vendors/select2/js/select2.min.js" %}"></script>
    <!-- Google Timeline JS -->
    <script src="{% static "vendors/google-timeline/js/loader.js" %}"></script>
    <!-- Data Table JS -->
    <script src="{% static "vendors/datatables.net/js/jquery.dataTables.js" %}"></script>
    <script src="{% static "vendors/datatables.net-bs4/js/dataTables.bootstrap4.min.js" %}"></script>
    <!-- Chart JS -->
    <!-- Charts -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/1.0.2/chartjs-plugin-annotation.min.js"></script> -->
    <script src="{% static "vendors/@coreui/chartjs/js/coreui-chartjs.bundle.js" %}"></script>
    <script src="{% static "js/charts.js" %}"></script>
    <!-- Custom -->
    <script src="{% static "customize/js/custom-function.js" %}"></script>
    <script src="{% static "customize/js/clock.js" %}"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function(event) {
        setTimeout(function() {
          document.body.classList.remove('c-no-layout-transition')
        }, 2000);
      });

      toggle();
      $(document).ready(function() {

      });

      $('#fwctype').change(function() {
        toggle();
        filter();
      });

      $('#fwc').change(function() {
        filter();
      });

      $('#fwcg').change(function() {
        filter();
      });

      $('#ftype').change(function() {
        toggle();
        filter();
      });

      $('#fmonth').change(function() {
        filter();
      });

      $('#fyear').change(function() {
        filter();
      });

      function toggle(){
        if($('#fwctype').val() == "WC"){
          $("#fwc").prop("hidden", false);
          $("#fwcg").prop("hidden", true);
        } else if($('#fwctype').val() == "WCG"){
          $("#fwc").prop("hidden", true);
          $("#fwcg").prop("hidden", false);
        }

        if($('#ftype').val() == "MONTHLY"){
          $("#fmonth").prop("hidden", false);
          $("#fyear").prop("hidden", true);
        } else if($('#ftype').val() == "YEARLY"){
          $("#fmonth").prop("hidden", true);
          $("#fyear").prop("hidden", false);
        }
      }

      function filter(){
        var fwctype = $("#fwctype").val();
        var fwc = ($("#fwc").val() != "" && fwctype == "WC")?$("#fwc").val():"FIRST";
        var fwcg = ($("#fwcg").val() != "" && fwctype == "WCG")?$("#fwcg").val():"FIRST";
        var ftype = $("#ftype").val();
        var fmonth = ($("#fmonth").val() != "" && ftype == "MONTHLY")?$("#fmonth").val():"NOW";
        var fyear = ($("#fyear").val() != "" && ftype == "YEARLY")?$("#fyear").val():"NOW";
        window.location.href = "/ab_graph/" + fwctype + "&" + fwc + "&" + fwcg + "&" + ftype + "&" + fmonth + "&" + fyear;
      }

    </script>
    <!-- OTHER FUNCTION -->
    <script>
      function getDataLen(){
        var arr = []
        for(i = 1;i <= parseInt($("#data_len").val());i++) arr.push(i);
        return arr;
      }

      function getDataRandom(){
        var arr = []
        for(i = 1;i <= parseInt($("#data_len").val());i++) arr.push(Math.floor(Math.random() * 12));
        return arr;
      }
    </script>
    {% if ftype == 'MONTHLY' %}
    <!-- MONTHLY GRAPH -->
    <script>
      const monthly_ctx = document.getElementById('monthly_chart').getContext('2d');
      const monthly_chart = new Chart(monthly_ctx, {
          type: 'bar',
          data: {
              labels: getDataLen(),
              datasets: [{
                  label: 'WORK',
                  data: getDataRandom(),
                  backgroundColor: 'rgb(46,184,92, 0.2)',
                  borderColor: 'rgb(46,184,92, 1)',
                  borderWidth: 1
              },{
                  label: 'SETUP',
                  data: getDataRandom(),
                  backgroundColor: 'rgb(157,208,77, 0.2)',
                  borderColor: 'rgb(157,208,77, 1)',
                  borderWidth: 1
              }]
          },
          options: {
            scales: {
              xAxes: [{
                  stacked: true,
              }],
              yAxes: [{
                  stacked: true,
                  ticks: {
                      beginAtZero: true,
                      max: 24,
                      min: 0,
                  }
              }],
            }
          }
      });
    </script>
    {% else %}
    <!-- YEARLY GRAPH -->
    <script>
      const yearly_ctx = document.getElementById('yearly_chart').getContext('2d');
      const yearly_chart = new Chart(yearly_ctx, {
          type: 'bar',
          data: {
              labels: ["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],
              datasets: [{
                  label: 'WORK',
                  data: getDataRandom(),
                  backgroundColor: 'rgb(46,184,92, 0.2)',
                  borderColor: 'rgb(46,184,92, 1)',
                  borderWidth: 1
              },{
                  label: 'SETUP',
                  data: getDataRandom(),
                  backgroundColor: 'rgb(157,208,77, 0.2)',
                  borderColor: 'rgb(157,208,77, 1)',
                  borderWidth: 1
              }]
          },
          options: {
            scales: {
              xAxes: [{
                  stacked: true,
              }],
              yAxes: [{
                  stacked: true,
                  ticks: {
                      beginAtZero: true,
                      max: 24,
                      min: 0,
                  }
              }],
            }
          }
      });
    </script>
    {% endif %}
  </body>
</html>
