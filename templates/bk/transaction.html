<!DOCTYPE html>
{% load static %}
{% load extra %}
<!--
* CoreUI Pro based Bootstrap Admin Template
* @version v3.2.0
* @link https://coreui.io/pro/
* Copyright (c) 2020 creativeLabs Łukasz Holeczek
* License (https://coreui.io/pro/license)
-->
<html lang="en">
  <head>
    <base href="./">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description" content="CoreUI - Open Source Bootstrap Admin Template">
    <meta name="author" content="Łukasz Holeczek">
    <meta name="keyword" content="Bootstrap,Admin,Template,Open,Source,jQuery,CSS,HTML,RWD,Dashboard">
    <title>Transaction | Shopfloor Reporting Application</title>
    <!-- Main styles for this application-->
    <link rel="stylesheet" href="{% static "css/style.css" %}">
    <!-- Icon CSS -->
    <link href="{% static "vendors/@coreui/icons/css/free.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/@coreui/icons/css/brand.min.css" %}" rel="stylesheet">
    <!-- Select CSS -->
    <link href="{% static "vendors/select2/css/select2.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/select2/css/select2-coreui.min.css" %}" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static "customize/css/decorate.css" %}" rel="stylesheet">
  </head>
  <body class="c-app c-no-layout-transition">
    <!-- *** LEFT SIDE BAR *** -->
    {% include 'sidebar.html' %}
    <div class="c-wrapper">
      <!-- *** HEADER *** -->
      <header class="c-header c-header-light c-header-fixed">
        {% include 'header.html' %}
        <div class="c-subheader justify-content-between px-3">
          <!-- Breadcrumb-->
          <ol class="breadcrumb border-0 m-0 px-0 px-md-3">
            <li class="breadcrumb-item">Transaction</li>
            {% if state != "FIRSTPAGE" %}
            <li class="breadcrumb-item active">
              {% if operationBefore != -1 %}<a href="/transaction/{{orderNo}}{{operationBefore}}" class="text-primary pt-1"><i class="c-icon cil-chevron-left"></i></a>&nbsp;{% endif %}
              <span id="bc_order_no">{{orderNo}}</span>&nbsp;-&nbsp;<span id="bc_operation_no">{{operationNo}}</span>
              {% if state == "DATAFOUND" %}
              <span>&nbsp;({{operation.WorkCenterNo}})</span>
              {% endif%}
              {% if operationAfter != -1 %}&nbsp;<a href="/transaction/{{orderNo}}{{operationAfter}}" class="text-primary pt-1"><i class="c-icon cil-chevron-right"></i></a>{% endif %}
            </li>
            {% endif %}
          </ol>
          {% if state == "DATAFOUND" %}
          <div class="c-subheader-nav small">
            <!-- <button type="button" class="btn btn-sm btn-pill btn-outline-danger" onclick="reset_all()">Reset All</button> -->
            <a href="/lot_traveller/{{orderNo}}&0" class="btn btn-sm btn-link">Partial Lot Traveller</a>
            |<button type="button" class="btn btn-sm btn-link" data-toggle="modal" data-target="#reset_order_modal">Reset Order</button>
            |<button type="button" class="btn btn-sm btn-link" data-toggle="modal" data-target="#cancel_order_modal">Cancel Order</button>
            |<button type="button" class="btn btn-sm btn-link" data-toggle="modal" data-target="#set_qty_modal">Set Operation Qty</button>
          </div>
          {% endif %}
          <div class="c-subheader-nav" {% if state != "FIRSTPAGE" %}hidden{% endif %}>
            <input type="password" hidden> <!-- Prevent Auto fill Password -->
            &nbsp;&nbsp;<div><i class="c-icon c-icon-lg cil-user"></i></div>&nbsp;&nbsp;
            <div style="width:50%"><input type="text" class="form-control form-control-sm" id="fp_operator_id" autocomplete="off"></div>
            &nbsp;&nbsp;<div><button type="button" class="btn btn-sm btn-pill btn-outline-info" onclick="fp_emp_search()">Go !</button></div>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          </div>
          <div class="c-subheader-nav mfe-2">
            <input type="password" hidden> <!-- Prevent Auto fill Password -->
            &nbsp;&nbsp;<div>Prod. Order - Oper. No</div>
            &nbsp;&nbsp;<div><input type="text" class="form-control form-control-sm" maxlength="10" id="sc_order_no" autocomplete="off" value="{{orderNo}}"></div>
            &nbsp;&nbsp;<div>-</div>&nbsp;&nbsp;
            <div style="width:15%"><input type="text" class="form-control form-control-sm" maxlength="4" id="sc_operation_no" autocomplete="off" value="{{operationNo}}"></div>
            &nbsp;&nbsp;<div><button type="button" class="btn btn-sm btn-pill btn-outline-info" onclick="shortcut_search()">Go !</button></div>
          </div>
        </div>
        <div class="progress" style="height: 4px; width: 100%">
          <progress style="width: 100%;" value="0" max="300" id="progressBar"></progress>
        </div>
      </header>
      <!-- *** BODY *** -->
      <div class="c-body">
        <main class="c-main">
          <div class="container-fluid">
            <div class="fade-in">
              <!-- Hidden Input -->
              <div hidden>
                <input type="text" id="has_data" value="{% if state == "DATAFOUND" %}True{% else %}False{% endif %}">
                <input type="text" id="is_operating" value="{{isOperating}}">
                <input type="text" id="workcenter_type" value="{{operation.WorkCenterType}}">
                <input type="text" id="join_list_length" value="{{joinList|length}}">
                <input type="text" id="is_joining" value="{% if operation.JoinToOrderNo != None %}True{% else %}False{% endif %}">
                <input type="text" id="has_report_time" value="{{hasReportTime}}">
                <input type="text" id="refresh_second" value="{{refreshSecond}}">
              </div>
              <!-- Main Body -->
              {% if state == "DATAFOUND" %}
              <div class="row" id="main_body">
                  <!-- Left Content -->
                  <div class="col-sm-12 col-md-4 p-0">
                    <div class="card border-secondary">
                      <!-- <div class="card-header text-right">
                        <i class="c-icon c-icon-sm cil-user"></i>
                      </div> -->
                      <div class="card-body px-1">
                        <!-- Quantity -->
                        <div class="row">
                          <div class="col text-right px-1">
                            <div class="ui-widget-info fade-in mb-3">
                              <h1 class="ui-value text-info"><strong><small>{{operation.ProcessQty.normalize}}</small></strong></h1>
                              <span class="ui-label text-info">Process</span>
                            </div>
                            <div class="ui-widget-warning fade-in">
                              <h1 class="ui-value text-warning"><strong><small>{{remainQty.normalize}}</small></strong></h1>
                              <span class="ui-label text-warning">Remain</span>
                            </div>
                          </div>
                          <div class="col text-left p-0">
                            <div class="ui-widget-success fade-in mb-3">
                              <h1 class="ui-value text-success"><strong><small>{{operation.AcceptedQty.normalize}}</small></strong></h1>
                              <span class="ui-label text-success">Accept</span>
                            </div>
                            <div class="ui-widget-danger fade-in">
                              <h1 class="ui-value text-danger"><strong><small>{{operation.RejectedQty.normalize}}</small></strong></h1>
                              <span class="ui-label text-danger">Reject</span>
                            </div>
                          </div>
                        </div>
                        <br>
                        <!-- Tab -->
                        <div class="nav-tabs-boxed">
                          <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item">
                              <a class="nav-link small" data-toggle="tab" href="#info-tab" role="tab">
                                {{operation.OperationNo}} ({{operation.WorkCenterNo}})
                              </a>
                            </li>
                            <li class="nav-item"><a class="nav-link small {% if not is_over_est_time %}active{% elif is_over_est_time and operation.OverEstNote|default_if_none:"" != "" %}active{% endif %}" data-toggle="tab" href="#rt-sheet-tab" role="tab">Routing Sheet ({{operationList|length}})</a></li>
                            <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#note-tab" role="tab">Note</a></li>
                            <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#history-tab" role="tab">History</a></li>
                            {% if is_over_est_time %}
                            <li class="nav-item"><a class="nav-link small {% if operation.OverEstNote|default_if_none:"" == "" %}active{% endif %}" data-toggle="tab" href="#over-est-tab" role="tab">{% if operation.OverEstNote|default_if_none:"" == "" %}<i class="cil cil-warning text-danger"></i>{% else %}<i class="cil cil-check-alt text-success"></i>{% endif %} Over Est. Time</a></li>
                            {% endif %}
                            {% if idleList|length > 0 %}
                            <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#idle-tab" role="tab">Idle</a></li>
                            {% endif %}
                            {% if overTimeOperatorList|length > 0 or overTimeWorkCenterList|length > 0 %}
                            <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#overtime-tab" role="tab">Overtime</a></li>
                            {% endif %}
                          </ul>
                          <div class="tab-content px-1">
                            <!-- Info Tab -->
                            <div class="tab-pane" id="info-tab" role="tabpanel">
                              <div class="nav-tabs-boxed">
                                <ul class="nav nav-tabs" role="tablist">
                                  <li class="nav-item"><a class="nav-link active small" data-toggle="tab" href="#operation-tab" role="tab">Operation</a></li>
                                  <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#order-tab" role="tab">Production Order</a></li>
                                  {% if bomList|length > 0 %}
                                  <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#bom-tab" role="tab">BOM</a></li>
                                  {% endif %}
                                </ul>
                              </div>
                              <div class="tab-content px-1">
                                <!-- Operation Tab -->
                                <div class="tab-pane small active" id="operation-tab" role="tabpanel">
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Prod. Order No</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="order_no" value="{{orderNo}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Operation No</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="operation_no" value="{{operationNo}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Operation Start</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="operation_start" value="{{operation.ProcessStart|default_if_none:""|date:"d-M-Y, H:i"}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Operation Stop</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="operation_stop" value="{{operation.ProcessStop|default_if_none:""|date:"d-M-Y, H:i"}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row" hidden>
                                    <label class="col-md-5 col-form-label text-right text-info"><strong>Process Qty</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="process_qty" value="{{operation.ProcessQty}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row" hidden>
                                    <label class="col-md-5 col-form-label text-right text-warning"><strong>Remain Qty</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="remain_qty" value="{{remainQty}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row" hidden>
                                    <label class="col-md-5 col-form-label text-right text-success"><strong>Accepted Qty</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="accepted_qty" value="{{operation.AcceptedQty}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row" hidden>
                                    <label class="col-md-5 col-form-label text-right text-danger"><strong>Rejected Qty</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="rejected_qty" value="{{operation.RejectedQty}}" readonly>
                                    </div>
                                  </div>
                                  <hr>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>WorkCenter/Routing</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="work_center" value="{{operation.WorkCenterNo|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>WorkCenterGroup</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="work_center_group" value="{{operation.WorkCenterGroup|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Plan Start</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="plan_start" value="{{operation.PlanStartDate|slice:'8:10'}}-{{operation.PlanStartDate|slice:'5:7'}}-{{operation.PlanStartDate|slice:'0:4'}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Plan Finish</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="plan_finish" value="{{operation.PlanFinishDate|slice:'8:10'}}-{{operation.PlanFinishDate|slice:'5:7'}}-{{operation.PlanFinishDate|slice:'0:4'}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Est. Setup Time / Unit</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="est_setup_time" value="{{operation.EstSetupTime.normalize}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Est. Operation Time / Unit</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="est_operate_time" value="{{operation.EstOperationTime.normalize}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Est. Labor Time / Unit</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="est_labor_time" value="{{operation.EstLaborTime.normalize}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Date Get From SAP</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="operation_date_get_from_sap" value="{{operation.DateGetFromSAP|default_if_none:'Created at SFR'|date:"d-M-Y, H:i"}}" readonly>
                                    </div>
                                  </div>
                                </div>
                                <!-- Production Order Tab -->
                                <div class="tab-pane small" id="order-tab" role="tabpanel">
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right text-primary"><strong>Prod. Order Qty</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="order_qty" value="{{order.ProductionOrderQuatity}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Order Start</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="order_start" value="{{order.ProcessStart|default_if_none:""|date:"d-M-Y, H:i"}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Order Stop</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="order_stop" value="{{order.ProcessStop|default_if_none:""|date:"d-M-Y, H:i"}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>FG Mat Code</strong></label>
                                    <div class="col-md-5">
                                      <input class="form-control form-control-sm" type="text" id="fg_material_code" value="{{order.FG_MaterialCode|default_if_none:""}}" readonly>
                                    </div>
                                    <label class="col-md-2 col-form-label">
                                      <a href="/drawing/{%if order.FG_Drawing == '' %}None{%else%}{{order.FG_Drawing}}{%endif%}&{%if order.FG_MaterialCode == ''%}None{%else%}{{order.FG_MaterialCode}}{%endif%}" target="_blank">
                                      See Drawing</a>
                                    </label>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>FG Drawing Dir</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="fg_drawing" value="{{order.FG_Drawing|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Customer PO No</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="customer_po_no" value="{{order.CustomerPONo|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Part No</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="part_no" value="{{order.PartNo|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Part Name</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="part_name" value="{{order.PartName|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Sales Order No</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="sale_order_no" value="{{order.SalesOrderNo|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Sales Create Date</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="sale_create_date" value="{{order.SalesCreateDate|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Sales Order Qty</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="sale_order_qty" value="{{order.SalesOrderQuantity|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>RM Mat Code</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="rm_material_code" value="{{order.RM_MaterialCode|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>MRP Controller</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="mrp_controller" value="{{order.MRP_Controller|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Request Date</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="request_date" value="{{order.RequestDate|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Release Date</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="release_date" value="{{order.ReleaseDate|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Drawing No</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="drawing_no" value="{{order.DrawingNo|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Routing Group</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="routing_group" value="{{order.RoutingGroup|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Routing Group Counter</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="routing_group_counter" value="{{order.RoutingGroupCounter|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Plant</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="plant" value="{{order.Plant|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Date Get From SAP</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="order_date_get_from_sap" value="{{order.DateGetFromSAP|default_if_none:""|date:"d-M-Y, H:i"}}" readonly>
                                    </div>
                                  </div>
                                </div>
                                <!-- BOM Tab -->
                                <div class="tab-pane small" id="bom-tab" role="tabpanel">
                                  <div class="form-group row">
                                    <table class="table table-sm table-responsive-sm table-outline text-center mx-3" width="100%">
                                      <thead class="bg-darkslategray">
                                        <tr>
                                          <th>RM_MaterialCode</th>
                                          <th>DateGetFromSAP</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        {% for bom in bomList %}
                                        <tr>
                                          <td>{{bom.RM_MaterialCode}}</td>
                                          <td>{{bom.DateGetFromSAP}}</td>
                                        </tr>
                                        {% endfor %}
                                      </tbody>
                                    </table>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <!-- Routing Sheet -->
                            <div class="tab-pane small {% if not is_over_est_time %}active{% elif is_over_est_time and operation.OverEstNote|default_if_none:"" != "" %}active{% endif %}" id="rt-sheet-tab" role="tabpanel">
                              <table class="table table-sm table-responsive-sm table-outline text-center">
                                <thead class="bg-darkslategray">
                                  <tr>
                                    <th>
                                      Status
                                      <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title="Tips"
                                      data-content="
                                      <strong class='text-success'>Complete</strong><br>
                                      <strong class='text-skyblue'>Complete (No Working Time Report)</strong><br>
                                      <strong class='text-yellowgreen'>Partial Complete</strong><br>
                                      <strong class='text-primary'>Joining</strong><br>
                                      <strong class='text-warning'>Working</strong><br>
                                      <strong class='text-info'>Ready</strong><br>
                                      <strong class='text-orangered'>Overtime</strong><br>
                                      <strong class='text-danger'>Error</strong><br>
                                      <strong class='text-dark'>Rejected</strong><br>
                                      ">?
                                      </a>
                                    </th>
                                    <th>Operation No</th>
                                    <th>Work Center</th>
                                    <th class="text-info">Process</th>
                                    <th class="text-success">Accepted</th>
                                    <th class="text-danger">Rejected</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  {% for item in operationList %}
                                  <tr {% if item.OperationNo.strip == operationNo %}class="bg-lavender"{% endif %}>
                                    <td>
                                      {% if item.WorkCenterNo == None %}<i class="c-icon c-icon-sm cib-discover text-danger pt-1" data-toggle="tooltip" data-original-title="Error"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'COMPLETE' %}<i class="c-icon c-icon-sm cib-discover text-success pt-1" data-toggle="tooltip" data-original-title="Complete"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'COMPLETE, NO WORKING TIME REPORT' %}<i class="c-icon c-icon-sm cib-discover text-skyblue pt-1" data-toggle="tooltip" data-original-title="Complete (No Working Time Report)"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'PARTIALCOMPLETE' %}<i class="c-icon c-icon-sm cib-discover text-yellowgreen pt-1" data-toggle="tooltip" data-original-title="Partial Complete"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'JOINING' %}<i class="c-icon c-icon-sm cib-discover text-primary pt-1" data-toggle="tooltip" data-original-title="Joining"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'WORKING' %}<i class="c-icon c-icon-sm cib-discover text-warning pt-1" data-toggle="tooltip" data-original-title="Working"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'READY' %}<i class="c-icon c-icon-sm cib-discover text-info pt-1" data-toggle="tooltip" data-original-title="Ready"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'OVERTIME' %}<i class="c-icon c-icon-sm cib-discover text-orangered pt-1" data-toggle="tooltip" data-original-title="Overtime"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'ERROR' %}<i class="c-icon c-icon-sm cib-discover text-danger pt-1" data-toggle="tooltip" data-original-title="Error"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'REJECTED' %}<i class="c-icon c-icon-sm cib-discover text-dark pt-1" data-toggle="tooltip" data-original-title="Rejected"></i>
                                      {% endif %}
                                    </td>
                                    <td>
                                      {% if item.OperationNo != operationNo %}
                                      <a href="/transaction/{{orderNo}}{{item.OperationNo}}">{{item.OperationNo}}</a>
                                      {% else %}
                                      {{item.OperationNo}}
                                      {% endif %}
                                    </td>
                                    <td>{{item.WorkCenterNo|default_if_none:""}}</td>
                                    <td>{%if item.ProcessQty.normalize != 0 %}{{item.ProcessQty.normalize}}{% endif %}</td>
                                    <td>{%if item.AcceptedQty.normalize != 0 %}{{item.AcceptedQty.normalize}}{% endif %}</td>
                                    <td>{%if item.RejectedQty.normalize != 0 %}{{item.RejectedQty.normalize}}{% endif %}</td>
                                  </tr>
                                  {% endfor %}
                                </tbody>
                              </table>
                            </div>
                            <!-- Note -->
                            <div class="tab-pane small" id="note-tab" role="tabpanel">
                              <table class="table table-sm table-responsive-sm table-outline text-center">
                                <thead class="bg-darkslategray">
                                  <tr>
                                    <th>Note</th>
                                    <th colspan="3" class="text-right">
                                      <button type="button" class="btn btn-sm btn-pill btn-link" onclick="open_note()" id="open_note_button"><strong><i class="c-icon c-icon-sm cil-pen text-warning"></i></strong></button>
                                      <button type="button" class="btn btn-sm btn-pill btn-link" onclick="save_note()" id="save_note_button" hidden><strong><i class="c-icon c-icon-sm cil-save text-success"></i></strong></button>
                                      <button type="button" class="btn btn-sm btn-pill btn-link" onclick="close_note()" id="close_note_button" hidden><strong><i class="c-icon c-icon-sm cil-x-circle text-danger"></i></strong></button>
                                      &nbsp;
                                    </th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr {% if item.OperationNo.strip == operationNo %}class="bg-lavender"{% endif %}>
                                    <td>Order</td>
                                    <td colspan="3"><textarea class="form-control" name="name" rows="2" cols="80" id="note_0" readonly>{{order.Note|default_if_none:""}}</textarea></td>
                                  </tr>
                                  {% for item in operationList %}
                                  <tr {% if item.OperationNo.strip == operationNo %}class="bg-lavender"{% endif %}>
                                    <td><strong>{{item.OperationNo}}</strong><br>{{item.WorkCenterNo}}</td>
                                    <td colspan="3"><textarea class="form-control" name="name" rows="2" cols="80" id="note_{{forloop.counter}}" readonly>{{item.Note|default_if_none:""}}</textarea></td>
                                  </tr>
                                  {% endfor %}
                                  <tr {% if item.OperationNo.strip == operationNo %}class="bg-lavender"{% endif %}>
                                    <td><b>Weight</b></td>
                                    <td><textarea class="form-control" name="name" rows="2" cols="80" id="note_weight" readonly>{{order.Weight|default_if_none:''}}</textarea></td>
                                    <!-- <td><input class="form-control" name="name" id="note_weight" value="{{order.Weight|default_if_none:''}}" readonly></td> -->
                                    <td><b>Size</b></td>
                                    <td><textarea class="form-control" name="name" rows="2" cols="80" id="note_size" readonly>{{order.Size|default_if_none:''}}</textarea></td>
                                    <!-- <td><input class="form-control" name="name" id="note_size" value="{{order.Size|default_if_none:''}}" readonly></td> -->
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                            <!-- Over Estimate Time Tab -->
                            <div class="tab-pane small {% if is_over_est_time and operation.OverEstNote|default_if_none:"" == "" %}active{% endif %}" id="over-est-tab" role="tabpanel">
                              <table class="table table-sm table-responsive-sm table-outline text-center">
                                <thead class="bg-darkslategray">
                                  <tr>
                                    <th></th>
                                    <th class="text-right">
                                      <button type="button" class="btn btn-sm btn-pill btn-link" onclick="open_over_est_note()" id="open_over_est_note_button"><strong><i class="c-icon c-icon-sm cil-pen text-warning"></i></strong></button>
                                      <button type="button" class="btn btn-sm btn-pill btn-link" onclick="save_over_est_note()" id="save_over_est_note_button" hidden><strong><i class="c-icon c-icon-sm cil-save text-success"></i></strong></button>
                                      <button type="button" class="btn btn-sm btn-pill btn-link" onclick="close_over_est_note()" id="close_over_est_note_button" hidden><strong><i class="c-icon c-icon-sm cil-x-circle text-danger"></i></strong></button>
                                      &nbsp;
                                    </th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr {% if item.OperationNo.strip == operationNo %}class="bg-lavender"{% endif %}>
                                    <td>Reason</td>
                                    <td><textarea class="form-control" name="name" rows="2" cols="80" id="over_est_note" readonly>{{operation.OverEstNote|default_if_none:""}}</textarea></td>
                                  </tr>
                                </tbody>
                              </table>

                              <table class="table table-sm table-responsive-sm table-outline text-center">
                                <thead class="bg-darkslategray">
                                  <tr>
                                    <th>Type</th>
                                    <th>Estimate</th>
                                    <th>Actual</th>
                                    <th>(Act/Est * 100) %</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr class="{% if actual_setup_time > est_setup_time_sum %}text-danger{% endif %}">
                                    <th>Setup</th>
                                    <td>{{est_setup_time_sum}}</td>
                                    <td>{{actual_setup_time}}</td>
                                    <td>{% if setup_time_percent != -1 %}{{setup_time_percent}}%{% endif %}</td>
                                  </tr>
                                  <tr class="{% if actual_oper_time > est_oper_time_sum %}text-danger{% endif %}">
                                    <th>Oper</th>
                                    <td>{{est_oper_time_sum}}</td>
                                    <td>{{actual_oper_time}}</td>
                                    <td>{% if oper_time_percent != -1 %}{{oper_time_percent}}%{% endif %}</td>
                                  </tr>
                                  <tr class="{% if actual_labor_time > est_labor_time_sum %}text-danger{% endif %}">
                                    <th>Labor</th>
                                    <td>{{est_labor_time_sum}}</td>
                                    <td>{{actual_labor_time}}</td>
                                    <td>{% if labor_time_percent != -1 %}{{labor_time_percent}}%{% endif %}</td>
                                  </tr>
                                  <tr class="{% if ai_time > est_oper_time_sum %}text-danger{% endif %}">
                                    <th>Oper + Idle</th>
                                    <td>{{est_oper_time_sum}}</td>
                                    <td>{{ai_time}}</td>
                                    <td>{% if setup_time_percent != -1 %}{{ai_time_percent}}%{% endif %}</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                            <!-- History Tab -->
                            <div class="tab-pane" id="history-tab" role="tabpanel">
                              <div class="nav-tabs-boxed">
                                <ul class="nav nav-tabs" role="tablist">
                                  <li class="nav-item"><a class="nav-link small active" data-toggle="tab" href="#operate-tab" role="tab" aria-controls="home">Operate {% if historyOperateList|length != 0 %}({{historyOperateList|length}}){% endif %}</a></li>
                                  <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#confirm-tab" role="tab" aria-controls="profile">Confirm {% if historyConfirmList|length != 0 %}({{historyConfirmList|length}}){% endif %}</a></li>
                                  <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#join-tab" role="tab" aria-controls="profile">Join {% if historyJoinList|length != 0 %}({{historyJoinList|length}}){% endif %}</a></li>
                                  <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#mod-tab" role="tab">Modified {% if modList|length != 0 %}({{modList|length}}){% endif %}</a></li>
                                  <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#toollist-tab" role="tab">Tool {% if historyToolList|length != 0 %}({{historyToolList|length}}){% endif %}</a></li>
                                </ul>
                              </div>
                              <div class="tab-content px-1">
                                <!-- Operate Tab -->
                                <div class="tab-pane active" id="operate-tab" role="tabpanel">
                                  {% if historyOperateList|length == 0 %}
                                  <h5 class="text-center mt-3">NO DATA</h5>
                                  {% else %}
                                  <table class="table table-sm table-responsive-sm table-outline small text-center">
                                    <thead class="bg-darkslategray">
                                      <tr>
                                        <th>Type
                                          <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title="Tips"
                                          data-content="
                                          <strong class='text-success'>Working</strong><br>
                                          <strong class='text-yellowgreen'>Setup</strong><br>
                                          <strong class='text-primary'>Manual Report</strong><br>
                                          <strong class='text-plum'>Ext-Work</strong><br>
                                          <strong class='text-dark'>Skip</strong><br>
                                          <strong class='text-warning'>Idle</strong><br>
                                          <strong style='color:#e5e5e5'>Auto Machine</strong><br>
                                          ">?
                                          </a>
                                        </th>
                                        <th>Operator</th>
                                        <th>Work Center</th>
                                        <th {% if operation.WorkCenterType == 'Labor' %} hidden {% endif %}>Setup</th>
                                        <th {% if operation.WorkCenterType == 'Labor' %} hidden {% endif %}>Oper</th>
                                        <th>Labor</th>
                                        <th {% if operation.WorkCenterType == 'Labor' %} hidden {% endif %}>Idle</th>
                                        <th>Start Time</th>
                                        <th>Finish Time</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      {% for operate in historyOperateList %}
                                      <tr>
                                        <td>
                                          {% if operate.Type.strip == 'IDLE' %}<i class="c-icon c-icon-sm cib-zalando pt-1 text-warning" data-toggle="tooltip" data-original-title="Idle"></i>
                                          {% elif operate.EmpID == None %}<i class="c-icon c-icon-sm cib-zalando pt-1" style="color:#e5e5e5" data-toggle="tooltip" data-original-title="Auto Machine">
                                          {% elif operate.Type.strip == 'WORKING' and operate.IsExternalProcess and operate.Setup == 0.00 and operate.Oper == 0.00 and operate.Labor == 0.00  %}<i class="c-icon c-icon-sm cib-zalando text-plum pt-1" data-toggle="tooltip" data-original-title="Ext-Work">
                                          {% elif operate.Type.strip == 'MANUAL' %}<i class="c-icon c-icon-sm cib-zalando text-primary pt-1" data-toggle="tooltip" data-original-title="Manual Report">
                                          {% elif operate.Setup == 0.00 and operate.Oper == 0.00 and operate.Labor == 0.00  %}<i class="c-icon c-icon-sm cib-zalando text-dark pt-1" data-toggle="tooltip" data-original-title="Skip">
                                          {% elif operate.Type.strip == 'WORKING' %}<span class="text-success"><i class="c-icon c-icon-sm cib-zalando text-success pt-1" data-toggle="tooltip" data-original-title="Working">
                                          {% elif operate.Type.strip == 'SETUP' %}<i class="c-icon c-icon-sm cib-zalando text-yellowgreen pt-1" data-toggle="tooltip" data-original-title="Setup">
                                          {% endif %}
                                        </td>
                                        <td><a href="/emp/{{operate.EmpID}}&NOW">{{operate.EmpID|default_if_none:""}}</a></td>
                                        <td><a href="/wc/{{operate.WorkCenterNo}}&NOW">{{operate.WorkCenterNo}}</a></td>
                                        <td {% if operation.WorkCenterType == 'Labor' %} hidden {% endif %}>{%if operate.Setup != 0.00 %}{{operate.Setup.normalize}}{% endif %}</td>
                                        <td {% if operation.WorkCenterType == 'Labor' %} hidden {% endif %}>{%if operate.Oper != 0.00 %}{{operate.Oper.normalize}}{% endif %}</td>
                                        <td>{%if operate.Labor != 0.00 %}{{operate.Labor.normalize}}{% endif %}</td>
                                        <td {% if operation.WorkCenterType == 'Labor' %} hidden {% endif %}>{%if operate.Idle != 0.00 %}{{operate.Idle.normalize}}{% endif %}</td>
                                        <td>{{operate.StartDateTime|date:"d-M-Y, H:i"}}</td>
                                        <td>
                                          {{operate.StopDateTime|date:"d-M-Y, H:i"}}
                                          {% if operate.Type.strip == 'IDLE' %}
                                          <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title="IdleType" data-content="{{operate.Description}}">?</a>
                                          {% endif %}
                                          {% if operate.Type.strip == 'MANUAL' %}
                                          <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title="ConfirmDateTime" data-content="{{operate.DateTimeStamp}}">?</a>
                                          {% endif %}
                                        </td>
                                      </tr>
                                      {% endfor %}
                                    </tbody>
                                  </table>
                                  {% endif %}
                                </div>
                                <!-- Confirm Tab -->
                                <div class="tab-pane" id="confirm-tab" role="tabpanel">
                                  {% if historyConfirmList|length == 0 %}
                                  <h5 class="text-center mt-3">NO DATA</h5>
                                  {% else %}
                                  <table class="table table-sm table-responsive-sm table-outline small text-center">
                                    <thead class="bg-darkslategray">
                                      <tr>
                                        <th>Operator</th>
                                        <th>Work Center</th>
                                        <th class="text-success">Accepted</th>
                                        <th class="text-danger">Rejected</th>
                                        <th>Reason</th>
                                        <th>Confirm Time</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      {% for confirm in historyConfirmList %}
                                      <tr>
                                        <td><a href="/emp/{{confirm.EmpID}}&NOW">{{confirm.EmpID}}</a></td>
                                        <td><a href="/wc/{{confirm.WorkCenterNo}}&NOW">{{confirm.WorkCenterNo}}</a></td>
                                        <td>{%if confirm.AcceptedQty != 0.00 %}{{confirm.AcceptedQty.normalize}}{% endif %}</td>
                                        <td>{%if confirm.RejectedQty != 0.00 %}{{confirm.RejectedQty.normalize}}{% endif %}</td>
                                        <td>
                                          {% if confirm.RejectReason.strip == 'SCRAP FROM PREVIOUS PROCESS' %}
                                            {% if confirm.OPN %}
                                              SCRAP FROM → {{confirm.OPN}} ({{confirm.WCN}})
                                            {% else %}
                                              {{confirm.RejectReason.strip}}
                                            {% endif %}
                                          {% else %}
                                            {{confirm.RejectReason}}
                                          {% endif %}
                                        </td>
                                        <td>{{confirm.ConfirmDateTime|date:"d-M-Y, H:i"}}</td>
                                      </tr>
                                      {% endfor %}
                                    </tbody>
                                  </table>
                                  {% endif %}
                                </div>
                                <!-- Join Tab -->
                                <div class="tab-pane" id="join-tab" role="tabpanel">
                                  {% if historyJoinList|length == 0 %}
                                  <h5 class="text-center mt-3">NO DATA</h5>
                                  {% else %}
                                  <table class="table table-sm table-responsive-sm table-outline small text-center">
                                    <thead class="bg-darkslategray">
                                      <tr>
                                        <th>Join To</th>
                                        <th>Join By</th>
                                        <th>Start</th>
                                        <th>Stop</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      {% for join in historyJoinList %}
                                      <tr>
                                        {% if orderNo == join.JoinToOrderNo and operationNo == join.JoinToOperationNo %}
                                        <td>{{join.JoinToOrderNo}} - {{join.JoinToOperationNo}}</td>
                                        <td><a href="/transaction/{{join.JoinByOrderNo}}{{join.JoinByOperationNo}}">{{join.JoinByOrderNo}} - {{join.JoinByOperationNo}}</a></td>
                                        {% elif orderNo == join.JoinByOrderNo and operationNo == join.JoinByOperationNo %}
                                        <td><a href="/transaction/{{join.JoinToOrderNo}}{{join.JoinToOperationNo}}">{{join.JoinToOrderNo}} - {{join.JoinToOperationNo}}</a></td>
                                        <td>{{join.JoinByOrderNo}} - {{join.JoinByOperationNo}}</td>
                                        {% endif %}
                                        <td>{{join.StartDateTime|date:"d-M-Y, H:i"}}</td>
                                        <td>{{join.StopDateTime|date:"d-M-Y, H:i"}}</td>
                                      </tr>
                                      {% endfor %}
                                    </tbody>
                                  </table>
                                  {% endif %}
                                </div>
                                <!-- Mod Tab -->
                                <div class="tab-pane" id="mod-tab" role="tabpanel">
                                  {% if modList|length == 0 %}
                                  <h5 class="text-center mt-3">NO DATA</h5>
                                  {% else %}
                                  <table class="table table-sm table-responsive-sm table-outline text-center small text-center">
                                    <thead class="bg-darkslategray">
                                      <tr>
                                        <th>Action</th>
                                        <th>Operation No</th>
                                        <th>EmpID</th>
                                        <th>ChiefID</th>
                                        <th>DateTimeStamp</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      {% for mod in modList %}
                                      <tr>
                                        <td class="
                                        {% if mod.Type == 'ADD' %}text-success
                                        {% elif mod.Type == 'CHANGE' %}text-warning
                                        {% elif mod.Type == 'DELETE' %}text-danger
                                        {% elif mod.Type == 'INC QTY' %}text-skyblue
                                        {% elif mod.Type == 'DEC QTY' %}text-lightpink
                                        {% endif %}">
                                          <strong>{{mod.Type}}</strong>
                                        </td>
                                        <td>{{mod.OperationNo}}</td>
                                        <td>{{mod.EmpID}}</td>
                                        <td>{{mod.ChiefID}}</td>
                                        <td>{{mod.ModifyDateTime|date:"d-M-Y, H:i"}}</td>
                                      </tr>
                                      {% endfor %}
                                    </tbody>
                                  </table>
                                  {% endif %}
                                </div>
                                <!-- Tool Tab -->
                                <div class="tab-pane" id="toollist-tab" role="tabpanel">
                                  {% if historyToolList|length == 0 %}
                                  <h5 class="text-center mt-3">NO DATA</h5>
                                  {% else %}
                                  <table class="table table-sm table-responsive-sm table-outline text-center small text-center">
                                    <thead class="bg-darkslategray">
                                      <tr>
                                        <th rowspan="2">WorkCenter</th>
                                        <th rowspan="2">No</th>
                                        <th rowspan="2">CT Code</th>
                                        <th rowspan="2">Tool No</th>
                                        <th rowspan="2">Confirmed Qty</th>
                                        <th colspan="2">Tool Life in Qty</th>
                                        <th colspan="2">Tool Life in Min</th>
                                        <th rowspan="2">InActiveReason</th>
                                      </tr>
                                      <tr>
                                        <th>Target</th>
                                        <th>%</th>
                                        <th>Target</th>
                                        <th>Actual</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      {% for tool in historyToolList %}
                                      <tr>
                                        <td>{{tool.WorkCenterNo}}</td>
                                        <td>{{tool.No}}</td>
                                        <td>{{tool.CTCode}}</td>
                                        <td>{{tool.ToolNo|default_if_none:""}}</td>
                                        <td>{{tool.ConfirmedQty}}</td>
                                        <td>{{tool.ToolLifeQty}}</td>
                                        <td>{{historyToolLifeQtyList|index:forloop.counter0}}%</td>
                                        <td>{{tool.ToolLifeMin}}</td>
                                        <td>{{historyToolLifeMinList|index:forloop.counter0}}</td>
                                        <td>{{tool.InActiveReason}}</td>
                                      </tr>
                                      {% endfor %}
                                    </tbody>
                                  </table>
                                  {% endif %}
                                </div>
                              </div>
                            </div>
                            <!-- Idle Tab -->
                            <div class="tab-pane small" id="idle-tab" role="tabpanel">
                              <table class="table table-sm table-responsive-sm table-outline text-center">
                                <thead class="bg-darkslategray">
                                  <tr>
                                    <th>Idle Type</th>
                                    <th>Duration (min)</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  {% for i in idleList %}
                                  <tr>
                                    <td>{{i.Description}}</td>
                                    <td>{{i.Idle|floatformat}}</td>
                                  </tr>
                                  {% endfor %}
                                  <tr>
                                    <th style="background-color: #d8dbe0;">Total</th>
                                    <th style="background-color: #d8dbe0;">{{total_idle_time|floatformat}}</th>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                            <!-- Overtime Tab -->
                            <div class="tab-pane small" id="overtime-tab" role="tabpanel">
                              {% if overTimeOperatorList|length > 0 %}
                              <h6>Operator</h6>
                              <table class="table table-sm table-responsive-sm table-outline text-center">
                                <thead class="bg-darkslategray">
                                  <tr>
                                    <th>EmpID</th>
                                    {% if operation.WorkCenterType == 'Machine' %}
                                    <th>WorkCenter</th>
                                    {% endif %}
                                    <th>Status</th>
                                    <th>StartDateTime</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  {% for ot in overTimeOperatorList %}
                                  <tr>
                                    <td><a href="/emp/{{ot.EmpID}}&NOW">{{ot.EmpID}}</a></td>
                                    {% if operation.WorkCenterType == 'Machine' %}
                                    <td><a href="/wc/{{ot.WorkCenterNo}}&NOW">{{ot.WorkCenterNo}}</a></td>
                                    {% endif %}
                                    <td>
                                      {% if ot.Status == 'WORKING' %}<span class="text-success"><strong>Working</strong></span>
                                      {% elif ot.Status == 'SETUP' %}<span class="text-yellowgreen"><strong>Setup</strong></span>
                                      {% else %}{{ot.Status}}{% endif %}
                                    </td>
                                    <td>{{ot.StartDateTime|date:"d-M-Y, H:i"}}</td>
                                  </tr>
                                  {% endfor %}
                                </tbody>
                              </table>
                              {% endif %}
                              {% if overTimeWorkCenterList|length > 0 %}
                              <h6>WorkCenter (Auto Machine)</h6>
                              <table class="table table-sm table-responsive-sm table-outline text-center">
                                <thead class="bg-darkslategray">
                                  <tr>
                                    <th>WorkCenter</th>
                                    <th>StartDateTime</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  {% for ot in overTimeWorkCenterList %}
                                  <tr>
                                    <td><a href="/wc/{{ot.WorkCenterNo}}&NOW">{{ot.WorkCenterNo}}</a></td>
                                    <td>{{ot.StartDateTime|date:"d-M-Y, H:i"}}</td>
                                  </tr>
                                  {% endfor %}
                                </tbody>
                              </table>
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Right Content -->
                  <div class="col-sm-12 col-md-8 pr-0">
                    <div class="row">
                      <!-- Button Group -->
                      <div class="col-md-6 text-left">
                        {% if isFirst and operation.ProcessStop == None %}
                        <button type="button" class="btn btn-xs bg-skyblue my-btn small btn-icon" data-toggle="modal" data-target="#inc_qty_modal" id="inc_qty_main_button" onclick="prepare_inc_qty()"><i class="c-icon cil-vertical-align-top"></i><br>Inc. Qty</button>
                        {% endif %}
                        {% if isFirst and operation.AcceptedQty == 0 and operation.RejectedQty == 0 %}
                        <button type="button" class="btn btn-xs bg-lightpink my-btn small btn-icon" data-toggle="modal" data-target="#dec_qty_modal" id="dec_qty_main_button" onclick="prepare_dec_qty()"><i class="c-icon cil-vertical-align-bottom"></i><br>Dec. Qty</button>
                        {% endif %}
                        {% if order.ProcessStop == None %}
                        <button type="button" class="btn btn-xs btn-success my-btn small btn-icon" data-toggle="modal" data-target="#add_modal" id="add_main_button" onclick="prepare_add()"><i class="c-icon cil-plus"></i><br>Add</button>
                        {% endif %}
                        {% if operation.ProcessStart == None and joinList|length == 0 and operation.JoinToOrderNo == None and operation.JoinToOperationNo == None %}
                        <button type="button" class="btn btn-xs btn-warning my-btn text-white small" data-toggle="modal" data-target="#change_modal" id="change_main_button" onclick="prepare_change()"><i class="c-icon cil-transfer"></i><br>Change</button>
                        {% endif %}
                        {% if operation.ProcessStart == None and joinList|length == 0 and operation.JoinToOrderNo == None and operation.JoinToOperationNo == None %}
                        <button type="button" class="btn btn-xs btn-danger my-btn small" data-toggle="modal" data-target="#delete_modal" id="delete_main_button" onclick="prepare_delete()"><i class="c-icon cil-trash"></i><br>Delete</button>
                        {% endif %}
                        <p></p>
                      </div>
                      <div class="col-md-6 text-right">
                        <a type="button" class="btn btn-xs btn-primary my-btn small" href="/join_activity/{{orderNo}}{{operationNo}}" id="join_main_button"><i class="c-icon cil-fullscreen-exit"></i><br>Join</a>
                        <button type="button" class="btn btn-xs btn-danger my-btn small" data-toggle="modal" data-target="#break_join_modal" id="break_join_main_button"><i class="c-icon cil-fullscreen"></i><br>Break Join</button>
                        {% if joinList|length > 0 %}
                        <button type="button" class="btn btn-xs btn-primary text-white my-btn small" data-toggle="modal" data-target="#join_list_modal" id="join_list_main_button"><i class="c-icon cil-list"></i><br>Join List</button>
                        {% endif %}
                        <a href="/transaction/0" class="btn btn-xs btn-dark my-btn small"><i class="c-icon cil-account-logout"></i><br>Exit</a>
                        <p></p>
                      </div>
                      {% if remainQty > 0 %}
                        <!-- WorkCenter/Operator -->
                        {% if operation.JoinToOrderNo == None and operation.JoinToOperationNo == None and operation.WorkCenterNo != None and isOvertime == False %}
                          <div class="col-md-12">
                            <div class="card border-secondary">
                              <div class="card-header">
                                <strong>Working Area</strong>
                                <div class="card-header-actions">
                                  {% if overTimeOperatorList|length != 0 or overTimeWorkCenterList|length != 0 or canMP or operation.WorkCenterGroup.strip == 'STD' %}
                                  <button class="btn btn-sm btn-link small" data-toggle="modal" data-target="#manual_report_modal" onclick="prepare_mp()" id="mp_main_button">Manual Report</button>
                                  {% endif %}
                                </div>
                              </div>
                              <div class="card-body px-1">
                                {% if operation.WorkCenterType == 'Machine' %}
                                <div class="form-group row">
                                  <label class="col-md-2 col-form-label text-right"><strong><i class="c-icon c-icon-sm cil-plus"></i> WorkCenter</strong></label>
                                  <div class="col-md-2">
                                    <input class="form-control" type="text" id="workcenter_no" autocomplete="off" value="" oninput="let p=this.selectionStart;this.value=this.value.toUpperCase();this.setSelectionRange(p, p);">
                                  </div>
                                  <div class="col-md-5">
                                    <input class="form-control" type="text" id="workcenter_name" value="" readonly>
                                  </div>
                                  <div class="col-md-2">
                                    <button type="button" class="btn btn-pill btn-info" id='workcenter_add_button' onclick="add_operating_workcenter()" disabled><i class="c-icon c-icon-sm cil-plus"></i> Add</button>
                                  </div>

                                </div>
                                <table class="table table-sm table-outline text-center" style="table-layout:fixed;" id="workcenter_table">
                                  <thead class="bg-darkslategray">
                                    <tr>
                                      <th><i class="c-icon cil-task"></i></th>
                                      <th><i class="c-icon cil-speedometer"></i></th>
                                      <th><i class="c-icon cil-speech"></i></th>
                                      <th><i class="c-icon cil-clock"></i></th>
                                      <th><i class="c-icon cil-options"></i></th>
                                    </tr>
                                  </thead>
                                  <tbody id="workcenter_table_body">

                                  </tbody>
                                </table>
                                {% endif %}
                                <div class="form-group row">
                                  <label class="col-md-2 col-form-label text-right"><strong><i class="c-icon c-icon-sm cil-plus"></i> Operator</strong></label>
                                  <div class="col-md-2">
                                    <input class="form-control" type="text" id="operator_id" autocomplete="off" value="">
                                  </div>
                                  <div class="col-md-5">
                                    <input class="form-control" type="text" id="operator_name" value="" readonly>
                                  </div>
                                  <div class="col-md-3">
                                    <button type="button" class="btn btn-pill {% if operation.IsExternalProcess %}bg-plum text-white{% else %}btn-success{% endif %}" id='operator_work_button' onclick="add_operating_operator('{% if operation.IsExternalProcess %}EXT-WORK{% else %}WORKING{% endif %}')" disabled><i class="c-icon c-icon-sm cil-power-standby"></i> Work</button>
                                    {% if operation.WorkCenterType == 'Machine' and joinList|length == 0 %}
                                    <button type="button" class="btn btn-pill bg-yellowgreen text-white" id='operator_setup_button' onclick="add_operating_operator('SETUP')" disabled><i class="c-icon c-icon-sm cil-power-standby"></i> Setup</button>
                                    {% endif %}
                                  </div>
                                </div>
                                <table class="table table-sm table-outline text-center" style="table-layout:fixed;" id="operator_table">
                                  <thead class="bg-darkslategray">
                                    <tr>
                                      <th><i class="c-icon cil-user"></i></th>
                                      {% if operation.WorkCenterType == 'Machine' %}<th><i class="c-icon cil-speedometer"></i></th>{% endif %}
                                      <th><i class="c-icon cil-speech"></i></th>
                                      <th><i class="c-icon cil-clock"></i></th>
                                      <th><i class="c-icon cil-options"></i></th>
                                    </tr>
                                  </thead>
                                  <tbody id="operator_table_body">

                                  </tbody>
                                </table>
                              </div>
                            </div>
                          </div>
                        {% endif %}
                        <!-- Overtime -->
                        {% if operation.JoinToOrderNo == None and operation.JoinToOperationNo == None and operation.WorkCenterNo != None and isOvertime == True %}
                          <div class="col-md-12">
                            <div class="card text-white text-center bg-orangered">
                              <div class="card-body text-center">
                                <br><br><br><br><br>
                                <h1><i class="c-icon c-icon-2xl cil-av-timer" style="font-size: 10rem; width: 10rem;"></i></h1>
                                <br>
                                <h3><strong>This Operation is Overtime</strong></h3>
                                <br>
                                <p>This operation exceed {{overtimehour}} hrs working time limit.<br>Please correct stop time manually.</p>
                                <button type="button" class="btn btn-pill btn-lg btn-dark small" onclick="fix_overtime()" id="fix_overtime_button"><strong>Fix Stop Time</strong></button>
                                <br><br><br><br>
                              </div>
                            </div>
                          </div>
                        {% endif %}
                        <!-- Joining -->
                        {% if operation.JoinToOrderNo != None and operation.JoinToOperationNo != None %}
                          <div class="col-md-12">
                            <div class="card text-white bg-primary text-center">
                              <div class="card-body text-center">
                                <br><br><br><br><br>
                                <h1><i class="c-icon c-icon-2xl cil-fork" style="font-size: 10rem; width: 10rem;"></i></h1>
                                <br>
                                <h3><strong>This Operation is Joining</strong></h3>
                                <br>
                                <a href="/transaction/{{operation.JoinToOrderNo}}{{operation.JoinToOperationNo}}" class="btn btn-pill btn-lg btn-dark small"><strong>&nbsp;&nbsp;&nbsp;GO TO JOIN OPERATION #{{operation.JoinToOrderNo}}-{{operation.JoinToOperationNo}}&nbsp;&nbsp;&nbsp;</strong></a>
                                <br><br><br><br><br>
                              </div>
                            </div>
                          </div>
                        {% endif %}
                      {% else %}
                        <!-- Complete Operation -->
                        {% if operation.ProcessQty != 0 %}
                          <div class="col-md-12">
                            <div class="card text-white bg-success text-center">
                              <div class="card-header">
                                <div class="card-header-actions">
                                  {% if canMP %}
                                  <button class="btn btn-sm btn-link text-white small" data-toggle="modal" data-target="#manual_report_modal" onclick="prepare_mp()" id="mp_main_button">Manual Report</button>
                                  {% endif %}
                                </div>
                              </div>
                              <div class="card-body text-center">
                                <br><br><br><br><br>
                                <h1>
                                  <i class="c-icon c-icon-2xl cil-check" style="font-size: 10rem; width: 10rem;"></i>
                                </h1>
                                <br>
                                <div class="row">
                                  {% if order.ProcessStop != None %}
                                  <div class="col-6">
                                    <h3><strong>This Order is Complete</strong></h3>
                                    <h6>Start Order : {{order.ProcessStart|date:"d-M-Y, H:i"}}</h6>
                                    <h6>Stop Order : {{order.ProcessStop|date:"d-M-Y, H:i"}}</h6>
                                  </div>
                                  {% endif %}
                                  <div class="{% if order.ProcessStop != None %}col-6{% else %}col-12{% endif %}">
                                    <h3><strong>This Operation is Complete</strong></h3>
                                    <h6>Start Process : {{operation.ProcessStart|date:"d-M-Y, H:i"}}</h6>
                                    <h6>Stop Process : {{operation.ProcessStop|date:"d-M-Y, H:i"}}</h6>
                                  </div>
                                </div>
                                <br>
                                {% if currentOperation != -1 %}
                                <a href="/transaction/{{orderNo}}{{currentOperation}}" class="btn btn-pill btn-lg btn-light small"><strong>&nbsp;&nbsp;&nbsp;Go To Current Operation #{{currentOperation}}&nbsp;&nbsp;&nbsp;</strong></a>
                                {% endif %}
                                <br><br><br><br>
                              </div>
                            </div>
                          </div>
                        {% endif %}
                        <!-- Waiting Operation -->
                        {% if operation.ProcessQty == 0 %}
                          <div class="col-md-12">
                            <div class="card text-white bg-dark text-center">
                              <div class="card-body text-center">
                                <br><br><br><br><br>
                                <h1><i class="c-icon c-icon-2xl cil-puzzle" style="font-size: 10rem; width: 10rem;"></i></h1>
                                <br>
                                {% if order.ProcessStop != None %}
                                <h3><strong>This Operation is Rejected</strong></h3>
                                {% else %}
                                <h3><strong>This Operation is Waiting</strong></h3>
                                {% endif %}
                                <br>
                                {% if currentOperation != -1 %}
                                <a href="/transaction/{{orderNo}}{{currentOperation}}" class="btn btn-pill btn-lg btn-light small"><strong>&nbsp;&nbsp;&nbsp;Go To Current Operation #{{currentOperation}}&nbsp;&nbsp;&nbsp;</strong></a>
                                {% endif %}
                                {% if order.ProcessStop != None %}
                                <h6>Start Order : {{order.ProcessStart|date:"d-M-Y, H:i"}}</h6>
                                <h6>Stop Order : {{order.ProcessStop|date:"d-M-Y, H:i"}}</h6>
                                {% endif %}
                                <br><br><br><br><br>
                              </div>
                            </div>
                          </div>
                        {% endif %}
                      {% endif %}

                      <!-- Tool List -->
                      {% if toolHeaderList %}
                      <div class="col-md-12">
                        <div class="card">
                          <div class="card-header">
                            <strong>Tool List</strong>
                          </div>
                          <div class="card-body">
                            <input type="text" id="toolh_id" hidden>
                            <input type="text" id="tooli_id" hidden>
                            <!-- Machine Tab -->
                            <div class="nav-tabs-boxed">
                              <ul class="nav nav-tabs" role="tablist">
                                {% for toolh in toolHeaderList %}
                                <li class="nav-item">
                                  <a class="nav-link small {% if forloop.counter0 == 0 %}active{% endif %}" data-toggle="tab" href="#tl-{{toolh.ID}}-tab" role="tab">
                                    {{toolh.WorkCenterNo}}
                                  </a>
                                </li>
                                {% endfor %}
                              </ul>
                            </div>
                            <div class="tab-content border px-1">
                              {% for toolh in toolHeaderList %}
                              {% with toolh_counter=forloop.counter0 %}
                              <div class="tab-pane py-2 {% if forloop.counter0 == 0 %}active{% endif %}" id="tl-{{toolh.ID}}-tab" role="tabpanel">
                                <div class="my-2">
                                  {% if not hasToolConfirmedQtyList|index:forloop.counter0 %}
                                  <button class="btn btn-info" data-toggle="modal" data-target="#change_tool_wc_modal" onclick="pre_toolh({{toolh.ID}})">Change WorkCenter</button>
                                  {% endif %}
                                  <button class="btn btn-success" data-toggle="modal" data-target="#add_new_tool_modal" onclick="pre_toolh({{toolh.ID}})">Add New Tool</button>
                                  <button class="btn btn-warning text-white" data-toggle="modal" data-target="#transfer_tool_modal" onclick="pre_toolh({{toolh.ID}})">Transfer</button>
                                  <button class="btn btn-danger" data-toggle="modal" data-target="#return_tool_all_modal" onclick="pre_toolh({{toolh.ID}})">Return All</button>
                                </div>
                                <!-- Detail Tab -->
                                <div class="nav-tabs-boxed">
                                  <ul class="nav nav-tabs" role="tablist">
                                    <li class="nav-item">
                                      <a class="nav-link small" data-toggle="tab" href="#toolh-{{toolh.ID}}-tab" role="tab">Header</a>
                                    </li>
                                    {% if toolStepLists|index:forloop.counter0 %}
                                    <li class="nav-item">
                                      <a class="nav-link small" data-toggle="tab" href="#tls-{{toolh.ID}}-tab" role="tab">Step</a>
                                    </li>
                                    {% endif %}
                                    <li class="nav-item">
                                      <a class="nav-link small active" data-toggle="tab" href="#tooli-{{toolh.ID}}-tab" role="tab">Item</a>
                                    </li>
                                  </ul>
                                </div>
                                <div class="tab-content border px-1">
                                  <!-- Tool List Header -->
                                  <div class="tab-pane py-2" id="toolh-{{toolh.ID}}-tab" role="tabpanel">
                                    <div class="row mt-3">
                                      <div class="form-group row col-6">
                                        <label class="col-md-5 col-form-label text-right"><strong>Drw. No./Part No.</strong></label>
                                        <div class="col-md-7">
                                          <input class="form-control form-control-sm" type="text" value="{{toolh.DrawingNo}}" readonly>
                                        </div>
                                      </div>
                                      <div class="form-group row col-6">
                                        <label class="col-md-5 col-form-label text-right"><strong>Tool List No.</strong></label>
                                        <div class="col-md-7">
                                          <input class="form-control form-control-sm" type="text" value="{{toolh.ToolListNo}}" readonly>
                                        </div>
                                      </div>
                                      <div class="form-group row col-6">
                                        <label class="col-md-5 col-form-label text-right"><strong>Drw. Rev./Part Rev.</strong></label>
                                        <div class="col-md-7">
                                          <input class="form-control form-control-sm" type="text" value="{{toolh.DrawingRev}}" readonly>
                                        </div>
                                      </div>
                                      <div class="form-group row col-6">
                                        <label class="col-md-5 col-form-label text-right"><strong>Tool List Rev.</strong></label>
                                        <div class="col-md-7">
                                          <input class="form-control form-control-sm" type="text" value="{{toolh.ToolListRev}}" readonly>
                                        </div>
                                      </div>
                                      <div class="form-group row col-6">
                                        <label class="col-md-5 col-form-label text-right"><strong>Part Name</strong></label>
                                        <div class="col-md-7">
                                          <input class="form-control form-control-sm" type="text" value="{{toolh.PartName}}" readonly>
                                        </div>
                                      </div>
                                      <div class="form-group row col-6">
                                        <label class="col-md-5 col-form-label text-right"><strong>Customer</strong></label>
                                        <div class="col-md-7">
                                          <input class="form-control form-control-sm" type="text" value="{{toolh.Customer}}" readonly>
                                        </div>
                                      </div>
                                      <div class="form-group row col-6">
                                        <label class="col-md-5 col-form-label text-right"><strong>Programmer</strong></label>
                                        <div class="col-md-7">
                                          <input class="form-control form-control-sm" type="text" value="{{toolh.Programmer}}" readonly>
                                        </div>
                                      </div>
                                      <div class="form-group row col-6">
                                        <label class="col-md-5 col-form-label text-right"><strong>File Location</strong></label>
                                        <div class="col-md-7">
                                          <input class="form-control form-control-sm" type="text" value="{{toolh.FileLocation}}" readonly>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  <!-- Tool List Step -->
                                  {% if toolStepLists|index:forloop.counter0 %}
                                  <div class="tab-pane py-2" id="tls-{{toolh.ID}}-tab" role="tabpanel">
                                    <table class="table table-sm table-outline small">
                                      <thead class="bg-darkslategray">
                                        <tr>
                                          <th>Step</th>
                                          <th>Operation</th>
                                          <th>Remark</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        {% for tls in toolStepLists|index:forloop.counter0 %}
                                        <tr>
                                          <td>{{tls.StepName}}</td>
                                          <td>{{tls.Operation}}</td>
                                          <td>{{tls.Remark}}</td>
                                        </tr>
                                        {% endfor %}
                                      </tbody>
                                    </table>
                                  </div>
                                  {% endif %}
                                  <!-- Tool List Item -->
                                  <div class="tab-pane py-2 active" id="tooli-{{toolh.ID}}-tab" role="tabpanel">
                                    <table class="table table-sm table-outline small text-center">
                                      <thead class="bg-darkslategray">
                                        <tr>
                                          <th rowspan="2">No</th>
                                          <th rowspan="2">CT Code</th>
                                          <th rowspan="2">Tool No</th>
                                          <th rowspan="2">Detail</th>
                                          <th rowspan="2">Confirmed Qty</th>
                                          <th colspan="2">Tool Life in Qty</th>
                                          <th colspan="2">Tool Life in Min</th>
                                          <th rowspan="2">Function</th>
                                        </tr>
                                        <tr>
                                          <th>Target</th>
                                          <th>%</th>
                                          <th>Target</th>
                                          <th>Actual</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        {% for tooli in toolItemLists|index:forloop.counter0 %}
                                        {% with tooli_counter=forloop.counter0 %}
                                        <tr>
                                          <td>{{tooli.No|floatformat}}</td>
                                          <td>{{tooli.CTCode1}}</td>
                                          <td>{{tooli.ToolNo|default_if_none:""}}</td>
                                          <td>
                                            <a tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title="Detail"
                                              data-content="
                                              <b>No</b> : {{tooli.No|floatformat}}<br>
                                              <b>CT Code</b> : {{tooli.CTCode1}}<br>
                                              <b>Tool Life in Qty</b> : {{tooli.ToolLifeQty}}<br>
                                              <b>Tool Life in Min</b> : {{tooli.ToolLifeMin}}<br>
                                              <b>Remark</b> : {{tooli.Remark}}<br>
                                              <hr>
                                              <b>Tool No</b> : {{tooli.ToolNo|default_if_none:''}}<br>
                                              <b>Type/Mat Desc</b> : {{tooli.Type|default_if_none:''}}<br>
                                              <b>Material</b> : {{tooli.Material|default_if_none:''}}<br>
                                              <b>Dia.</b> : {{tooli.Dia|default_if_none:''}}<br>
                                              <b>Flute</b> : {{tooli.Flute|default_if_none:''}}<br>
                                              <b>Holder MA-Code</b> : {{tooli.MACode|default_if_none:''}}<br>
                                              <b>Projection Length</b> : {{tooli.ProjLen|default_if_none:''}}<br>
                                              <b>Flute Length</b> : {{tooli.FluteLen|default_if_none:''}}<br>
                                              "><u>Detail</u>
                                            </a>
                                          </td>
                                          <td><b>{{tooli.ConfirmedQty}}</b></td>
                                          <td>{{tooli.ToolLifeQty}}</td>
                                          <td>{{toolLifeQtyLists|index:toolh_counter|index:tooli_counter}}%</td>
                                          <td>{{tooli.ToolLifeMin}}</td>
                                          <td>{{toolLifeMinLists|index:toolh_counter|index:tooli_counter}}</td>
                                          <td>
                                            <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#change_tool_modal" onclick="pre_tooli({{tooli.ID}})">Change</button>
                                            <button class="btn btn-danger btn-sm" data-toggle="modal" data-target="#return_tool_modal" onclick="pre_tooli({{tooli.ID}})">Return</button>
                                          </td>
                                        </tr>
                                        {% endwith %}
                                        {% endfor %}
                                      </tbody>
                                    </table>
                                  </div>
                                </div>
                              </div>
                              {% endwith %}
                              {% endfor %}
                            </div>
                          </div>
                        </div>
                      </div>
                      {% endif %}

                    </div>
                  </div>
                </div>
              {% endif%}
              <!-- Cancel Order -->
              {% if state == "CANCEL" %}
              <div class="row">
                <div class="col-md-12 text-center">
                  <br><br><br><br><br><br><br><br>
                  <h1><i class="c-icon c-icon-2xl cil-x-circle" style="font-size: 10rem; width: 10rem;"></i></h1>
                  <br>
                  <h1><strong>Canceled Production Order</strong></h1>
                  <br>
                  <p>
                    <strong>Production Order No</strong><br><span class="text-danger"><strong>{{orderNo}}</strong></span><br>
                    <strong>EmpID (Requester)</strong><br>
                    <span class="text-dark">{{cancelInfo.Requester|default_if_none:""}}
                      {% if cancelInfo.EmpName %}| {{cancelInfo.EmpName}} ({{cancelInfo.Section}} - {{cancelInfo.CostCenter}}) {% endif %}
                    </span><br>
                    <strong>Reason</strong><br><span class="text-dark">{{cancelInfo.Reason|default_if_none:""}}</span><br>
                    <strong>DateTimeStamp</strong><br><span class="text-dark">{{cancelInfo.DateTimeStamp}}</span>
                  </p>
                </div>
              </div>
              {% endif%}
              <!-- Not Found -->
              {% if state == "NODATAFOUND" or state == "NOOPERATIONFOUND" %}
              <div class="row">
                <div class="col-md-12 text-center">
                  <br><br><br><br><br><br><br><br>
                  <h1><i class="c-icon c-icon-2xl cil-ban" style="font-size: 10rem; width: 10rem;"></i></h1>
                  <br>
                  {% if state == "NODATAFOUND" %}
                  <h1><strong>Production Order No Not Found</strong></h1>
                  {% elif state == "NOOPERATIONFOUND" %}
                  <h1><strong>Operation Not Found</strong></h1>
                  {% endif %}
                  <p>
                    <strong>Production Order No</strong><br><span class="{% if state == "NODATAFOUND" %}text-danger{% else %}text-success{% endif %}"><strong><span id="nf_order_no">{{orderNo}}</span></strong></span>
                    <br>
                    <strong>Operation No</strong><br><span class="text-danger"><strong><span id="nf_operation_no">{{operationNo}}</span></strong></span>
                  </p>
                  {% if state == "NOOPERATIONFOUND" and currentOperation != -1 %}
                  <a href="/transaction/{{orderNo}}{{currentOperation}}" class="btn btn-pill btn-lg btn-dark small"><strong>&nbsp;&nbsp;&nbsp;Go To Current Operation #{{currentOperation}}&nbsp;&nbsp;&nbsp;</strong></a>
                  {% elif state == "NOOPERATIONFOUND" %}
                  <p class="text-danger">
                    This Production has only header, please try refresh (F5) once<br>
                    If this message show again please contact SFR Team<br>
                  </p>
                  {% endif %}
                </div>
              </div>
              {% endif%}
              <!-- First Page -->
              {% if state == "FIRSTPAGE" %}
              <div class="row">
                <div class="col-md-12">
                  <br><br><br>
                  <h1 class="text-center"><i class="c-icon c-icon-2xl cil-globe-alt" style="font-size: 10rem; width: 10rem;"></i></h1>
                  <br>
                  <h1 class="text-center"><strong>SHOPFLOOR REPORTING APPLICATION</strong></h1>
                  <h6 class="text-center"><a href="../media/SFR Manual.pdf" target="_blank">SFR MANUAL.PDF</a></h6>
                  <br><br><br>
                  <div class="row">
                    <div class="col-sm-1 col-md-2"></div>
                    <div class="col-sm-10 col-md-8">
                      <div class="card">
                        <div class="card-body small" style="height:240px; overflow:auto;">
                          {% include 'annoucement.html' %}
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-1 col-md-2"></div>
                  </div>
                </div>
              </div>
              {% endif %}
            </div>
          </div>
        </main>
      </div>
      <!-- *** FOOTER *** -->
      {% include 'footer.html' %}
      <!-- *** MODAL *** -->
      <div class="modal" id="inc_qty_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header bg-skyblue">
              <h4 class="modal-title"><i class="c-icon cil-vertical-align-top"></i> Increase Production Order Qty</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <small>การเพิ่มจำนวนชิ้นงานสามารถเพิ่มได้เฉพาะเมื่อ Process แรกยังไม่ได้ Confirm จำนวนครบ โดยจะต้องทำการแก้ไขใน SAP ด้วยตัวเองด้วย</small>
              <hr>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Employee ID</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="text" id="inc_qty_emp_id" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm my-password" type="text" id="inc_qty_password" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Increase Qty By</strong></label>
                <div class="col-md-3">
                  <input class="form-control form-control-sm" type="text" value="{{operation.ProcessQty.normalize}}" autocomplete="off" readonly>
                </div>
                <div class="col-md-1">
                  +
                </div>
                <div class="col-md-4">
                  <input class="form-control form-control-sm" type="text" id="inc_qty_amount" autocomplete="off">
                </div>
              </div>
              <div class="text-danger text-center small" id="inc_qty_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <small>Permission: Section Chief+</small>
              <button class="btn bg-skyblue" type="button" id="inc_qty_confirm_button" onclick="inc_qty()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="dec_qty_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header bg-lightpink">
              <h4 class="modal-title"><i class="c-icon cil-vertical-align-bottom"></i> Decrease Production Order Qty</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <small>การลดจำนวนชิ้นงานสามารถลดได้เฉพาะเมื่อ Process แรกยังไม่ได้ Confirm จำนวน โดยจะต้องทำการแก้ไขใน SAP ด้วยตัวเองด้วย</small>
              <hr>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Employee ID</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="text" id="dec_qty_emp_id" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm my-password" type="text" id="dec_qty_password" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Decrease Qty By</strong></label>
                <div class="col-md-3">
                  <input class="form-control form-control-sm" type="text" value="{{operation.ProcessQty.normalize}}" autocomplete="off" readonly>
                </div>
                <div class="col-md-1">
                  -
                </div>
                <div class="col-md-4">
                  <input class="form-control form-control-sm" type="text" id="dec_qty_amount" autocomplete="off">
                </div>
              </div>
              <div class="text-danger text-center small" id="dec_qty_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <small>Permission: Section Chief+</small>
              <button class="btn bg-lightpink" type="button" id="dec_qty_confirm_button" onclick="dec_qty()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="add_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-xl modal-success" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-plus"></i> Add Operation</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <div class="row">
                <div class="col-6">
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Employee ID</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="text" id="add_emp_id" autocomplete="off">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm my-password" type="text" id="add_password" autocomplete="off">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small">
                      <strong>New Operation No</strong>
                      <a class="badge badge-pill badge-secondary" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title="Conditions"
                      data-content="
                      1) Not Exist Number.<br>
                      2) Only After Working/Complete Operation.<br>
                      3) Never Deleted Number.<br>
                      ">!
                      </a>
                    </label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="text" id="add_new_operation_no" autocomplete="off" maxlength="4" value="">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Work Center</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="text" id="add_work_center_no" autocomplete="off" value="" oninput="let p=this.selectionStart;this.value=this.value.toUpperCase();this.setSelectionRange(p, p);">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Plan Start Date</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="date" id="add_plan_start_date" autocomplete="off">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Plan Finish Date</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="date" id="add_plan_finish_date" autocomplete="off">
                    </div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small">
                      <strong>Control Key</strong>
                      <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title="Conditions"
                      data-content="
                      PP01 - Internal Work Center<br>
                      PP02 - External Process
                      ">!
                      </a>
                    </label>
                    <div class="col-md-8">
                      <select class="form-control form-control-sm" id="add_control_key">
                        <option value="PP01" selected>(PP01) Routing/Ref. op. set - internal proc.</option>
                        <option value="PP02">(PP02) Routing/Ref. op. set - external proc.</option>
                      </select>
                    </div>
                  </div>
                  <div id="add_pp01">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Est. Setup Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="number" id="add_est_setup_time" autocomplete="off">
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Est. Operation Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="number" id="add_est_operate_time" autocomplete="off">
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Est. Labor Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="number" id="add_est_labor_time" autocomplete="off">
                      </div>
                    </div>
                    <small>* The estimated time accept a maximum of three digits. If the input exceeds three digits, the system will automatically correct it.</small>
                  </div>
                  <div id="add_pp02" hidden>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Planned Delivery Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="text" id="add_pdt" autocomplete="off" value="7" readonly>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Purchasing Org</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="text" id="add_purchasing_org" autocomplete="off" value="{{order.Plant}}" readonly>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Cost Element</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="text" id="add_cost_element" autocomplete="off" value="51202101" readonly>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Material Group</strong></label>
                      <div class="col-md-8">
                        <select class="form-control form-control-sm" id="add_mat_group">
                          {% for materialGroup in materialGroupList %}
                          {% if materialGroup.Code.strip == 'ZEXTERNAL' %}
                          <option value="{{materialGroup.Code}}">{{materialGroup.Code}} | {{materialGroup.Description}}</option>
                          {% endif %}
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Purchasing Group</strong></label>
                      <div class="col-md-8">
                        <select class="form-control form-control-sm" id="add_purchasing_group">
                          {% for purchaseGroup in purchaseGroupList %}
                          <option value="{{purchaseGroup.ID}}" {% if purchaseGroup.IsDefault %}selected{% endif %}>{{purchaseGroup.ID}} | {{purchaseGroup.Name}}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Price Unit</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="number" id="add_price_unit" autocomplete="off">
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Price</strong></label>
                      <div class="col-md-5">
                        <input class="form-control form-control-sm" type="number" id="add_price" autocomplete="off">
                      </div>
                      <div class="col-md-3">
                        <select class="form-control form-control-sm" id="add_currency">
                          {% for currency in currencyList %}
                          <option value="{{currency.Name}}" {% if currency.IsDefault %}selected{% endif %}>{{currency.Name}}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-12">
                  <small class="text-danger text-center" id="add_invalid_text"></small>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <small>Permission: Section Chief+</small>
              <button class="btn btn-success text-white" type="button" id="add_confirm_button" onclick="add()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="change_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-xl modal-warning" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-transfer"></i> Change Operation</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br>
              <div class="row">
                <div class="col-6">
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Employee ID</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="text" id="change_emp_id" autocomplete="off">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm my-password" type="text" id="change_password" autocomplete="off">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Work Center</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="text" id="change_work_center_no" autocomplete="off" value="" oninput="let p=this.selectionStart;this.value=this.value.toUpperCase();this.setSelectionRange(p, p);">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Plan Start Date</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="date" id="change_plan_start_date" autocomplete="off">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Plan Finish Date</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="date" id="change_plan_finish_date" autocomplete="off">
                    </div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small">
                      <strong>Control Key</strong>
                      <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title="Conditions"
                      data-content="
                      PP01 - Internal Work Center<br>
                      PP02 - External Process
                      ">!
                      </a>
                    </label>
                    <div class="col-md-8">
                      <select class="form-control form-control-sm" id="change_control_key">
                        <option value="PP01" selected>(PP01) Routing/Ref. op. set - internal proc.</option>
                        <option value="PP02">(PP02) Routing/Ref. op. set - external proc.</option>
                      </select>
                    </div>
                  </div>
                  <div id="change_pp01">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Est. Setup Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="number" id="change_est_setup_time" autocomplete="off">
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Est. Operation Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="number" id="change_est_operate_time" autocomplete="off">
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Est. Labor Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="number" id="change_est_labor_time" autocomplete="off">
                      </div>
                    </div>
                    <small>* The estimated time accept a maximum of three digits. If the input exceeds three digits, the system will automatically correct it.</small>
                  </div>
                  <div id="change_pp02" hidden>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Planned Delivery Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="text" id="change_pdt" autocomplete="off" value="7" readonly>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Purchasing Org</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="text" id="change_purchasing_org" autocomplete="off" value="{{order.Plant}}" readonly>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Cost Element</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="text" id="change_cost_element" autocomplete="off" value="51202101" readonly>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Material Group</strong></label>
                      <div class="col-md-8">
                        <select class="form-control form-control-sm" id="change_mat_group">
                          {% for materialGroup in materialGroupList %}
                          {% if materialGroup.Code.strip == 'ZEXTERNAL' %}
                          <option value="{{materialGroup.Code}}">{{materialGroup.Code}} | {{materialGroup.Description}}</option>
                          {% endif %}
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Purchasing Group</strong></label>
                      <div class="col-md-8">
                        <select class="form-control form-control-sm" id="change_purchasing_group">
                          {% for purchaseGroup in purchaseGroupList %}
                          <option value="{{purchaseGroup.ID}}" {% if purchaseGroup.IsDefault %}selected{% endif %}>{{purchaseGroup.ID}} | {{purchaseGroup.Name}}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Price Unit</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="number" id="change_price_unit" autocomplete="off" readonly>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Price</strong></label>
                      <div class="col-md-5">
                        <input class="form-control form-control-sm" type="number" id="change_price" autocomplete="off" readonly>
                      </div>
                      <div class="col-md-3">
                        <select class="form-control form-control-sm" id="change_currency" readonly>
                          {% for currency in currencyList %}
                          <option value="{{currency.Name}}" {% if currency.IsDefault %}selected{% endif %}>{{currency.Name}}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="text-danger text-center small" id="change_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <small>Permission: Section Chief+</small>
              <button class="btn btn-warning text-white" type="button" id="change_confirm_button" onclick="change()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="delete_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-danger" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-trash"></i> Delete Operation</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br><h3 class="text-center">Are you sure to delete this operation ?</h3><br>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Employee ID</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="text" id="del_emp_id" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm my-password" type="text" id="del_password" autocomplete="off">
                </div>
              </div>
              <div class="text-danger text-center small" id="del_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <small>Permission: Section Chief+</small>
              <button class="btn btn-danger" type="button" id="trash_confirm_button" onclick="trash()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="break_join_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-danger" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-fullscreen"></i> Break Join</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br><h3 class="text-center">Are you sure to break join activity ?</h3><br>
            </div>
            <div class="modal-footer">
              <button class="btn btn-danger" type="button" onclick="break_join()" id="break_now_button">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="join_list_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-primary" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-list"></i> Join List ({{joinList|length}})</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <table class="table table-sm table-responsive-sm table-outline text-center">
                <thead class="bg-darkslategray">
                  <tr>
                    <th>No</th>
                    <th>Prod. Order - Oper. No</th>
                  </tr>
                </thead>
                <tbody>
                  {% for join in joinList %}
                  <tr>
                    <td>{{forloop.counter}}</td>
                    <td><a href="/transaction/{{join.OrderNo}}{{join.OperationNo}}">{{join.OrderNo}} - {{join.OperationNo}}</a></td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="confirm_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg modal-primary" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-star"></i> Confirm</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <input type="text" id="confirm_id" hidden>
              <div class="col-md-12">
                <div class="form-group row">
                  <label class="col-md-3 col-form-label text-right"><strong>Operator</strong></label>
                  <div class="col-md-7">
                    <input class="form-control" type="text" id="confirm_operator" readonly>
                  </div>
                </div>
                {% if operation.WorkCenterType == 'Machine' %}
                <div class="form-group row">
                  <label class="col-md-3 col-form-label text-right"><strong>Work Center</strong></label>
                  <div class="col-md-7">
                    <input class="form-control" type="text" id="confirm_workcenter" readonly>
                  </div>
                </div>
                {% endif %}
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Start Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="confirm_start_time" readonly>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Stop Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="confirm_stop_time" readonly>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right text-success"><strong>Good Qty</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="good_qty" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right text-danger"><strong>Reject Qty</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="reject_qty" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-group row">
                      <label class="col-md-2 col-form-label text-right">
                        <strong>Reason</strong>
                        <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title=""data-content="<u>SCRAP FROM PREVIOUS PROCESS</u><br>Rejected quantity will not be reported to SAP.">!</a>
                      </label>
                      <div class="col-md-10">
                        <select class="form-control" id="reject_reason" {% if rejectReason.Name.strip == 'OTHER' or rejectReason.Name.strip == 'SCRAP FROM PREVIOUS PROCESS' %}class="text-primary"{% endif %}>
                          <option value="-1" selected>-</option>
                          {% for rejectReason in rejectReasonList %}
                          <option value="{{rejectReason.Name.strip}}">{{rejectReason.Name}}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" id="other_group" hidden>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Other</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="other_reason" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" id="scrap_at_group" hidden>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Scrap At</strong></label>
                      <div class="col-md-8">
                        <select class="form-control" id="scrap_at">
                          {% for opr in operationList %}
                            {% if opr.OperationNo < operation.OperationNo %}
                            <option value="{{opr.OperationNo}}">{{opr.OperationNo}} | {{opr.WorkCenterNo}}</option>
                            {% endif %}
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="text-danger text-center small" id="confirm_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" type="button" id="confirm_button" onclick="confirm()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="manual_report_modal" tabindex="-1" role="dialog">
       <div class="modal-dialog modal-xl modal-primary" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-clipboard"></i> Manual Report</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <div class="col-md-12">
                <div class="row">
                  <div class="col-md-5"><hr></div><div class="col-md-2 text-center"><strong>Work Time</strong></div><div class="col-md-5"><hr></div>
                  <div class="col-md-6"  {% if operation.WorkCenterType == 'Labor' %}hidden{% endif %}>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Work Center</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="mp_workcenter_no" autocomplete="off" oninput="let p=this.selectionStart;this.value=this.value.toUpperCase();this.setSelectionRange(p, p);" {% if operation.WorkCenterType.strip == 'Labor' %}value="{{operation.WorkCenterNo}}" readonly{% endif %}>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" {% if operation.WorkCenterType == 'Labor' %}hidden{% endif %}>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Setup (min)</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="mp_setup_time" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" {% if operation.WorkCenterType == 'Labor' %}hidden{% endif %}></div>
                  <div class="col-md-6" {% if operation.WorkCenterType == 'Labor' %}hidden{% endif %}>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Operate (min)</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="mp_operate_time" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Employee ID</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="mp_emp_id" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" {% if operation.IsExternalProcess %}hidden{% endif %}>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Labor (min)</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="mp_labor_time" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" {% if operation.IsExternalProcess == False %}hidden{% endif %}></div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Start Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="datetime-local" id="mp_start_time" onkeydown="return false">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Stop Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="datetime-local" id="mp_stop_time" onkeydown="return false">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-5"><hr></div><div class="col-md-2 text-center"><strong>Quantity</strong></div><div class="col-md-5"><hr></div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right text-success"><strong>Good Qty</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="mp_good_qty" autocomplete="off" {% if operation.ProcessStop != None and remainQty == 0 %}readonly{% endif %}>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right text-danger"><strong>Reject Qty</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="mp_reject_qty" autocomplete="off" {% if operation.ProcessStop != None and remainQty == 0 %}readonly{% endif %}>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right">
                        <strong>Reason</strong>
                      </label>
                      <div class="col-md-8">
                        <select class="form-control" id="mp_reject_reason" {% if operation.ProcessStop != None and remainQty == 0 %}readonly{% endif %}>
                          <option value="-1" selected>-</option>
                          {% for rejectReason in rejectReasonList %}
                          <option value="{{rejectReason.Name.strip}}" {% if rejectReason.Name.strip == 'OTHER' or rejectReason.Name.strip == 'SCRAP FROM PREVIOUS PROCESS' %}class="text-primary"{% endif %}>
                            {{rejectReason.Name}}
                          </option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" id="mp_other_group" hidden>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Other</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="mp_other_reason" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" id="mp_scrap_at_group" hidden>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Scrap At</strong></label>
                      <div class="col-md-8">
                        <select class="form-control" id="mp_scrap_at">
                          {% for opr in operationList %}
                            {% if opr.OperationNo < operation.OperationNo %}
                            <option value="{{opr.OperationNo}}">{{opr.OperationNo}} | {{opr.WorkCenterNo}}</option>
                            {% endif %}
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="text-danger text-center small" id="mp_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" type="button" id="mp_button" onclick="manual_report()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="reset_order_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-danger" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-loop-circular"></i> Reset Order</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm my-password" type="text" id="rso_password" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Start Operation</strong></label>
                <div class="col-md-8">
                  <select class="form-control form-control-sm" id="rso_start_operation_no">
                    {% for opr in operationList %}
                    <option value="{{opr.OperationNo}}">{{opr.OperationNo}} | {{opr.WorkCenterNo}}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="text-danger text-center small" id="rso_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <small>Permission: Administrator+</small>
              <button class="btn btn-danger" type="button" id="rso_confirm_button" onclick="reset_order()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="cancel_order_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header bg-darkslategray">
              <h4 class="modal-title"><i class="c-icon cil-x-circle"></i> Cancel Order</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm my-password" type="text" id="cc_password" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>EmpID (Requester)</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="text" id="cc_emp_id" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Reason</strong></label>
                <div class="col-md-8">
                  <textarea class="form-control" rows="3" cols="80" id="cc_reason"></textarea>
                </div>
              </div>
              <div class="text-danger text-center small" id="cc_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <small>Permission: Administrator+</small>
              <button class="btn bg-darkslategray text-white" type="button" id="cc_confirm_button" onclick="cancel_order()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="set_qty_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header bg-darkslategray">
              <h4 class="modal-title"><i class="c-icon cil-pen"></i> Set Operation Qty</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm my-password" type="text" id="sqty_password" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small text-info"><strong>Process Qty</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="number" id="sqty_process_qty" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small text-success"><strong>Accepeted Qty</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="number" id="sqty_accepted_qty" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small text-danger"><strong>Rejected Qty</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="number" id="sqty_rejected_qty" autocomplete="off">
                </div>
              </div>
              <div class="text-danger text-center small" id="sqty_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <small>Permission: Administrator+</small>
              <button class="btn bg-darkslategray text-white" type="button" id="sqty_confirm_button" onclick="sqty_operation()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="return_tool_all_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-danger" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Return All</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br><h3 class="text-center">Are you sure to return all tool list ?</h3><br>
              <div class="text-center">
                <small>* If the confirmed quantity is 0, it will not be counted as a used tool.</small>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-danger" type="button" onclick="return_tool_all()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="transfer_tool_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-warning" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Transfer Tool</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Prod. Order - Oper. No</strong></label>
                <div class="col-md-4">
                  <input class="form-control" type="text" maxlength="10" id="transfer_tool_order_no">
                </div>
                -
                <div class="col-md-3">
                  <input class="form-control" type="text" maxlength="4" id="transfer_tool_operation_no">
                </div>
              </div>
              <div class="text-center">
                <small id="transfer_tool_invalid_text" class="text-danger"></small>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-warning text-white" type="button" onclick="transfer_tool()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="return_tool_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-danger" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Return Tool</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br><h3 class="text-center">Are you sure to return this tool ?</h3><br>
              <div class="text-center">
                <small>* If the confirmed quantity is 0, it will not be counted as a used tool.</small>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-danger" type="button" onclick="return_tool()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="change_tool_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-primary" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Change Tool</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <!-- <br><h3 class="text-center">Are you sure to change this tool ?</h3><br> -->
              <div class="text-center">
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right">Change Type</label>
                  <div class="col-md-8 col-form-label">
                    <div class="form-check form-check-inline mr-1">
                      <input class="form-check-input" id="change_tool_change_type_same" type="radio" value="Same" name="change_tool_change_type" checked>
                      <label class="form-check-label" for="change_tool_change_type_same">Same Tool</label>
                    </div>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <div class="form-check form-check-inline mr-1">
                      <input class="form-check-input" id="change_tool_change_type_diff" type="radio" value="Diff" name="change_tool_change_type">
                      <label class="form-check-label" for="change_tool_change_type_diff">Different Tool</label>
                    </div>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right" for="text-input">Change Reason <span class="text-danger">*</span></label>
                  <div class="col-md-8">
                    <input class="form-control" type="text" id="change_tool_reason">
                  </div>
                </div>
                <div id="change_tool_diff_group" hidden>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right" for="text-input">CT Code <span class="text-danger">*</span></label>
                    <div class="col-md-8">
                      <input class="form-control" type="text" id="change_tool_ct_code" oninput="let p=this.selectionStart;this.value=this.value.toUpperCase();this.setSelectionRange(p, p);">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right" for="text-input">Tool No</label>
                    <div class="col-md-8">
                      <input class="form-control" type="text" id="change_tool_tool_no">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right" for="text-input">Tool Life in Qty</label>
                    <div class="col-md-8">
                      <input class="form-control" type="text" id="change_tool_tool_life_qty">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right" for="text-input">Tool Life in Min</label>
                    <div class="col-md-8">
                      <input class="form-control" type="number" id="change_tool_tool_life_min">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right" for="text-input">Remark</label>
                    <div class="col-md-8">
                      <textarea class="form-control" id="change_tool_remark" cols="30" rows="5"></textarea>
                    </div>
                  </div>
                </div>
                <div class="text-center">
                  <small id="change_tool_invalid_text" class="text-danger"></small>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" type="button" onclick="change_tool()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="change_tool_wc_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-info" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Change WorkCenter</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <div class="text-center">
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right" for="text-input">WorkCenter <span class="text-danger">*</span></label>
                  <div class="col-md-8">
                    <input class="form-control" type="text" id="change_tool_wc_no" oninput="let p=this.selectionStart;this.value=this.value.toUpperCase();this.setSelectionRange(p, p);">
                  </div>
                </div>
                <div class="text-center">
                  <small id="change_tool_wc_invalid_text" class="text-danger"></small>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-info" type="button" onclick="change_tool_wc()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="add_new_tool_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-success" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Add New Tool</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <div class="text-center">
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right" for="text-input">No <span class="text-danger">*</span></label>
                  <div class="col-md-8">
                    <input class="form-control" type="number" id="add_new_tool_no">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right" for="text-input">CT Code <span class="text-danger">*</span></label>
                  <div class="col-md-8">
                    <input class="form-control" type="text" id="add_new_tool_ct_code" oninput="let p=this.selectionStart;this.value=this.value.toUpperCase();this.setSelectionRange(p, p);">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right" for="text-input">Tool No</label>
                  <div class="col-md-8">
                    <input class="form-control" type="text" id="add_new_tool_tool_no">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right" for="text-input">Tool Life in Qty</label>
                  <div class="col-md-8">
                    <input class="form-control" type="text" id="add_new_tool_tool_life_qty">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right" for="text-input">Tool Life in Min</label>
                  <div class="col-md-8">
                    <input class="form-control" type="number" id="add_new_tool_tool_life_min">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right" for="text-input">Remark</label>
                  <div class="col-md-8">
                    <textarea class="form-control" id="add_new_tool_remark" cols="30" rows="5"></textarea>
                  </div>
                </div>

                <div class="text-center">
                  <small id="add_new_tool_invalid_text" class="text-danger"></small>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-success" type="button" onclick="add_new_tool()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <!-- *** RIGHT SIDE BAR *** -->
      {% include 'aside.html' %}
    </div>
    <!-- CoreUI and necessary plugins-->
    <script src="{% static "vendors/@coreui/coreui-pro/js/coreui.bundle.min.js" %}"></script>
    <!--[if IE]><!-->
    <script src="{% static "vendors/@coreui/icons/js/svgxuse.min.js" %}"></script>
    <!--<![endif]-->
    <script src="{% static "vendors/jquery/js/jquery.min.js" %}"></script>
    <!-- SELECT JS -->
    <script src="{% static "vendors/select2/js/select2.min.js" %}"></script>
    <!-- Popover JS -->
    <script src="{% static "js/popovers.js" %}"></script>
    <!-- Tooltips JS -->
    <script src="{% static "js/tooltips.js" %}"></script>
    <!-- Custom JS -->
    <script src="{% static "customize/js/custom-function.js" %}"></script>
    <script src="{% static "customize/js/clock.js" %}"></script>
    <!-- Data Table JS -->
    <script src="{% static "vendors/datatables.net/js/jquery.dataTables.js" %}"></script>
    <script src="{% static "vendors/datatables.net-bs4/js/dataTables.bootstrap4.min.js" %}"></script>
    <!-- MAIN -->
    <script>
      document.addEventListener("DOMContentLoaded", function(event) {
        setTimeout(function() {
          document.body.classList.remove('c-no-layout-transition')
        }, 2000);
      });

      var refresh_second = $("#refresh_second").val();
      var refresh_second_left = refresh_second;
      var downloadTimer = setInterval(function(){
        document.getElementById("progressBar").value = 300 - refresh_second_left;
        refresh_second_left -= ($("#has_data").val() == "True")?1:0;
        if(refresh_second_left == 0) window.location.href = '/transaction/0';
      }, 1000);

      window.addEventListener( "pageshow", function (event) {
        if (event.persisted || (typeof window.performance != "undefined" && window.performance.navigation.type === 2)) window.location.reload();
      });

      //-- INITIALIZE
      var isSearchingWorkCenter = false;
      var isSearchingOperator = false;
      var currentWorkCenterNo = null;
      var currentOperatorId = null;
      var operationListLength = parseInt('{{operationList|length}}');

      $(document).ready(function() {
        showTime();
        if($("#has_data").val() == "True" && $("#remain_qty").val() > 0){
          if($("#workcenter_type").val() == 'Machine') reload_workcenter_table();
          reload_operator_table();
        }
        dynamic_join();
      });
    </script>
    <!-- MAIN TABLE -->
    <script>
      $("#workcenter_no").on("change keyup", function() {
        var routing_no = $('#work_center').val();
        var routing_wcg = $('#work_center_group').val();
        $('#workcenter_name').val('');
        $('#workcenter_add_button').prop('disabled', true);
        remove_valid('workcenter_name');
        $('#workcenter_name').removeClass('text-danger');
        var workcenter_no = $('#workcenter_no').val();
        if(isSearchingWorkCenter == false && workcenter_no.length >= 3){
          isSearchingWorkCenter = true;
          $.ajax({
            url: '/get_workcenter_data/',
            data: {
              'routing_no': routing_no,
              'routing_wcg': routing_wcg,
              'workcenter_no': workcenter_no,
            },
            dataType: 'json',
            success: function (data) {
              if (data.canAdd) {
                currentWorkCenterNo = data.WorkCenterNo;
                $('#workcenter_name').val(data.WorkCenterNo+" | "+data.WorkCenterName);
                $('#workcenter_add_button').prop('disabled', false);
                valid('workcenter_name');
                $('#workcenter_name').addClass('text-success');
              } else {
                $('#workcenter_name').val(data.invalid_text);
                invalid('workcenter_name');
                $('#workcenter_name').addClass('text-danger');
              }
              isSearchingWorkCenter = false;
            }
          });
        }
      });

      $("#operator_id").on("change keyup", function() {
        $('#operator_name').val('');
        $('#operator_work_button').prop('disabled', true);
        $('#operator_setup_button').prop('disabled', true);
        remove_valid('operator_name');
        $('#operator_name').removeClass('text-danger');
        var operator_id = $('#operator_id').val();
        if(isSearchingOperator == false && operator_id.length >= 4){
          isSearchingOperator = true;
          $.ajax({
            url: '/get_operator_data/',
            data: {
              'operator_id': operator_id,
            },
            dataType: 'json',
            success: function (data) {
              if (data.canAdd) {
                $('#operator_work_button').prop('disabled', false);
                $('#operator_setup_button').prop('disabled', false);
                currentOperatorId = data.EmpID;
                currentOperatorName = data.EmpName;
                $('#operator_name').val(data.EmpID+" | "+data.EmpName+" ("+data.Section+")");
                valid('operator_name');
                $('#operator_name').addClass('text-success');
              } else {
                $('#operator_name').val(data.invalid_text);
                invalid('operator_name');
                $('#operator_name').addClass('text-danger');
              }
              isSearchingOperator = false;
            }
          });
        }
      });

      function create_workcenter_table(){
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        $.ajax({
          url: '/get_operating_workcenter_list/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
          },
          dataType: 'json',
          success: function (data) {
            var completed_count = 0;
            if(data.OWCList.length == 0){
              var row = "<tr><td colspan='5'>Please add workcenter above.</td></tr>";
              $("#workcenter_table_body").append(row);
            } else {
              for(var i = 0;i < data.OWCList.length;i++){
                var owc = data.OWCList[i];
                var row = "";
                // console.log(owc);
                for(var j = 0;j < owc.length;j++){
                  var owc_id = owc[0];
                  // var owc_workcenter_name = owc[1]+" | "+owc[2];
                  var owc_workcenter_name = owc[1];
                  var owc_startdatetime = owc[3];
                  var startdatetime = (owc_startdatetime == null)?"-":getFullDateTimeFromString(owc_startdatetime);
                  var owc_stopdatetime = owc[4];
                  var stopdatetime = (owc_stopdatetime == null)?"-":getFullDateTimeFromString(owc_stopdatetime);
                  var owc_status = $.trim(owc[5]);
                  var mc_type = $.trim(owc[6]);
                  var description = $.trim(owc[7]);
                  if(owc_status == "COMPLETE") {
                    completed_count++;
                    break;
                  }
                  row = "";
                  row += "<tr id='workcenter_row_"+owc_id+"'>";
                  row += "<td>";
                  if(owc_status != "SETUP" && owc_status != "IDLE"){
                    row += "<input type='radio' class='my-radio' name='workcenter_radio' value='"+owc_id+"' checked>";
                  }
                  row += "</td>";
                  row += "<td class='small'>"+owc_workcenter_name+"</td>";
                  row += (owc_status == "WAITING")?"<td class='font-weight-bold'>":"<td class='blink font-weight-bold'>";
                  row += owc_status;
                  if(owc_status == "IDLE"){
                    row += " ("+description+")";
                  }
                  row += "<input type='text' id='workcenter_status_"+owc_id+"' value='"+owc_status+"' hidden>";
                  row += "</td>";
                  row += "<td class='small'>";
                  if(owc_status == "WAITING"){
                    row += "<div></div>";
                  } else {
                    row += "<div><i class='c-icon c-icon-sm cil-power-standby text-success font-weight-bold'></i> "+startdatetime+"</div>";
                  }
                  row += "</td>";
                  row += "<td>";
                  if(owc_status == "WAITING"){
                    row += "<div class='btn-group'><button class='btn btn-sm btn-pill btn-warning text-white dropdown-toggle' id='idle_operating_workcenter_"+owc_id+"' type='button' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false'>Idle</button><div class='dropdown-menu bg-warning dropdown-menu-right' style='margin: 0px;'>";
                    {% for item in idleTypeList %}
                      row += "<button class='dropdown-item bg-warning text-white' onclick='idle_operating_workcenter("+owc_id+",{{item.Code}})'>● {{item.Description}}</button>";
                    {% endfor %}
                    row += "</div></div>&nbsp;";
                    row += "<button type='button' class='btn btn-sm btn-pill btn-dark small' id='delete_operating_workcenter_"+owc_id+"' onclick='delete_operating_workcenter("+owc_id+")'>Delete</button>";
                  } else if(owc_status == "IDLE"){
                    row += "<button type='button' class='btn btn-sm btn-pill btn-danger small' id='stop_idle_operating_workcenter_"+owc_id+"' onclick='stop_idle_operating_workcenter("+owc_id+")'>Stop Idle</button>";
                  } else if (owc_status == "WORKING" && mc_type == "Auto" && data.hasOperatorOperatingList[i] == false){
                    row += "<button type='button' class='btn btn-sm btn-pill btn-danger small' id='stop_operating_workcenter_"+owc_id+"' onclick='stop_operating_workcenter("+owc_id+")'>Stop Machine</button>";
                  }
                  row += "</td>";
                  row += "</tr>";
                }
                $("#workcenter_table_body").append(row);
                dynamic_operator_setup();
              }
              if(completed_count == data.OWCList.length){
                var row = "<tr><td colspan='5'>Please add workcenter above.</td></tr>";
                $("#workcenter_table_body").append(row);
              }
            }
            dynamic_operator_id();
          }
        });
      }

      function create_operator_table(){
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        var workcenter_type = $("#workcenter_type").val();
        $.ajax({
          url: '/get_operating_operator_list/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
          },
          dataType: 'json',
          success: function (data) {
            if(data.OOPRList.length == 0){
              var row = "<tr><td colspan='"+((workcenter_type == 'Machine')?5:4)+"'>Please add operator above.</td></tr>";
              $("#operator_table_body").append(row);
            } else {
              var expire_count = 0;
              for(var i = 0;i < data.OOPRList.length;i++){
                var oopr = data.OOPRList[i];
                var row = "";
                // console.log(oopr);
                for(var j = 0;j < oopr.length;j++){
                  var oopr_id = oopr[0];
                  // var oopr_workcenter_name = (oopr[1] == null)?null:oopr[1]+" | "+oopr[2];
                  var oopr_workcenter_name = (oopr[1] == null)?null:oopr[1];
                  var oopr_operator_id = oopr[3];
                  var oopr_operator_name = oopr[4];
                  var oopr_startdatetime = oopr[5];
                  var startdatetime = (oopr_startdatetime == null)?"-":getFullDateTimeFromString(oopr_startdatetime);
                  var oopr_stopdatetime = oopr[6];
                  var stopdatetime = (oopr_stopdatetime == null)?"-":getFullDateTimeFromString(oopr_stopdatetime);
                  var oopr_status = $.trim(oopr[7]);
                  if(oopr_status == "COMPLETE" && $('#remain_qty').val() > 0 && (new Date() - new Date(oopr_stopdatetime))/(24*3600*1000) > 1){
                    expire_count += 1;
                    break;
                  }
                  row = "";
                  row += "<tr id='operator_row_"+oopr_id+"'>";
                  row += "<td class='small'><b>"+oopr_operator_id+"</b><br>"+oopr_operator_name+"</td>";
                  row += (oopr_workcenter_name == null)? "":"<td class='small'>"+oopr_workcenter_name+"</td>";
                  row += (oopr_status == 'COMPLETE')?"<td class='text-success font-weight-bold'>":"<td class='blink font-weight-bold'>";
                  row += oopr_status+"</td>";
                  row += "<td class='small'>";
                  row += "<div> <i class='c-icon c-icon-sm cil-power-standby text-success font-weight-bold'></i> "+startdatetime+"</div>";
                  if(stopdatetime != "-"){
                    row += "<div> <i class='c-icon c-icon-sm cil-power-standby text-danger font-weight-bold'></i> "+stopdatetime+"</div>";
                  }
                  row += "</td>";
                  row += "<td>";
                  if(oopr_status == "WORKING" || oopr_status == "EXT-WORK"){
                    row += "<button type='button' class='btn btn-sm btn-pill btn-danger small' id='stop_work_operating_operator_"+oopr_id+"' onclick='stop_work_operating_operator("+oopr_id+")'>Stop Working</button>";
                  } else if (oopr_status == "SETUP"){
                    row += "<button type='button' class='btn btn-sm btn-pill btn-success small' id='start_work_operating_operator_"+oopr_id+"' onclick='start_work_operating_operator("+oopr_id+")'>Start Working</button><br>";
                    row += "<button type='button' class='btn btn-sm btn-pill btn-warning text-white small' id='stop_setup_operating_operator_"+oopr_id+"' onclick='stop_setup_operating_operator("+oopr_id+")'>Stop Setup & Exit</button>";
                  } else if (oopr_status == "COMPLETE" && $('#remain_qty').val() > 0){
                    if($('#join_list_length').val() == 0) {
                      if((new Date() - new Date(oopr_stopdatetime))/(24*3600*1000) > 1){
                        row += "<small class='text-muted'>EXPIRED</small>";
                      } else {
                        row += "<button type='button' class='btn btn-sm btn-pill btn-primary small' onclick='prepare_confirm("+oopr_id+")' data-toggle='modal' data-target='#confirm_modal'>Confirm</button>";
                      }
                    } else {
                      row += "<small class='text-danger'>BREAK JOIN TO CONFIRM</small>";
                    }
                  }
                  row += "</td>";
                  row += "</tr>";
                }
                $("#operator_table_body").append(row);
              }
              if(expire_count > 0){
                row += "<tr><td class='text-center' colspan='5'><small>" + expire_count + " Expired Records</small></td></tr>";
                $("#operator_table_body").append(row);
              }
            }
          }
        });
      }

      function reload_workcenter_table(){
        $("#workcenter_table > tbody").empty();
        create_workcenter_table();
        refresh_second_left = refresh_second;
      }

      function reload_operator_table(){
        $("#operator_table > tbody").empty();
        create_operator_table();
        refresh_second_left = refresh_second;
      }

      function add_operating_workcenter(){
        $('#workcenter_add_button').prop('disabled', true);
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        $.ajax({
          url: '/add_operating_workcenter/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
            'workcenter_no': currentWorkCenterNo,
          },
          dataType: 'json',
          success: function (data) {
            $('#workcenter_no').val("");
            $('#workcenter_name').val("");
            remove_valid('workcenter_name');
            reload_workcenter_table();
          }
        });
      }

      function delete_operating_workcenter(id){
        $('#delete_operating_workcenter_' + id).prop('disabled', true);
        $.ajax({
          url: '/delete_operating_workcenter/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            reload_workcenter_table();
            $('#operator_work_button').prop('disabled', true);
            $('#operator_setup_button').prop('disabled', true);
            $('#operator_id').val("");
            $('#operator_name').val("");
            remove_valid('operator_name');
          }
        });
      }

      function idle_operating_workcenter(id, code){
        $('#idle_operating_workcenter_' + id).prop('disabled', true);
        $.ajax({
          url: '/idle_operating_workcenter/',
          data: {
            'id': id,
            'code': code,
          },
          dataType: 'json',
          success: function (data) {
            reload_workcenter_table();
            $('#operator_work_button').prop('disabled', true);
            $('#operator_setup_button').prop('disabled', true);
            $('#operator_id').val("");
            $('#operator_name').val("");
            remove_valid('operator_name');
          }
        });
      }

      function stop_idle_operating_workcenter(id){
        $('#stop_idle_operating_workcenter_' + id).prop('disabled', true);
        $.ajax({
          url: '/stop_idle_operating_workcenter/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            reload_workcenter_table();
          }
        });
      }

      function stop_operating_workcenter(id){
        $('#stop_operating_workcenter_' + id).prop('disabled', true);
        $.ajax({
          url: '/stop_operating_workcenter/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            $("#is_operating").val(capitalizeFirstLetter(data.IsOperating.toString()));
            dynamic_join();
            reload_workcenter_table();
          }
        });
      }

      function add_operating_operator(status){
        $('#operator_work_button').prop('disabled', true);
        $('#operator_setup_button').prop('disabled', true);
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        var owc_id = -1;
        if ($('input[name="workcenter_radio"]').length > 0){
          owc_id = document.querySelector('input[name="workcenter_radio"]:checked').value;
        }
        $.ajax({
          url: '/add_operating_operator/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
            'operator_id': currentOperatorId,
            'owc_id': owc_id,
            'status': status,
          },
          dataType: 'json',
          success: function (data) {
            if(data.refresh) location.reload();
            $("#is_operating").val("True");
            dynamic_join();
            $('#operator_id').val("");
            $('#operator_name').val("");
            remove_valid('operator_name');
            if($("#workcenter_type").val() == 'Machine') reload_workcenter_table();
            reload_operator_table();
          }
        });
      }

      function start_work_operating_operator(id){
        $('#start_work_operating_operator_' + id).prop('disabled', true);
        $.ajax({
          url: '/start_work_operating_operator/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            $("#is_operating").val("True");
            dynamic_join();
            if($("#workcenter_type").val() == 'Machine') reload_workcenter_table();
            reload_operator_table();
          }
        });
      }

      function stop_setup_operating_operator(id){
        $('#stop_setup_operating_operator_' + id).prop('disabled', true);
        $.ajax({
          url: '/stop_setup_operating_operator/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            $("#is_operating").val(capitalizeFirstLetter(data.IsOperating.toString()));
            dynamic_join();
            if($("#workcenter_type").val() == 'Machine') reload_workcenter_table();
            reload_operator_table();
          }
        });
      }

      function stop_work_operating_operator(id){
        $('#stop_work_operating_operator_' + id).prop('disabled', true);
        $.ajax({
          url: '/stop_work_operating_operator/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            $("#is_operating").val(capitalizeFirstLetter(data.IsOperating.toString()));
            dynamic_join();
            if($("#workcenter_type").val() == 'Machine') reload_workcenter_table();
            reload_operator_table();
          }
        });
      }

      function break_join(){
        var order_no = $('#order_no').val();
        var operation_no = $('#operation_no').val();
        $.ajax({
          url: '/break_join/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
          },
          dataType: 'json',
          success: function (data) {
            location.reload();
          }
        });
      }
    </script>
    <!-- CONFIRM & MANUAL REPORT & FIX OVERTIME -->
    <script>
      function prepare_confirm(id){
        remove_valid_many(["good_qty","reject_qty","reject_reason","other_reason"]);
        $('#good_qty').val("");
        $('#reject_qty').val("");
        $('#reject_reason').val(-1);
        $('#other_reason').val("");
        $('#confirm_id').val(id);
        $("#scrap_at_group").prop("hidden", true);
        $('#confirm_button').prop('disabled', true);
        $.ajax({
          url: '/get_data_for_confirm/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            $('#confirm_operator').val(data.operator_text);
            $('#confirm_workcenter').val(data.workcenter_text);
            $('#confirm_start_time').val(data.start_time);
            $('#confirm_stop_time').val(data.stop_time);
            $('#confirm_button').prop('disabled', false);
            $('#good_qty').focus();
            refresh_second_left = refresh_second;
          }
        });
      }

      function prepare_mp(){
        remove_valid_many(["mp_emp_id","mp_workcenter_no","mp_labor_time","mp_operate_time","mp_setup_time","mp_start_time","mp_stop_time","mp_good_qty","mp_reject_qty","mp_reject_reason","mp_other_reason"]);
        $('#mp_emp_id').val("");
        if ($("#work_center_type") == 'Machine') $('#mp_workcenter_no').val("");
        $('#mp_labor_time').val("");
        $('#mp_operate_time').val("");
        $('#mp_setup_time').val("");
        $('#mp_start_time').val("");
        $('#mp_stop_time').val("");
        $('#mp_good_qty').val("");
        $('#mp_reject_qty').val("");
        $('#mp_reject_reason').val(-1);
        $('#mp_other_reason').val("");
        $("#mp_scrap_at_group").prop("hidden", true);
        $("#mp_invalid_text").text("");
        $('#mp_workcenter_no').focus();
        refresh_second_left = refresh_second;
      }

      function confirm(){
        $("#confirm_invalid_text").text("");
        if($('#good_qty').val() == "") $('#good_qty').val("0");
        if($('#reject_qty').val() == "") $('#reject_qty').val("0");
        var confirm_id = $('#confirm_id').val();
        var remain_qty = parseFloat($('#remain_qty').val());
        var good_qty = parseFloat($('#good_qty').val());
        var reject_qty = parseFloat($('#reject_qty').val());
        var reject_reason = $('#reject_reason').val();
        var other_reason = $('#other_reason').val();
        var scrap_at = $('#scrap_at').val();
        var canConfirm = false;
        remove_valid_many(["good_qty","reject_qty","reject_reason","other_reason"]);
        if(good_qty <= 0 && reject_qty <= 0){
          invalid("good_qty");
          invalid("reject_qty");
          $("#confirm_invalid_text").text("Good Qty + Reject Qty can not be 0.");
        } else {
          valid("good_qty");
          valid("reject_qty");
          if(remain_qty < good_qty + reject_qty) {
            invalid("good_qty");
            invalid("reject_qty");
            $("#confirm_invalid_text").text("Good Qty + Reject Qty can not be more than Remaining Qty.");
          } else {
            valid("good_qty");
            valid("reject_qty");
            if(reject_qty > 0 && reject_reason == -1) {
              invalid("reject_reason");
              $("#confirm_invalid_text").text("Please select reject reason.");
            } else {
              valid("reject_reason");
              if(reject_reason == "OTHER" && other_reason == "") {
                invalid("other_reason");
                $("#confirm_invalid_text").text("Please fill reason in other reason field.");
              } else {
                valid("other_reason");
                if(other_reason.includes("|")) {
                  invalid("other_reason");
                  $("#confirm_invalid_text").text("character | is not allow to use.");
                } else {
                  valid("other_reason");
                  canConfirm = true;
                }
              }
            }
          }
        }
        if(canConfirm) {
          $('#confirm_button').prop('disabled', true);
          $.ajax({
            url: '/confirm/',
            data: {
              'confirm_id': confirm_id,
              'good_qty': good_qty,
              'reject_qty': reject_qty,
              'reject_reason': reject_reason,
              'other_reason': other_reason,
              'scrap_at': scrap_at,
            },
            dataType: 'json',
            success: function (data) {
              location.reload();
            }
          });
        }
      }

      function manual_report(){
        //a
        if($('#mp_labor_time').val() == "") $('#mp_labor_time').val("0");
        if($('#mp_setup_time').val() == "") $('#mp_setup_time').val("0");
        if($('#mp_operate_time').val() == "") $('#mp_operate_time').val("0");
        if($('#mp_good_qty').val() == "") $('#mp_good_qty').val("0");
        if($('#mp_reject_qty').val() == "") $('#mp_reject_qty').val("0");
        //b
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        var workcenter_type = $('#workcenter_type').val();
        var emp_id = $('#mp_emp_id').val();
        var workcenter_no = $('#mp_workcenter_no').val();
        var labor_time = parseFloat($('#mp_labor_time').val());
        var operate_time = parseFloat($('#mp_operate_time').val());
        var setup_time = parseFloat($('#mp_setup_time').val());
        var start_time = new Date($('#mp_start_time').val());
        var stop_time = new Date($('#mp_stop_time').val());
        var remain_qty = parseFloat($('#remain_qty').val());
        var good_qty = parseFloat($('#mp_good_qty').val());
        var reject_qty = parseFloat($('#mp_reject_qty').val());
        var reject_reason = $('#mp_reject_reason').val();
        var other_reason = $('#mp_other_reason').val();
        var scrap_at = $('#mp_scrap_at').val();
        var isReportable = false;
        $("#mp_invalid_text").text("");
        remove_valid_many(["mp_emp_id","mp_workcenter_no","mp_labor_time","mp_operate_time","mp_setup_time","mp_start_time","mp_stop_time","mp_good_qty","mp_reject_qty","mp_reject_reason","mp_other_reason"]);
        //c
        validate_operator(emp_id, function(isExist, invalid_text2) {
          if(!isExist){
            invalid("mp_emp_id");
            $("#mp_invalid_text").text(invalid_text2);
          } else{
            valid("mp_emp_id");
            validate_work_center(workcenter_no, function(canUse, invalid_text3) {
              if(!canUse && workcenter_type != "Labor"){
                invalid("mp_workcenter_no");
                $("#mp_invalid_text").text(invalid_text3);
              } else{
                valid("mp_workcenter_no");
                if($('#mp_start_time').val() == ""){
                  invalid("mp_start_time");
                  $("#mp_invalid_text").text("Please fill Start Time.");
                } else {
                  valid("mp_start_time");
                  if($('#mp_stop_time').val() == ""){
                    invalid("mp_stop_time");
                    $("#mp_invalid_text").text("Please fill Stop Time.");
                  } else {
                    valid("mp_stop_time");
                    if(start_time >= stop_time){
                      invalid_many(["mp_start_time","mp_stop_time"]);
                      $("#mp_invalid_text").text("Start Time >= Stop Time.");
                    } else {
                      valid_many(["mp_start_time","mp_stop_time"]);
                      if(stop_time > Date.now()){
                        invalid_many(["mp_stop_time"]);
                        $("#mp_invalid_text").text("Stop Time > Present.");
                      } else {
                        valid_many(["mp_stop_time"]);
                        if(remain_qty < good_qty + reject_qty){
                          invalid_many(["mp_good_qty","mp_reject_qty"]);
                          $("#mp_invalid_text").text("Good Qty + Reject Qty can not be more than Remaining Qty.");
                        } else {
                          valid_many(["mp_good_qty","mp_reject_qty"]);
                          if(reject_qty > 0 && reject_reason == -1){
                            invalid("mp_reject_reason");
                            $("#mp_invalid_text").text("Please select reject reason.");
                          } else {
                            valid("mp_reject_reason");
                            if(reject_reason == "OTHER" && other_reason == ""){
                              invalid("mp_other_reason");
                              $("#mp_invalid_text").text("Please fill reason in other reason field.");
                            } else {
                              valid("mp_other_reason");
                              if(other_reason.includes("|")){
                                invalid("mp_other_reason");
                                $("#mp_invalid_text").text("character | is not allow to use.");
                              } else {
                                valid("mp_other_reason");
                                if(labor_time == 0 && operate_time == 0 && setup_time == 0 && good_qty == 0 && reject_qty == 0){
                                  invalid_many(["mp_labor_time","mp_operate_time","mp_setup_time","mp_good_qty","mp_reject_qty"]);
                                  $("#mp_invalid_text").text("At least one value need to be more than 0.");
                                } else {
                                  valid_many(["mp_labor_time","mp_operate_time","mp_setup_time","mp_good_qty","mp_reject_qty"]);
                                  if(labor_time > 9999){
                                    invalid("mp_labor_time");
                                    $("#mp_invalid_text").text("Labor Time is too large.");
                                  } else {
                                    valid("mp_labor_time");
                                    if(setup_time > 9999){
                                      invalid("mp_setup_time");
                                      $("#mp_invalid_text").text("Setup Time is too large.");
                                    } else {
                                      valid("mp_setup_time");
                                      if(operate_time > 9999){
                                        invalid("mp_operate_time");
                                        $("#mp_invalid_text").text("Operate Time is too large.");
                                      } else {
                                        valid("mp_operate_time");
                                        isReportable = true;
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
              if(isReportable){
                $('#mp_button').prop('disabled', true);
                $.ajax({
                  url: '/manual_report/',
                  data: {
                    'order_no': order_no,
                    'operation_no': operation_no,
                    'emp_id': emp_id,
                    'workcenter_no': workcenter_no,
                    'labor_time': labor_time,
                    'operate_time': operate_time,
                    'setup_time': setup_time,
                    'start_time': new Date(start_time).addHours(7).toISOString(),
                    'stop_time': new Date(stop_time).addHours(7).toISOString(),
                    'good_qty': good_qty,
                    'reject_qty': reject_qty,
                    'reject_reason': reject_reason,
                    'other_reason': other_reason,
                    'scrap_at': scrap_at,
                  },
                  dataType: 'json',
                  success: function (data) {
                    location.reload();
                  }
                });
              }
            });
          }
        });
      }

      function fix_overtime(){
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        $('#fix_overtime_button').prop('disabled', true);
        $.ajax({
          url: '/fix_overtime/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
          },
          dataType: 'json',
          success: function (data) {
            location.reload();
          }
        });
      }
    </script>
    <!-- MODIFIER -->
    <script>
      function clear_validate_inc_qty(){
        $("#inc_qty_invalid_text").text("");
        remove_valid_many(["inc_qty_emp_id","inc_qty_password","inc_qty_amount"]);
      }

      function clear_validate_dec_qty(){
        $("#dec_qty_invalid_text").text("");
        remove_valid_many(["dec_qty_emp_id","dec_qty_password","dec_qty_amount"]);
      }

      function clear_validate_add(){
        $("#add_invalid_text").text("");
        remove_valid_many(["add_emp_id","add_password","add_new_operation_no","add_work_center_no","add_plan_start_date","add_plan_finish_date","add_est_setup_time","add_est_operate_time","add_est_labor_time","add_price_unit","add_price"]);
      }

      function clear_validate_change(){
        $("#change_invalid_text").text("");
        remove_valid_many(["change_emp_id","change_password","change_work_center_no","change_plan_start_date","change_plan_finish_date","change_est_setup_time","change_est_operate_time","change_est_labor_time","change_price_unit","change_price"]);
      }

      function clear_validate_delete(){
        $("#del_invalid_text").text("");
        remove_valid_many(["del_emp_id","del_password"]);
      }

      function prepare_inc_qty(){
        clear_validate_inc_qty();
        emptyInputs(["inc_qty_emp_id","inc_qty_password","inc_qty_amount"]);
        $("#inc_qty_emp_id").focus();
        refresh_second_left = refresh_second;
      }

      function prepare_dec_qty(){
        clear_validate_dec_qty();
        emptyInputs(["dec_qty_emp_id","dec_qty_password","dec_qty_amount"]);
        $("#dec_qty_emp_id").focus();
        refresh_second_left = refresh_second;
      }

      function prepare_add(){
        clear_validate_add();
        emptyInputs(["add_emp_id","add_password","add_new_operation_no","add_work_center_no","add_plan_start_date","add_plan_finish_date","add_est_setup_time","add_est_operate_time","add_est_labor_time","add_price_unit","add_price"]);
        $("#add_price_unit").val("1");
        $("#add_price").val("1");
        $("#add_emp_id").focus();
        refresh_second_left = refresh_second;
      }

      function prepare_change(){
        clear_validate_change();
        emptyInputs(["change_emp_id","change_password","change_new_operation_no","change_work_center_no","change_plan_start_date","change_plan_finish_date","change_est_setup_time","change_est_operate_time","change_est_labor_time","change_price_unit","change_price"]);
        $("#change_price_unit").val("1");
        $("#change_price").val("1");
        $("#change_emp_id").focus();
        refresh_second_left = refresh_second;
      }

      function prepare_delete(){
        clear_validate_delete();
        emptyInputs(["del_emp_id","del_password"]);
        $("#del_emp_id").focus();
        refresh_second_left = refresh_second;
      }

      function add(){
        // a
        $("#add_new_operation_no").val(frontZero($("#add_new_operation_no").val(), 4));
        setZeroInputs(['add_est_setup_time','add_est_operate_time','add_est_labor_time','add_price_unit','add_price']);
        $('#add_price').val(roundToTwo($('#add_price').val()));
        // b
        var order_no = $("#order_no").val();
        var new_operation_no = $("#add_new_operation_no").val();
        var emp_id = $("#add_emp_id").val();
        var password = $("#add_password").val();
        var work_center_no = $("#add_work_center_no").val();
        var plan_start_date = $("#add_plan_start_date").val();
        var plan_finish_date = $("#add_plan_finish_date").val();
        var control_key = $("#add_control_key").val();
        var est_setup_time = parseFloat($('#add_est_setup_time').val()).toFixed(3);
        var est_operate_time = parseFloat($('#add_est_operate_time').val()).toFixed(3);
        var est_labor_time = parseFloat($('#add_est_labor_time').val()).toFixed(3);
        var pdt = $("#add_pdt").val();
        var purchasing_org = $("#add_purchasing_org").val();
        var cost_element = $("#add_cost_element").val();
        var mat_group = $("#add_mat_group").val();
        var purchasing_group = $("#add_purchasing_group").val();
        var price_unit = parseFloat($('#add_price_unit').val());
        var price = parseFloat($('#add_price').val());
        var currency = $('#add_currency').val();
        var isAddable = false;
        var isExternalProcess = false;
        clear_validate_add();
        // c
        validate_operator(emp_id, function(isCorrect, invalid_text) {
          if(!isCorrect){
            invalid("add_emp_id");
            $("#add_invalid_text").text(invalid_text);
          } else {
            valid("add_emp_id");
            validate_section_chief_password(password, function(isCorrect, invalid_text) {
              if(!isCorrect){
                invalid("add_password");
                $("#add_invalid_text").text(invalid_text);
              } else {
                valid("add_password");
                validate_new_operation(new_operation_no, function(canAdd, invalid_text) {
                  if(!canAdd) {
                    invalid("add_new_operation_no");
                    $("#add_invalid_text").text(invalid_text);
                  } else {
                    valid("add_new_operation_no");
                    validate_routing(work_center_no, function(canUse, invalid_text, isExt) {
                      isExternalProcess = isExt;
                      if(!canUse) {
                        invalid("add_work_center_no");
                        $("#add_invalid_text").text(invalid_text);
                      } else {
                        valid("add_work_center_no");
                        if(plan_start_date == ""){
                          invalid("add_plan_start_date");
                          $("#add_invalid_text").text("Please fill plant start date.");
                        } else {
                          valid("add_plan_start_date");
                          if(plan_finish_date == ""){
                            invalid("add_plan_finish_date");
                            $("#add_invalid_text").text("Please fill plant start date.");
                          } else {
                            valid("add_plan_finish_date");
                            if(plan_start_date > plan_finish_date){
                              invalid_many(["add_plan_start_date","add_plan_finish_date"]);
                              $("#add_invalid_text").text("Plan start date > plan finish date");
                            } else {
                              valid_many(["add_plan_start_date","add_plan_finish_date"]);
                              if(control_key == "PP01" && isExternalProcess){
                                invalid("add_control_key");
                                $("#add_invalid_text").text("This Work Center is an external process please choose PP02");
                              } else if(control_key == "PP02" && !isExternalProcess){
                                invalid("add_control_key");
                                $("#add_invalid_text").text("This Work Center is an internal process please choose PP01");
                              } else {
                                valid("add_control_key");
                                if(control_key == "PP01"){
                                  if($('#add_est_setup_time').val().split(".")[0].length > 6){
                                    invalid("add_est_setup_time");
                                    $("#add_invalid_text").text("Estimate setup time is too large.");
                                  } else {
                                    valid("add_est_setup_time");
                                    if($('#add_est_operate_time').val().split(".")[0].length > 6){
                                      invalid("add_est_operate_time");
                                      $("#add_invalid_text").text("Estimate operation time is too large.");
                                    } else {
                                      valid("add_est_operate_time");
                                      if($('#add_est_labor_time').val().split(".")[0].length > 6){
                                        invalid("add_est_labor_time");
                                        $("#add_invalid_text").text("Estimate labor time is too large.");
                                      }
                                      else {
                                        valid("add_est_labor_time");
                                        if(est_setup_time == 0 && est_operate_time == 0 && est_labor_time == 0){
                                          invalid_many(["add_est_setup_time","add_est_operate_time","add_est_labor_time"]);
                                          $("#add_invalid_text").text("Estimate Setup/Operate/Labor can not be all 0.");
                                        }
                                        else {
                                          valid_many(["add_est_setup_time","add_est_operate_time","add_est_labor_time"]);
                                          isAddable = true;
                                        }
                                      }
                                    }
                                  }
                                } else if(control_key == "PP02"){
                                  if(price_unit <= 0){
                                    invalid("add_price_unit");
                                    $("#add_invalid_text").text("Price unit can not be 0.");
                                  } else if($('#add_price_unit').val().length > 6){
                                    invalid("add_price_unit");
                                    $("#add_invalid_text").text("Price unit is too large.");
                                  } else {
                                    valid("add_price_unit");
                                    if(price <= 0){
                                      invalid("add_price");
                                      $("#add_invalid_text").text("Price can not be 0.");
                                    } else if($('#add_price').val().split(".")[0].length > 9){
                                      invalid("add_price");
                                      $("#add_invalid_text").text("Price is too large.");
                                    } else {
                                      valid("add_price");
                                      isAddable = true;
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                        if(isAddable){
                          $('#add_confirm_button').prop('disabled', true);
                          $.ajax({
                            url: '/add_operation/',
                            data: {
                              'order_no': order_no,
                              'new_operation_no': new_operation_no,
                              'emp_id': emp_id,
                              'password': password,
                              'work_center_no': work_center_no,
                              'control_key': control_key,
                              'plan_start_date': plan_start_date,
                              'plan_finish_date': plan_finish_date,
                              'est_setup_time': est_setup_time,
                              'est_operate_time': est_operate_time,
                              'est_labor_time': est_labor_time,
                              'pdt': pdt,
                              'purchasing_org': purchasing_org,
                              'cost_element': cost_element,
                              'mat_group': mat_group,
                              'purchasing_group': purchasing_group,
                              'price_unit': price_unit,
                              'price': price,
                              'currency': currency,
                            },
                            dataType: 'json',
                            success: function (data) {
                              window.location.href = "/transaction/" + order_no + new_operation_no;
                            }
                          });
                        } else {
                        }
                      }
                    });
                  }
                });
              }
            });
          }
        });
      }

      function change(){
        // a
        setZeroInputs(['change_est_setup_time','change_est_operate_time','change_est_labor_time','change_price_unit','change_price']);
        $('#change_price').val(roundToTwo($('#change_price').val()));
        // b
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        var emp_id = $("#change_emp_id").val();
        var password = $("#change_password").val();
        var work_center_no = $("#change_work_center_no").val();
        var plan_start_date = $("#change_plan_start_date").val();
        var plan_finish_date = $("#change_plan_finish_date").val();
        var control_key = $("#change_control_key").val();
        var est_setup_time = parseFloat($('#change_est_setup_time').val()).toFixed(3);
        var est_operate_time = parseFloat($('#change_est_operate_time').val()).toFixed(3);
        var est_labor_time = parseFloat($('#change_est_labor_time').val()).toFixed(3);
        var pdt = $("#change_pdt").val();
        var purchasing_org = $("#change_purchasing_org").val();
        var cost_element = $("#change_cost_element").val();
        var mat_group = $("#change_mat_group").val();
        var purchasing_group = $("#change_purchasing_group").val();
        var price_unit = parseFloat($('#change_price_unit').val());
        var price = parseFloat($('#change_price').val());
        var currency = $('#change_currency').val();
        var isChangable = false;
        clear_validate_change();
        // c
        validate_operator(emp_id, function(isCorrect, invalid_text) {
          if(!isCorrect){
            invalid("add_emp_id");
            $("#change_invalid_text").text(invalid_text);
          } else {
            valid("change_emp_id");
            validate_section_chief_password(password, function(isCorrect, invalid_text) {
              if(!isCorrect){
                invalid("change_password");
                $("#change_invalid_text").text(invalid_text);
              } else {
                valid("change_password");
                validate_routing(work_center_no, function(canUse, invalid_text, isExt) {
                  isExternalProcess = isExt;
                  if(!canUse) {
                    invalid("change_work_center_no");
                    $("#change_invalid_text").text(invalid_text);
                  } else {
                    valid("change_work_center_no");
                    if(plan_start_date == ""){
                      invalid("change_plan_start_date");
                      $("#change_invalid_text").text("Please fill plant start date.");
                    } else {
                      valid("change_plan_start_date");
                      if(plan_finish_date == ""){
                        invalid("change_plan_finish_date");
                        $("#change_invalid_text").text("Please fill plant start date.");
                      } else {
                        valid("change_plan_finish_date");
                        if(plan_start_date > plan_finish_date){
                          invalid_many(["change_plan_start_date","change_plan_finish_date"]);
                          $("#change_invalid_text").text("Plan start date > plan finish date");
                        } else {
                          valid_many(["change_plan_start_date","change_plan_finish_date"]);
                          if(control_key == "PP01" && isExternalProcess){
                            invalid("change_control_key");
                            $("#change_invalid_text").text("This Work Center is an external process please choose PP02");
                          } else if(control_key == "PP02" && !isExternalProcess){
                            invalid("change_control_key");
                            $("#change_invalid_text").text("This Work Center is an internal process please choose PP01");
                          } else {
                            valid("change_control_key");
                            if(control_key == "PP01"){
                              if($('#change_est_setup_time').val().split(".")[0].length > 6){
                                invalid("change_est_setup_time");
                                $("#change_invalid_text").text("Estimate setup time is too large.");
                              } else {
                                valid("change_est_setup_time");
                                if($('#change_est_operate_time').val().split(".")[0].length > 6){
                                  invalid("change_est_operate_time");
                                  $("#change_invalid_text").text("Estimate operation time is too large.");
                                } else {
                                  valid("change_est_operate_time");
                                  if($('#change_est_labor_time').val().split(".")[0].length > 6){
                                    invalid("change_est_labor_time");
                                    $("#change_invalid_text").text("Estimate labor time is too large.");
                                  }
                                  else {
                                    valid("change_est_labor_time");
                                    if(est_setup_time == 0 && est_operate_time == 0 && est_labor_time == 0){
                                      invalid_many(["change_est_setup_time","change_est_operate_time","change_est_labor_time"]);
                                      $("#change_invalid_text").text("Estimate Setup/Operate/Labor can not be all 0.");
                                    }
                                    else {
                                      valid_many(["change_est_setup_time","change_est_operate_time","change_est_labor_time"]);
                                      isChangable = true;
                                    }
                                  }
                                }
                              }
                            } else if(control_key == "PP02"){
                              if(price_unit <= 0){
                                invalid("change_price_unit");
                                $("#change_invalid_text").text("Price unit can not be 0.");
                              } else if($('#change_price_unit').val().length > 6){
                                invalid("change_price_unit");
                                $("#change_invalid_text").text("Price unit is too large.");
                              } else {
                                valid("change_price_unit");
                                if(price <= 0){
                                  invalid("change_price");
                                  $("#change_invalid_text").text("Price can not be 0.");
                                } else if($('#change_price').val().split(".")[0].length > 9){
                                  invalid("change_price");
                                  $("#change_invalid_text").text("Price is too large.");
                                } else {
                                  valid("change_price");
                                  isChangable = true;
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                    if(isChangable){
                      $('#change_confirm_button').prop('disabled', true);
                      $.ajax({
                        url: '/change_operation/',
                        data: {
                          'order_no': order_no,
                          'operation_no': operation_no,
                          'emp_id': emp_id,
                          'password': password,
                          'work_center_no': work_center_no,
                          'control_key': control_key,
                          'plan_start_date': plan_start_date,
                          'plan_finish_date': plan_finish_date,
                          'est_setup_time': est_setup_time,
                          'est_operate_time': est_operate_time,
                          'est_labor_time': est_labor_time,
                          'pdt': pdt,
                          'purchasing_org': purchasing_org,
                          'cost_element': cost_element,
                          'mat_group': mat_group,
                          'purchasing_group': purchasing_group,
                          'price_unit': price_unit,
                          'price': price,
                          'currency': currency,
                        },
                        dataType: 'json',
                        success: function (data) {
                          location.reload();
                        }
                      });
                    } else {
                    }
                  }
                });
              }
            });
          }
        });
      }

      function trash(){
        var order_no = $('#order_no').val();
        var operation_no = $('#operation_no').val();
        var emp_id = $("#del_emp_id").val();
        var password = $("#del_password").val();
        clear_validate_delete();
        validate_operator(emp_id, function(isCorrect, invalid_text) {
          if(!isCorrect){
            invalid("del_emp_id");
            $("#del_invalid_text").text(invalid_text);
          } else {
            valid("del_emp_id");
            validate_section_chief_password(password, function(isCorrect, invalid_text) {
              if(!isCorrect){
                invalid("del_password");
                $("#del_invalid_text").text(invalid_text);
              } else {
                valid("del_password");
                $('#trash_confirm_button').prop('disabled', true);
                $.ajax({
                  url: '/delete_operation/',
                  data: {
                    'order_no': order_no,
                    'operation_no': operation_no,
                    'emp_id' : emp_id,
                    'password': password,
                  },
                  dataType: 'json',
                  success: function (data) {
                    window.location.href = '/transaction/' + data.nextoolink;
                  }
                });
              }
            });
          }
        });
      }

      function inc_qty(){
        var order_no = $('#order_no').val();
        var operation_no = $('#operation_no').val();
        var emp_id = $("#inc_qty_emp_id").val();
        var password = $("#inc_qty_password").val();
        var amount = $("#inc_qty_amount").val();
        clear_validate_inc_qty();
        validate_operator(emp_id, function(isCorrect, invalid_text) {
          if(!isCorrect){
            invalid("inc_qty_emp_id");
            $("#inc_qty_invalid_text").text(invalid_text);
          } else {
            valid("inc_qty_emp_id");
            validate_section_chief_password(password, function(isCorrect, invalid_text) {
              if(!isCorrect){
                invalid("inc_qty_password");
                $("#inc_qty_invalid_text").text(invalid_text);
              } else {
                valid("inc_qty_password");
                if(amount == "" || amount == 0){
                  invalid("inc_qty_amount");
                  $("#inc_qty_invalid_text").text("Please fill amount correctly.");
                } else {
                  valid("inc_qty_amount");
                  $('#inc_qty_confirm_button').prop('disabled', true);
                  $.ajax({
                    url: '/inc_qty/',
                    data: {
                      'order_no': order_no,
                      'operation_no': operation_no,
                      'emp_id' : emp_id,
                      'password': password,
                      'amount' : amount,
                    },
                    dataType: 'json',
                    success: function (data) {
                      location.reload();
                    }
                  });
                }
              }
            });
          }
        });
      }

      function dec_qty(){
        var order_no = $('#order_no').val();
        var operation_no = $('#operation_no').val();
        var emp_id = $("#dec_qty_emp_id").val();
        var password = $("#dec_qty_password").val();
        var amount = $("#dec_qty_amount").val();
        clear_validate_dec_qty();
        validate_operator(emp_id, function(isCorrect, invalid_text) {
          if(!isCorrect){
            invalid("dec_qty_emp_id");
            $("#dec_qty_invalid_text").text(invalid_text);
          } else {
            valid("dec_qty_emp_id");
            validate_section_chief_password(password, function(isCorrect, invalid_text) {
              if(!isCorrect){
                invalid("dec_qty_password");
                $("#dec_qty_invalid_text").text(invalid_text);
              } else {
                valid("dec_qty_password");
                if(amount == "" || amount == 0){
                  invalid("dec_qty_amount");
                  $("#dec_qty_invalid_text").text("Please fill amount correctly.");
                } else {
                  valid("dec_qty_amount");
                  $('#dec_qty_confirm_button').prop('disabled', true);
                  $.ajax({
                    url: '/dec_qty/',
                    data: {
                      'order_no': order_no,
                      'operation_no': operation_no,
                      'emp_id' : emp_id,
                      'password': password,
                      'amount' : amount,
                    },
                    dataType: 'json',
                    success: function (data) {
                      location.reload();
                    }
                  });
                }
              }
            });
          }
        });
      }
    </script>
    <!-- NOTE -->
    <script>
      function open_note(){
        for(var i = 0;i <= operationListLength;i++){
          $("#note_" + i).prop("readonly", false);
        }
        $("#note_weight").prop("readonly", false);
        $("#note_size").prop("readonly", false);
        $("#save_note_button").prop("hidden", false);
        $("#close_note_button").prop("hidden", false);
        $("#open_note_button").prop("hidden", true);
      }

      function close_note(){
        for(var i = 0;i <= operationListLength;i++){
          $("#note_" + i).prop("readonly", true);
        }
        $("#note_weight").prop("readonly", true);
        $("#note_size").prop("readonly", true);
        $("#save_note_button").prop("hidden", true);
        $("#close_note_button").prop("hidden", true);
        $("#open_note_button").prop("hidden", false);
      }

      function save_note(){
        $("#save_note_button").prop("hidden", true);
        $("#close_note_button").prop("hidden", true);
        var order_no = $("#order_no").val();
        var order_note = $("#note_0").val();
        var operation_note_list = [];
        for(var i = 1;i <= operationListLength;i++){
          operation_note_list.push($("#note_" + i).val());
        }
        var weight = $("#note_weight").val();
        var size = $("#note_size").val();
        $.ajax({
          url: '/save_note/',
          data: {
            'order_no': order_no,
            'order_note': order_note,
            'operation_note_list': operation_note_list,
            'weight': weight,
            'size': size,
          },
          dataType: 'json',
          success: function (data) {
            location.reload();
          }
        });
      }
    </script>
    <!-- OVER EST. NOTE -->
    <script>
      function open_over_est_note(){
        $("#over_est_note").prop("readonly", false);
        $("#save_over_est_note_button").prop("hidden", false);
        $("#close_over_est_note_button").prop("hidden", false);
        $("#open_over_est_note_button").prop("hidden", true);
      }

      function close_over_est_note(){
        $("#over_est_note").prop("readonly", true);
        $("#save_over_est_note_button").prop("hidden", true);
        $("#close_over_est_note_button").prop("hidden", true);
        $("#open_over_est_note_button").prop("hidden", false);
      }

      function save_over_est_note(){
        $("#save_over_est_note_button").prop("hidden", true);
        $("#close_over_est_note_button").prop("hidden", true);
        var order_no = $("#order_no").val();
        var operation_no = $('#operation_no').val();
        var over_est_note = $("#over_est_note").val();
        $.ajax({
          url: '/save_over_est_note/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
            'over_est_note': over_est_note,
          },
          dataType: 'json',
          success: function (data) {
            location.reload();
          }
        });
      }
    </script>
    <!-- TOOL LIST -->
    <script>
      function pre_toolh(toolh_id){
        $('#toolh_id').val(toolh_id);
      }

      function pre_tooli(tooli_id){
        $('#tooli_id').val(tooli_id);
      }

      function return_tool_all(){
        var toolh_id = $('#toolh_id').val();
        $.ajax({
          url: '/return_tool_all/',
          data: {
            'toolh_id': toolh_id,
          },
          dataType: 'json',
          success: function (data) {
            location.reload();
          }
        });
      }

      function return_tool(){
        var tooli_id = $('#tooli_id').val();
        $.ajax({
          url: '/return_tool/',
          data: {
            'tooli_id': tooli_id,
          },
          dataType: 'json',
          success: function (data) {
            location.reload();
          }
        });
      }

      function transfer_tool(){
        remove_valid('transfer_tool_order_no');
        remove_valid('transfer_tool_operation_no');
        $("#transfer_tool_invalid_text").text("");
        fix_transfer_tool_prod_no();
        validate_transfer_tool(function(result) {
					if(result){
            var order_no =  $("#transfer_tool_order_no").val();
            var operation_no =  $("#transfer_tool_operation_no").val();
            var toolh_id = $('#toolh_id').val();
						$.ajax({
              url: '/transfer_tool/',
              data: {
                'order_no': order_no,
                'operation_no': operation_no,
                'toolh_id': toolh_id,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
					}
				});
      }

      function change_tool(){
        remove_valid('change_tool_reason');
        remove_valid('change_tool_ct_code');
        var tool_life_qty = $('#change_tool_tool_life_qty').val();
        var tool_life_min = $('#change_tool_tool_life_min').val();
        if(tool_life_qty == "") $('#change_tool_tool_life_qty').val(0);
        if(tool_life_min == "") $('#change_tool_tool_life_min').val(0);
        $("#change_tool_invalid_text").text("");
        var tooli_id = $('#tooli_id').val();
        var change_type = $('input[name=change_tool_change_type]:checked').val();
        var reason = $('#change_tool_reason').val();
        var ct_code = $('#change_tool_ct_code').val();
        var tool_no = $('#change_tool_tool_no').val();
        var tool_life_qty = $('#change_tool_tool_life_qty').val();
        var tool_life_min = $('#change_tool_tool_life_min').val();
        var remark = $('#change_tool_remark').val();
        if(reason == ""){
          $("#change_tool_invalid_text").text("Please give a reason.");
          return
        } else if (change_type == 'Diff' && ct_code == "") {
          $("#change_tool_invalid_text").text("Please give fill CT Code.");
        } else {
          $.ajax({
            url: '/change_tool/',
            data: {
              'tooli_id': tooli_id,
              'change_type': change_type,
              'reason': reason,
              'ct_code': ct_code,
              'tool_no': tool_no,
              'tool_life_qty': tool_life_qty,
              'tool_life_min': tool_life_min,
              'remark': remark,
            },
            dataType: 'json',
            success: function (data) {
              location.reload();
            }
          });
        }
      }

      function change_tool_wc(){
        remove_valid('change_tool_wc_no');
        $("#change_tool_wc_invalid_text").text("");
        validate_change_tool_wc(function(result) {
					if(result){
            var toolh_id = $('#toolh_id').val();
            var wc_no =  $("#change_tool_wc_no").val();
						$.ajax({
              url: '/change_tool_wc/',
              data: {
                'toolh_id': toolh_id,
                'wc_no': wc_no,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
					}
				});
      }

      function add_new_tool(){
        remove_valid('add_new_tool_no');
        remove_valid('add_new_tool_code');
        var tool_life_qty = $('#add_new_tool_tool_life_qty').val();
        var tool_life_min = $('#add_new_tool_tool_life_min').val();
        if(tool_life_qty == "") $('#add_new_tool_tool_life_qty').val(0);
        if(tool_life_min == "") $('#add_new_tool_tool_life_min').val(0);
        $("#add_new_tool_invalid_text").text("");
        validate_add_new_tool(function(result) {
					if(result){
            var toolh_id = $('#toolh_id').val();
            var no =  $("#add_new_tool_no").val();
            var ct_code =  $("#add_new_tool_ct_code").val();
            var tool_no = $('#add_new_tool_tool_no').val();
            var tool_life_qty =  $("#add_new_tool_tool_life_qty").val();
            var tool_life_min =  $("#add_new_tool_tool_life_min").val();
            var remark =  $("#add_new_tool_remark").val();
						$.ajax({
              url: '/add_new_tool/',
              data: {
                'toolh_id': toolh_id,
                'no': no,
                'ct_code': ct_code,
                'tool_no': tool_no,
                'tool_life_qty': tool_life_qty,
                'tool_life_min': tool_life_min,
                'remark': remark,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
					}
				});
      }

      function validate_transfer_tool(_callback){
        var order_no =  $("#transfer_tool_order_no").val();
        var operation_no =  $("#transfer_tool_operation_no").val();
        var toolh_id = $('#toolh_id').val();
        if(order_no.length < 6){
          $("#transfer_tool_invalid_text").text("Please fill at least 6 digit for Order No.");
          _callback(false);
        } else {
          $.ajax({
            url: '/validate_transfer_tool/',
            data: {
              'order_no': order_no,
              'operation_no': operation_no,
              'toolh_id': toolh_id,
            },
            dataType: 'json',
            success: function (data) {
              if(data.canUse){
                _callback(true);
              } else {
                $("#transfer_tool_invalid_text").text(data.invalidText);
                _callback(false);
              }
            }
          });
        }
      }

      function fix_transfer_tool_prod_no(){
        var order_no =  $("#transfer_tool_order_no").val();
        var operation_no =  frontZero($("#transfer_tool_operation_no").val(), 4);
        $("#transfer_tool_operation_no").val(operation_no);
      }

      function validate_change_tool_wc(_callback){
        var toolh_id = $('#toolh_id').val();
        var wc_no =  $("#change_tool_wc_no").val();
        if(wc_no.length == 0){
          $("#change_tool_wc_invalid_text").text("Please fill WorkCenter.");
          _callback(false);
        } else {
          $.ajax({
            url: '/validate_change_tool_wc/',
            data: {
              'toolh_id': toolh_id,
              'wc_no': wc_no,
            },
            dataType: 'json',
            success: function (data) {
              if(data.canUse){
                _callback(true);
              } else {
                $("#change_tool_wc_invalid_text").text(data.invalidText);
                _callback(false);
              }
            }
          });
        }
      }

      function validate_add_new_tool(_callback){
        var toolh_id = $('#toolh_id').val();
        var no =  $("#add_new_tool_no").val();
        var ct_code =  $("#add_new_tool_ct_code").val();
        if(no.length == 0 || no == '0'){
          $("#add_new_tool_invalid_text").text("Please fill No and No can not be zero.");
          _callback(false);
        } else if(ct_code.length == 0){
          $("#add_new_tool_invalid_text").text("Please fill CT Code.");
          _callback(false);
        } else {
          $.ajax({
            url: '/validate_add_new_tool/',
            data: {
              'toolh_id': toolh_id,
              'no': no,
            },
            dataType: 'json',
            success: function (data) {
              if(data.canUse){
                _callback(true);
              } else {
                $("#add_new_tool_invalid_text").text(data.invalidText);
                _callback(false);
              }
            }
          });
        }
      }
    </script>
    <!-- VALIDATION -->
    <script>
      //-- VALIDATION
      function validate_new_operation(new_operation_no, _callback){
        var order_no = $("#order_no").val();
        if(new_operation_no == "0000") _callback(false, "This Operation No is not available.");
        else {
          $.ajax({
            url: '/validate_new_operation/',
            data: {
              'order_no': order_no,
              'new_operation_no': new_operation_no,
            },
            dataType: 'json',
            success: function (data) {
              (data.canAdd)? _callback(true, ""):_callback(false, "This Operation No is not available.");
            }
          });
        }
      }

      function validate_routing(work_center_no, _callback){
        if(work_center_no.length < 2) _callback(false, "Routing not found.", false);
        else {
          $.ajax({
            url: '/validate_routing/',
            data: {
              'work_center_no': work_center_no,
            },
            dataType: 'json',
            success: function (data) {
              (data.canUse)? _callback(true, "", data.isExt):_callback(false, data.invalidText, false);
            }
          });
        }
      }

      function validate_work_center(work_center_no, _callback){
        var work_center_group = $("#work_center_group").val();
        if(work_center_no.length == 0) _callback(false, "Please fill Work Center.");
        else if(work_center_no.length < 2) _callback(false, "WorkCenter Not Found.");
        else {
          $.ajax({
            url: '/validate_work_center/',
            data: {
              'work_center_no': work_center_no,
              'work_center_group': work_center_group,
            },
            dataType: 'json',
            success: function (data) {
              (data.canUse)? _callback(true, ""):_callback(false, data.invalidText);
            }
          });
        }
      }

      function validate_operator(emp_id, _callback){
        if(emp_id.length == 0) _callback(false, "Please fill Emplyee ID.");
        else if(emp_id.length < 4) _callback(false, "Employee Not Found.");
        else {
          $.ajax({
            url: '/validate_operator/',
            data: {
              'emp_id': emp_id,
            },
            dataType: 'json',
            success: function (data) {
              (data.isExist)? _callback(true, ""):_callback(false, "Employee Not Found.");
            }
          });
        }
      }

      function validate_password(password, _callback){
        if(password.length == 0) _callback(false, "Please fill Password.");
        else if(password.length < 4) _callback(false, "Password is not correct.");
        else {
          $.ajax({
            url: '/validate_password/',
            data: {
              'password': password,
            },
            dataType: 'json',
            success: function (data) {
              (data.isCorrect)? _callback(true, ""):_callback(false, "Password is not correct.");
            }
          });
        }
      }

      function validate_section_chief_password(password, _callback){
        if(password.length == 0) _callback(false, "Please fill Password.");
        else if(password.length < 4) _callback(false, "Password is not correct.");
        else {
          $.ajax({
            url: '/validate_section_chief_password/',
            data: {
              'password': password,
            },
            dataType: 'json',
            success: function (data) {
              (data.isCorrect)? _callback(true, ""):_callback(false, "Password is not correct.");
            }
          });
        }
      }
    </script>
    <!-- SHORTCUT SEARCH -->
    <script>
      document.getElementById("sc_order_no").addEventListener("keydown", function (e) {
        if (e.code === "Enter" || e.code == "NumpadEnter") shortcut_search();
      });

      document.getElementById("sc_order_no").addEventListener("keyup", function (e) {
        if ($("#sc_order_no").val().length == 12) $("#sc_operation_no").focus();
      });

      document.getElementById("sc_operation_no").addEventListener("keydown", function (e) {
        if (e.code === "Enter" || e.code == "NumpadEnter") shortcut_search();
      });

      function shortcut_search(){
          var order_no =  $("#sc_order_no").val();
          var operation_no =  frontZero($("#sc_operation_no").val(), 4);
          (order_no.length < 6)? invalid("sc_order_no"): valid("sc_order_no");
          (operation_no.length < 4)? invalid("sc_operation_no"): valid("sc_operation_no");
          if(order_no.length >= 6 && operation_no.length == 4){
            remove_valid_many(["sc_order_no","sc_operation_no"]);
            window.open('/transaction/' + order_no + operation_no, '_self');
          }
      }

      document.getElementById("fp_operator_id").addEventListener("keydown", function (e) {
        if (e.code === "Enter" || e.code == "NumpadEnter") fp_emp_search();
      });

      function fp_emp_at_com_search(emp_id){
        $.ajax({
          url: '/fp_emp_search/',
          data: {
            'operator_id': emp_id,
          },
          dataType: 'json',
          success: function (data) {
            if(data.path == ""){
              window.open('/transaction/0', '_self');
            } else {
              window.open('/transaction/' + data.path, '_self');
            }
          }
        });
      }

      function fp_emp_search(){
          remove_valid_many(["fp_operator_id"]);
          var operator_id =  $("#fp_operator_id").val();
          if (operator_id.length < 4){
            invalid("fp_operator_id");
          } else {
            $.ajax({
              url: '/fp_emp_search/',
              data: {
                'operator_id': operator_id,
              },
              dataType: 'json',
              success: function (data) {
                if(data.path == ""){
                  invalid("fp_operator_id");
                } else {
                  valid("fp_operator_id");
                  window.open('/transaction/' + data.path, '_self');
                }
              }
            });
          }
      }
    </script>
    <!-- DYNAMIC INPUT -->
    <script>
      $(document).on('change', 'input[type=radio][name=workcenter_radio]', function (event) {
          dynamic_operator_setup();
      });

      $('input[name=change_tool_change_type]').change(function() {
        var selectedValue = $(this).val();
        $('#change_tool_diff_group').prop('hidden', true);
        if(selectedValue == 'Diff') $('#change_tool_diff_group').prop('hidden', false);
      });
      
      function dynamic_operator_setup(){
        if ($('input[name="workcenter_radio"]').length > 0){
          owc_id = document.querySelector('input[name="workcenter_radio"]:checked').value;
          var owc_status = $('#workcenter_status_' + owc_id).val();
          if(owc_status == "WORKING"){
            $("#operator_setup_button").prop('hidden', true);
          } else {
            $("#operator_setup_button").prop('hidden', false);
          }
        }
      }

      function dynamic_operator_id(){
        if($('#workcenter_type').val() == 'Labor'){
          $("#operator_id").prop('readonly', false);
        } else if($('#workcenter_type').val() == 'Machine' && $('input[name="workcenter_radio"]').length > 0){
          $("#operator_id").prop('readonly', false);
        } else {
          $("#operator_id").prop('readonly', true);
        }
      }

      function dynamic_join(){
        if($("#join_list_length").val() > 0 && $("#is_operating").val() == "False"){
          $("#break_join_main_button").prop("hidden", false);
        } else {
          $("#break_join_main_button").prop("hidden", true);
        }
        if($("#join_list_length").val() == 0 && $("#is_operating").val() == "False" && $("#workcenter_type").val() == 'Machine' && $("#remain_qty").val() > 0 && $("#is_joining").val() == "False"){
          $("#join_main_button").prop("hidden", false);
        } else {
          $("#join_main_button").prop("hidden", true);
        }
        if($("#join_list_length").val() == 0){
          $("#mp_main_button").removeClass("disabled");
        } else {
          $("#mp_main_button").addClass("disabled");
        }
      }

      $('#mp_setup_checkbox').change(function() {
          (this.checked)? $("#mp_setup_start_time_group").prop("hidden", false):$("#mp_setup_start_time_group").prop("hidden", true);
          (this.checked)? $("#mp_setup_stop_time_group").prop("hidden", false):$("#mp_setup_stop_time_group").prop("hidden", true);
      });

      $('#reject_reason').on("change", function() {
        var reason = $('#reject_reason').val();
        $("#other_group").prop("hidden", true);
        $("#scrap_at_group").prop("hidden", true);
        $("#other_reason").val("");
        if(reason == "OTHER"){
          $("#other_group").prop("hidden", false);
        } else if (reason == "SCRAP FROM PREVIOUS PROCESS"){
          $("#scrap_at_group").prop("hidden", false);
        }
      });

      $('#mp_reject_reason').on("change", function() {
        var reason = $('#mp_reject_reason').val();
        $("#mp_other_group").prop("hidden", true);
        $("#mp_scrap_at_group").prop("hidden", true);
        $("#mp_other_reason").val("");
        if(reason == "OTHER"){
          $("#mp_other_group").prop("hidden", false);
        } else if (reason == "SCRAP FROM PREVIOUS PROCESS"){
          $("#mp_scrap_at_group").prop("hidden", false);
        }
      });

      $('#add_control_key').on("change", function() {
        ($('#add_control_key').val() == "PP01")? $("#add_pp01").prop("hidden", false): $("#add_pp01").prop("hidden", true);
        ($('#add_control_key').val() == "PP01")? $("#add_pp02").prop("hidden", true): $("#add_pp02").prop("hidden", false);
      });

      $('#change_control_key').on("change", function() {
        ($('#change_control_key').val() == "PP01")? $("#change_pp01").prop("hidden", false): $("#change_pp01").prop("hidden", true);
        ($('#change_control_key').val() == "PP01")? $("#change_pp02").prop("hidden", true): $("#change_pp02").prop("hidden", false);
      });
    </script>
    <!-- KET RESTRICT -->
    <script>
      $("#add_new_tool_tool_life_qty").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#change_tool_flute").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#change_tool_proj_len").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#change_tool_flute_len").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#change_tool_tool_life_qty").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });


      $("#sqty_process_qty").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#sqty_accepted_qty").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#sqty_rejected_qty").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#inc_qty_amount").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#inc_qty_emp_id").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#add_emp_id").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#add_new_operation_no").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      // $("#add_est_setup_time").on("keypress keyup blur",function (event) {
      //     $(this).val($(this).val().replace(/[^\d].+/, ""));
      //     if((event.which < 48 || event.which > 57)) event.preventDefault();
      // });

      // $("#add_est_operate_time").on("keypress keyup blur",function (event) {
      //     $(this).val($(this).val().replace(/[^\d].+/, ""));
      //     if((event.which < 48 || event.which > 57)) event.preventDefault();
      // });

      // $("#add_est_labor_time").on("keypress keyup blur",function (event) {
      //     $(this).val($(this).val().replace(/[^\d].+/, ""));
      //     if((event.which < 48 || event.which > 57)) event.preventDefault();
      // });

      $("#add_pdt").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#add_price_unit").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#change_emp_id").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      // $("#change_est_setup_time").on("keypress keyup blur",function (event) {
      //     $(this).val($(this).val().replace(/[^\d].+/, ""));
      //     if((event.which < 48 || event.which > 57)) event.preventDefault();
      // });

      // $("#change_est_operate_time").on("keypress keyup blur",function (event) {
      //     $(this).val($(this).val().replace(/[^\d].+/, ""));
      //     if((event.which < 48 || event.which > 57)) event.preventDefault();
      // });

      // $("#change_est_labor_time").on("keypress keyup blur",function (event) {
      //     $(this).val($(this).val().replace(/[^\d].+/, ""));
      //     if((event.which < 48 || event.which > 57)) event.preventDefault();
      // });

      $("#change_pdt").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#del_emp_id").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#operator_id").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#good_qty").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#reject_qty").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_emp_id").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_labor_time").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_setup_time").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_operate_time").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_good_qty").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_reject_qty").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#sc_order_no").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#sc_operation_no").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#fp_operator_id").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#transfer_tool_order_no").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#transfer_tool_operation_no").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });
    </script>
    <!-- ADMIN -->
    <script>

      function validate_admin_password(password, _callback){
        if(password.length < 4) _callback(false);
        else {
          $.ajax({
            url: '/validate_admin_password/',
            data: {
              'password': password,
            },
            dataType: 'json',
            success: function (data) {
              if(data.isCorrect) _callback(true);
              else _callback(false);
            }
          });
        }
      }

      function clear_validate_reset_order(){
        $("#rso_invalid_text").text("");
        remove_valid_many(["rso_password"]);
      }

      function reset_order(){
        var order_no = $('#order_no').val();
        var start_operation_no = $('#rso_start_operation_no').val();
        var password = $('#rso_password').val();
        validate_admin_password(password, function(isCorrect, invalid_text) {
          if(!isCorrect){
            invalid("rso_password");
            $("#rso_invalid_text").text(invalid_text);
          } else {
            valid("rso_password");
            $('#rso_confirm_button').prop('disabled', true);
            $.ajax({
              url: '/reset_order/',
              data: {
                'order_no': order_no,
                'start_operation_no' : start_operation_no,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }
        });
      }

      function clear_validate_cancel_order(){
        $("#cc_invalid_text").text("");
        remove_valid_many(["cc_password","cc_emp_id","cc_reason"]);
      }

      function cancel_order(){
        var order_no = $('#order_no').val();
        var password = $('#cc_password').val();
        var emp_id = $('#cc_emp_id').val();
        var reason = $('#cc_reason').val();
        validate_admin_password(password, function(isCorrect, invalid_text) {
          if(!isCorrect){
            invalid("cc_password");
            $("#cc_invalid_text").text(invalid_text);
          } else {
            valid("cc_password");
            $('#cc_confirm_button').prop('disabled', true);
            $.ajax({
              url: '/cancel_order/',
              data: {
                'order_no': order_no,
                'emp_id': emp_id,
                'reason': reason,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }
        });
      }

      function sqty_operation(){
        var order_no = $('#order_no').val();
        var operation_no = $('#operation_no').val();
        var password = $('#sqty_password').val();
        if($('#sqty_process_qty').val() == "") $('#sqty_process_qty').val("0");
        if($('#sqty_accepted_qty').val() == "") $('#sqty_accepted_qty').val("0");
        if($('#sqty_rejected_qty').val() == "") $('#sqty_rejected_qty').val("0");
        var confirm_id = $('#confirm_id').val();
        var process_qty = parseFloat($('#sqty_process_qty').val());
        var accepted_qty = parseFloat($('#sqty_accepted_qty').val());
        var rejected_qty = parseFloat($('#sqty_rejected_qty').val());
        validate_admin_password(password, function(isCorrect, invalid_text) {
          if(!isCorrect){
            invalid("sqty_password");
            $("#sqty_invalid_text").text(invalid_text);
          } else {
            valid("sqty_password");
            $('#sqty_confirm_button').prop('disabled', true);
            $.ajax({
              url: '/sqty_operation/',
              data: {
                'order_no': order_no,
                'operation_no': operation_no,
                'process_qty': process_qty,
                'accepted_qty': accepted_qty,
                'rejected_qty': rejected_qty,
              },
              dataType: 'json',
              success: function (data) {
                location.reload();
              }
            });
          }
        });
      }
    </script>
  </body>
</html>
