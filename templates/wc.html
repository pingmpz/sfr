<!DOCTYPE html>
{% load static %}
{% load extra %}
<!--
* CoreUI Pro based Bootstrap Admin Template
* @version v3.2.0
* @link https://coreui.io/pro/
* Copyright (c) 2020 creativeLabs Łukasz Holeczek
* License (https://coreui.io/pro/license)
-->
<html lang="en">
  <head>
    <base href="./">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description" content="CoreUI - Open Source Bootstrap Admin Template">
    <meta name="author" content="Łukasz Holeczek">
    <meta name="keyword" content="Bootstrap,Admin,Template,Open,Source,jQuery,CSS,HTML,RWD,Dashboard">
    <title>Work Center | Shopfloor Reporting Application</title>
    <!-- Main styles for this application-->
    <link rel="stylesheet" href="{% static "css/style.css" %}">
    <!-- Icon CSS -->
    <link href="{% static "vendors/@coreui/icons/css/free.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/@coreui/icons/css/brand.min.css" %}" rel="stylesheet">
    <!-- Select CSS -->
    <link href="{% static "vendors/select2/css/select2.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/select2/css/select2-coreui.min.css" %}" rel="stylesheet">
    <!-- Data Table CSS -->
    <link href="{% static "vendors/datatables.net-bs4/css/dataTables.bootstrap4.css" %}" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static "customize/css/decorate.css" %}" rel="stylesheet">
  </head>
  <body class="c-app c-no-layout-transition">
    <!-- *** LEFT SIDE BAR *** -->
    {% include 'sidebar.html' %}
    <!-- *** RIGHT SIDE BAR *** -->
    <div class="c-wrapper">
      <!-- *** HEADER *** -->
      <header class="c-header c-header-light c-header-fixed">
        {% include 'header.html' %}
        <div class="c-subheader justify-content-between px-3">
          <!-- Breadcrumb-->
          <ol class="breadcrumb border-0 m-0 px-0 px-md-3">
            <li class="breadcrumb-item">Work Center</li>
            <!-- Breadcrumb Menu-->
            <li class="breadcrumb-item active">
              {{workCenter.WorkCenterNo}}
            </li>
          </ol>
          <div class="c-subheader-nav d-md-down-none mfe-2">
            <input type="month" class="form-control" id="fmonth" value="{{fmonth}}" onkeydown="return false" required>
            <input type="text" id="year" value="{{fmonth|slice:'0:4'}}" hidden>
            <input type="text" id="month" value="{{fmonth|slice:'5:7'}}" hidden>
            <button type="button" class="btn btn-sm btn-link text-primary" style="padding-top: 3px;" onclick="window.scrollTo(0,0);"><i class="c-icon c-icon-sm cil-chevron-double-up"></i></a>
            <button type="button" class="btn btn-sm btn-link text-primary" style="padding-top: 3px;" onclick="window.scrollTo(0,document.body.scrollHeight);"><i class="c-icon c-icon-sm cil-chevron-double-down"></i></a>
          </div>
        </div>
      </header>
      <!-- *** BODY *** -->
      <div class="c-body">
        <main class="c-main">
          <div class="container-fluid">
            <div class="fade-in">
              <div class="row">
                <div class="col-md-3">
                  <div class="card">
                    <div class="card-header"><strong>Infomation</strong></div>
                    <div class="card-body">
                      <div class="small">
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right"><strong>Work Center</strong></label>
                          <div class="col-md-8">
                            <input class="form-control form-control-sm" type="text" id="work_center_no" value="{{workCenter.WorkCenterNo}}" readonly>
                          </div>
                        </div>
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right"><strong>Name</strong></label>
                          <div class="col-md-8">
                            <input class="form-control form-control-sm" type="text" value="{{workCenter.WorkCenterName}}" readonly>
                          </div>
                        </div>
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right"><strong>Work Center Group</strong></label>
                          <div class="col-md-8">
                            <input class="form-control form-control-sm" type="text" value="{{workCenter.WorkCenterGroup}}" readonly>
                          </div>
                        </div>
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right"><strong>Routing</strong></label>
                          <div class="col-md-8">
                            {% if workCenter.IsRouting %}<i class="c-icon cil-check-alt text-success" style="padding-top: 7px"></i>
                            {% else %}<i class="c-icon cil-x text-danger" style="padding-top: 6px"></i>
                            {% endif %}
                          </div>
                        </div>
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right"><strong>External Process</strong></label>
                          <div class="col-md-8">
                            {% if workCenter.IsExternalProcess %}<i class="c-icon cil-check-alt text-success" style="padding-top: 7px"></i>
                            {% else %}<i class="c-icon cil-x text-danger" style="padding-top: 6px"></i>
                            {% endif %}
                          </div>
                        </div>
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right"><strong>Work Center Type</strong></label>
                          <div class="col-md-8">
                            <input class="form-control form-control-sm" type="text" value="{{workCenter.WorkCenterType}}" readonly>
                          </div>
                        </div>
                        {% if workCenter.WorkCenterType == 'Machine' %}
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right"><strong>Machine Type</strong></label>
                          <div class="col-md-8">
                            <input class="form-control form-control-sm" type="text" value="{{workCenter.MachineType|default_if_none:""}}" readonly>
                          </div>
                        </div>
                        {% endif %}
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right"><strong>Hourly Rate</strong></label>
                          <div class="col-md-8">
                            <input class="form-control form-control-sm" type="text" value="{{workCenter.HourlyRate}}" readonly>
                          </div>
                        </div>
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right"><strong>Noted</strong></label>
                          <div class="col-md-8">
                            <input class="form-control form-control-sm" type="text" value="{{workCenter.Noted|default_if_none:""}}" readonly>
                          </div>
                        </div>
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right"><strong>Active</strong></label>
                          <div class="col-md-8">
                            {% if workCenter.IsActive %}<i class="c-icon cil-check-alt text-success" style="padding-top: 7px"></i>
                            {% else %}<i class="c-icon cil-x text-danger" style="padding-top: 6px"></i>
                            {% endif %}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="card">
                    <div class="card-header"><strong>Statistic</strong></div>
                    <div class="card-body">
                      <div class="small">
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right"><strong>Setup Time</strong></label>
                          <div class="col-md-8">
                            <input class="form-control form-control-sm" type="text" value="{{totalSetupTime}}" readonly>
                          </div>
                        </div>
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right"><strong>Oper Time</strong></label>
                          <div class="col-md-8">
                            <input class="form-control form-control-sm" type="text" value="{{totalOperTime}}" readonly>
                          </div>
                        </div>
                        <div class="form-group row">
                          <label class="col-md-4 col-form-label text-right"><strong>Total Time</strong></label>
                          <div class="col-md-8">
                            <input class="form-control form-control-sm" type="text" value="{{totalWorkingTime}}" readonly>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-9">
                  <div class="card">
                    <div class="card-header">
                      <strong>History</strong>
                    </div>
                    <div class="card-body">
                      <!-- History -->
                      <div class="nav-tabs-boxed">
                        <ul class="nav nav-tabs" role="tablist">
                          <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#wc-tran-tab" role="tab">Transaction ({{historyTransList|length}})</a></li>
                          <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#wc-ot-tab" role="tab">Overtime ({{historyOvertimeList|length}})</a></li>
                        </ul>
                        <div class="tab-content">
                          <!-- Transaction Tab -->
                          <div class="tab-pane active" id="wc-tran-tab" role="tabpanel">
                            <table class="table table-sm table-outline small" id="wc_tran_table" style="table-layout: fixed;">
                              <thead class="thead-light">
                                <tr>
                                  <th>StartDateTime</th>
                                  <th>EndDateTime</th>
                                  <th>Setup</th>
                                  <th>Oper</th>
                                  <th>Labor</th>
                                  <th>Type</th>
                                  <th>By EmpID</th>
                                  <th>Prod. Order - Oper.No</th>
                                </tr>
                              </thead>
                              <tbody>
                                {% for ht in historyTransList %}
                                <tr style="background-color:#f{{ht.StartDateTime|date:'md'|add:'0'|modulo:8}}f{{ht.StartDateTime|date:'md'|add:'0'|modulo:9}}f{{ht.StartDateTime|date:'md'|add:'0'|modulo:10}}">
                                  <td>{{ht.StartDateTime|date:"d-M-Y, H:i"}}</td>
                                  <td>{{ht.StopDateTime|date:"d-M-Y, H:i"}}</td>
                                  <td>{%if ht.Setup != 0.00 %}{{ht.Setup.normalize}}{% endif %}</td>
                                  <td>{%if ht.Oper != 0.00 %}{{ht.Oper.normalize}}{% endif %}</td>
                                  <td>{%if ht.Labor != 0.00 %}{{ht.Labor.normalize}}{% endif %}</td>
                                  <td>
                                    {% if ht.Type.strip == 'WORKING' and workCenter.IsExternalProcess and ht.Setup == 0.00 and ht.Oper == 0.00 and ht.Labor == 0.00  %}<span class="text-plum"><strong>Ext-Work</strong></span>
                                    {% elif ht.Setup == 0.00 and ht.Oper == 0.00 and ht.Labor == 0.00  %}<span class="text-muted"><strong>Skip</strong></span>
                                    {% elif ht.Type.strip == 'WORKING' %}<span class="text-success"><strong>Working</strong></span>
                                    {% elif ht.Type.strip == 'SETUP' %}<span class="text-yellowgreen"><strong>Setup</strong></span>
                                    {% elif ht.Type.strip == 'MANUAL' %}<span class="text-primary"><strong>Manual Report</strong></span>
                                    {% endif %}
                                  </td>
                                  <td><a href="/emp/{{ht.EmpID}}&NOW">{{ht.EmpID|default_if_none:""}}</a></td>
                                  <td><a href="/transaction/{{ht.OrderNo}}{{ht.OperationNo}}">{{ht.OrderNo}}-{{ht.OperationNo}}</a></td>
                                </tr>
                                {% endfor %}
                              </tbody>
                            </table>
                          </div>
                          <!-- Overtime Tab -->
                          <div class="tab-pane" id="wc-ot-tab" role="tabpanel">
                            <table class="table table-sm table-outline small" id="wc_ot_table" style="table-layout: fixed;">
                              <thead class="thead-light">
                                <tr>
                                  <th>StartDateTime</th>
                                  <th>Prod. Order - Oper.No</th>
                                </tr>
                              </thead>
                              <tbody>
                                {% for ht in historyOvertimeList %}
                                <tr style="background-color:#f{{ht.StartDateTime|date:'md'|add:'0'|modulo:8}}f{{ht.StartDateTime|date:'md'|add:'0'|modulo:9}}f{{ht.StartDateTime|date:'md'|add:'0'|modulo:10}}">
                                  <td>{{ht.StartDateTime|date:"d-M-Y, H:i"}}</td>
                                  <td><a href="/transaction/{{ht.OrderNo}}{{ht.OperationNo}}">{{ht.OrderNo}}-{{ht.OperationNo}}</a></td>
                                </tr>
                                {% endfor %}
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
      <!-- *** FOOTER *** -->
      {% include 'footer.html' %}
    </div>
    <!-- CoreUI and necessary plugins-->
    <script src="{% static "vendors/@coreui/coreui-pro/js/coreui.bundle.min.js" %}"></script>
    <!--[if IE]><!-->
    <script src="{% static "vendors/@coreui/icons/js/svgxuse.min.js" %}"></script>
    <!--<![endif]-->
    <script src="{% static "vendors/jquery/js/jquery.min.js" %}"></script>
    <script src="{% static "vendors/select2/js/select2.min.js" %}"></script>
    <!-- Data Table JS -->
    <script src="{% static "vendors/datatables.net/js/jquery.dataTables.js" %}"></script>
    <script src="{% static "vendors/datatables.net-bs4/js/dataTables.bootstrap4.min.js" %}"></script>
    <!-- Custom -->
    <script src="{% static "customize/js/custom-function.js" %}"></script>
    <script src="{% static "customize/js/clock.js" %}"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function(event) {
        setTimeout(function() {
          document.body.classList.remove('c-no-layout-transition')
        }, 2000);
      });

      $(document).ready(function() {
        $('#wc_tran_table').DataTable( {
            "order": [[ 0, "desc" ]],
            'iDisplayLength': 100,
        });
        $('#wc_ot_table').DataTable( {
            "order": [[ 0, "desc" ]],
            'iDisplayLength': 100,
        });
      });

      $('#fmonth').change(function() {
        window.location.href =  "/wc/" + ($("#work_center_no").val() + "&" + $("#fmonth").val());
      });

    </script>
  </body>
</html>
