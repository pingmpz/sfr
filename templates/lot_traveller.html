<!DOCTYPE html>
{% load static %}
{% load extra %}
<!--
* CoreUI Pro based Bootstrap Admin Template
* @version v3.2.0
* @link https://coreui.io/pro/
* Copyright (c) 2020 creativeLabs Łukasz Holeczek
* License (https://coreui.io/pro/license)
-->
<html lang="en">
  <head>
    <base href="./">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description" content="CoreUI - Open Source Bootstrap Admin Template">
    <meta name="author" content="Łukasz Holeczek">
    <meta name="keyword" content="Bootstrap,Admin,Template,Open,Source,jQuery,CSS,HTML,RWD,Dashboard">
    <title>Partial Lot Traveller | Shopfloor Reporting Application</title>
    <!-- Main styles for this application-->
    <link rel="stylesheet" href="{% static "css/style.css" %}">
    <!-- Icon CSS -->
    <link href="{% static "vendors/@coreui/icons/css/free.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/@coreui/icons/css/brand.min.css" %}" rel="stylesheet">
    <!-- Select CSS -->
    <link href="{% static "vendors/select2/css/select2.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/select2/css/select2-coreui.min.css" %}" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static "customize/css/decorate.css" %}" rel="stylesheet">
  </head>
  <body class="c-app c-no-layout-transition">
    <!-- *** LEFT SIDE BAR *** -->
    {% include 'sidebar.html' %}
    <!-- *** RIGHT SIDE BAR *** -->
    <div class="c-wrapper">
      <!-- *** HEADER *** -->
      <header class="c-header c-header-light c-header-fixed">
        {% include 'header.html' %}
        <div class="c-subheader justify-content-between px-3">
          <!-- Breadcrumb-->
          <ol class="breadcrumb border-0 m-0 px-0 px-md-3">
            <li class="breadcrumb-item">Partial Lot Traveller</li>
            {% if state != "FIRSTPAGE" %}
            <li class="breadcrumb-item active">
              <span id="bc_order_no">{{orderNo}}</span>
              {% if LotNo != "0" %}&nbsp;/&nbsp;<span id="bc_lot_no">{{LotNo}}</span>{% endif %}
            </li>
            {% endif %}
          </ol>
          <div class="c-subheader-nav d-md-down-none mfe-2" style="width: 480px">
            <input type="password" hidden> <!-- Prevent Auto fill Password -->
            <div>Prod. Order / Lot No</div>
            &nbsp;&nbsp;<div><input type="text" class="form-control form-control-sm" maxlength="10" id="sc_order_no" autocomplete="off" value="{{orderNo}}"></div>
            &nbsp;&nbsp;<div>/</div>&nbsp;&nbsp;
            <div style="width:15%">
              <select class="form-control form-control-sm" id="sc_lot_no" {% if state != "DATAFOUND" or LotNo == "0" %}readonly{% endif %}>
                {% if state != "DATAFOUND" or LotNo == "0" %}<option value="-1">#</option>{% endif %}
                {% for item in pltList %}
                <option value="{{item.LotNo}}" {% if LotNo == item.LotNo|slugify %}selected{% endif %}>{{item.LotNo}}</option>
                {% endfor %}
              </select>
            </div>
            &nbsp;&nbsp;<div><button type="button" class="btn btn-sm btn-pill btn-outline-info" onclick="shortcut_search()">Go !</button></div>
          </div>
        </div>
      </header>
      <!-- *** BODY *** -->
      <div class="c-body">
        <main class="c-main">
          <div class="container-fluid">
            <div class="fade-in">
              <!-- First Page -->
              {% if state == "FIRSTPAGE" %}
              <div class="row">
                <div class="col-md-12 text-center">
                  <br><br><br><br><br><br><br><br><br><br><br>
                  <h1><i class="c-icon c-icon-2xl cil-list-rich" style="font-size: 8rem; width: 8rem;"></i></h1>
                  <br>
                  <h1><strong>PARTIAL LOT TRAVELLER</strong></h1>
                </div>
              </div>
              {% endif %}
              <!-- Not Found -->
              {% if state == 'NODATAFOUND' %}
              <div class="row">
                <div class="col-md-12 text-center">
                  <br><br><br><br><br><br><br><br>
                  <h1><i class="c-icon c-icon-2xl cil-ban" style="font-size: 10rem; width: 10rem;"></i></h1>
                  <br>
                  <h1><strong>PRODUCTION ORDER NOT FOUND</strong></h1>
                  <p>
                    <strong>PRODUCTION ORDER NO</strong>
                    <br>
                    <span class="text-danger"><strong><span id="nf_order_no">{{orderNo}}</span></strong></span>
                    <br>
                  </p>
                </div>
              </div>
              {% endif%}
              <!-- Found -->
              {% if state == "DATAFOUND" %}
              <div class="row">
                <div class="col-md-12">
                  <div class="card">
                    <div class="card-header">
                      {% if LotNo == '0' %}
                      Please Do Partail Lot First.
                      {% endif %}
                      <div class="card-header-actions">
                        <button class="btn btn-sm btn-link small" data-toggle="modal" data-target="#increase_lot_no_modal" onclick="prepare_increase_lot_no()"> <i class="c-icon c-icon-sm cil-fork" style="transform: rotateZ(180deg); transform: scaleY(-1);"></i></button>
                        {% if LotNo != '0' %}
                        <button class="btn btn-sm btn-link small" onclick="printDiv()"> <i class="c-icon c-icon-sm cil-print"></i></button>
                        {% endif %}
                      </div>
                    </div>
                    {% if LotNo != '0' %}
                    <div class="card-body">
                      <input type="text" id="order_no" value="{{orderNo}}" hidden>
                      <input type="text" id="operation_no" value="{{operationNo}}" hidden>
                      <input type="text" id="final_lot_no" value="{{order.LotNo}}" hidden>
                      <div id="print-area">
                        <style>
                          table, th, td {
                            border: 1px solid black;
                            border-collapse: collapse;
                          }
                          table {
                            margin-bottom: 0px !important;
                            table-layout: fixed;
                          }
                          td {
                            height: 30px !important;
                            padding: 1px !important;
                            font-size: 10px;
                            overflow:hidden;
                            vertical-align: inherit !important;
                          }
                          .toprow {
                            border-top-color: #000000 !important;
                          }
                          .title {
                            background-color:#e1e4e7 !important;
                          }
                          .toptable {
                            /* width: 11.11%; */
                          }
                          .bottable {
                            /* width: 7.69%; */
                          }
                        </style>
                        <script src="{% static "vendors/jsbarcode/js/jsbarcode.all.min.js" %}"></script>
                        <div id="page_1">
                          <div class="row">
                            <div class="col-2"></div>
                            <div class="col-5 text-center"><h3>Partial Lot Traveller</h3></div>
                            <div class="col-4" style="padding-top: 3px">
                              <div class="form-check form-check-inline mr-1">
                                <input class="form-check-input" type="checkbox" id="non_asm_1" {% if plt.Type.strip == 'NONASM' %}checked{% endif %} style="width: 18px; height: 18px;">&nbsp;&nbsp;
                                <h5 class="form-check-label">Non-ASM</h5>
                              </div>
                              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                              <div class="form-check form-check-inline mr-1">
                                <input class="form-check-input" type="checkbox" id="asm_1" {% if plt.Type.strip == 'ASM' %}checked{% endif %} style="width: 18px; height: 18px;">&nbsp;&nbsp;
                                <h5 class="form-check-label">ASM</h5>
                              </div>
                            </div>
                            <div class="col-1 text-right" style="padding-top: 3px">1/{{pageCount}}</div>
                          </div>
                          <table class="table small">
                            <tbody>
                              <tr>
                                <td class="toprow title toptable"><strong>Prod. Order No.</strong></td>
                                <td class="toprow toptable">{{orderNo}}/<input type="text" style="border: none; width: 20%" id="lot_no_1" value="{{LotNo}}"></td>
                                <td class="toprow title toptable"><strong>Sales order No.</strong></td>
                                <td class="toprow toptable">{{order.SalesOrderNo|default_if_none:""}}</td>
                                <td class="toprow title toptable"><strong>Sales Order Qty</strong></td>
                                <td class="toprow toptable">{{order.SalesOrderQuantity|floatformat|default_if_none:""}}</td>
                                <td class="toprow title toptable"><strong>Partial Lot Qty</strong></td>
                                <td class="toprow toptable" colspan="2"><input type="text" style="border: none; width: 100%" id="pl_qty_1" value="{{plt.LotQty}}"></td>
                              </tr>
                              <tr>
                                <td class="title"><strong>Release Date</strong></td>
                                <td>
                                  {% if order.ReleaseDate != None %}
                                  {{order.ReleaseDate|replace:".|-" }}
                                  <!-- {{order.ReleaseDate|slice:"8:10"}}-{{order.ReleaseDate|slice:"5:7"}}-{{order.ReleaseDate|slice:"0:4"}} -->
                                  {% endif %}
                                </td>
                                <td class="title"><strong>Request Date</strong></td>
                                <td>
                                  {% if order.RequestDate != None %}
                                  {{order.RequestDate|replace:".|-" }}
                                  <!-- {{order.RequestDate|slice:"8:10"}}-{{order.RequestDate|slice:"5:7"}}-{{order.RequestDate|slice:"0:4"}} -->
                                  {% endif %}
                                </td>
                                <td class="title"><strong>Prod. Order Qty</strong></td>
                                <td>{{order.ProductionOrderQuatity|floatformat|default_if_none:""}}</td>
                                <td rowspan="2"></td>
                                <td rowspan="2"></td>
                                <td rowspan="2"></td>
                              </tr>
                              <tr>
                                <td class="title"><strong>FG. Mat. Code. No.</strong></td>
                                <td>{{order.FG_MaterialCode|default_if_none:""}}</td>
                                <td class="title"><strong>RM Mat'l Code No.</strong></td>
                                <td>{{order.RM_MaterialCode|default_if_none:""}}</td>
                                <td class="title"><strong>MRP Controller</strong></td>
                                <td>{{order.MRP_Controller|default_if_none:""}}</td>
                              </tr>
                              <tr>
                                <td class="title"><strong>Drawing No./Rev.</strong></td>
                                <td colspan="3">{{order.DrawingNo|default_if_none:""}}</td>
                                <td class="title"><strong>PO No. (Customer)</strong></td>
                                <td>{{order.CustomerPONo|default_if_none:""}}</td>
                                <td class="title"><strong>Mgr/Eng'r/MRP</strong></td>
                                <td class="title"><strong>QA</strong></td>
                                <td class="title"><strong>CS</strong></td>
                              </tr>
                              <tr>
                                <td class="title"><strong>Part No./Rev.</strong></td>
                                <td colspan="3">{{order.PartNo|default_if_none:""}}</td>
                                <td class="title"><strong>Sale Create Date</strong></td>
                                <td>
                                  {% if order.SalesCreateDate != None %}
                                  {{order.SalesCreateDate|replace:".|-" }}
                                  <!-- {{order.SalesCreateDate|slice:"8:10"}}-{{order.SalesCreateDate|slice:"5:7"}}-{{order.SalesCreateDate|slice:"0:4"}} -->
                                  {% endif %}
                                </td>
                                <td class="text-center" colspan="3" rowspan="2">
                                  <svg id="barcode_1"></svg>
                                  <script>
                                  JsBarcode("#barcode_1", "{{orderNo}}", {
                                    format: "CODE39",
                                    displayValue: false,
                                    width: 1,
                                    height: 40,
                                    margin: 0,
                                  });
                                  </script>
                                </td>
                              </tr>
                              <tr>
                                <td class="title"><strong>Part Name</strong></td>
                                <td colspan="3">{{order.PartName|default_if_none:""}}</td>
                                <td class="title"><strong>Printed Date</strong></td>
                                <td>{% now 'd-m-Y' %}</td>
                              </tr>
                            </tbody>
                          </table>
                          <table class="table text-center table-sm">
                            <tbody>
                              <tr>
                                <td class="title bottable" rowspan="2" colspan="2"><strong>Routing<br>กระบวนการผลิต<br>Operation Number<br>Group/Grp.Counter</strong></td>
                                <td class="title bottable" colspan="3"><strong>Planning</strong></td>
                                <td class="title bottable" colspan="3"><strong>Estimate Time</strong></td>
                                <td class="title bottable"><strong>งานดี<br>Accept</strong></td>
                                <td class="title bottable"><strong>งานเสีย<br>Reject</strong></td>
                                <td class="title bottable"><strong>ผู้ผลิต<br>ID / ประทับตรา</strong></td>
                                <td class="title bottable" rowspan="2" colspan="2"><strong>Barcode</strong></td>
                                <td class="title bottable" rowspan="2"><strong>Operation Short Text</strong></td>
                              </tr>
                              <tr>
                                <td class="title bottable"><strong>วันที่เริ่มผลิต<br>Start Date</strong></td>
                                <td class="title bottable"><strong>แผนการผลิต<br>Planning<br>(Day)</strong></td>
                                <td class="title bottable"><strong>วันที่ผลิตเสร็จ<br>Planned Finish<br>Date</strong></td>
                                <td class="title bottable"><strong>Setup<br>Time<br>(Min)</strong></td>
                                <td class="title bottable"><strong>Operation<br>Time<br>(Min)</strong></td>
                                <td class="title bottable"><strong>Labor<br>Time<br>(Min)</strong></td>
                                <td class="title bottable"><strong>(Qty)</strong></td>
                                <td class="title bottable"><strong>(Qty)</strong></td>
                                <td class="title bottable"><strong>Operator<br>ID / Stamp</strong></td>
                              </tr>
                              {% for operation in operationList1 %}
                                <tr>
                                  <td>{{operation.OperationNo}}</td>
                                  <td>{{operation.WorkCenterNo}}</td>
                                  <td>
                                    {% if operation.PlanStartDate != None %}
                                    {{operation.PlanStartDate|slice:"8:10"}}-{{operation.PlanStartDate|slice:"5:7"}}-{{operation.PlanStartDate|slice:"0:4"}}
                                    {% endif %}
                                  </td>
                                  <td>{{planDayCountList1|index:forloop.counter0}}</td>
                                  <td>
                                    {% if operation.PlanFinishDate != None %}
                                    {{operation.PlanFinishDate|slice:"8:10"}}-{{operation.PlanFinishDate|slice:"5:7"}}-{{operation.PlanFinishDate|slice:"0:4"}}
                                    {% endif %}
                                  </td>
                                  <td>{{operation.EstSetupTime|floatformat}}</td>
                                  <td>{{operation.EstOperationTime|floatformat}}</td>
                                  <td>{{operation.EstLaborTime|floatformat}}</td>
                                  <td></td>
                                  <td></td>
                                  <td></td>
                                  <td colspan="2">
                                    <svg id="barcode_1_{{forloop.counter}}"></svg>
                                    <script>
                                    JsBarcode("#barcode_1_{{forloop.counter}}", "{{operation.OperationNo}}", {
                                      format: "CODE39",
                                      displayValue: false,
                                      width: 1,
                                      height: 20,
                                      margin: 0,
                                    });
                                    </script>
                                  </td>
                                  <td></td>
                                </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                          <div class="row" style="font-size: 10px;">
                            <div class="col-10">
                              Effective Date : 15 December 2021, retention for ISO 9001 3 years, IATF 16949 15 years, AS9100 10 years except special requirements defined in the announcement "Retention of Quality Records"
                            </div>
                            <div class="col-2 text-right">
                              FM-GEN-PC-084 Rev.1
                            </div>
                          </div>
                        </div>
                        {% if pageCount >= 2 %}
                        <div id="page_2">
                          <div class="row">
                            <div class="col-2"></div>
                            <div class="col-5 text-center"><h3>Partial Lot Traveller</h3></div>
                            <div class="col-4" style="padding-top: 3px">
                              <div class="form-check form-check-inline mr-1">
                                <input class="form-check-input" type="checkbox" id="non_asm_2" {% if plt.Type.strip == 'NONASM' %}checked{% endif %} style="width: 18px; height: 18px;">&nbsp;&nbsp;
                                <h5 class="form-check-label">Non-ASM</h5>
                              </div>
                              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                              <div class="form-check form-check-inline mr-1">
                                <input class="form-check-input" type="checkbox" id="asm_2" {% if plt.Type.strip == 'ASM' %}checked{% endif %} style="width: 18px; height: 18px;">&nbsp;&nbsp;
                                <h5 class="form-check-label">ASM</h5>
                              </div>
                            </div>
                            <div class="col-1 text-right" style="padding-top: 3px">2/{{pageCount}}</div>
                          </div>
                          <table class="table small">
                            <tbody>
                              <tr>
                                <td class="toprow title toptable"><strong>Prod. Order No.</strong></td>
                                <td class="toprow toptable">{{orderNo}}/<input type="text" style="border: none; width: 20%" id="lot_no_2" value="{{LotNo}}"></td>
                                <td class="toprow title toptable"><strong>Sales order No.</strong></td>
                                <td class="toprow toptable">{{order.SalesOrderNo|default_if_none:""}}</td>
                                <td class="toprow title toptable"><strong>Sales Order Qty</strong></td>
                                <td class="toprow toptable">{{order.SalesOrderQuantity|floatformat|default_if_none:""}}</td>
                                <td class="toprow title toptable"><strong>Partial Lot Qty</strong></td>
                                <td class="toprow toptable" colspan="2"><input type="text" style="border: none; width: 100%" id="pl_qty_2" value="{{plt.LotQty}}"></td>
                              </tr>
                              <tr>
                                <td class="title"><strong>Release Date</strong></td>
                                <td>
                                  {% if order.ReleaseDate != None %}
                                  {{order.ReleaseDate|replace:".|-" }}
                                  <!-- {{order.ReleaseDate|slice:"8:10"}}-{{order.ReleaseDate|slice:"5:7"}}-{{order.ReleaseDate|slice:"0:4"}} -->
                                  {% endif %}
                                </td>
                                <td class="title"><strong>Request Date</strong></td>
                                <td>
                                  {{order.RequestDate|replace:".|-" }}
                                  {% if order.RequestDate != None %}
                                  {{order.RequestDate|replace:".|-" }}
                                  <!-- {{order.RequestDate|slice:"8:10"}}-{{order.RequestDate|slice:"5:7"}}-{{order.RequestDate|slice:"0:4"}} -->
                                  {% endif %}
                                </td>
                                <td class="title"><strong>Prod. Order Qty</strong></td>
                                <td>{{order.ProductionOrderQuatity|floatformat|default_if_none:""}}</td>
                                <td rowspan="2"></td>
                                <td rowspan="2"></td>
                                <td rowspan="2"></td>
                              </tr>
                              <tr>
                                <td class="title"><strong>FG. Mat. Code. No.</strong></td>
                                <td>{{order.FG_MaterialCode|default_if_none:""}}</td>
                                <td class="title"><strong>RM Mat'l Code No.</strong></td>
                                <td>{{order.RM_MaterialCode|default_if_none:""}}</td>
                                <td class="title"><strong>MRP Controller</strong></td>
                                <td>{{order.MRP_Controller|default_if_none:""}}</td>
                              </tr>
                              <tr>
                                <td class="title"><strong>Drawing No./Rev.</strong></td>
                                <td colspan="3">{{order.DrawingNo|default_if_none:""}}</td>
                                <td class="title"><strong>PO No. (Customer)</strong></td>
                                <td>{{order.CustomerPONo|default_if_none:""}}</td>
                                <td class="title"><strong>Mgr/Eng'r/MRP</strong></td>
                                <td class="title"><strong>QA</strong></td>
                                <td class="title"><strong>CS</strong></td>
                              </tr>
                              <tr>
                                <td class="title"><strong>Part No./Rev.</strong></td>
                                <td colspan="3">{{order.PartNo|default_if_none:""}}</td>
                                <td class="title"><strong>Sale Create Date</strong></td>
                                <td>
                                  {% if order.SalesCreateDate != None %}
                                  {{order.SalesCreateDate|replace:".|-" }}
                                  <!-- {{order.SalesCreateDate|slice:"8:10"}}-{{order.SalesCreateDate|slice:"5:7"}}-{{order.SalesCreateDate|slice:"0:4"}} -->
                                  {% endif %}
                                </td>
                                <td class="text-center" colspan="3" rowspan="2">
                                  <svg id="barcode_2"></svg>
                                  <script>
                                  JsBarcode("#barcode_2", "{{orderNo}}", {
                                    format: "CODE39",
                                    displayValue: false,
                                    width: 1,
                                    height: 40,
                                    margin: 0,
                                  });
                                  </script>
                                </td>
                              </tr>
                              <tr>
                                <td class="title"><strong>Part Name</strong></td>
                                <td colspan="3">{{order.PartName|default_if_none:""}}</td>
                                <td class="title"><strong>Printed Date</strong></td>
                                <td>{% now 'd-m-Y' %}</td>
                              </tr>
                            </tbody>
                          </table>
                          <table class="table text-center table-sm">
                            <tbody>
                              <tr>
                                <td class="title bottable" rowspan="2" colspan="2"><strong>Routing<br>กระบวนการผลิต<br>Operation Number<br>Group/Grp.Counter</strong></td>
                                <td class="title bottable" colspan="3"><strong>Planning</strong></td>
                                <td class="title bottable" colspan="3"><strong>Estimate Time</strong></td>
                                <td class="title bottable"><strong>งานดี<br>Accept</strong></td>
                                <td class="title bottable"><strong>งานเสีย<br>Reject</strong></td>
                                <td class="title bottable"><strong>ผู้ผลิต<br>ID / ประทับตรา</strong></td>
                                <td class="title bottable" rowspan="2" colspan="2"><strong>Barcode</strong></td>
                                <td class="title bottable" rowspan="2"><strong>Operation Short Text</strong></td>
                              </tr>
                              <tr>
                                <td class="title bottable"><strong>วันที่เริ่มผลิต<br>Start Date</strong></td>
                                <td class="title bottable"><strong>แผนการผลิต<br>Planning<br>(Day)</strong></td>
                                <td class="title bottable"><strong>วันที่ผลิตเสร็จ<br>Planned Finish<br>Date</strong></td>
                                <td class="title bottable"><strong>Setup<br>Time<br>(Min)</strong></td>
                                <td class="title bottable"><strong>Operation<br>Time<br>(Min)</strong></td>
                                <td class="title bottable"><strong>Labor<br>Time<br>(Min)</strong></td>
                                <td class="title bottable"><strong>(Qty)</strong></td>
                                <td class="title bottable"><strong>(Qty)</strong></td>
                                <td class="title bottable"><strong>Operator<br>ID / Stamp</strong></td>
                              </tr>
                              {% for operation in operationList2 %}
                                <tr>
                                  <td>{{operation.OperationNo}}</td>
                                  <td>{{operation.WorkCenterNo}}</td>
                                  <td>
                                    {% if operation.PlanStartDate != None %}
                                    {{operation.PlanStartDate|slice:"8:10"}}-{{operation.PlanStartDate|slice:"5:7"}}-{{operation.PlanStartDate|slice:"0:4"}}
                                    {% endif %}
                                  </td>
                                  <td>{{planDayCountList2|index:forloop.counter0}}</td>
                                  <td>
                                    {% if operation.PlanFinishDate != None %}
                                    {{operation.PlanFinishDate|slice:"8:10"}}-{{operation.PlanFinishDate|slice:"5:7"}}-{{operation.PlanFinishDate|slice:"0:4"}}
                                    {% endif %}
                                  </td>
                                  <td>{{operation.EstSetupTime|floatformat}}</td>
                                  <td>{{operation.EstOperationTime|floatformat}}</td>
                                  <td>{{operation.EstLaborTime|floatformat}}</td>
                                  <td></td>
                                  <td></td>
                                  <td></td>
                                  <td colspan="2">
                                    <svg id="barcode_2_{{forloop.counter}}"></svg>
                                    <script>
                                    JsBarcode("#barcode_2_{{forloop.counter}}", "{{operation.OperationNo}}", {
                                      format: "CODE39",
                                      displayValue: false,
                                      width: 1,
                                      height: 20,
                                      margin: 0,
                                    });
                                    </script>
                                  </td>
                                  <td></td>
                                </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                          <div class="row" style="font-size: 10px;">
                            <div class="col-10">
                              Effective Date : 15 December 2021, retention for ISO 9001 3 years, IATF 16949 15 years, AS9100 10 years except special requirements defined in the announcement "Retention of Quality Records"
                            </div>
                            <div class="col-2 text-right">
                              FM-GEN-PC-084 Rev.1
                            </div>
                          </div>
                        </div>
                        {% endif %}
                        {% if pageCount >= 3 %}
                        <div id="page_3">
                          <div class="row">
                            <div class="col-2"></div>
                            <div class="col-5 text-center"><h3>Partial Lot Traveller</h3></div>
                            <div class="col-4" style="padding-top: 3px">
                              <div class="form-check form-check-inline mr-1">
                                <input class="form-check-input" type="checkbox" id="non_asm_3" style="width: 18px; height: 18px;" {% if plt.Type.strip == 'NONASM' %}checked{% endif %}>&nbsp;&nbsp;
                                <h5 class="form-check-label">Non-ASM</h5>
                              </div>
                              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                              <div class="form-check form-check-inline mr-1">
                                <input class="form-check-input" type="checkbox" id="asm_3" style="width: 18px; height: 18px;" {% if plt.Type.strip == 'ASM' %}checked{% endif %}>&nbsp;&nbsp;
                                <h5 class="form-check-label">ASM</h5>
                              </div>
                            </div>
                            <div class="col-1 text-right" style="padding-top: 3px">3/{{pageCount}}</div>
                          </div>
                          <table class="table small">
                            <tbody>
                              <tr>
                                <td class="toprow title toptable"><strong>Prod. Order No.</strong></td>
                                <td class="toprow toptable">{{orderNo}}/<input type="text" style="border: none; width: 20%" id="lot_no_3" value="{{LotNo}}"></td>
                                <td class="toprow title toptable"><strong>Sales order No.</strong></td>
                                <td class="toprow toptable">{{order.SalesOrderNo|default_if_none:""}}</td>
                                <td class="toprow title toptable"><strong>Sales Order Qty</strong></td>
                                <td class="toprow toptable">{{order.SalesOrderQuantity|floatformat|default_if_none:""}}</td>
                                <td class="toprow title toptable"><strong>Partial Lot Qty</strong></td>
                                <td class="toprow toptable" colspan="2"><input type="text" style="border: none; width: 100%" id="pl_qty_3" value="{{plt.LotQty}}"></td>
                              </tr>
                              <tr>
                                <td class="title"><strong>Release Date</strong></td>
                                <td>
                                  {% if order.ReleaseDate != None %}
                                  {{order.ReleaseDate|replace:".|-" }}
                                  <!-- {{order.ReleaseDate|slice:"8:10"}}-{{order.ReleaseDate|slice:"5:7"}}-{{order.ReleaseDate|slice:"0:4"}} -->
                                  {% endif %}
                                </td>
                                <td class="title"><strong>Request Date</strong></td>
                                <td>
                                  {% if order.RequestDate != None %}
                                  {{order.RequestDate|replace:".|-" }}
                                  <!-- {{order.RequestDate|slice:"8:10"}}-{{order.RequestDate|slice:"5:7"}}-{{order.RequestDate|slice:"0:4"}} -->
                                  {% endif %}
                                </td>
                                <td class="title"><strong>Prod. Order Qty</strong></td>
                                <td>{{order.ProductionOrderQuatity|floatformat|default_if_none:""}}</td>
                                <td rowspan="2"></td>
                                <td rowspan="2"></td>
                                <td rowspan="2"></td>
                              </tr>
                              <tr>
                                <td class="title"><strong>FG. Mat. Code. No.</strong></td>
                                <td>{{order.FG_MaterialCode|default_if_none:""}}</td>
                                <td class="title"><strong>RM Mat'l Code No.</strong></td>
                                <td>{{order.RM_MaterialCode|default_if_none:""}}</td>
                                <td class="title"><strong>MRP Controller</strong></td>
                                <td>{{order.MRP_Controller|default_if_none:""}}</td>
                              </tr>
                              <tr>
                                <td class="title"><strong>Drawing No./Rev.</strong></td>
                                <td colspan="3">{{order.DrawingNo|default_if_none:""}}</td>
                                <td class="title"><strong>PO No. (Customer)</strong></td>
                                <td>{{order.CustomerPONo|default_if_none:""}}</td>
                                <td class="title"><strong>Mgr/Eng'r/MRP</strong></td>
                                <td class="title"><strong>QA</strong></td>
                                <td class="title"><strong>CS</strong></td>
                              </tr>
                              <tr>
                                <td class="title"><strong>Part No./Rev.</strong></td>
                                <td colspan="3">{{order.PartNo|default_if_none:""}}</td>
                                <td class="title"><strong>Sale Create Date</strong></td>
                                <td>
                                  {% if order.SalesCreateDate != None %}
                                  {{order.SalesCreateDate|replace:".|-" }}
                                  <!-- {{order.SalesCreateDate|slice:"8:10"}}-{{order.SalesCreateDate|slice:"5:7"}}-{{order.SalesCreateDate|slice:"0:4"}} -->
                                  {% endif %}
                                </td>
                                <td class="text-center" colspan="3" rowspan="2">
                                  <svg id="barcode_3"></svg>
                                  <script>
                                  JsBarcode("#barcode_3", "{{orderNo}}", {
                                    format: "CODE39",
                                    displayValue: false,
                                    width: 1,
                                    height: 40,
                                    margin: 0,
                                  });
                                  </script>
                                </td>
                              </tr>
                              <tr>
                                <td class="title"><strong>Part Name</strong></td>
                                <td colspan="3">{{order.PartName|default_if_none:""}}</td>
                                <td class="title"><strong>Printed Date</strong></td>
                                <td>{% now 'd-m-Y' %}</td>
                              </tr>
                            </tbody>
                          </table>
                          <table class="table text-center table-sm">
                            <tbody>
                              <tr>
                                <td class="title bottable" rowspan="2" colspan="2"><strong>Routing<br>กระบวนการผลิต<br>Operation Number<br>Group/Grp.Counter</strong></td>
                                <td class="title bottable" colspan="3"><strong>Planning</strong></td>
                                <td class="title bottable" colspan="3"><strong>Estimate Time</strong></td>
                                <td class="title bottable"><strong>งานดี<br>Accept</strong></td>
                                <td class="title bottable"><strong>งานเสีย<br>Reject</strong></td>
                                <td class="title bottable"><strong>ผู้ผลิต<br>ID / ประทับตรา</strong></td>
                                <td class="title bottable" rowspan="2" colspan="2"><strong>Barcode</strong></td>
                                <td class="title bottable" rowspan="2"><strong>Operation Short Text</strong></td>
                              </tr>
                              <tr>
                                <td class="title bottable"><strong>วันที่เริ่มผลิต<br>Start Date</strong></td>
                                <td class="title bottable"><strong>แผนการผลิต<br>Planning<br>(Day)</strong></td>
                                <td class="title bottable"><strong>วันที่ผลิตเสร็จ<br>Planned Finish<br>Date</strong></td>
                                <td class="title bottable"><strong>Setup<br>Time<br>(Min)</strong></td>
                                <td class="title bottable"><strong>Operation<br>Time<br>(Min)</strong></td>
                                <td class="title bottable"><strong>Labor<br>Time<br>(Min)</strong></td>
                                <td class="title bottable"><strong>(Qty)</strong></td>
                                <td class="title bottable"><strong>(Qty)</strong></td>
                                <td class="title bottable"><strong>Operator<br>ID / Stamp</strong></td>
                              </tr>
                              {% for operation in operationList3 %}
                                <tr>
                                  <td>{{operation.OperationNo}}</td>
                                  <td>{{operation.WorkCenterNo}}</td>
                                  <td>
                                    {% if operation.PlanStartDate != None %}
                                    {{operation.PlanStartDate|slice:"8:10"}}-{{operation.PlanStartDate|slice:"5:7"}}-{{operation.PlanStartDate|slice:"0:4"}}
                                    {% endif %}
                                  </td>
                                  <td>{{planDayCountList2|index:forloop.counter0}}</td>
                                  <td>
                                    {% if operation.PlanFinishDate != None %}
                                    {{operation.PlanFinishDate|slice:"8:10"}}-{{operation.PlanFinishDate|slice:"5:7"}}-{{operation.PlanFinishDate|slice:"0:4"}}
                                    {% endif %}
                                  </td>
                                  <td>{{operation.EstSetupTime|floatformat}}</td>
                                  <td>{{operation.EstOperationTime|floatformat}}</td>
                                  <td>{{operation.EstLaborTime|floatformat}}</td>
                                  <td></td>
                                  <td></td>
                                  <td></td>
                                  <td colspan="2">
                                    <svg id="barcode_3_{{forloop.counter}}"></svg>
                                    <script>
                                    JsBarcode("#barcode_3_{{forloop.counter}}", "{{operation.OperationNo}}", {
                                      format: "CODE39",
                                      displayValue: false,
                                      width: 1,
                                      height: 20,
                                      margin: 0,
                                    });
                                    </script>
                                  </td>
                                  <td></td>
                                </tr>
                              {% endfor %}
                            </tbody>
                          </table>
                          <div class="row" style="font-size: 10px;">
                            <div class="col-10">
                              Effective Date : 15 December 2021, retention for ISO 9001 3 years, IATF 16949 15 years, AS9100 10 years except special requirements defined in the announcement "Retention of Quality Records"
                            </div>
                            <div class="col-2 text-right">
                              FM-GEN-PC-084 Rev.1
                            </div>
                          </div>
                        </div>
                        {% endif %}
                      </div>
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>
              {% endif %}
            </div>
          </div>
        </main>
      </div>
      <!-- *** FOOTER *** -->
      <div class="modal" id="increase_lot_no_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-danger" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-fork" style="transform: rotateZ(180deg); transform: scaleY(-1);"></i> Partial Lot</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br><h4 class="text-center">Are you sure to create another partial lot ?</h4><br>
              <div class="row">
                <div class="col-5 text-right">
                  <h1 style="font-size: 72px">{{order.LotNo}}</h1>
                </div>
                <div class="col-2 text-center">
                  <i class="c-icon c-icon-xl cil-arrow-right" style="padding-top: 40px"></i>
                </div>
                <div class="col-5 text-left">
                  <h1 style="font-size: 72px">{{order.LotNo|add:1}}</h1>
                </div>
              </div>
              <br>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm my-password" type="text" id="sl_password" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Start At Operation</strong></label>
                <div class="col-md-8">
                  <select class="form-control form-control-sm" id="sl_start_operation_no">
                    {% for opr in operationList %}
                    <option value="{{opr.OperationNo}}">{{opr.OperationNo}}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Lot Qty</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="text" id="sl_lot_qty" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Type</strong></label>
                <div class="col-md-8">
                  <select class="form-control form-control-sm" id="sl_type">
                    <option value="NONASM">NON-ASM</option>
                    <option value="ASM">ASM</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <small>Permission: Section Chief+</small>
              <button class="btn btn-danger" type="button" id="trash_confirm_button" onclick="increase_lot_no()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- CoreUI and necessary plugins-->
    <script src="{% static "vendors/@coreui/coreui-pro/js/coreui.bundle.min.js" %}"></script>
    <!--[if IE]><!-->
    <script src="{% static "vendors/@coreui/icons/js/svgxuse.min.js" %}"></script>
    <!--<![endif]-->
    <script src="{% static "vendors/jquery/js/jquery.min.js" %}"></script>
    <script src="{% static "vendors/select2/js/select2.min.js" %}"></script>
    <script src="{% static "vendors/printThis/printThis.js" %}"></script>
    <!-- Custom -->
    <script src="{% static "customize/js/clock.js" %}"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function(event) {
        setTimeout(function() {
          document.body.classList.remove('c-no-layout-transition')
        }, 2000);
      });

      $("#sl_lot_qty").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      function printDiv(){
        $('#print-area').printThis();
      }

      function prepare_increase_lot_no(){
        $("#sl_password").val("");
        $("#sl_lot_qty").val("");
        remove_valid_many(["sl_password","sl_lot_qty"]);
      }

      function increase_lot_no(){
        if($('#sl_lot_qty').val() == "") $('#sl_lot_qty').val("0");
        var order_no = $("#order_no").val();
        var password = $("#sl_password").val();
        var start_operation_no = $("#sl_start_operation_no").val();
        var lot_qty = $("#sl_lot_qty").val();
        var type = $("#sl_type").val();
        var final_lot_no = $("#final_lot_no").val();
        remove_valid_many(["sl_password","sl_lot_qty"]);
        validate_section_chief_password(password, function(isCorrect, invalid_text) {
          if(!isCorrect){
            invalid("sl_password");
          } else {
            if(lot_qty <= 0){
              invalid("sl_lot_qty");
            } else {
              valid("sl_lot_qty");
              $.ajax({
                url: '/increase_lot_no/',
                data: {
                  'order_no': order_no,
                  'password': password,
                  'start_operation_no': start_operation_no,
                  'lot_qty': lot_qty,
                  'type': type,
                  'final_lot_no': final_lot_no,
                },
                dataType: 'json',
                success: function (data) {
                  location.reload();
                }
              });
            }
          }
        });
      }

      function validate_section_chief_password(password, _callback){
        if(password.length == 0) _callback(false, "Please fill Password.");
        else if(password.length < 4) _callback(false, "Password is not correct.");
        else {
          $.ajax({
            url: '/validate_section_chief_password/',
            data: {
              'password': password,
            },
            dataType: 'json',
            success: function (data) {
              (data.isCorrect)? _callback(true, ""):_callback(false, "Password is not correct.");
            }
          });
        }
      }
    </script>

    <!-- SHORTCUT SEARCH -->
    <script>
      document.getElementById("sc_order_no").addEventListener("keydown", function (e) {
        if (e.code === "Enter" || e.code == "NumpadEnter") shortcut_search();
      });

      $('#sc_lot_no').change(function() {
        shortcut_search();
      });

      function shortcut_search(){
          var order_no =  $("#sc_order_no").val();
          var lot_no =  $("#sc_lot_no").val();
          (order_no.length < 6)? invalid("sc_order_no"): valid("sc_order_no");
          if(order_no.length >= 6){
            remove_valid_many(["sc_order_no"]);
            window.open('/lot_traveller/' + order_no + "&" + lot_no, '_self');
          }
        }

      $("#sc_order_no").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      //-- VALIDATE CONTROL
      remove_valid_many = (input_ids) => { for(var i = 0;i < input_ids.length;i++) remove_valid(input_ids[i]); }
      valid_many = (input_ids) => { for(var i = 0;i < input_ids.length;i++) valid(input_ids[i]); }
      invalid_many = (input_ids) => { for(var i = 0;i < input_ids.length;i++) invalid(input_ids[i]); }

      function remove_valid(input_id){
        $("#"+input_id).removeClass("is-invalid");
        $("#"+input_id).removeClass("is-valid");
      }

      function valid(input_id){
        $("#"+input_id).addClass("is-valid");
        $("#"+input_id).removeClass("is-invalid");
      }

      function invalid(input_id){
        $("#"+input_id).addClass("is-invalid");
        $("#"+input_id).removeClass("is-valid");
      }

      function frontZero(str, len){
        var result = str;
        for(var i = str.length;i < len;i++) result = "0" + result;
        return result;
      }
    </script>
  </body>
</html>
