<!DOCTYPE html>
{% load static %}
{% load extra %}
<!--
* CoreUI Pro based Bootstrap Admin Template
* @version v3.2.0
* @link https://coreui.io/pro/
* Copyright (c) 2020 creativeLabs Łukasz Holeczek
* License (https://coreui.io/pro/license)
-->
<html lang="en">
  <head>
    <base href="./">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description" content="CoreUI - Open Source Bootstrap Admin Template">
    <meta name="author" content="Łukasz Holeczek">
    <meta name="keyword" content="Bootstrap,Admin,Template,Open,Source,jQuery,CSS,HTML,RWD,Dashboard">
    <title>Cummulative Rejection | Shopfloor Reporting Application</title>
    <!-- Main styles for this application-->
    <link rel="stylesheet" href="{% static "css/style.css" %}">
    <!-- Icon CSS -->
    <link href="{% static "vendors/@coreui/icons/css/free.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/@coreui/icons/css/brand.min.css" %}" rel="stylesheet">
    <!-- Select CSS -->
    <link href="{% static "vendors/select2/css/select2.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/select2/css/select2-coreui.min.css" %}" rel="stylesheet">
    <!-- Data Table CSS -->
    <link href="{% static "vendors/datatables.net-bs4/css/dataTables.bootstrap4.css" %}" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static "customize/css/decorate.css" %}" rel="stylesheet">
    <!-- Chart CSS -->
    <link href="{% static "vendors/@coreui/chartjs/css/coreui-chartjs.css" %}" rel="stylesheet" >
  </head>
  <body class="c-app c-no-layout-transition">
    <!-- *** LEFT SIDE BAR *** -->
    {% include 'sidebar.html' %}
    <!-- *** RIGHT SIDE BAR *** -->
    <div class="c-wrapper">
      <!-- *** HEADER *** -->
      <header class="c-header c-header-light c-header-fixed">
        {% include 'header.html' %}
        <div class="c-subheader justify-content-between px-3">
          <!-- Breadcrumb-->
          <ol class="breadcrumb border-0 m-0 px-0 px-md-3">
            <li class="breadcrumb-item">Cummulative Rejection</li>
            <!-- Breadcrumb Menu-->
            <li class="breadcrumb-item active">{{pfc}} ({{month}})</li>
          </ol>
          <div class="c-subheader-nav d-md-down-none mfe-2">
            <button type="button" class="btn mg-5 btn-pill btn-dark" data-toggle="modal" data-target="#filter_modal"><i class="cil cil-filter"></i>&nbsp;&nbsp;Filter</button>
          </div>
        </div>
      </header>
      <!-- *** BODY *** -->
      <div class="c-body">
        <main class="c-main">
          <div class="container-fluid">
            <div class="fade-in">
              <div class="row">
                <div class="col-md-12">
                  <div class="card">
                    <div class="card-body">
                      <div class="row">
                        <div class="col-12">
                          <div class="row">
                            <div class="col-12">
                              <div class="card border-dard">
                                <div class="card-header">
                                  {{fpfc}}
                                </div>
                                <div class="card-body">
                                  <div class="row">
                                    <div class="col-9">
                                      <canvas id="chart" width="400" height="180"></canvas>
                                      <div class="text-center mt-3">
                                        <form action="/report/graph/cumulative_rejection_record/" method="POST" id="form2">
                                          {% csrf_token %}
                                          <input class="form-control" type="month" name="month" value="{{month}}" hidden>
                                          <input class="form-control" type="text" name="pfc" value="{{pfc}}" hidden>
                                          <button type="submit" class="btn btn-danger">See Record</button>
                                        </form>
                                      </div>
                                      <small>* Rejection from MT_AS will not be considered.</small>
                                    </div>
                                    <div class="col-3">
                                      <table class="table table-sm table-outline small">
                                        <thead class="thead-light">
                                          <th>Date</th>
                                          <th>Order Qty</th>
                                          <th>Reject Qty</th>
                                          <th>Reject Percentage</th>
                                        </thead>
                                        <tbody>
                                          {% for day in days %}
                                          <tr>
                                            {% if is_sundays|index:forloop.counter0 %}
                                            <th class="text-danger">{{day}}</th>
                                            {% else %}
                                            <th>{{day}}</th>
                                            {% endif %}
                                            <td>{{orders|index:forloop.counter0|floatformat}}</td>
                                            <td>{{rejects|index:forloop.counter0|floatformat}}</td>
                                            <td>{{percentages|index:forloop.counter0|floatformat}} %</td>
                                          </tr>
                                          {% endfor %}
                                          <tr class="bg-light text-dark">
                                            <th>Total</th>
                                            <th>{{total_order|floatformat}}</th>
                                            <th>{{total_reject|floatformat}}</th>
                                            <th>{{total_percentage|floatformat}} %</th>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
      <!-- *** FOOTER *** -->
      {% include 'footer.html' %}

      <!-- Filter Modal -->
      <div class="modal" id="filter_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header bg-darkslategray">
              <h4 class="modal-title">Filter</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <form action="/report/graph/cumulative_rejection/" method="POST" id="form">
              {% csrf_token %}
                <br>
                <div class="form-group row">
                  <label class="col-md-3 col-form-label text-right small"><strong>Month</strong></label>
                  <div class="col-md-8">
                    <input class="form-control" type="month" id="month" name="month" value="{{month}}">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-3 col-form-label text-right small"><strong>Profit Center</strong></label>
                  <div class="col-md-8">
                    <select class="form-control" name="pfc" id="pfc">
                      {% for ipfc in pfcs %}
                        <option value="{{ipfc.ProfitCenter}}" {% if ipfc.ProfitCenter == pfc %}selected{% endif %}>{{ipfc.ProfitCenter}}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button class="btn bg-darkslategray text-white" type="button" onclick="filter()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

    </div>
    <!-- CoreUI and necessary plugins-->
    <script src="{% static "vendors/@coreui/coreui-pro/js/coreui.bundle.min.js" %}"></script>
    <!--[if IE]><!-->
    <script src="{% static "vendors/@coreui/icons/js/svgxuse.min.js" %}"></script>
    <!--<![endif]-->
    <script src="{% static "vendors/jquery/js/jquery.min.js" %}"></script>
    <script src="{% static "vendors/select2/js/select2.min.js" %}"></script>
    <!-- Google Timeline JS -->
    <!-- <script src="{% static "vendors/google-timeline/js/loader.js" %}"></script> -->
    <!-- Data Table JS -->
    <script src="{% static "vendors/datatables.net/js/jquery.dataTables.js" %}"></script>
    <script src="{% static "vendors/datatables.net-bs4/js/dataTables.bootstrap4.min.js" %}"></script>
    <!-- Chart JS -->
    <!-- <script src="{% static "vendors/@coreui/chartjs/js/coreui-chartjs.bundle.js" %}"></script> -->
    <!-- <script src="{% static "js/charts.js" %}"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.0/dist/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.0.0-rc.1/chartjs-plugin-datalabels.min.js" integrity="sha512-+UYTD5L/bU1sgAfWA0ELK5RlQ811q8wZIocqI7+K0Lhh8yVdIoAMEs96wJAIbgFvzynPm36ZCXtkydxu1cs27w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/1.0.2/chartjs-plugin-annotation.min.js"></script>
    <!-- Custom -->
    <script src="{% static "customize/js/custom-function.js" %}"></script>
    <script src="{% static "customize/js/clock.js" %}"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function(event) {
        setTimeout(function() {
          document.body.classList.remove('c-no-layout-transition')
        }, 2000);
      });

      function filter(){
				document.getElementById('form').submit();
			}
    </script>
    <!-- GRAPH -->
    <script>
      window.onload = function() {
        // GRAPH
        var ctx = document.getElementById('chart').getContext('2d');
        var chart = new Chart(ctx, {
              type: 'bar',
              data: {
                  labels: {{days|safe}},
                  datasets: [{
                      label: 'Reject Percentage',
                      data: {{percentages}},
                      backgroundColor: 'rgb(247,79,117, 0.2)',
                      borderColor: 'rgb(247,79,117, 1)',
                      borderWidth: 1
                  }]
              },
              plugins: [ChartDataLabels],
              options: {
                plugins: {
                  datalabels: {
                		formatter: (value, ctx) => {
                			if(value > 0){
                        value = value.toString() + '%';
                        return value;
                      } else {
                        value = "";
                        return value;
                      }
                		},
                		anchor: 'end',
                		align: 'end',
                    rotation: '-45',
                	}
                },
                scales: {
                  x: {
                    stacked: false,
                    title: {
                      display: true,
                      text: 'Day',
                    }
                  },
                  y: {
                    // max: {{y_size}},
                    // min: 100,
                    stacked: false,
                    title: {
                      display: true,
                      text: 'Reject Percentage',
                    },
                  }
                }
              }
          });
      };
    </script>
  </body>
</html>
