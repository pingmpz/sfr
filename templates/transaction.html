<!DOCTYPE html>
{% load static %}
{% load extra %}
<!--
* CoreUI Pro based Bootstrap Admin Template
* @version v3.2.0
* @link https://coreui.io/pro/
* Copyright (c) 2020 creativeLabs Łukasz Holeczek
* License (https://coreui.io/pro/license)
-->
<html lang="en">
  <head>
    <base href="./">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description" content="CoreUI - Open Source Bootstrap Admin Template">
    <meta name="author" content="Łukasz Holeczek">
    <meta name="keyword" content="Bootstrap,Admin,Template,Open,Source,jQuery,CSS,HTML,RWD,Dashboard">
    <title>Transaction | Shopfloor Reporting Application</title>
    <!-- Main styles for this application-->
    <link rel="stylesheet" href="{% static "css/style.css" %}">
    <!-- Icon CSS -->
    <link href="{% static "vendors/@coreui/icons/css/free.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/@coreui/icons/css/brand.min.css" %}" rel="stylesheet">
    <!-- Select CSS -->
    <link href="{% static "vendors/select2/css/select2.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/select2/css/select2-coreui.min.css" %}" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static "customize/css/decorate.css" %}" rel="stylesheet">
  </head>
  <body class="c-app c-no-layout-transition">
    <!-- *** LEFT SIDE BAR *** -->
    {% include 'sidebar.html' %}
    <!-- *** RIGHT SIDE BAR *** -->
    <div class="c-wrapper">
      <!-- *** HEADER *** -->
      <header class="c-header c-header-light c-header-fixed">
        {% include 'header.html' %}
        <div class="c-subheader justify-content-between px-3">
          <!-- Breadcrumb-->
          <ol class="breadcrumb border-0 m-0 px-0 px-md-3">
            <li class="breadcrumb-item">Transaction</li>
            {% if state != "FIRSTPAGE" %}
            <li class="breadcrumb-item active">
              {% if operationBefore != -1 %}<a href="/transaction/{{orderNo}}{{operationBefore}}" class="text-primary" style="padding-top: 3px;"><i class="c-icon cil-chevron-left"></i></a>&nbsp;{% endif %}
              <span id="bc_order_no">{{orderNo}}</span>&nbsp;-&nbsp;<span id="bc_operation_no">{{operationNo}}</span>
              {% if operationAfter != -1 %}&nbsp;<a href="/transaction/{{orderNo}}{{operationAfter}}" class="text-primary" style="padding-top: 3px;"><i class="c-icon cil-chevron-right"></i></a>{% endif %}
            </li>
            {% endif %}
            <!-- Breadcrumb Menu-->
          </ol>
          <div class="c-subheader-nav d-md-down-none mfe-2">
            <input type="password" hidden> <!-- Prevent Auto fill Password -->
            <button type="button" class="btn btn-sm btn-pill btn-outline-danger" onclick="reset_all()">Reset All</button>
            &nbsp;&nbsp;<div>Prod. Order - Oper. No</div>
            &nbsp;&nbsp;<div><input type="text" class="form-control form-control-sm" maxlength="10" id="sc_order_no" autocomplete="off" value="{{orderNo}}"></div>
            &nbsp;&nbsp;<div>-</div>&nbsp;&nbsp;
            <div style="width:15%"><input type="text" class="form-control form-control-sm" maxlength="4" id="sc_operation_no" autocomplete="off" value="{{operationNo}}"></div>
            &nbsp;&nbsp;<div><button type="button" class="btn btn-sm btn-pill btn-outline-info" onclick="shortcut_search()">Go !</button></div>
          </div>
        </div>
        <div class="progress" style="height: 4px; width: 100%">
          <progress style="width: 100%;" value="0" max="300" id="progressBar"></progress>
        </div>
      </header>
      <!-- *** BODY *** -->
      <div class="c-body">
        <main class="c-main">
          <div class="container-fluid">
            <div class="fade-in">
              <!-- Hidden Input -->
              <div hidden>
                <input type="text" id="has_data" value="{% if state == "DATAFOUND" %}True{% else %}False{% endif %}">
                <input type="text" id="is_operating" value="{{IsOperating}}">
                <input type="text" id="workcenter_type" value="{{operation.WorkCenterType}}">
                <input type="text" id="join_list_length" value="{{joinList|length}}">
                <input type="text" id="is_joining" value="{% if operation.JoinToOrderNo != None %}True{% else %}False{% endif %}">
              </div>
              <!-- Main Body -->
              {% if state == "DATAFOUND" %}
              <div class="row" id="main_body">
                  <!-- Left Content -->
                  <div class="col-sm-12 col-md-4">
                    <div class="card border-secondary">
                      <div class="card-body">
                        <!-- Quantity -->
                        <div class="text-center">
                          <div class="ui-widget-info fade-in">
                            <h1 class="ui-value text-info"><strong>{{operation.ProcessQty.normalize}}</strong></h1>
                            <span class="ui-label text-info">Process</span>
                          </div>
                          &nbsp;
                          <div class="ui-widget-warning fade-in">
                            <h1 class="ui-value text-warning"><strong>{{remainQty.normalize}}</strong></h1>
                            <span class="ui-label text-warning">Remain</span>
                          </div>
                          &nbsp;
                          <div class="ui-widget-success fade-in">
                            <h1 class="ui-value text-success"><strong>{{operation.AcceptedQty.normalize}}</strong></h1>
                            <span class="ui-label text-success">Accept</span>
                          </div>
                          &nbsp;
                          <div class="ui-widget-danger fade-in">
                            <h1 class="ui-value text-danger"><strong>{{operation.RejectedQty.normalize}}</strong></h1>
                            <span class="ui-label text-danger">Reject</span>
                          </div>
                        </div>
                        <br>
                        <!-- Tab -->
                        <div class="nav-tabs-boxed">
                          <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#operation-tab" role="tab">Operation</a></li>
                            <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#order-tab" role="tab">Production Order</a></li>
                            <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#structure-tab" role="tab">Structure ({{operationList|length}})</a></li>
                          </ul>
                          <div class="tab-content">
                            <!-- Operation Tab -->
                            <div class="tab-pane small active" id="operation-tab" role="tabpanel">
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Production Order No</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="order_no" value="{{orderNo}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Operation No</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="operation_no" value="{{operationNo}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Operation Start</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="operation_start" value="{{operation.ProcessStart|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Operation Stop</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="operation_stop" value="{{operation.ProcessStop|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row" hidden>
                                <label class="col-md-5 col-form-label text-right text-info"><strong>Process Qty</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="process_qty" value="{{operation.ProcessQty}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row" hidden>
                                <label class="col-md-5 col-form-label text-right text-warning"><strong>Remain Qty</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="remain_qty" value="{{remainQty}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row" hidden>
                                <label class="col-md-5 col-form-label text-right text-success"><strong>Accepted Qty</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="accepted_qty" value="{{operation.AcceptedQty}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row" hidden>
                                <label class="col-md-5 col-form-label text-right text-danger"><strong>Rejected Qty</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="rejected_qty" value="{{operation.RejectedQty}}" readonly>
                                </div>
                              </div>
                              <hr>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Work Center</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="work_center" value="{{operation.WorkCenterNo}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Work Center Group</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="work_center_group" value="{{operation.WorkCenterGroup}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Plan Start</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="plan_start" value="{{operation.PlanStartDate|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Plan Finish</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="plan_finish" value="{{operation.PlanFinishDate|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Est. Setup Time</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="est_setup_time" value="{{operation.EstSetupTime|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Est. Operation Time</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="est_operate_time" value="{{operation.EstOperationTime|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Est. Labor Time</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="est_labor_time" value="{{operation.EstLaborTime|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Date Get From SAP</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="operation_date_get_from_sap" value="{{operation.DateGetFromSAP|default_if_none:'Created at SFR'}}" readonly>
                                </div>
                              </div>
                            </div>
                            <!-- Production Order Tab -->
                            <div class="tab-pane small" id="order-tab" role="tabpanel">
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right text-primary"><strong>Prod. Order Qty</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="order_qty" value="{{order.ProductionOrderQuatity}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Order Start</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="order_start" value="{{order.ProcessStart|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Order Stop</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="order_stop" value="{{order.ProcessStop|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Customer PO No</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="customer_po_no" value="{{order.CustomerPONo|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Part No</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="part_no" value="{{order.PartNo|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Part Name</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="part_name" value="{{order.PartName|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Sales Order No</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="sale_order_no" value="{{order.SalesOrderNo|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Sales Create Date</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="sale_create_date" value="{{order.SalesCreateDate|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Sales Order Qty</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="sale_order_qty" value="{{order.SalesOrderQuantity|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>FG Mat Code</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="fg_material_code" value="{{order.FG_MaterialCode|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>RM Mat Code</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="rm_material_code" value="{{order.RM_MaterialCode|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>MRP Controller</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="mrp_controller" value="{{order.MRP_Controller|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Request Date</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="request_date" value="{{order.request_date|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Release Date</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="release_date" value="{{order.ReleaseDate|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Drawing No</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="drawing_no" value="{{order.DrawingNo|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Routing Group</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="routing_group" value="{{order.RoutingGroup|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Routing Group Counter</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="routing_group_counter" value="{{order.RoutingGroupCounter|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Plant</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="plant" value="{{order.Plant|default_if_none:""}}" readonly>
                                </div>
                              </div>
                              <div class="form-group row">
                                <label class="col-md-5 col-form-label text-right"><strong>Date Get From SAP</strong></label>
                                <div class="col-md-7">
                                  <input class="form-control form-control-sm" type="text" id="order_date_get_from_sap" value="{{order.DateGetFromSAP|default_if_none:""}}" readonly>
                                </div>
                              </div>
                            </div>
                            <!-- Structure Tab -->
                            <div class="tab-pane small" id="structure-tab" role="tabpanel">
                              <table class="table table-sm table-responsive-sm table-outline text-center">
                                <thead class="bg-darkslategray">
                                  <tr>
                                    <th>
                                      Status
                                      <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title="Tips"
                                      data-content="
                                      <strong class='text-success'>COMPLETED</strong><br>
                                      <strong class='text-primary'>JOINING</strong><br>
                                      <strong class='text-warning'>WORKING</strong><br>
                                      <strong class='text-info'>READY</strong><br>
                                      <strong class='text-danger'>ERROR</strong><br>
                                      ">?
                                      </a>
                                    </th>
                                    <th>Operation No</th>
                                    <th>Work Center</th>
                                    <th></th>
                                  </tr>
                                </thead>
                                <tbody>
                                  {% for operation in operationList %}
                                  <tr {% if operation.OperationNo.strip == operationNo %}class="bg-lavender"{% endif %}>
                                    <td>
                                      {% if operationStatusList|index:forloop.counter0 == 'COMPLETED' %}<i class="c-icon c-icon-sm cib-discover text-success" style="padding-top:5px"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'JOINING' %}<i class="c-icon c-icon-sm cib-discover text-primary" style="padding-top:5px"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'WORKING' %}<i class="c-icon c-icon-sm cib-discover text-warning" style="padding-top:5px"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'READY' %}<i class="c-icon c-icon-sm cib-discover text-info" style="padding-top:5px"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'ERROR' %}<i class="c-icon c-icon-sm cib-discover text-danger" style="padding-top:5px"></i>
                                      {% endif %}
                                    </td>
                                    <td>
                                      {% if operation.OperationNo != operationNo %}
                                      <a href="/transaction/{{orderNo}}{{operation.OperationNo}}">{{operation.OperationNo}}</a>
                                      {% else %}
                                      {{operation.OperationNo}}
                                      {% endif %}
                                    </td>
                                    <td>{{operation.WorkCenterNo}}</td>
                                    <td>
                                      {% if operation.IsExternalProcess %}<i class="c-icon c-icon-sm cil-external-link"></i>
                                      {% elif operation.WorkCenterType == 'Labor' %}<i class="c-icon c-icon-sm cil-user"></i>
                                      {% elif operation.WorkCenterType == 'Machine' %}<i class="c-icon c-icon-sm cil-gauge"></i>
                                      {% endif %}
                                    </td>
                                  </tr>
                                  {% endfor %}
                                </tbody>
                              </table>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Right Content -->
                  <div class="col-sm-12 col-md-8">
                    <div class="row">
                      <!-- Button Group -->
                      <div class="col-md-6 text-left">
                        {% if order.ProcessStop == None %}
                        <button type="button" class="btn btn-xs btn-success my-btn small btn-icon" data-toggle="modal" data-target="#add_modal" id="add_main_button" onclick="prepare_add()"><i class="c-icon c-icon-xs cil-plus"></i><br>Add</button>
                        {% endif %}
                        {% if operation.ProcessStart == None and joinList|length == 0 and operation.JoinToOrderNo == None and operation.JoinToOperationNo == None %}
                        <button type="button" class="btn btn-xs btn-warning my-btn text-white small" data-toggle="modal" data-target="#change_modal" id="change_main_button" disabled><i class="c-icon c-icon-xs cil-transfer"></i><br>Change</button>
                        {% endif %}
                        {% if operation.ProcessStart == None and joinList|length == 0 and operation.JoinToOrderNo == None and operation.JoinToOperationNo == None %}
                        <button type="button" class="btn btn-xs btn-danger my-btn small" data-toggle="modal" data-target="#delete_modal" id="delete_main_button" onclick="prepare_delete()"><i class="c-icon c-icon-xs cil-trash"></i><br>Delete</button>
                        {% endif %}
                        <p></p>
                      </div>
                      <div class="col-md-6 text-right">
                        <a type="button" class="btn btn-xs btn-primary my-btn small" href="/join_activity/{{orderNo}}{{operationNo}}" id="join_main_button"><i class="c-icon c-icon-xs cil-fullscreen-exit"></i><br>Join</a>
                        <button type="button" class="btn btn-xs btn-danger my-btn small" data-toggle="modal" data-target="#break_join_modal" id="break_join_main_button"><i class="c-icon c-icon-xs cil-fullscreen"></i><br>Break Join</button>
                        {% if joinList|length > 0 %}
                        <button type="button" class="btn btn-xs btn-primary text-white my-btn small" data-toggle="modal" data-target="#join_list_modal" id="join_list_main_button"><i class="c-icon c-icon-xs cil-list"></i><br>Join List</button>
                        {% endif %}
                        {% if historyOperateList|length > 0 or historyConfirmList|length > 0 or historyJoinList|length > 0 %}
                        <button type="button" class="btn btn-xs btn-info text-white my-btn small" data-toggle="modal" data-target="#history_modal" id="history_main_button"><i class="c-icon c-icon-xs cil-history"></i><br>History</button>
                        {% endif %}
                        <a href="/transaction/0" class="btn btn-xs btn-dark my-btn small"><i class="c-icon c-icon-xs cil-account-logout"></i><br>Exit</a>
                        <p></p>
                      </div>
                      {% if remainQty > 0 %} <!-- *** START CONDITION 1 *** -->
                      {% if operation.JoinToOrderNo == None and operation.JoinToOperationNo == None %} <!-- *** START CONDITION 2 *** -->
                      <!-- WorkCenter/Operator -->
                      <div class="col-md-12">
                        <div class="card border-secondary">
                          <div class="card-header">
                            <strong>Work Center/Operator</strong>
                            <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title="Tips"
                            data-content="
                            - <strong class='text-danger'>Stop Working</strong> on manual workcenter will automatically stop workcenter.<br>
                            - You can ignore <strong class='text-primary'>Confirm</strong> and let operator after you confirm all quantity.<br>
                            - Employee working on <strong class='text-plum'>External Process</strong> can still work on other operations.<br>
                            - <strong class='text-plum'>External Process</strong> only keep startdatetime and stopdatetime, but not working time.<br>
                            - Be Careful !, <strong class='text-primary'>Confirm</strong> all remaining quantity will terminate all working operator and workcenter.<br>
                            ">?
                            </a>
                            <div class="card-header-actions">
                              <button class="btn btn-sm btn-link small" data-toggle="modal" data-target="#manual_report_modal" disabled><del>Manual Report</del></button>
                            </div>
                          </div>
                          <div class="card-body">
                            {% if operation.WorkCenterType == 'Machine' %}
                            <div class="form-group row">
                              <label class="col-md-2 col-form-label text-right"><strong><i class="c-icon c-icon-sm cil-plus"></i> Work Center</strong></label>
                              <div class="col-md-2">
                                <input class="form-control" type="text" id="workcenter_no" autocomplete="off" value="" oninput="let p=this.selectionStart;this.value=this.value.toUpperCase();this.setSelectionRange(p, p);">
                              </div>
                              <div class="col-md-5">
                                <input class="form-control" type="text" id="workcenter_name" value="" readonly>
                              </div>
                              <div class="col-md-2"><button type="button" class="btn btn-pill btn-info" id='workcenter_add_button' onclick="add_operating_workcenter()" disabled>Add</button></div>
                            </div>
                            <table class="table table-sm table-outline text-center" style="table-layout:fixed;" id="workcenter_table">
                              <thead class="bg-darkslategray">
                                <tr>
                                  <th></th>
                                  <th>Work Center</th>
                                  <th>Status</th>
                                  <th>Start Time</th>
                                  <th></th>
                                </tr>
                              </thead>
                              <tbody id="workcenter_table_body">

                              </tbody>
                            </table>
                            {% endif %}
                            <div class="form-group row">
                              <label class="col-md-2 col-form-label text-right"><strong><i class="c-icon c-icon-sm cil-plus"></i> Operator</strong></label>
                              <div class="col-md-2">
                                <input class="form-control" type="text" id="operator_id" autocomplete="off" value="">
                              </div>
                              <div class="col-md-5">
                                <input class="form-control" type="text" id="operator_name" value="" readonly>
                              </div>
                              <div class="col-md-3">
                                <button type="button" class="btn btn-pill {% if operation.IsExternalProcess %}bg-plum text-white{% else %}btn-success{% endif %}" id='operator_work_button' onclick="add_operating_operator('{% if operation.IsExternalProcess %}EXT-WORK{% else %}WORKING{% endif %}')" disabled>Start Work</button>
                                {% if operation.WorkCenterType == 'Machine' %}
                                <button type="button" class="btn btn-pill bg-yellowgreen text-white" id='operator_setup_button' onclick="add_operating_operator('SETUP')" disabled>Start Setup</button>
                                {% endif %}
                              </div>
                            </div>
                            <table class="table table-sm table-outline text-center" style="table-layout:fixed;" id="operator_table">
                              <thead class="bg-darkslategray">
                                <tr>
                                  {% if operation.WorkCenterType == 'Machine' %}<th>Work Center</th>{% endif %}
                                  <th>Operator</th>
                                  <th>Status</th>
                                  <th>Start-Stop Time</th>
                                  <th></th>
                                </tr>
                              </thead>
                              <tbody id="operator_table_body">

                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                      {% endif %} <!-- *** END CONDITION 2 *** -->
                      {% if operation.JoinToOrderNo != None and operation.JoinToOperationNo != None %} <!-- *** START CONDITION 2 *** -->
                      <!-- Joining -->
                      <div class="col-md-12">
                        <div class="card text-white bg-primary text-center">
                          <div class="card-body text-center">
                            <br><br><br><br><br>
                            <h1><i class="c-icon c-icon-2xl cil-fork" style="font-size: 10rem; width: 10rem;"></i></h1>
                            <br>
                            <h3><strong>THIS OPERATION IS JOINING</strong></h3>
                            <br>
                            <a href="/transaction/{{operation.JoinToOrderNo}}{{operation.JoinToOperationNo}}" class="btn btn-pill btn-lg btn-dark small"><strong>&nbsp;&nbsp;&nbsp;GO TO JOIN OPERATION #{{operation.JoinToOrderNo}}-{{operation.JoinToOperationNo}}&nbsp;&nbsp;&nbsp;</strong></a>
                            <br><br><br><br><br>
                          </div>
                        </div>
                      </div>
                      {% endif %} <!-- *** END CONDITION 2 *** -->
                      {% else %}<!-- *** ELSE CONDITION 1 *** -->
                      {% if operation.ProcessQty != 0 %} <!-- *** START CONDITION 2 *** -->
                      <!-- Completed Operation -->
                      <div class="col-md-12">
                        <div class="card text-white bg-success text-center">
                          <div class="card-body text-center">
                            <br><br><br><br><br>
                            <h1><i class="c-icon c-icon-2xl cil-check" style="font-size: 10rem; width: 10rem;"></i></h1>
                            <br>
                            <h3><strong>THIS OPERATION IS COMPLETED</strong></h3>
                            <h6>Start Process : {{operation.ProcessStart}}</h6>
                            <h6>Stop Process : {{operation.ProcessStop}}</h6>
                            <br>
                            {% if currentOperation != -1 %}
                            <a href="/transaction/{{orderNo}}{{currentOperation}}" class="btn btn-pill btn-lg btn-light small"><strong>&nbsp;&nbsp;&nbsp;GO TO CURRENT OPERATION #{{currentOperation}}&nbsp;&nbsp;&nbsp;</strong></a>
                            {% endif %}
                            <br><br><br><br>
                          </div>
                        </div>
                      </div>
                      {% endif %} <!-- *** END CONDITION 2 *** -->
                      {% if operation.ProcessQty == 0 %} <!-- *** START CONDITION 2 *** -->
                      <!-- Waiting Operation -->
                      <div class="col-md-12">
                        <div class="card text-white bg-dark text-center">
                          <div class="card-body text-center">
                            <br><br><br><br><br>
                            <h1><i class="c-icon c-icon-2xl cil-puzzle" style="font-size: 10rem; width: 10rem;"></i></h1>
                            <br>
                            <h3><strong>THIS OPERATION IS WAITING</strong></h3>
                            <br>
                            {% if currentOperation != -1 %}
                            <a href="/transaction/{{orderNo}}{{currentOperation}}" class="btn btn-pill btn-lg btn-light small"><strong>&nbsp;&nbsp;&nbsp;GO TO CURRENT OPERATION #{{currentOperation}}&nbsp;&nbsp;&nbsp;</strong></a>
                            {% endif %}
                            <br><br><br><br><br>
                          </div>
                        </div>
                      </div>
                      {% endif %} <!-- *** END CONDITION 2 *** -->
                      {% endif %} <!-- *** END CONDITION 1 *** -->
                    </div>
                  </div>
                </div>
              {% endif%}
              <!-- Not Found -->
              {% if state != "FIRSTPAGE" and state != "DATAFOUND" %}
              <div class="row">
                <div class="col-md-12 text-center">
                  <br><br><br><br><br><br><br><br>
                  <h1><i class="c-icon c-icon-2xl cil-ban" style="font-size: 10rem; width: 10rem;"></i></h1>
                  <br>
                  {% if state == "NODATAFOUND" %}
                  <h1><strong>PRODUCTION ORDER NOT FOUND</strong></h1>
                  {% elif state == "NOOPERATIONFOUND" %}
                  <h1><strong>OPERATION NOT FOUND</strong></h1>
                  {% endif %}
                  <p>
                    <strong>PRODUCTION NO</strong><br><span class="{% if state == "NODATAFOUND" %}text-danger{% else %}text-success{% endif %}"><strong><span id="nf_order_no">{{orderNo}}</span></strong></span>
                    <br>
                    <strong>OPERATION NO</strong><br><span class="text-danger"><strong><span id="nf_operation_no">{{operationNo}}</span></strong></span>
                  </p>
                  {% if state == "NOOPERATIONFOUND" and currentOperation != -1 %}
                  <a href="/transaction/{{orderNo}}{{currentOperation}}" class="btn btn-pill btn-lg btn-dark small"><strong>&nbsp;&nbsp;&nbsp;GO TO CURRENT OPERATION #{{currentOperation}}&nbsp;&nbsp;&nbsp;</strong></a>
                  {% elif state == "NOOPERATIONFOUND" %}
                  <p class="text-danger">*** THIS PRODUCTION ORDER HAS ONLY HEADER PLEASE CONTACT ADMIN ***</p>
                  {% endif %}
                </div>
              </div>
              {% endif%}
              <!-- First Page -->
              {% if state == "FIRSTPAGE" %}
              <div class="row">
                <div class="col-md-12 text-center">
                  <br><br><br><br><br><br><br><br><br><br>
                  <h1><i class="c-icon c-icon-2xl cil-globe-alt" style="font-size: 10rem; width: 10rem;"></i></h1>
                  <br>
                  <h1><strong>SHOPFLOOR REPORTING APPLCATION</strong></h1>
                </div>
              </div>
              {% endif %}
            </div>
          </div>
        </main>
      </div>
      <!-- *** FOOTER *** -->
      {% include 'footer.html' %}
      <!-- *** MODAL *** -->
      <div class="modal" id="add_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-success" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-plus"></i> Add Operation</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br><h3 class="text-center">Are you sure to add new operation ?</h3><br>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small">
                  <strong>New Operation No</strong>
                  <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title="Conditions"
                  data-content="
                  1) Not Exist Number.<br>
                  2) Only After Working/Completed Operation.<br>
                  3) Never Deleted Number.<br>
                  ">!
                  </a>
                </label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="text" id="add_new_operation_no" autocomplete="off" maxlength="4" value="">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Work Center</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="text" id="add_work_center_no" autocomplete="off" value="" oninput="let p=this.selectionStart;this.value=this.value.toUpperCase();this.setSelectionRange(p, p);">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Control Key</strong></label>
                <div class="col-md-8">
                  <select class="form-control form-control-sm" id="add_control_key">
                    <option value="PP01" selected>Routing/Ref. op. set - internal proc.</option>
                    <option value="PP02">Routing/Ref. op. set - external proc.</option>
                  </select>
                </div>
              </div>
              <div id="add_pp01">
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Est. Setup Time</strong></label>
                  <div class="col-md-8">
                    <input class="form-control form-control-sm" type="number" id="add_est_setup_time" autocomplete="off">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Est. Operation Time</strong></label>
                  <div class="col-md-8">
                    <input class="form-control form-control-sm" type="number" id="add_est_operate_time" autocomplete="off">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Est. Labor Time</strong></label>
                  <div class="col-md-8">
                    <input class="form-control form-control-sm" type="number" id="add_est_labor_time" autocomplete="off">
                  </div>
                </div>
              </div>
              <div id="add_pp02" hidden>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Planned Delivery Time</strong></label>
                  <div class="col-md-8">
                    <input class="form-control form-control-sm" type="text" id="add_pdt" autocomplete="off" value="7" readonly>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Purchasing Org</strong></label>
                  <div class="col-md-8">
                    <input class="form-control form-control-sm" type="text" id="add_purchasing_org" autocomplete="off" value="{{order.Plant}}" readonly>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Cost Element</strong></label>
                  <div class="col-md-8">
                    <input class="form-control form-control-sm" type="text" id="add_cost_element" autocomplete="off" value="51202101" readonly>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Material Group</strong></label>
                  <div class="col-md-8">
                    <select class="form-control form-control-sm" id="add_mat_group">
                      {% for materialGroup in materialGroupList %}
                      <option value="{{materialGroup.Code}}">{{materialGroup.Code}} | {{materialGroup.Description}}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Purchasing Group</strong></label>
                  <div class="col-md-8">
                    <select class="form-control form-control-sm" id="add_purchasing_group">
                      {% for purchaseGroup in purchaseGroupList %}
                      <option value="{{purchaseGroup.ID}}" {% if purchaseGroup.IsDefault %}selected{% endif %}>{{purchaseGroup.ID}} | {{purchaseGroup.Name}}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Price Unit</strong></label>
                  <div class="col-md-8">
                    <input class="form-control form-control-sm" type="number" id="add_price_unit" autocomplete="off">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Price</strong></label>
                  <div class="col-md-5">
                    <input class="form-control form-control-sm" type="number" id="add_price" autocomplete="off">
                  </div>
                  <div class="col-md-3">
                    <select class="form-control form-control-sm" id="add_currency">
                      {% for currency in currencyList %}
                      <option value="{{currency.Name}}" {% if currency.IsDefault %}selected{% endif %}>{{currency.Name}}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-success text-white" type="button" id="add_confirm_button" onclick="add()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="change_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-warning" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-transfer"></i> Change Operation</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br><h3 class="text-center">Are you sure to change this operation ?</h3><br>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Employee ID</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="text" id="change_emp_id" autocomplete="off" value="">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Change Reason</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="text" id="change_reason" autocomplete="off" value="">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Work Center</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="text" id="change_work_center" autocomplete="off" value="{{operation.WorkCenter}}">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Control Key</strong></label>
                <div class="col-md-8">
                  <select class="form-control form-control-sm" id="change_control_key">
                    <option value="PP01" selected>PP01 (Internal Process)</option>
                    <option value="PP02">PP02 (External Process)</option>
                  </select>
                </div>
              </div>
              <div id="change_pp01">
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Est. Setup Time</strong></label>
                  <div class="col-md-8">
                    <input class="form-control form-control-sm" type="number" id="change_est_setup_time" autocomplete="off" value="{{operation.EstimateSetTime}}">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Est. Operation Time</strong></label>
                  <div class="col-md-8">
                    <input class="form-control form-control-sm" type="number" id="change_est_operate_time" autocomplete="off" value="{{operation.EstimateOoperationTime}}">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Est. Labor Time</strong></label>
                  <div class="col-md-8">
                    <input class="form-control form-control-sm" type="number" id="change_est_labor_time" autocomplete="off" value="{{operation.EstimateLaborTime}}">
                  </div>
                </div>
              </div>
              <div id="change_pp02" hidden>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Planned Delivery Time</strong></label>
                  <div class="col-md-8">
                    <input class="form-control form-control-sm" type="text" id="change_pdt" autocomplete="off" value="7" readonly>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Purchasing Org</strong></label>
                  <div class="col-md-8">
                    <input class="form-control form-control-sm" type="text" id="change_purchasing_org" autocomplete="off" value="3000" readonly>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Cost Element</strong></label>
                  <div class="col-md-8">
                    <input class="form-control form-control-sm" type="text" id="change_cost_element" autocomplete="off" value="51202101" readonly>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Material Group</strong></label>
                  <div class="col-md-8">
                    <select class="form-control form-control-sm" id="change_mat_group">
                      {% for materialGroup in materialGroupList %}
                      <option value="{{materialGroup.Code}}">{{materialGroup.Code}} | {{materialGroup.Description}}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Purchasing Group</strong></label>
                  <div class="col-md-8">
                    <select class="form-control form-control-sm" id="change_purchasing_group">
                      {% for purchaseGroup in purchaseGroupList %}
                      <option value="{{purchaseGroup.ID}}" {% if purchaseGroup.ID.strip == '345' %}selected{% endif %}>{{purchaseGroup.ID}} | {{purchaseGroup.Name}}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-md-4 col-form-label text-right small"><strong>Price</strong></label>
                  <div class="col-md-5">
                    <input class="form-control form-control-sm" type="number" id="change_price" autocomplete="off" value="">
                  </div>
                  <div class="col-md-3">
                    <select class="form-control form-control-sm" id="change_currency">
                      <option value="THB" selected>THB</option>
                      <option value="USD">USD</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-warning text-white" type="button" id="change_confirm_button" onclick="change()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="delete_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-danger" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-trash"></i> Delete Operation</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br><h3 class="text-center">Are you sure to delete this operation ?</h3><br>
              <h1 class="text-center text-danger" id="del_text"></h1>
              <br>
              <p class="text-center"><small>Please fill the above code to the input field below.</small></p>
              <input type="text" class="form-control text-center" maxlength="4" id="del_code" autocomplete="off">
            </div>
            <div class="modal-footer">
              <button class="btn btn-danger" type="button" id="trash_confirm_button" onclick="trash()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="break_join_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-danger" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-fullscreen"></i> Break Join</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br><h3 class="text-center">Are you sure to break join activity ?</h3><br>
            </div>
            <div class="modal-footer">
              <button class="btn btn-danger" type="button" onclick="break_join()" id="break_now_button">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="join_list_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-primary" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-list"></i> Join List ({{joinList|length}})</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <table class="table table-sm table-responsive-sm table-outline text-center">
                <thead class="bg-darkslategray">
                  <tr>
                    <th>No</th>
                    <th>Prod. Order - Oper. No</th>
                  </tr>
                </thead>
                <tbody>
                  {% for join in joinList %}
                  <tr>
                    <td>{{forloop.counter}}</td>
                    <td><a href="/transaction/{{join.OrderNo}}{{join.OperationNo}}">{{join.OrderNo}} - {{join.OperationNo}}</a></td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="history_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-info modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-history"></i> History</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <div class="nav-tabs-boxed">
                <ul class="nav nav-tabs" role="tablist">
                  <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#operate-tab" role="tab" aria-controls="home">Operate ({{historyOperateList|length}})</a></li>
                  <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#confirm-tab" role="tab" aria-controls="profile">Confirm ({{historyConfirmList|length}})</a></li>
                  <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#join-tab" role="tab" aria-controls="profile">Join ({{historyJoinList|length}})</a></li>
                </ul>
                <div class="tab-content">
                  <!-- Operate Tab -->
                  <div class="tab-pane active" id="operate-tab" role="tabpanel">
                    <table class="table table-sm table-responsive-sm table-outline small">
                      <thead class="bg-darkslategray">
                        <tr>
                          <th>Operator</th>
                          <th>Work Center</th>
                          <th>Type</th>
                          <th>Start Time</th>
                          <th>Finish Time</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for operate in historyOperateList %}
                        {% if operate.EmpID != None %}
                        <tr>
                          <td>{{operate.EmpID}}</td>
                          <td>{{operate.WorkCenterNo}}</td>
                          <td>{{operate.Type}}</td>
                          <td>{{operate.StartDateTime}}</td>
                          <td>{{operate.StopDateTime}}</td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                  <!-- Confirm Tab -->
                  <div class="tab-pane" id="confirm-tab" role="tabpanel">
                    <table class="table table-sm table-responsive-sm table-outline small">
                      <thead class="bg-darkslategray">
                        <tr>
                          <th>Operator</th>
                          <th>Work Center</th>
                          <th>Good Qty</th>
                          <th>Reject Qty</th>
                          <th>Reason</th>
                          <th>Confirm Time</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for confirm in historyConfirmList %}
                        <tr>
                          <td>{{confirm.EmpID}}</td>
                          <td>{{confirm.WorkCenterNo}}</td>
                          <td>{{confirm.AcceptedQty}}</td>
                          <td>{{confirm.RejectedQty}}</td>
                          <td>{{confirm.RejectReason}}</td>
                          <td>{{confirm.ConfirmDateTime}}</td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                  <!-- Join Tab -->
                  <div class="tab-pane" id="join-tab" role="tabpanel">
                    <table class="table table-sm table-responsive-sm table-outline small">
                      <thead class="bg-darkslategray">
                        <tr>
                          <th>Join To</th>
                          <th>Join By</th>
                          <th>Start</th>
                          <th>Stop</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for join in historyJoinList %}
                        <tr>
                          {% if orderNo == join.JoinToOrderNo and operationNo == join.JoinToOperationNo %}
                          <td>{{join.JoinToOrderNo}} - {{join.JoinToOperationNo}}</td>
                          <td><a href="/transaction/{{join.JoinByOrderNo}}{{join.JoinByOperationNo}}">{{join.JoinByOrderNo}} - {{join.JoinByOperationNo}}</a></td>
                          {% elif orderNo == join.JoinByOrderNo and operationNo == join.JoinByOperationNo %}
                          <td><a href="/transaction/{{join.JoinToOrderNo}}{{join.JoinToOperationNo}}">{{join.JoinToOrderNo}} - {{join.JoinToOperationNo}}</a></td>
                          <td>{{join.JoinByOrderNo}} - {{join.JoinByOperationNo}}</td>
                          {% endif %}
                          <td>{{join.StartDateTime}}</td>
                          <td>{{join.StopDateTime}}</td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="confirm_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg modal-primary" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-star"></i> Confirm</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <input type="text" id="confirm_id" hidden>
              <div class="col-md-12">
                <div class="form-group row">
                  <label class="col-md-3 col-form-label text-right"><strong>Operator</strong></label>
                  <div class="col-md-7">
                    <input class="form-control" type="text" id="confirm_operator" readonly>
                  </div>
                </div>
                {% if operation.WorkCenterType == 'Machine' %}
                <div class="form-group row">
                  <label class="col-md-3 col-form-label text-right"><strong>Work Center</strong></label>
                  <div class="col-md-7">
                    <input class="form-control" type="text" id="confirm_workcenter" readonly>
                  </div>
                </div>
                {% endif %}
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Start Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="confirm_start_time" readonly>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Stop Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="confirm_stop_time" readonly>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right text-success"><strong>Good Qty</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="good_qty" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right text-danger"><strong>Reject Qty</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="reject_qty" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right">
                        <strong>Reason</strong>
                        <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title=""data-content="<u>MATERIAL DEFECT</u><br> - Reject Qty will not send to SAP.">!</a>
                      </label>
                      <div class="col-md-8">
                        <select class="form-control" id="reject_reason">
                          <option value="-1" selected>-</option>
                          {% for rejectReason in rejectReasonList %}
                          <option value="{{rejectReason.Name.strip}}">{{rejectReason.Name}} {% if rejectReason.Name.strip == 'MATERIAL DEFECT' %}*{% endif %}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Other</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="other_reason" autocomplete="off" readonly>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="text-danger text-center small" id="confirm_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" type="button" id="confirm_button" onclick="confirm()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="manual_report_modal" tabindex="-1" role="dialog">
       <div class="modal-dialog modal-xl modal-primary" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-clipboard"></i> Manual Report</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <div class="col-md-12">
                <div class="row">
                  <div class="col-md-12">
                    <div class="form-group row">
                      <label class="col-md-2 col-form-label text-right"><strong>Password</strong> <span class="text-danger">*</span></label>
                      <div class="col-md-10">
                        <input class="form-control" type="password" id="mp_password" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-5"><hr></div><div class="col-md-2 text-center"><strong>Work Time</strong></div><div class="col-md-5"><hr></div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Employee ID</strong> <span class="text-danger">*</span></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="mp_emp_id" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Labor (min)</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="mp_labor_time" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" {% if operation.WorkCenterType == 'Labor' %}hidden{% endif %}>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Work Center</strong> <span class="text-danger">*</span></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="mp_workcenter_no" {% if operation.WorkCenterType == 'Labor' %}value="{{operation.WorkCenterNo}}" readonly{% endif %}>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" {% if operation.WorkCenterType == 'Labor' %}hidden{% endif %}>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Setup (min)</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="mp_setup_time" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" {% if operation.WorkCenterType == 'Labor' %}hidden{% endif %}></div>
                  <div class="col-md-6" {% if operation.WorkCenterType == 'Labor' %}hidden{% endif %}>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Operate (min)</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="mp_operate_time" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Start Time</strong> <span class="text-danger">*</span></label>
                      <div class="col-md-8">
                        <input class="form-control" type="datetime-local" id="mp_start_time">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Stop Time</strong> <span class="text-danger">*</span></label>
                      <div class="col-md-8">
                        <input class="form-control" type="datetime-local" id="mp_stop_time">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-5"><hr></div><div class="col-md-2 text-center"><strong>Quantity</strong></div><div class="col-md-5"><hr></div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right text-success"><strong>Good Qty</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="mp_good_qty" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right text-danger"><strong>Reject Qty</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="mp_reject_qty" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Reason</strong></label>
                      <div class="col-md-8">
                        <select class="form-control" id="mp_reject_reason">
                          <option value="-1" selected>-</option>
                          {% for rejectReason in rejectReasonList %}
                          <option value="{{rejectReason.Name.strip}}">{{rejectReason.Name}}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Other</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="mp_other_reason" autocomplete="off" readonly>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="text-danger text-center small" id="mp_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" type="button" id="mp_button" onclick="manual_report()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- CoreUI and necessary plugins-->
    <script src="{% static "vendors/@coreui/coreui-pro/js/coreui.bundle.min.js" %}"></script>
    <!--[if IE]><!-->
    <script src="{% static "vendors/@coreui/icons/js/svgxuse.min.js" %}"></script>
    <!--<![endif]-->
    <script src="{% static "vendors/jquery/js/jquery.min.js" %}"></script>
    <!-- SELECT JS -->
    <script src="{% static "vendors/select2/js/select2.min.js" %}"></script>
    <!-- Popover JS -->
    <script src="{% static "js/popovers.js" %}"></script>
    <!-- Custom JS -->
    <script src="{% static "customize/js/clock.js" %}"></script>
    <!-- MAIN -->
    <script>
      document.addEventListener("DOMContentLoaded", function(event) {
        setTimeout(function() {
          document.body.classList.remove('c-no-layout-transition')
        }, 2000);
      });

      var timeleft = 300;
      var downloadTimer = setInterval(function(){
        document.getElementById("progressBar").value = 300 - timeleft;
        timeleft -= ($("#has_data").val() == "True")?1:0;
        if(timeleft == 0) window.location.href = '/transaction/0';
      }, 1000);

      window.addEventListener( "pageshow", function (event) {
        if (event.persisted || (typeof window.performance != "undefined" && window.performance.navigation.type === 2)) window.location.reload();
      });

      //-- INITIALIZE
      var isSearchingWorkCenter = false;
      var isSearchingOperator = false;
      var currentWorkCenterNo = null;
      var currentOperatorId = null;

      $(document).ready(function() {
        showTime();
        if($("#has_data").val() == "True" && $("#remain_qty").val() > 0){
          if($("#workcenter_type").val() == 'Machine') reload_workcenter_table();
          reload_operator_table();
        }
        dynamic_join();
      });

      function reset_all(){
        $.ajax({
          url: '/reset_all/',
          data: {
          },
          dataType: 'json',
          success: function (data) {
            location.reload();
          }
        });
      }
    </script>
    <!-- MAIN TABLE -->
    <script>
      $("#workcenter_no").on("change keyup", function() {
        var work_center_group = $('#work_center_group').val();
        $('#workcenter_name').val('');
        $('#workcenter_add_button').prop('disabled', true);
        remove_valid('workcenter_name');
        $('#workcenter_name').removeClass('text-danger');
        var workcenter_no = $('#workcenter_no').val();
        if(isSearchingWorkCenter == false && workcenter_no.length >= 3){
          isSearchingWorkCenter = true;
          $.ajax({
            url: '/get_workcenter_data/',
            data: {
              'workcenter_no': workcenter_no,
              'work_center_group' : work_center_group,
            },
            dataType: 'json',
            success: function (data) {
              if (data.canAdd) {
                currentWorkCenterNo = data.WorkCenterNo;
                $('#workcenter_name').val(data.WorkCenterNo+" | "+data.WorkCenterName);
                $('#workcenter_add_button').prop('disabled', false);
                valid('workcenter_name');
                $('#workcenter_name').addClass('text-success');
              } else {
                $('#workcenter_name').val(data.invalid_text);
                invalid('workcenter_name');
                $('#workcenter_name').addClass('text-danger');
              }
              isSearchingWorkCenter = false;
            }
          });
        }
      });

      $("#operator_id").on("change keyup", function() {
        $('#operator_name').val('');
        $('#operator_work_button').prop('disabled', true);
        $('#operator_setup_button').prop('disabled', true);
        remove_valid('operator_name');
        $('#operator_name').removeClass('text-danger');
        var operator_id = $('#operator_id').val();
        if(isSearchingOperator == false && operator_id.length >= 4){
          isSearchingOperator = true;
          $.ajax({
            url: '/get_operator_data/',
            data: {
              'operator_id': operator_id,
            },
            dataType: 'json',
            success: function (data) {
              if (data.canAdd) {
                $('#operator_work_button').prop('disabled', false);
                $('#operator_setup_button').prop('disabled', false);
                currentOperatorId = data.EmpID;
                currentOperatorName = data.EmpName;
                $('#operator_name').val(data.EmpID+" | "+data.EmpName+" ("+data.Section+")");
                valid('operator_name');
                $('#operator_name').addClass('text-success');
              } else {
                $('#operator_name').val(data.invalid_text);
                invalid('operator_name');
                $('#operator_name').addClass('text-danger');
              }
              isSearchingOperator = false;
            }
          });
        }
      });

      function create_workcenter_table(){
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        $.ajax({
          url: '/get_operating_workcenter_list/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
          },
          dataType: 'json',
          success: function (data) {
            var completed_count = 0;
            if(data.OWCList.length == 0){
              var row = "<tr><td colspan='5'>Please add workcenter above.</td></tr>";
              $("#workcenter_table_body").append(row);
            } else {
              for(var i = 0;i < data.OWCList.length;i++){
                var owc = data.OWCList[i];
                var row = "";
                // console.log(owc);
                for(var j = 0;j < owc.length;j++){
                  var owc_id = owc[0];
                  var owc_workcenter_name = owc[7]+" | "+owc[8];
                  var owc_startdatetime = owc[4];
                  var startdatetime = (owc_startdatetime == null)?"-":getFullDateTime(owc_startdatetime);
                  var owc_stopdatetime = owc[5];
                  var stopdatetime = (owc_stopdatetime == null)?"-":getFullDateTime(owc_stopdatetime);
                  var owc_status = $.trim(owc[6]);
                  var mc_type = $.trim(owc[13]);
                  if(owc_status == "COMPLETED") {
                    completed_count++;
                    break;
                  }
                  row = "";
                  row += "<tr id='workcenter_row_"+owc_id+"'>";
                  row += "<td>";
                  if(owc_status != "SETUP"){
                    row += "<input type='radio' class='my-radio' name='workcenter_radio' value='"+owc_id+"' checked>";
                  }
                  row += "</td>";
                  row += "<td class='small'>"+owc_workcenter_name+"</td>";
                  row += (owc_status == "WAITING")?"<td class='font-weight-bold'>":"<td class='blink font-weight-bold'>";
                  row += owc_status;
                  row += "<input type='text' id='workcenter_status_"+owc_id+"' value='"+owc_status+"' hidden>";
                  row += "</td>";
                  row += "<td class='small'>";
                  row += "<div>"+startdatetime+"</div>";
                  row += "</td>";
                  row += "<td>";
                  if(owc_status == "WAITING"){
                    row += "<button type='button' class='btn btn-sm btn-pill btn-dark small' id='delete_operating_workcenter_"+owc_id+"' onclick='delete_operating_workcenter("+owc_id+")'>Delete</button>";
                  } else if (owc_status == "WORKING" && mc_type == "Auto" && data.hasOperatorOperatingList[i] == false){
                    row += "<button type='button' class='btn btn-sm btn-pill btn-danger small' id='stop_operating_workcenter_"+owc_id+"' onclick='stop_operating_workcenter("+owc_id+")'>Stop Machine</button>";
                  }
                  row += "</td>";
                  row += "</tr>";
                }
                $("#workcenter_table_body").append(row);
                dynamic_operator_setup();
              }
              if(completed_count == data.OWCList.length){
                var row = "<tr><td colspan='5'>Please add workcenter above.</td></tr>";
                $("#workcenter_table_body").append(row);
              }
            }
            dynamic_operator_id();
          }
        });
      }

      function create_operator_table(){
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        var workcenter_type = $("#workcenter_type").val();
        $.ajax({
          url: '/get_operating_operator_list/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
          },
          dataType: 'json',
          success: function (data) {
            if(data.OOPRList.length == 0){
              var row = "<tr><td colspan='"+((workcenter_type == 'Machine')?5:4)+"'>Please add operator above.</td></tr>";
              $("#operator_table_body").append(row);
            } else {
              for(var i = 0;i < data.OOPRList.length;i++){
                var oopr = data.OOPRList[i];
                var row = "";
                // console.log(oopr);
                for(var j = 0;j < oopr.length;j++){
                  var oopr_id = oopr[0];
                  var oopr_workcenter_name = (oopr[18] == null)?null:oopr[18]+" | "+oopr[19];
                  var oopr_operator_name = oopr[8]+" | "+oopr[9];
                  var oopr_startdatetime = oopr[5];
                  var startdatetime = (oopr_startdatetime == null)?"-":getFullDateTime(oopr_startdatetime);
                  var oopr_stopdatetime = oopr[6];
                  var stopdatetime = (oopr_stopdatetime == null)?"-":getFullDateTime(oopr_stopdatetime);
                  var oopr_status = $.trim(oopr[7]);
                  row = "";
                  row += "<tr id='operator_row_"+oopr_id+"'>";
                  row += (oopr_workcenter_name == null)? "":"<td class='small'>"+oopr_workcenter_name+"</td>";
                  row += "<td class='small'>"+oopr_operator_name+"</td>";
                  row += (oopr_status == 'COMPLETED')?"<td class='text-success font-weight-bold'>":"<td class='blink font-weight-bold'>";
                  row += oopr_status+"</td>";
                  row += "<td class='small'>";
                  row += "<div> <strong>START</strong> "+startdatetime+"</div>";
                  row += "<div> <strong>STOP</strong> "+stopdatetime+"</div>";
                  row += "</td>";
                  row += "<td>";
                  if(oopr_status == "WORKING" || oopr_status == "EXT-WORK"){
                    row += "<button type='button' class='btn btn-sm btn-pill btn-danger small' id='stop_work_operating_operator_"+oopr_id+"' onclick='stop_work_operating_operator("+oopr_id+")'>Stop Working</button>";
                  } else if (oopr_status == "SETUP"){
                    row += "<button type='button' class='btn btn-sm btn-pill btn-success small' id='start_work_operating_operator_"+oopr_id+"' onclick='start_work_operating_operator("+oopr_id+")'>Start Working</button> ";
                    row += "<button type='button' class='btn btn-sm btn-pill btn-warning text-white small' id='stop_setup_operating_operator_"+oopr_id+"' onclick='stop_setup_operating_operator("+oopr_id+")'>Stop Setup & Exit</button>";
                  } else if (oopr_status == "COMPLETED" && $('#remain_qty').val() > 0){
                    if($('#join_list_length').val() == 0) {
                      row += "<button type='button' class='btn btn-sm btn-pill btn-primary small' onclick='prepare_confirm("+oopr_id+")' data-toggle='modal' data-target='#confirm_modal'>Confirm</button>";
                    } else {
                      row += "<small class='text-danger'>BREAK JOIN TO CONFIRM</small>";
                    }
                  }
                  row += "</td>";
                  row += "</tr>";
                }
                $("#operator_table_body").append(row);
              }
            }
          }
        });
      }

      function reload_workcenter_table(){
        $("#workcenter_table > tbody").empty();
        create_workcenter_table();
        timeleft = 300;
      }

      function reload_operator_table(){
        $("#operator_table > tbody").empty();
        create_operator_table();
        timeleft = 300;
      }

      function add_operating_workcenter(){
        $('#workcenter_add_button').prop('disabled', true);
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        $.ajax({
          url: '/add_operating_workcenter/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
            'workcenter_no': currentWorkCenterNo,
          },
          dataType: 'json',
          success: function (data) {
            $('#workcenter_no').val("");
            $('#workcenter_name').val("");
            remove_valid('workcenter_name');
            reload_workcenter_table();
          }
        });
      }

      function delete_operating_workcenter(id){
        $('#delete_operating_workcenter_' + id).prop('disabled', true);
        $.ajax({
          url: '/delete_operating_workcenter/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            reload_workcenter_table();
            $('#operator_work_button').prop('disabled', true);
            $('#operator_setup_button').prop('disabled', true);
            $('#operator_id').val("");
            $('#operator_name').val("");
            remove_valid('operator_name');
          }
        });
      }

      function stop_operating_workcenter(id){
        $('#stop_operating_workcenter_' + id).prop('disabled', true);
        $.ajax({
          url: '/stop_operating_workcenter/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            $("#is_operating").val(capitalizeFirstLetter(data.IsOperating.toString()));
            dynamic_join();
            reload_workcenter_table();
          }
        });
      }

      function add_operating_operator(status){
        $('#operator_work_button').prop('disabled', true);
        $('#operator_setup_button').prop('disabled', true);
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        var owc_id = -1;
        if ($('input[name="workcenter_radio"]').length > 0){
          owc_id = document.querySelector('input[name="workcenter_radio"]:checked').value;
        }
        $.ajax({
          url: '/add_operating_operator/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
            'operator_id': currentOperatorId,
            'owc_id': owc_id,
            'status': status,
          },
          dataType: 'json',
          success: function (data) {
            if(data.refresh) location.reload();
            $("#is_operating").val("True");
            dynamic_join();
            $('#operator_id').val("");
            $('#operator_name').val("");
            remove_valid('operator_name');
            if($("#workcenter_type").val() == 'Machine') reload_workcenter_table();
            reload_operator_table();
          }
        });
      }

      function start_work_operating_operator(id){
        $('#start_work_operating_operator_' + id).prop('disabled', true);
        $.ajax({
          url: '/start_work_operating_operator/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            $("#is_operating").val("True");
            dynamic_join();
            if($("#workcenter_type").val() == 'Machine') reload_workcenter_table();
            reload_operator_table();
          }
        });
      }

      function stop_setup_operating_operator(id){
        $('#stop_setup_operating_operator_' + id).prop('disabled', true);
        $.ajax({
          url: '/stop_setup_operating_operator/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            $("#is_operating").val(capitalizeFirstLetter(data.IsOperating.toString()));
            dynamic_join();
            if($("#workcenter_type").val() == 'Machine') reload_workcenter_table();
            reload_operator_table();
          }
        });
      }

      function stop_work_operating_operator(id){
        $('#stop_work_operating_operator_' + id).prop('disabled', true);
        $.ajax({
          url: '/stop_work_operating_operator/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            $("#is_operating").val(capitalizeFirstLetter(data.IsOperating.toString()));
            dynamic_join();
            if($("#workcenter_type").val() == 'Machine') reload_workcenter_table();
            reload_operator_table();
          }
        });
      }

      function prepare_confirm(id){
        $('#confirm_button').prop('disabled', true);
        $.ajax({
          url: '/get_data_for_confirm/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            $('#confirm_id').val(id);
            $('#confirm_operator').val(data.operator_text);
            $('#confirm_workcenter').val(data.workcenter_text);
            $('#confirm_start_time').val(data.start_time);
            $('#confirm_stop_time').val(data.stop_time);
            $('#confirm_button').prop('disabled', false);
            $('#good_qty').focus();
          }
        });
      }

      function break_join(){
        var order_no = $('#order_no').val();
        var operation_no = $('#operation_no').val();
        $.ajax({
          url: '/break_join/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
          },
          dataType: 'json',
          success: function (data) {
            location.reload();
          }
        });
      }

      function confirm(){
        $("#confirm_invalid_text").text("");
        if($('#good_qty').val() == "") $('#good_qty').val("0");
        if($('#reject_qty').val() == "") $('#reject_qty').val("0");
        var confirm_id = $('#confirm_id').val();
        var remain_qty = parseFloat($('#remain_qty').val());
        var good_qty = parseFloat($('#good_qty').val());
        var reject_qty = parseFloat($('#reject_qty').val());
        var reject_reason = $('#reject_reason').val();
        var other_reason = $('#other_reason').val();
        if(good_qty <= 0 && reject_qty <= 0) $("#confirm_invalid_text").text("Good Qty + Reject Qty can not be 0.");
        else if(remain_qty < good_qty + reject_qty) $("#confirm_invalid_text").text("Good Qty + Reject Qty can not be more than Remaining Qty.");
        else if(reject_qty > 0 && reject_reason == -1) $("#confirm_invalid_text").text("Please select reject reason.");
        else if(reject_reason == "OTHER" && other_reason == "") $("#confirm_invalid_text").text("Please fill reason in other reason field.");
        else if(other_reason.includes("|")) $("#confirm_invalid_text").text("character | is not allow to use.");
        else {
          $('#confirm_button').prop('disabled', true);
          if (reject_qty == 0) reject_reason = "";
          $.ajax({
            url: '/confirm/',
            data: {
              'confirm_id': confirm_id,
              'good_qty': good_qty,
              'reject_qty': reject_qty,
              'reject_reason': reject_reason,
              'other_reason': other_reason,
            },
            dataType: 'json',
            success: function (data) {
              location.reload();
            }
          });
        }
      }

      function manual_report(){
        $("#mp_invalid_text").text("");
        if($('#mp_labor_time').val() == "") $('#mp_labor_time').val("0");
        if($('#mp_setup_time').val() == "") $('#mp_setup_time').val("0");
        if($('#mp_operate_time').val() == "") $('#mp_operate_time').val("0");
        if($('#mp_good_qty').val() == "") $('#mp_good_qty').val("0");
        if($('#mp_reject_qty').val() == "") $('#mp_reject_qty').val("0");
        var workcenter_type = $('#workcenter_type').val();
        var password = $('#mp_password').val();
        var emp_id = $('#mp_emp_id').val();
        var workcenter_no = $('#mp_workcenter_no').val();
        var labor_time = parseFloat($('#mp_labor_time').val());
        var operate_time = parseFloat($('#mp_operate_time').val());
        var setup_time = parseFloat($('#mp_setup_time').val());
        var good_qty = parseFloat($('#mp_good_qty').val());
        var start_time = new Date($('#mp_start_time').val());
        var stop_time = new Date($('#mp_stop_time').val());
        var remain_qty = parseFloat($('#remain_qty').val());
        var good_qty = parseFloat($('#mp_good_qty').val());
        var reject_qty = parseFloat($('#mp_reject_qty').val());
        var reject_reason = $('#mp_reject_reason').val();
        var other_reason = $('#mp_other_reason').val();
        if(password == "") $("#mp_invalid_text").text("Please fill password.");
        else if(emp_id == "") $("#mp_invalid_text").text("Please fill Employee ID.");
        else if(workcenter_no == "") $("#mp_invalid_text").text("Please fill WorkCenter.");
        else if($('#mp_start_time').val() == "") $("#mp_invalid_text").text("Please fill Start Time.");
        else if($('#mp_stop_time').val() == "") $("#mp_invalid_text").text("Please fill Stop Time.");
        else if(start_time >= stop_time) $("#mp_invalid_text").text("Start Time >= Stop Time");
        else if(remain_qty < good_qty + reject_qty) $("#mp_invalid_text").text("Good Qty + Reject Qty can not be more than Remaining Qty.");
        else if(reject_qty > 0 && reject_reason == -1) $("#mp_invalid_text").text("Please select reject reason.");
        else if(reject_reason == "OTHER" && other_reason == "") $("#mp_invalid_text").text("Please fill reason in other reason field.");
        else if(other_reason.includes("|")) $("#mp_invalid_text").text("character | is not allow to use.");
        else if(labor_time == 0 && operate_time == 0 && setup_time == 0 && good_qty == 0 && reject_qty == 0) $("#mp_invalid_text").text("At least one value need to be more than 0.");
        // Validate Password
        // Validate EmpID
        // Validate WorkCenter
        else {
          // REPORT !!
        }
      }
    </script>
    <!-- MODIFIER -->
    <script>
      //-- ADD OPERATION
      function add(){
        $('#add_confirm_button').prop('disabled', true);
        // a
        $("#add_new_operation_no").val(frontZero($("#add_new_operation_no").val(), 4));
        if($('#add_est_setup_time').val() == "") $('#add_est_setup_time').val("0");
        if($('#add_est_operate_time').val() == "") $('#add_est_operate_time').val("0");
        if($('#add_est_labor_time').val() == "") $('#add_est_labor_time').val("0");
        if($('#add_price_unit').val() == "") $('#add_price_unit').val("0");
        if($('#add_price').val() == "") $('#add_price').val("0");
        $('#add_price').val(roundToTwo($('#add_price').val()));
        // b
        var order_no = $("#order_no").val();
        var new_operation_no = $("#add_new_operation_no").val();
        var work_center_no = $("#add_work_center_no").val();
        var control_key = $("#add_control_key").val();
        var est_setup_time = parseFloat($('#add_est_setup_time').val());
        var est_operate_time = parseFloat($('#add_est_operate_time').val());
        var est_labor_time = parseFloat($('#add_est_labor_time').val());
        var pdt = $("#add_pdt").val();
        var purchasing_org = $("#add_purchasing_org").val();
        var cost_element = $("#add_cost_element").val();
        var mat_group = $("#add_mat_group").val();
        var purchasing_group = $("#add_purchasing_group").val();
        var price_unit = parseFloat($('#add_price_unit').val());
        var price = parseFloat($('#add_price').val());
        var currency = $('#add_currency').val();
        var isAddable = false;
        remove_valid_many(["add_new_operation_no","add_work_center_no","add_est_setup_time","add_est_operate_time","add_est_labor_time","add_price_unit","add_price"]);
        // c
        validate_new_operation(new_operation_no, function(canAdd) {
          if(!canAdd) {
            invalid("add_new_operation_no");
            $('#add_confirm_button').prop('disabled', false);
          } else {
            valid("add_new_operation_no");
            validate_routing(work_center_no, function(canUse) {
              if(!canUse) {
                invalid("add_work_center_no");
                $('#add_confirm_button').prop('disabled', false);
              } else {
                valid("add_work_center_no");
                if(control_key == "PP01"){
                  if($('#add_est_setup_time').val().split(".")[0].length > 6) invalid("add_est_setup_time");
                  else {
                    valid("add_est_setup_time");
                    if($('#add_est_operate_time').val().split(".")[0].length > 6) invalid("add_est_operate_time");
                    else {
                      valid("add_est_operate_time");
                      if($('#add_est_labor_time').val().split(".")[0].length > 6) invalid("add_est_labor_time");
                      else {
                        valid("add_est_labor_time");
                        isAddable = true;
                      }
                    }
                  }
                } else if(control_key == "PP02"){
                  if(price_unit <= 0 || $('#add_price_unit').val().length > 6) invalid("add_price_unit");
                  else {
                    valid("add_price_unit");
                    if(price <= 0 || $('#add_price').val().split(".")[0].length > 9) invalid("add_price");
                    else {
                      valid("add_price");
                      isAddable = true;
                    }
                  }
                }
                if(isAddable){
                  $.ajax({
                    url: '/add_operation/',
                    data: {
                      'order_no': order_no,
                      'new_operation_no': new_operation_no,
                      'work_center_no': work_center_no,
                      'control_key': control_key,
                      'est_setup_time': est_setup_time,
                      'est_operate_time': est_operate_time,
                      'est_labor_time': est_labor_time,
                      'pdt': pdt,
                      'purchasing_org': purchasing_org,
                      'cost_element': cost_element,
                      'mat_group': mat_group,
                      'purchasing_group': purchasing_group,
                      'price_unit': price_unit,
                      'price': price,
                      'currency': currency,
                    },
                    dataType: 'json',
                    success: function (data) {
                      location.reload();
                    }
                  });
                } else {
                  $('#add_confirm_button').prop('disabled', false);
                }
              }
            });
          }
        });
      }

      function prepare_add(){
        remove_valid_many(["add_new_operation_no","add_work_center_no","add_est_setup_time","add_est_operate_time","add_est_labor_time","add_price_unit","add_price"]);
        $("#add_new_operation_no").val("");
        $("#add_work_center_no").val("");
        $("#add_est_setup_time").val("");
        $("#add_est_operate_time").val("");
        $("#add_est_labor_time").val("");
        $("#add_price_unit").val("");
        $("#add_price").val("");
        $("#add_new_operation_no").focus();
      }

      //-- CHANGE OPERATION
      function change(){
        $('#change_confirm_button').prop('disabled', true);
        $('#change_confirm_button').prop('disabled', false);
      }

      //-- DELETE OPERATION
      function trash(){
        remove_valid("del_code");
        var del_text = $("#del_text").text();
        var del_code = $("#del_code").val();
        if(del_text != del_code){
          invalid("del_code");
        } else {
          valid("del_code");
          $('#trash_confirm_button').prop('disabled', true);
          var order_no = $('#order_no').val();
          var operation_no = $('#operation_no').val();
          $.ajax({
            url: '/delete_operation/',
            data: {
              'order_no': order_no,
              'operation_no': operation_no,
            },
            dataType: 'json',
            success: function (data) {
              window.location.href = '/transaction/' + data.nextlink;
            }
          });
        }
      }

      function prepare_delete(){
        $("#del_text").text(generateRandomCode(4));
        remove_valid("del_code");
        $("#del_code").val("");
        $("#del_code").focus();
      }
    </script>
    <!-- VALIDATION AND SHORTCUT SEARCH -->
    <script>
      //-- VALIDATION
      function validate_new_operation(new_operation_no, _callback){
        var order_no = $("#order_no").val();
        if(new_operation_no == "0000") _callback(false);
        else {
          $.ajax({
            url: '/validate_new_operation/',
            data: {
              'order_no': order_no,
              'new_operation_no': new_operation_no,
            },
            dataType: 'json',
            success: function (data) {
              (data.canAdd)? _callback(true):_callback(false);
            }
          });
        }
      }

      function validate_routing(work_center_no, _callback){
        if(work_center_no.length < 3) _callback(false);
        else {
          $.ajax({
            url: '/validate_routing/',
            data: {
              'work_center_no': work_center_no,
            },
            dataType: 'json',
            success: function (data) {
              (data.canUse)? _callback(true):_callback(false);
            }
          });
        }
      }

      //-- SHORTCUT SEARCH
      document.getElementById("sc_order_no").addEventListener("keydown", function (e) {
            if (e.code === "Enter" || e.code == "NumpadEnter") shortcut_search();
        });

      document.getElementById("sc_order_no").addEventListener("keyup", function (e) {
            if ($("#sc_order_no").val().length == 12) $("#sc_operation_no").focus();
        });

      document.getElementById("sc_operation_no").addEventListener("keydown", function (e) {
            if (e.code === "Enter" || e.code == "NumpadEnter") shortcut_search();
        });

      function shortcut_search(){
          var order_no =  $("#sc_order_no").val();
          var operation_no =  frontZero($("#sc_operation_no").val(), 4);
          (order_no.length < 6)? invalid("sc_order_no"): valid("sc_order_no");
          (operation_no.length < 4)? invalid("sc_operation_no"): valid("sc_operation_no");
          if(order_no.length >= 6 && operation_no.length == 4){
            remove_valid_many(["sc_order_no","sc_operation_no"]);
            window.open('/transaction/' + order_no + operation_no, '_self');
          }
        }

      //-- VALIDATE CONTROL
      remove_valid_many = (input_ids) => { for(var i = 0;i < input_ids.length;i++) remove_valid(input_ids[i]); }
      valid_many = (input_ids) => { for(var i = 0;i < input_ids.length;i++) valid(input_ids[i]); }

      function remove_valid(input_id){
        $("#"+input_id).removeClass("is-invalid");
        $("#"+input_id).removeClass("is-valid");
      }

      function valid(input_id){
        $("#"+input_id).addClass("is-valid");
        $("#"+input_id).removeClass("is-invalid");
      }

      function invalid(input_id){
        $("#"+input_id).addClass("is-invalid");
        $("#"+input_id).removeClass("is-valid");
      }
    </script>
    <!-- DYNAMIC INPUT -->
    <script>
      $(document).on('change', 'input[type=radio][name=workcenter_radio]', function (event) {
          dynamic_operator_setup();
      });

      function dynamic_operator_setup(){
        if ($('input[name="workcenter_radio"]').length > 0){
          owc_id = document.querySelector('input[name="workcenter_radio"]:checked').value;
          var owc_status = $('#workcenter_status_' + owc_id).val();
          if(owc_status == "WORKING"){
            $("#operator_setup_button").prop('hidden', true);
          } else {
            $("#operator_setup_button").prop('hidden', false);
          }
        }
      }

      function dynamic_operator_id(){
        if($('#workcenter_type').val() == 'Labor'){
          $("#operator_id").prop('readonly', false);
        } else if($('#workcenter_type').val() == 'Machine' && $('input[name="workcenter_radio"]').length > 0){
          $("#operator_id").prop('readonly', false);
        } else {
          $("#operator_id").prop('readonly', true);
        }
      }

      function dynamic_join(){
        if($("#join_list_length").val() > 0 && $("#is_operating").val() == "False"){
          $("#break_join_main_button").prop("hidden", false);
        } else {
          $("#break_join_main_button").prop("hidden", true);
        }
        if($("#join_list_length").val() == 0 && $("#is_operating").val() == "False" && $("#workcenter_type").val() == 'Machine' && $("#remain_qty").val() > 0 && $("#is_joining").val() == "False"){
          $("#join_main_button").prop("hidden", false);
        } else {
          $("#join_main_button").prop("hidden", true);
        }
      }

      $('#mp_setup_checkbox').change(function() {
          (this.checked)? $("#mp_setup_start_time_group").prop("hidden", false):$("#mp_setup_start_time_group").prop("hidden", true);
          (this.checked)? $("#mp_setup_stop_time_group").prop("hidden", false):$("#mp_setup_stop_time_group").prop("hidden", true);
      });

      $('#reject_reason').on("change", function() {
        if($('#reject_reason').val() != "OTHER"){
          $("#other_reason").prop("readonly", true);
          $("#other_reason").val("");
        } else {
          $("#other_reason").prop("readonly", false)
        }
      });

      $('#mp_reject_reason').on("change", function() {
        if($('#mp_reject_reason').val() != "OTHER"){
          $("#mp_other_reason").prop("readonly", true);
          $("#mp_other_reason").val("");
        } else {
          $("#mp_other_reason").prop("readonly", false)
        }
      });

      $('#add_control_key').on("change", function() {
        ($('#add_control_key').val() == "PP01")? $("#add_pp01").prop("hidden", false): $("#add_pp01").prop("hidden", true);
        ($('#add_control_key').val() == "PP01")? $("#add_pp02").prop("hidden", true): $("#add_pp02").prop("hidden", false);
      });

      $('#change_control_key').on("change", function() {
        ($('#change_control_key').val() == "PP01")? $("#change_pp01").prop("hidden", false): $("#change_pp01").prop("hidden", true);
        ($('#change_control_key').val() == "PP01")? $("#change_pp02").prop("hidden", true): $("#change_pp02").prop("hidden", false);
      });
    </script>
    <!-- KET RESTRICT -->
    <script>
      $("#add_new_operation_no").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#add_est_setup_time").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#add_est_operate_time").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#add_est_labor_time").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#add_pdt").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#add_price_unit").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#change_est_setup_time").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#change_est_operate_time").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#change_est_labor_time").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#change_pdt").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#operator_id").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#good_qty").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#reject_qty").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_emp_id").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_labor_time").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_setup_time").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_operate_time").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_good_qty").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_reject_qty").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#sc_order_no").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#sc_operation_no").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });
    </script>
    <!-- ETC -->
    <script>
      function capitalizeFirstLetter(str) {
         return str.charAt(0).toUpperCase() + str.slice(1);
      }

      function getFullDateTime(str) {
         var result = "";
         var year = new Date(str).getFullYear();
         var month = frontZero((new Date(str).getMonth() + 1).toString(), 2);
         var date = frontZero(new Date(str).getDate().toString(), 2);
         var hour = frontZero(new Date(str).getHours().toString(), 2);
         var minute = frontZero(new Date(str).getMinutes().toString(), 2);
         var second = frontZero(new Date(str).getSeconds().toString(), 2);
         result = date+"-"+month+"-"+year+", "+hour+":"+minute+":"+second;
         return result
      }

      function frontZero(str, len){
        var result = str;
        for(var i = str.length;i < len;i++) result = "0" + result;
        return result;
      }

      function generateRandomCode(length) {
        var result = '';
        var characters = 'ABCDEFGHJKMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz123456789'; // remove i l o 0
        // var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        for ( var i = 0; i < length; i++ ) result += characters.charAt(Math.floor(Math.random() * characters.length));
        return result;
      }

      function roundToTwo(num) {
        return +(Math.round(num + "e+2")  + "e-2");
      }
    </script>
  </body>
</html>
