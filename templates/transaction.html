<!DOCTYPE html>
{% load static %}
{% load extra %}
<!--
* CoreUI Pro based Bootstrap Admin Template
* @version v3.2.0
* @link https://coreui.io/pro/
* Copyright (c) 2020 creativeLabs Łukasz Holeczek
* License (https://coreui.io/pro/license)
-->
<html lang="en">
  <head>
    <base href="./">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description" content="CoreUI - Open Source Bootstrap Admin Template">
    <meta name="author" content="Łukasz Holeczek">
    <meta name="keyword" content="Bootstrap,Admin,Template,Open,Source,jQuery,CSS,HTML,RWD,Dashboard">
    <title>Transaction | Shopfloor Reporting Application</title>
    <!-- Main styles for this application-->
    <link rel="stylesheet" href="{% static "css/style.css" %}">
    <!-- Icon CSS -->
    <link href="{% static "vendors/@coreui/icons/css/free.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/@coreui/icons/css/brand.min.css" %}" rel="stylesheet">
    <!-- Select CSS -->
    <link href="{% static "vendors/select2/css/select2.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/select2/css/select2-coreui.min.css" %}" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static "customize/css/decorate.css" %}" rel="stylesheet">
  </head>
  <body class="c-app c-no-layout-transition">
    <!-- *** LEFT SIDE BAR *** -->
    {% include 'sidebar.html' %}
    <!-- *** RIGHT SIDE BAR *** -->
    <div class="c-wrapper">
      <!-- *** HEADER *** -->
      <header class="c-header c-header-light c-header-fixed">
        {% include 'header.html' %}
        <div class="c-subheader justify-content-between px-3">
          <!-- Breadcrumb-->
          <ol class="breadcrumb border-0 m-0 px-0 px-md-3">
            <li class="breadcrumb-item">Transaction</li>
            {% if state != "FIRSTPAGE" %}
            <li class="breadcrumb-item active">
              {% if operationBefore != -1 %}<a href="/transaction/{{orderNo}}{{operationBefore}}" class="text-primary" style="padding-top: 3px;"><i class="c-icon cil-chevron-left"></i></a>&nbsp;{% endif %}
              <span id="bc_order_no">{{orderNo}}</span>&nbsp;-&nbsp;<span id="bc_operation_no">{{operationNo}}</span>
              {% if operationAfter != -1 %}&nbsp;<a href="/transaction/{{orderNo}}{{operationAfter}}" class="text-primary" style="padding-top: 3px;"><i class="c-icon cil-chevron-right"></i></a>{% endif %}
            </li>
            {% endif %}
          </ol>
          {% if state == "DATAFOUND" %}
          <div class="c-subheader-nav small">
            <!-- <button type="button" class="btn btn-sm btn-pill btn-outline-danger" onclick="reset_all()">Reset All</button> -->
            <a href="/lot_traveller/{{orderNo}}&0" class="btn btn-sm btn-link">Partial Lot Traveller</a>
            |<button type="button" class="btn btn-sm btn-link" data-toggle="modal" data-target="#reset_order_modal">Reset Order</button>
            |<button type="button" class="btn btn-sm btn-link" data-toggle="modal" data-target="#cancel_order_modal">Cancel Order</button>
            |<button type="button" class="btn btn-sm btn-link" data-toggle="modal" data-target="#set_qty_modal">Set Operation Qty</button>
          </div>
          {% endif %}
          <div class="c-subheader-nav" {% if state != "FIRSTPAGE" %}hidden{% endif %}>
            <input type="password" hidden> <!-- Prevent Auto fill Password -->
            &nbsp;&nbsp;<div><i class="c-icon c-icon-lg cil-user"></i></div>&nbsp;&nbsp;
            <div style="width:50%"><input type="text" class="form-control form-control-sm" id="fp_operator_id" autocomplete="off"></div>
            &nbsp;&nbsp;<div><button type="button" class="btn btn-sm btn-pill btn-outline-info" onclick="fp_emp_search()">Go !</button></div>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          </div>
          <div class="c-subheader-nav mfe-2">
            <input type="password" hidden> <!-- Prevent Auto fill Password -->
            &nbsp;&nbsp;<div>Prod. Order - Oper. No</div>
            &nbsp;&nbsp;<div><input type="text" class="form-control form-control-sm" maxlength="10" id="sc_order_no" autocomplete="off" value="{{orderNo}}"></div>
            &nbsp;&nbsp;<div>-</div>&nbsp;&nbsp;
            <div style="width:15%"><input type="text" class="form-control form-control-sm" maxlength="4" id="sc_operation_no" autocomplete="off" value="{{operationNo}}"></div>
            &nbsp;&nbsp;<div><button type="button" class="btn btn-sm btn-pill btn-outline-info" onclick="shortcut_search()">Go !</button></div>
          </div>
        </div>
        <div class="progress" style="height: 4px; width: 100%">
          <progress style="width: 100%;" value="0" max="300" id="progressBar"></progress>
        </div>
      </header>
      <!-- *** BODY *** -->
      <div class="c-body">
        <main class="c-main">
          <div class="container-fluid">
            <div class="fade-in">
              <!-- Hidden Input -->
              <div hidden>
                <input type="text" id="has_data" value="{% if state == "DATAFOUND" %}True{% else %}False{% endif %}">
                <input type="text" id="is_operating" value="{{isOperating}}">
                <input type="text" id="workcenter_type" value="{{operation.WorkCenterType}}">
                <input type="text" id="join_list_length" value="{{joinList|length}}">
                <input type="text" id="is_joining" value="{% if operation.JoinToOrderNo != None %}True{% else %}False{% endif %}">
                <input type="text" id="has_report_time" value="{{hasReportTime}}">
                <input type="text" id="refresh_second" value="{{refreshSecond}}">
              </div>
              <!-- Main Body -->
              {% if state == "DATAFOUND" %}
              <div class="row" id="main_body">
                  <!-- Left Content -->
                  <div class="col-sm-12 col-md-4" style="padding:0px;">
                    <div class="card border-secondary">
                      <!-- <div class="card-header text-right">
                        <i class="c-icon c-icon-sm cil-user"></i>
                      </div> -->
                      <div class="card-body" style="padding-left: 5px; padding-right: 5px;">
                        <!-- Quantity -->
                        <div hidden>
                          \\129.1.100.188\Drawingsap\DRAWING\ABRIC\FG-ABRIC-BD0000003-1A.JPG
                        </div>
                        <div class="row">
                          <div class="col text-right" style="padding-left:0px; padding-right:5px;">
                            <div class="ui-widget-info fade-in" style="margin-bottom:20px">
                              <h1 class="ui-value text-info"><strong><small>{{operation.ProcessQty.normalize}}</small></strong></h1>
                              <span class="ui-label text-info">Process</span>
                            </div>
                            <div class="ui-widget-warning fade-in">
                              <h1 class="ui-value text-warning"><strong><small>{{remainQty.normalize}}</small></strong></h1>
                              <span class="ui-label text-warning">Remain</span>
                            </div>
                          </div>
                          <div class="col text-left" style="padding:0px;">
                            <div class="ui-widget-success fade-in" style="margin-bottom:20px">
                              <h1 class="ui-value text-success"><strong><small>{{operation.AcceptedQty.normalize}}</small></strong></h1>
                              <span class="ui-label text-success">Accept</span>
                            </div>
                            <div class="ui-widget-danger fade-in">
                              <h1 class="ui-value text-danger"><strong><small>{{operation.RejectedQty.normalize}}</small></strong></h1>
                              <span class="ui-label text-danger">Reject</span>
                            </div>
                          </div>
                        </div>
                        <br>
                        <!-- Tab -->
                        <div class="nav-tabs-boxed">
                          <ul class="nav nav-tabs" role="tablist">
                            <li class="nav-item">
                              <a class="nav-link small" data-toggle="tab" href="#info-tab" role="tab">
                                {{operation.OperationNo}} ({{operation.WorkCenterNo}})
                              </a>
                            </li>
                            <li class="nav-item"><a class="nav-link active small" data-toggle="tab" href="#rt-sheet-tab" role="tab">Routing Sheet ({{operationList|length}})</a></li>
                            <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#note-tab" role="tab">Note</a></li>
                            <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#history-tab" role="tab">History</a></li>
                            {% if overTimeOperatorList|length > 0 or overTimeWorkCenterList|length > 0 %}
                            <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#overtime-tab" role="tab">Overtime</a></li>
                            {% endif %}
                          </ul>
                          <div class="tab-content" style="padding-left: 5px; padding-right: 5px;">
                            <!-- Info Tab -->
                            <div class="tab-pane" id="info-tab" role="tabpanel">
                              <div class="nav-tabs-boxed">
                                <ul class="nav nav-tabs" role="tablist">
                                  <li class="nav-item"><a class="nav-link active small" data-toggle="tab" href="#operation-tab" role="tab">Operation</a></li>
                                  <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#order-tab" role="tab">Production Order</a></li>
                                </ul>
                              </div>
                              <div class="tab-content" style="padding-left: 5px; padding-right: 5px;">
                                <!-- Operation Tab -->
                                <div class="tab-pane small active" id="operation-tab" role="tabpanel">
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Prod. Order No</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="order_no" value="{{orderNo}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Operation No</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="operation_no" value="{{operationNo}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Operation Start</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="operation_start" value="{{operation.ProcessStart|default_if_none:""|date:"d-M-Y, H:i"}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Operation Stop</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="operation_stop" value="{{operation.ProcessStop|default_if_none:""|date:"d-M-Y, H:i"}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row" hidden>
                                    <label class="col-md-5 col-form-label text-right text-info"><strong>Process Qty</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="process_qty" value="{{operation.ProcessQty}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row" hidden>
                                    <label class="col-md-5 col-form-label text-right text-warning"><strong>Remain Qty</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="remain_qty" value="{{remainQty}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row" hidden>
                                    <label class="col-md-5 col-form-label text-right text-success"><strong>Accepted Qty</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="accepted_qty" value="{{operation.AcceptedQty}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row" hidden>
                                    <label class="col-md-5 col-form-label text-right text-danger"><strong>Rejected Qty</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="rejected_qty" value="{{operation.RejectedQty}}" readonly>
                                    </div>
                                  </div>
                                  <hr>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Work Center</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="work_center" value="{{operation.WorkCenterNo|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Work Center Group</strong>
                                      {% if workCenterInGroupList|length != 0 %}
                                      <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true"
                                      title="WorkCenter(s) in <span class='text-info'>{{operation.WorkCenterGroup}}</span> Group."
                                      data-content="{% for wc in workCenterInGroupList %}{{wc.WorkCenterNo}}<br>{% endfor %}">?</a>
                                      {% endif %}
                                    </label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="work_center_group" value="{{operation.WorkCenterGroup|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Plan Start</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="plan_start" value="{{operation.PlanStartDate|slice:'8:10'}}-{{operation.PlanStartDate|slice:'5:7'}}-{{operation.PlanStartDate|slice:'0:4'}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Plan Finish</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="plan_finish" value="{{operation.PlanFinishDate|slice:'8:10'}}-{{operation.PlanFinishDate|slice:'5:7'}}-{{operation.PlanFinishDate|slice:'0:4'}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Est. Setup Time</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="est_setup_time" value="{{operation.EstSetupTime.normalize}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Est. Operation Time</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="est_operate_time" value="{{operation.EstOperationTime.normalize}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Est. Labor Time</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="est_labor_time" value="{{operation.EstLaborTime.normalize}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Date Get From SAP</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="operation_date_get_from_sap" value="{{operation.DateGetFromSAP|default_if_none:'Created at SFR'|date:"d-M-Y, H:i"}}" readonly>
                                    </div>
                                  </div>
                                </div>
                                <!-- Production Order Tab -->
                                <div class="tab-pane small" id="order-tab" role="tabpanel">
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right text-primary"><strong>Prod. Order Qty</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="order_qty" value="{{order.ProductionOrderQuatity}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Order Start</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="order_start" value="{{order.ProcessStart|default_if_none:""|date:"d-M-Y, H:i"}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Order Stop</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="order_stop" value="{{order.ProcessStop|default_if_none:""|date:"d-M-Y, H:i"}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Customer PO No</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="customer_po_no" value="{{order.CustomerPONo|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Part No</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="part_no" value="{{order.PartNo|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Part Name</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="part_name" value="{{order.PartName|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Sales Order No</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="sale_order_no" value="{{order.SalesOrderNo|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Sales Create Date</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="sale_create_date" value="{{order.SalesCreateDate|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Sales Order Qty</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="sale_order_qty" value="{{order.SalesOrderQuantity|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>FG Mat Code</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="fg_material_code" value="{{order.FG_MaterialCode|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>RM Mat Code</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="rm_material_code" value="{{order.RM_MaterialCode|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>MRP Controller</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="mrp_controller" value="{{order.MRP_Controller|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Request Date</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="request_date" value="{{order.request_date|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Release Date</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="release_date" value="{{order.ReleaseDate|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Drawing No</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="drawing_no" value="{{order.DrawingNo|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Routing Group</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="routing_group" value="{{order.RoutingGroup|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Routing Group Counter</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="routing_group_counter" value="{{order.RoutingGroupCounter|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Plant</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="plant" value="{{order.Plant|default_if_none:""}}" readonly>
                                    </div>
                                  </div>
                                  <div class="form-group row">
                                    <label class="col-md-5 col-form-label text-right"><strong>Date Get From SAP</strong></label>
                                    <div class="col-md-7">
                                      <input class="form-control form-control-sm" type="text" id="order_date_get_from_sap" value="{{order.DateGetFromSAP|default_if_none:""|date:"d-M-Y, H:i"}}" readonly>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <!-- Routing Sheet -->
                            <div class="tab-pane active small" id="rt-sheet-tab" role="tabpanel">
                              <table class="table table-sm table-responsive-sm table-outline text-center">
                                <thead class="bg-darkslategray">
                                  <tr>
                                    <th>
                                      Status
                                      <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title="Tips"
                                      data-content="
                                      <strong class='text-success'>Complete</strong><br>
                                      <strong class='text-skyblue'>Complete (No Working Time Report)</strong><br>
                                      <strong class='text-yellowgreen'>Partial Complete</strong><br>
                                      <strong class='text-primary'>Joining</strong><br>
                                      <strong class='text-warning'>Working</strong><br>
                                      <strong class='text-info'>Ready</strong><br>
                                      <strong class='text-orangered'>Overtime</strong><br>
                                      <strong class='text-danger'>Error</strong><br>
                                      <strong class='text-dark'>Closed</strong><br>
                                      ">?
                                      </a>
                                    </th>
                                    <th>Operation No</th>
                                    <th>Work Center</th>
                                    <th class="text-info">Process</th>
                                    <th class="text-success">Accepted</th>
                                    <th class="text-danger">Rejected</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  {% for item in operationList %}
                                  <tr {% if item.OperationNo.strip == operationNo %}class="bg-lavender"{% endif %}>
                                    <td>
                                      {% if item.WorkCenterNo == None %}<i class="c-icon c-icon-sm cib-discover text-danger" style="padding-top:5px" data-toggle="tooltip" data-original-title="Error"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'COMPLETE' %}<i class="c-icon c-icon-sm cib-discover text-success" style="padding-top:5px" data-toggle="tooltip" data-original-title="Complete"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'COMPLETE, NO WORKING TIME REPORT' %}<i class="c-icon c-icon-sm cib-discover text-skyblue" style="padding-top:5px" data-toggle="tooltip" data-original-title="Complete (No Working Time Report)"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'PARTIALCOMPLETE' %}<i class="c-icon c-icon-sm cib-discover text-yellowgreen" style="padding-top:5px" data-toggle="tooltip" data-original-title="Partial Complete"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'JOINING' %}<i class="c-icon c-icon-sm cib-discover text-primary" style="padding-top:5px" data-toggle="tooltip" data-original-title="Joining"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'WORKING' %}<i class="c-icon c-icon-sm cib-discover text-warning" style="padding-top:5px" data-toggle="tooltip" data-original-title="Working"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'READY' %}<i class="c-icon c-icon-sm cib-discover text-info" style="padding-top:5px" data-toggle="tooltip" data-original-title="Ready"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'OVERTIME' %}<i class="c-icon c-icon-sm cib-discover text-orangered" style="padding-top:5px;" data-toggle="tooltip" data-original-title="Overtime"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'ERROR' %}<i class="c-icon c-icon-sm cib-discover text-danger" style="padding-top:5px" data-toggle="tooltip" data-original-title="Error"></i>
                                      {% elif operationStatusList|index:forloop.counter0 == 'CLOSED' %}<i class="c-icon c-icon-sm cib-discover text-dark" style="padding-top:5px" data-toggle="tooltip" data-original-title="Closed"></i>
                                      {% endif %}
                                    </td>
                                    <td>
                                      {% if item.OperationNo != operationNo %}
                                      <a href="/transaction/{{orderNo}}{{item.OperationNo}}">{{item.OperationNo}}</a>
                                      {% else %}
                                      {{item.OperationNo}}
                                      {% endif %}
                                    </td>
                                    <td>{{item.WorkCenterNo|default_if_none:""}}</td>
                                    <td>{{item.ProcessQty.normalize}}</td>
                                    <td>{{item.AcceptedQty.normalize}}</td>
                                    <td>{{item.RejectedQty.normalize}}</td>
                                  </tr>
                                  {% endfor %}
                                </tbody>
                              </table>
                            </div>
                            <!-- Note -->
                            <div class="tab-pane small" id="note-tab" role="tabpanel">
                              <table class="table table-sm table-responsive-sm table-outline text-center">
                                <thead class="bg-darkslategray">
                                  <tr>
                                    <th>Note</th>
                                    <th class="text-right">
                                      <button type="button" class="btn btn-sm btn-pill btn-link" onclick="open_note()" id="open_note_button"><strong><i class="c-icon c-icon-sm cil-pen text-warning"></i></strong></button>
                                      <button type="button" class="btn btn-sm btn-pill btn-link" onclick="save_note()" id="save_note_button" hidden><strong><i class="c-icon c-icon-sm cil-save text-success"></i></strong></button>
                                      <button type="button" class="btn btn-sm btn-pill btn-link" onclick="close_note()" id="close_note_button" hidden><strong><i class="c-icon c-icon-sm cil-x-circle text-danger"></i></strong></button>
                                      &nbsp;
                                    </th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr {% if item.OperationNo.strip == operationNo %}class="bg-lavender"{% endif %}>
                                    <td>Order</td>
                                    <td><textarea class="form-control" name="name" rows="2" cols="80" id="note_0" readonly>{{order.Note|default_if_none:""}}</textarea></td>
                                  </tr>
                                  {% for item in operationList %}
                                  <tr {% if item.OperationNo.strip == operationNo %}class="bg-lavender"{% endif %}>
                                    <td><strong>{{item.OperationNo}}</strong><br>{{item.WorkCenterNo}}</td>
                                    <td><textarea class="form-control" name="name" rows="2" cols="80" id="note_{{forloop.counter}}" readonly>{{item.Note|default_if_none:""}}</textarea></td>
                                  </tr>
                                  {% endfor %}
                                </tbody>
                              </table>
                            </div>
                            <!-- History Tab -->
                            <div class="tab-pane" id="history-tab" role="tabpanel">
                              <div class="nav-tabs-boxed">
                                <ul class="nav nav-tabs" role="tablist">
                                  <li class="nav-item"><a class="nav-link small active" data-toggle="tab" href="#operate-tab" role="tab" aria-controls="home">Operate ({{historyOperateList|length}})</a></li>
                                  <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#confirm-tab" role="tab" aria-controls="profile">Confirm ({{historyConfirmList|length}})</a></li>
                                  <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#join-tab" role="tab" aria-controls="profile">Join ({{historyJoinList|length}})</a></li>
                                  <li class="nav-item"><a class="nav-link small" data-toggle="tab" href="#mod-tab" role="tab">Modified ({{modList|length}})</a></li>
                                </ul>
                              </div>
                              <div class="tab-content" style="padding-left: 5px; padding-right: 5px;">
                                <!-- Operate Tab -->
                                <div class="tab-pane active" id="operate-tab" role="tabpanel">
                                  {% if historyOperateList|length == 0 %}
                                  <h5 class="text-center">NO DATA</h5>
                                  {% else %}
                                  <table class="table table-sm table-responsive-sm table-outline small">
                                    <thead class="bg-darkslategray">
                                      <tr>
                                        <th>Operator</th>
                                        <th>Work Center</th>
                                        <th>Type</th>
                                        <th>Setup</th>
                                        <th>Oper</th>
                                        <th>Labor</th>
                                        <th>Start Time</th>
                                        <th>Finish Time</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      {% for operate in historyOperateList %}
                                      {% if operate.EmpID != None %}
                                      <tr>
                                        <td><a href="/emp/{{operate.EmpID}}&NOW">{{operate.EmpID}}</a></td>
                                        <td><a href="/wc/{{operate.WorkCenterNo}}&NOW">{{operate.WorkCenterNo}}</a></td>
                                        <td>
                                          {% if operate.Type.strip == 'WORKING' and operate.IsExternalProcess and operate.Setup == 0.00 and operate.Oper == 0.00 and operate.Labor == 0.00  %}<span class="text-plum"><strong>Ext-Work</strong></span>
                                          {% elif operate.Setup == 0.00 and operate.Oper == 0.00 and operate.Labor == 0.00  %}<span class="text-muted"><strong>Skip</strong></span>
                                          {% elif operate.Type.strip == 'WORKING' %}<span class="text-success"><strong>Working</strong></span>
                                          {% elif operate.Type.strip == 'SETUP' %}<span class="text-yellowgreen"><strong>Setup</strong></span>
                                          {% elif operate.Type.strip == 'MANUAL' %}<span class="text-primary"><strong>Manual Report</strong></span>
                                          {% endif %}
                                        </td>
                                        <td>{%if operate.Setup != 0.00 %}{{operate.Setup.normalize}}{% endif %}</td>
                                        <td>{%if operate.Oper != 0.00 %}{{operate.Oper.normalize}}{% endif %}</td>
                                        <td>{%if operate.Labor != 0.00 %}{{operate.Labor.normalize}}{% endif %}</td>
                                        <td>{{operate.StartDateTime|date:"d-M-Y, H:i"}}</td>
                                        <td>{{operate.StopDateTime|date:"d-M-Y, H:i"}}</td>
                                      </tr>
                                      {% endif %}
                                      {% endfor %}
                                    </tbody>
                                  </table>
                                  {% endif %}
                                </div>
                                <!-- Confirm Tab -->
                                <div class="tab-pane" id="confirm-tab" role="tabpanel">
                                  {% if historyConfirmList|length == 0 %}
                                  <h5 class="text-center">NO DATA</h5>
                                  {% else %}
                                  <table class="table table-sm table-responsive-sm table-outline small">
                                    <thead class="bg-darkslategray">
                                      <tr>
                                        <th>Operator</th>
                                        <th>Work Center</th>
                                        <th class="text-success">Good Qty</th>
                                        <th class="text-danger">Reject Qty</th>
                                        <th>Reason</th>
                                        <th>Confirm Time</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      {% for confirm in historyConfirmList %}
                                      <tr>
                                        <td><a href="/emp/{{confirm.EmpID}}&NOW">{{confirm.EmpID}}</a></td>
                                        <td><a href="/wc/{{confirm.WorkCenterNo}}&NOW">{{confirm.WorkCenterNo}}</a></td>
                                        <td>{%if confirm.AcceptedQty != 0.00 %}{{confirm.AcceptedQty.normalize}}{% endif %}</td>
                                        <td>{%if confirm.RejectedQty != 0.00 %}{{confirm.RejectedQty.normalize}}{% endif %}</td>
                                        <td>
                                          {% if confirm.RejectReason.strip == 'SCRAP FROM PREVIOUS PROCESS' %}
                                          SCRAP FROM → {{confirm.OPN}} ({{confirm.WCN}})
                                          {% else %}{{confirm.RejectReason}}{% endif %}
                                        </td>
                                        <td>{{confirm.ConfirmDateTime|date:"d-M-Y, H:i"}}</td>
                                      </tr>
                                      {% endfor %}
                                    </tbody>
                                  </table>
                                  {% endif %}
                                </div>
                                <!-- Join Tab -->
                                <div class="tab-pane" id="join-tab" role="tabpanel">
                                  {% if historyJoinList|length == 0 %}
                                  <h5 class="text-center">NO DATA</h5>
                                  {% else %}
                                  <table class="table table-sm table-responsive-sm table-outline small">
                                    <thead class="bg-darkslategray">
                                      <tr>
                                        <th>Join To</th>
                                        <th>Join By</th>
                                        <th>Start</th>
                                        <th>Stop</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      {% for join in historyJoinList %}
                                      <tr>
                                        {% if orderNo == join.JoinToOrderNo and operationNo == join.JoinToOperationNo %}
                                        <td>{{join.JoinToOrderNo}} - {{join.JoinToOperationNo}}</td>
                                        <td><a href="/transaction/{{join.JoinByOrderNo}}{{join.JoinByOperationNo}}">{{join.JoinByOrderNo}} - {{join.JoinByOperationNo}}</a></td>
                                        {% elif orderNo == join.JoinByOrderNo and operationNo == join.JoinByOperationNo %}
                                        <td><a href="/transaction/{{join.JoinToOrderNo}}{{join.JoinToOperationNo}}">{{join.JoinToOrderNo}} - {{join.JoinToOperationNo}}</a></td>
                                        <td>{{join.JoinByOrderNo}} - {{join.JoinByOperationNo}}</td>
                                        {% endif %}
                                        <td>{{join.StartDateTime|date:"d-M-Y, H:i"}}</td>
                                        <td>{{join.StopDateTime|date:"d-M-Y, H:i"}}</td>
                                      </tr>
                                      {% endfor %}
                                    </tbody>
                                  </table>
                                  {% endif %}
                                </div>
                                <!-- Mod Tab -->
                                <div class="tab-pane" id="mod-tab" role="tabpanel">
                                  {% if modList|length == 0 %}
                                  <h5 class="text-center">NO DATA</h5>
                                  {% else %}
                                  <table class="table table-sm table-responsive-sm table-outline text-center small">
                                    <thead class="bg-darkslategray">
                                      <tr>
                                        <th>Action</th>
                                        <th>Operation No</th>
                                        <th>EmpID</th>
                                        <th>ChiefID</th>
                                        <th>DateTimeStamp</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      {% for mod in modList %}
                                      <tr>
                                        <td class="
                                        {% if mod.Type == 'ADD' %}text-success
                                        {% elif mod.Type == 'CHANGE' %}text-warning
                                        {% elif mod.Type == 'DELETE' %}text-danger
                                        {% elif mod.Type == 'INC QTY' %}text-skyblue
                                        {% elif mod.Type == 'DEC QTY' %}text-lightpink
                                        {% endif %}">
                                          <strong>{{mod.Type}}</strong>
                                        </td>
                                        <td>{{mod.OperationNo}}</td>
                                        <td>{{mod.EmpID}}</td>
                                        <td>{{mod.ChiefID}}</td>
                                        <td>{{mod.ModifyDateTime|date:"d-M-Y, H:i"}}</td>
                                      </tr>
                                      {% endfor %}
                                    </tbody>
                                  </table>
                                  {% endif %}
                                </div>
                              </div>
                            </div>
                            <!-- Overtime Tab -->
                            <div class="tab-pane small" id="overtime-tab" role="tabpanel">
                              {% if overTimeOperatorList|length > 0 %}
                              <h6>Operator</h6>
                              <table class="table table-sm table-responsive-sm table-outline text-center">
                                <thead class="bg-darkslategray">
                                  <tr>
                                    <th>EmpID</th>
                                    {% if operation.WorkCenterType == 'Machine' %}
                                    <th>WorkCenter</th>
                                    {% endif %}
                                    <th>Status</th>
                                    <th>StartDateTime</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  {% for ot in overTimeOperatorList %}
                                  <tr>
                                    <td><a href="/emp/{{ot.EmpID}}&NOW">{{ot.EmpID}}</a></td>
                                    {% if operation.WorkCenterType == 'Machine' %}
                                    <td><a href="/wc/{{ot.WorkCenterNo}}&NOW">{{ot.WorkCenterNo}}</a></td>
                                    {% endif %}
                                    <td>
                                      {% if ot.Status == 'WORKING' %}<span class="text-success"><strong>Working</strong></span>
                                      {% elif ot.Status == 'SETUP' %}<span class="text-yellowgreen"><strong>Setup</strong></span>
                                      {% else %}{{ot.Status}}{% endif %}
                                    </td>
                                    <td>{{ot.StartDateTime|date:"d-M-Y, H:i"}}</td>
                                  </tr>
                                  {% endfor %}
                                </tbody>
                              </table>
                              {% endif %}
                              {% if overTimeWorkCenterList|length > 0 %}
                              <h6>WorkCenter (Auto Machine)</h6>
                              <table class="table table-sm table-responsive-sm table-outline text-center">
                                <thead class="bg-darkslategray">
                                  <tr>
                                    <th>WorkCenter</th>
                                    <th>StartDateTime</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  {% for ot in overTimeWorkCenterList %}
                                  <tr>
                                    <td><a href="/wc/{{ot.WorkCenterNo}}&NOW">{{ot.WorkCenterNo}}</a></td>
                                    <td>{{ot.StartDateTime|date:"d-M-Y, H:i"}}</td>
                                  </tr>
                                  {% endfor %}
                                </tbody>
                              </table>
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Right Content -->
                  <div class="col-sm-12 col-md-8" style="padding-left: 10px; padding-right: 0px;">
                    <div class="row">
                      <!-- Button Group -->
                      <div class="col-md-6 text-left">
                        {% if isFirst and operation.ProcessStop == None %}
                        <button type="button" class="btn btn-xs bg-skyblue my-btn small btn-icon" data-toggle="modal" data-target="#inc_qty_modal" id="inc_qty_main_button" onclick="prepare_inc_qty()"><i class="c-icon cil-vertical-align-top"></i><br>Inc. Qty</button>
                        {% endif %}
                        {% if isFirst and operation.AcceptedQty == 0 and operation.RejectedQty == 0 %}
                        <button type="button" class="btn btn-xs bg-lightpink my-btn small btn-icon" data-toggle="modal" data-target="#dec_qty_modal" id="dec_qty_main_button" onclick="prepare_dec_qty()"><i class="c-icon cil-vertical-align-bottom"></i><br>Dec. Qty</button>
                        {% endif %}
                        {% if order.ProcessStop == None %}
                        <button type="button" class="btn btn-xs btn-success my-btn small btn-icon" data-toggle="modal" data-target="#add_modal" id="add_main_button" onclick="prepare_add()"><i class="c-icon cil-plus"></i><br>Add</button>
                        {% endif %}
                        {% if operation.ProcessStart == None and joinList|length == 0 and operation.JoinToOrderNo == None and operation.JoinToOperationNo == None %}
                        <button type="button" class="btn btn-xs btn-warning my-btn text-white small" data-toggle="modal" data-target="#change_modal" id="change_main_button" onclick="prepare_change()"><i class="c-icon cil-transfer"></i><br>Change</button>
                        {% endif %}
                        {% if operation.ProcessStart == None and joinList|length == 0 and operation.JoinToOrderNo == None and operation.JoinToOperationNo == None %}
                        <button type="button" class="btn btn-xs btn-danger my-btn small" data-toggle="modal" data-target="#delete_modal" id="delete_main_button" onclick="prepare_delete()"><i class="c-icon cil-trash"></i><br>Delete</button>
                        {% endif %}
                        <p></p>
                      </div>
                      <div class="col-md-6 text-right">
                        <a type="button" class="btn btn-xs btn-primary my-btn small" href="/join_activity/{{orderNo}}{{operationNo}}" id="join_main_button"><i class="c-icon cil-fullscreen-exit"></i><br>Join</a>
                        <button type="button" class="btn btn-xs btn-danger my-btn small" data-toggle="modal" data-target="#break_join_modal" id="break_join_main_button"><i class="c-icon cil-fullscreen"></i><br>Break Join</button>
                        {% if joinList|length > 0 %}
                        <button type="button" class="btn btn-xs btn-primary text-white my-btn small" data-toggle="modal" data-target="#join_list_modal" id="join_list_main_button"><i class="c-icon cil-list"></i><br>Join List</button>
                        {% endif %}
                        <a href="/transaction/0" class="btn btn-xs btn-dark my-btn small"><i class="c-icon cil-account-logout"></i><br>Exit</a>
                        <p></p>
                      </div>
                      {% if remainQty > 0 %}
                        <!-- WorkCenter/Operator -->
                        {% if operation.JoinToOrderNo == None and operation.JoinToOperationNo == None and operation.WorkCenterNo != None and isOvertime == False %}
                          <div class="col-md-12">
                            <div class="card border-secondary">
                              <div class="card-header">
                                <strong>Working Area</strong>
                                <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title="Tips"
                                data-content="
                                - <strong class='text-danger'>Stop Working</strong> on manual workcenter will automatically stop workcenter.<br>
                                - You can ignore <strong class='text-primary'>Confirm</strong> and let operator after you confirm all quantity.<br>
                                - Employee working on <strong class='text-plum'>External Process</strong> can still work on other operations.<br>
                                - <strong class='text-plum'>External Process</strong> only keep startdatetime and stopdatetime, but not working time.<br>
                                - Be Careful !, <strong class='text-primary'>Confirm</strong> all remaining quantity will terminate all working operator and workcenter.<br>
                                ">?
                                </a>
                                <div class="card-header-actions">
                                  {% if overTimeOperatorList|length != 0 or overTimeWorkCenterList|length != 0 or canMP or operation.WorkCenterGroup.strip == 'STD' %}
                                  <button class="btn btn-sm btn-link small" data-toggle="modal" data-target="#manual_report_modal" onclick="prepare_mp()" id="mp_main_button">Manual Report</button>
                                  {% endif %}
                                </div>
                              </div>
                              <div class="card-body" style="padding-left: 5px; padding-right: 5px;">
                                {% if operation.WorkCenterType == 'Machine' %}
                                <div class="form-group row">
                                  <label class="col-md-2 col-form-label text-right"><strong><i class="c-icon c-icon-sm cil-plus"></i> WorkCenter</strong></label>
                                  <div class="col-md-2">
                                    <input class="form-control" type="text" id="workcenter_no" autocomplete="off" value="" oninput="let p=this.selectionStart;this.value=this.value.toUpperCase();this.setSelectionRange(p, p);">
                                  </div>
                                  <div class="col-md-5">
                                    <input class="form-control" type="text" id="workcenter_name" value="" readonly>
                                  </div>
                                  <div class="col-md-2">
                                    <button type="button" class="btn btn-pill btn-info" id='workcenter_add_button' onclick="add_operating_workcenter()" disabled><i class="c-icon c-icon-sm cil-plus"></i> Add</button>
                                  </div>

                                </div>
                                <table class="table table-sm table-outline text-center" style="table-layout:fixed;" id="workcenter_table">
                                  <thead class="bg-darkslategray">
                                    <tr>
                                      <th><i class="c-icon cil-task"></i></th>
                                      <th><i class="c-icon cil-speedometer"></i></th>
                                      <th><i class="c-icon cil-speech"></i></th>
                                      <th><i class="c-icon cil-clock"></i></th>
                                      <th><i class="c-icon cil-options"></i></th>
                                    </tr>
                                  </thead>
                                  <tbody id="workcenter_table_body">

                                  </tbody>
                                </table>
                                {% endif %}
                                <div class="form-group row">
                                  <label class="col-md-2 col-form-label text-right"><strong><i class="c-icon c-icon-sm cil-plus"></i> Operator</strong></label>
                                  <div class="col-md-2">
                                    <input class="form-control" type="text" id="operator_id" autocomplete="off" value="">
                                  </div>
                                  <div class="col-md-5">
                                    <input class="form-control" type="text" id="operator_name" value="" readonly>
                                  </div>
                                  <div class="col-md-3">
                                    <button type="button" class="btn btn-pill {% if operation.IsExternalProcess %}bg-plum text-white{% else %}btn-success{% endif %}" id='operator_work_button' onclick="add_operating_operator('{% if operation.IsExternalProcess %}EXT-WORK{% else %}WORKING{% endif %}')" disabled><i class="c-icon c-icon-sm cil-power-standby"></i> Work</button>
                                    {% if operation.WorkCenterType == 'Machine' and joinList|length == 0 %}
                                    <button type="button" class="btn btn-pill bg-yellowgreen text-white" id='operator_setup_button' onclick="add_operating_operator('SETUP')" disabled><i class="c-icon c-icon-sm cil-power-standby"></i> Setup</button>
                                    {% endif %}
                                  </div>
                                </div>
                                <table class="table table-sm table-outline text-center" style="table-layout:fixed;" id="operator_table">
                                  <thead class="bg-darkslategray">
                                    <tr>
                                      <th><i class="c-icon cil-user"></i></th>
                                      {% if operation.WorkCenterType == 'Machine' %}<th><i class="c-icon cil-speedometer"></i></th>{% endif %}
                                      <th><i class="c-icon cil-speech"></i></th>
                                      <th><i class="c-icon cil-clock"></i></th>
                                      <th><i class="c-icon cil-options"></i></th>
                                    </tr>
                                  </thead>
                                  <tbody id="operator_table_body">

                                  </tbody>
                                </table>
                              </div>
                            </div>
                          </div>
                        {% endif %}
                        <!-- Overtime -->
                        {% if operation.JoinToOrderNo == None and operation.JoinToOperationNo == None and operation.WorkCenterNo != None and isOvertime == True %}
                          <div class="col-md-12">
                            <div class="card text-white text-center bg-orangered">
                              <div class="card-body text-center">
                                <br><br><br><br><br>
                                <h1><i class="c-icon c-icon-2xl cil-av-timer" style="font-size: 10rem; width: 10rem;"></i></h1>
                                <br>
                                <h3><strong>This Operation is Overtime</strong></h3>
                                <br>
                                <p>This operation exceed {{overtimehour}} hrs working time limit.<br>Please correct stop time manually.</p>
                                <button type="button" class="btn btn-pill btn-lg btn-dark small" onclick="fix_overtime()" id="fix_overtime_button"><strong>Fix Stop Time</strong></button>
                                <br><br><br><br>
                              </div>
                            </div>
                          </div>
                        {% endif %}
                        <!-- Joining -->
                        {% if operation.JoinToOrderNo != None and operation.JoinToOperationNo != None %}
                          <div class="col-md-12">
                            <div class="card text-white bg-primary text-center">
                              <div class="card-body text-center">
                                <br><br><br><br><br>
                                <h1><i class="c-icon c-icon-2xl cil-fork" style="font-size: 10rem; width: 10rem;"></i></h1>
                                <br>
                                <h3><strong>This Operation is Joining</strong></h3>
                                <br>
                                <a href="/transaction/{{operation.JoinToOrderNo}}{{operation.JoinToOperationNo}}" class="btn btn-pill btn-lg btn-dark small"><strong>&nbsp;&nbsp;&nbsp;GO TO JOIN OPERATION #{{operation.JoinToOrderNo}}-{{operation.JoinToOperationNo}}&nbsp;&nbsp;&nbsp;</strong></a>
                                <br><br><br><br><br>
                              </div>
                            </div>
                          </div>
                        {% endif %}
                      {% else %}
                        <!-- Complete Operation -->
                        {% if operation.ProcessQty != 0 %}
                          <div class="col-md-12">
                            <div class="card text-white bg-success text-center">
                              <div class="card-header">
                                <div class="card-header-actions">
                                  {% if canMP %}
                                  <button class="btn btn-sm btn-link text-white small" data-toggle="modal" data-target="#manual_report_modal" onclick="prepare_mp()" id="mp_main_button">Manual Report</button>
                                  {% endif %}
                                </div>
                              </div>
                              <div class="card-body text-center">
                                <br><br><br><br><br>
                                <h1>
                                  <i class="c-icon c-icon-2xl cil-check" style="font-size: 10rem; width: 10rem;"></i>
                                </h1>
                                <br>
                                <div class="row">
                                  {% if order.ProcessStop != None %}
                                  <div class="col-6">
                                    <h3><strong>This Order is Complete</strong></h3>
                                    <h6>Start Order : {{order.ProcessStart|date:"d-M-Y, H:i"}}</h6>
                                    <h6>Stop Order : {{order.ProcessStop|date:"d-M-Y, H:i"}}</h6>
                                  </div>
                                  {% endif %}
                                  <div class="{% if order.ProcessStop != None %}col-6{% else %}col-12{% endif %}">
                                    <h3><strong>This Operation is Complete</strong></h3>
                                    <h6>Start Process : {{operation.ProcessStart|date:"d-M-Y, H:i"}}</h6>
                                    <h6>Stop Process : {{operation.ProcessStop|date:"d-M-Y, H:i"}}</h6>
                                  </div>
                                </div>
                                <br>
                                {% if currentOperation != -1 %}
                                <a href="/transaction/{{orderNo}}{{currentOperation}}" class="btn btn-pill btn-lg btn-light small"><strong>&nbsp;&nbsp;&nbsp;Go To Current Operation #{{currentOperation}}&nbsp;&nbsp;&nbsp;</strong></a>
                                {% endif %}
                                <br><br><br><br>
                              </div>
                            </div>
                          </div>
                        {% endif %}
                        <!-- Waiting Operation -->
                        {% if operation.ProcessQty == 0 %}
                          <div class="col-md-12">
                            <div class="card text-white bg-dark text-center">
                              <div class="card-body text-center">
                                <br><br><br><br><br>
                                <h1><i class="c-icon c-icon-2xl cil-puzzle" style="font-size: 10rem; width: 10rem;"></i></h1>
                                <br>
                                <h3><strong>This Operation is Waiting</strong></h3>
                                <br>
                                {% if currentOperation != -1 %}
                                <a href="/transaction/{{orderNo}}{{currentOperation}}" class="btn btn-pill btn-lg btn-light small"><strong>&nbsp;&nbsp;&nbsp;Go To Current Operation #{{currentOperation}}&nbsp;&nbsp;&nbsp;</strong></a>
                                {% endif %}
                                <br><br><br><br><br>
                              </div>
                            </div>
                          </div>
                        {% endif %}
                      {% endif %}
                    </div>
                  </div>
                </div>
              {% endif%}
              <!-- Cancel Order -->
              {% if state == "CANCEL" %}
              <div class="row">
                <div class="col-md-12 text-center">
                  <br><br><br><br><br><br><br><br>
                  <h1><i class="c-icon c-icon-2xl cil-x-circle" style="font-size: 10rem; width: 10rem;"></i></h1>
                  <br>
                  <h1><strong>Canceled Production Order</strong></h1>
                  <br>
                  <p>
                    <strong>Production Order No</strong><br><span class="text-danger"><strong>{{orderNo}}</strong></span>
                  </p>
                </div>
              </div>
              {% endif%}
              <!-- Not Found -->
              {% if state == "NODATAFOUND" or state == "NOOPERATIONFOUND" %}
              <div class="row">
                <div class="col-md-12 text-center">
                  <br><br><br><br><br><br><br><br>
                  <h1><i class="c-icon c-icon-2xl cil-ban" style="font-size: 10rem; width: 10rem;"></i></h1>
                  <br>
                  {% if state == "NODATAFOUND" %}
                  <h1><strong>Production Order No Not Found</strong></h1>
                  {% elif state == "NOOPERATIONFOUND" %}
                  <h1><strong>Operation Not Found</strong></h1>
                  {% endif %}
                  <p>
                    <strong>Production Order No</strong><br><span class="{% if state == "NODATAFOUND" %}text-danger{% else %}text-success{% endif %}"><strong><span id="nf_order_no">{{orderNo}}</span></strong></span>
                    <br>
                    <strong>Operation No</strong><br><span class="text-danger"><strong><span id="nf_operation_no">{{operationNo}}</span></strong></span>
                  </p>
                  {% if state == "NOOPERATIONFOUND" and currentOperation != -1 %}
                  <a href="/transaction/{{orderNo}}{{currentOperation}}" class="btn btn-pill btn-lg btn-dark small"><strong>&nbsp;&nbsp;&nbsp;Go To Current Operation #{{currentOperation}}&nbsp;&nbsp;&nbsp;</strong></a>
                  {% elif state == "NOOPERATIONFOUND" %}
                  <p class="text-danger">
                    This Production has only header, please try refresh (F5) once<br>
                    If this message show again please contact SFR Team<br>
                  </p>
                  {% endif %}
                </div>
              </div>
              {% endif%}
              <!-- First Page -->
              {% if state == "FIRSTPAGE" %}
              <div class="row">
                <div class="col-md-12">
                  <br><br><br>
                  <h1 class="text-center"><i class="c-icon c-icon-2xl cil-globe-alt" style="font-size: 10rem; width: 10rem;"></i></h1>
                  <br>
                  <h1 class="text-center"><strong>SHOPFLOOR REPORTING APPLICATION</strong></h1>
                  <h6 class="text-center"><a href="../media/SFR Manual.pdf" target="_blank">SFR MANUAL.PDF</a></h6>
                  <br><br><br>
                  <div class="row">
                    <div class="col-sm-1 col-md-2"></div>
                    <div class="col-sm-10 col-md-8">
                      <div class="card">
                        <div class="card-body small" style="height:240px; overflow:auto;">
                          <h5 class="text-center">
                            <b class="text-warning blink">★★★★★</b><br> วัน <u>อาทิตย์ที่ 27 กุมภาพันธ์ เวลา 17:00 น. - เที่ยงคืน</u> แผนก <b class="text-primary">MIS</b> จะทำการปิดปรับปรุงเซิพเวอร์ <b>SFR</b><br>
                            ขอให้พนักงานทุกท่าน <b class="text-danger">Stop</b> ตัวเองออกจากระบบก่อนเวลาดังกล่าวด้วย และ สำหรับพนักงานที่ทำงาน ณ เวลาดังกล่าว โปรดจดบันทึกข้อมูลการทำงานไว้ เพื่อทำ <b class="text-info">Manual Report</b> ในภายหลัง<hr>
                          </h5>
                          <b class="text-warning blink">★</b> ขอให้ทุกแผนก ทุกกระบวนการผลิต  หยุดบันทึกการทำงาน และจำนวนชิ้นงานผ่านระบบ SAP ทุกกรณี <u>ให้ทำผ่านระบบ SFR เท่านั้น</u> (ยกเว้นการได้รับอนุญาติจาก <b class="text-orangered">SFR Team</b> นะครับ)<hr>
                          <b class="text-warning blink">★</b> CASE การแก้ไขข้อมูลต่าง ๆ <u>โปรดส่งเมลมาเท่านั้น</u> ส่งถึง <b>yashawantatul.man@ccsadvancetech.co.th, warissara@ccsadvancetech.co.th, puchong.nan@ccsadvancetech.co.th</b> และ CC ถึง <b>atul@ccsgroups.com</b><hr>
                          หากพนักงานท่านใดเจอ Order ที่ถูก <b class="text-danger">Cancel</b> ไปแล้ว โปรดแจ้งมาที่เมล <b>yashawantatul.man@ccsadvancetech.co.th</b> <i class="text-muted">──22-Feb-2022 14:15</i><hr>
                          <b class="text-orangered">SFR Team</b> กำลังทำการแก้ไข Section/CostCenter ของพนักงานทุกคน ข้อมูลอาจจะยังไม่ถูกต้องหรือครบถ้วนในช่วงเวลานี้ <i class="text-muted">──18-Feb-2022 22:00</i><hr>
                          กล่องด้านบนรูป <i class="c-icon c-icon-sm cil-user"></i> ใช้สำหรับใส่เลขรหัสพนักงาน ถ้าหากพนักงานทำงานอยู่จะกระโดดไปที่ Production Order นั้น ๆ ให้ทันที ไม่สามารถใช้ได้กับ <b class="text-plum">External Process</b> <i class="text-muted">──10-Feb-2022 13:40</i><hr>
                          ฟังค์ชั่น <b class="text-skyblue">Inc. Qty</b> (เพิ่มจำนวนชิ้นงาน) สามารถทำได้โดยที่ <u>Process แรกยังไม่ได้ Confirm จำนวนครบ</u><br>
                          ฟังค์ชั่น <b class="text-lightpink">Dec. Qty</b> (ลดจำนวนชิ้นงาน) สามารถทำได้โดยที่ <u>Process แรกยังไม่ได้ Confirm จำนวนเลย</u><br>
                          โดยทั้ง 2 ฟังค์ชั่นนี้ จะต้องแก้ไขที่ SAP เองด้วย<br>
                          ..ส่วนการลดจำนวนชิ้นงานโดยที่ทำเลยไป Process อื่นๆ แล้ว จะต้อง Reject ชิ้นงานโดยให้เหตุผลว่า <b class="text-danger">MATERIAL QUANTITY ADJUSTMENT</b><br>
                          หากมีข้อสงสัยติดต่อ <b>6624</b> หรือ <b>1345</b><i class="text-muted">──10-Feb-2022 10:10</i><hr>
                          แถบ <b class="text-info">History</b> (ประวัติ) ถูกย้ายมากล่องซ้ายมือนะครับ <i class="text-muted">──10-Feb-2022 08:45</i><hr>
                          ตาราง Overtime ดูได้ที่แถบซ้ายมือ Report > Overtime Table สำหรับหัวหน้าแผนก (กด Fix Stop Time ไปแล้ว) <i class="text-muted">──09-Feb-2022 00:45</i><hr>
                          Order ที่เคยทำ <b class="text-info">Partial</b> ไปแล้วใน SAP ติดต่อ <b>6624</b> นะครับ <i class="text-muted">──07-Feb-2022 13:30</i><hr>
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-1 col-md-2"></div>
                  </div>
                </div>
              </div>
              {% endif %}
            </div>
          </div>
        </main>
      </div>
      <!-- *** FOOTER *** -->
      {% include 'footer.html' %}
      <!-- *** MODAL *** -->
      <div class="modal" id="inc_qty_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header bg-skyblue">
              <h4 class="modal-title"><i class="c-icon cil-vertical-align-top"></i> Increase Production Order Qty</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <small>การเพิ่มจำนวนชิ้นงานสามารถเพิ่มได้เฉพาะเมื่อ Process แรกยังไม่ได้ Confirm จำนวนครบ โดยจะต้องทำการแก้ไขใน SAP ด้วยตัวเองด้วย</small>
              <hr>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Employee ID</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="text" id="inc_qty_emp_id" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm my-password" type="text" id="inc_qty_password" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Increase Qty By</strong></label>
                <div class="col-md-3">
                  <input class="form-control form-control-sm" type="text" value="{{operation.ProcessQty.normalize}}" autocomplete="off" readonly>
                </div>
                <div class="col-md-1">
                  +
                </div>
                <div class="col-md-4">
                  <input class="form-control form-control-sm" type="text" id="inc_qty_amount" autocomplete="off">
                </div>
              </div>
              <div class="text-danger text-center small" id="inc_qty_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <small>Permission: Section Chief+</small>
              <button class="btn bg-skyblue" type="button" id="inc_qty_confirm_button" onclick="inc_qty()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="dec_qty_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header bg-lightpink">
              <h4 class="modal-title"><i class="c-icon cil-vertical-align-bottom"></i> Decrease Production Order Qty</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <small>การลดจำนวนชิ้นงานสามารถลดได้เฉพาะเมื่อ Process แรกยังไม่ได้ Confirm จำนวน โดยจะต้องทำการแก้ไขใน SAP ด้วยตัวเองด้วย</small>
              <hr>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Employee ID</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="text" id="dec_qty_emp_id" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm my-password" type="text" id="dec_qty_password" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Decrease Qty By</strong></label>
                <div class="col-md-3">
                  <input class="form-control form-control-sm" type="text" value="{{operation.ProcessQty.normalize}}" autocomplete="off" readonly>
                </div>
                <div class="col-md-1">
                  -
                </div>
                <div class="col-md-4">
                  <input class="form-control form-control-sm" type="text" id="dec_qty_amount" autocomplete="off">
                </div>
              </div>
              <div class="text-danger text-center small" id="dec_qty_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <small>Permission: Section Chief+</small>
              <button class="btn bg-lightpink" type="button" id="dec_qty_confirm_button" onclick="dec_qty()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="add_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-xl modal-success" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-plus"></i> Add Operation</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br>
              <div class="row">
                <div class="col-6">
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Employee ID</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="text" id="add_emp_id" autocomplete="off">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm my-password" type="text" id="add_password" autocomplete="off">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small">
                      <strong>New Operation No</strong>
                      <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title="Conditions"
                      data-content="
                      1) Not Exist Number.<br>
                      2) Only After Working/Complete Operation.<br>
                      3) Never Deleted Number.<br>
                      ">!
                      </a>
                    </label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="text" id="add_new_operation_no" autocomplete="off" maxlength="4" value="">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Work Center</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="text" id="add_work_center_no" autocomplete="off" value="" oninput="let p=this.selectionStart;this.value=this.value.toUpperCase();this.setSelectionRange(p, p);">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Plan Start Date</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="date" id="add_plan_start_date" autocomplete="off">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Plan Finish Date</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="date" id="add_plan_finish_date" autocomplete="off">
                    </div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small">
                      <strong>Control Key</strong>
                      <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title="Conditions"
                      data-content="
                      PP01 - Internal Work Center<br>
                      PP02 - External Process
                      ">!
                      </a>
                    </label>
                    <div class="col-md-8">
                      <select class="form-control form-control-sm" id="add_control_key">
                        <option value="PP01" selected>(PP01) Routing/Ref. op. set - internal proc.</option>
                        <option value="PP02">(PP02) Routing/Ref. op. set - external proc.</option>
                      </select>
                    </div>
                  </div>
                  <div id="add_pp01">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Est. Setup Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="number" id="add_est_setup_time" autocomplete="off">
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Est. Operation Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="number" id="add_est_operate_time" autocomplete="off">
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Est. Labor Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="number" id="add_est_labor_time" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div id="add_pp02" hidden>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Planned Delivery Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="text" id="add_pdt" autocomplete="off" value="7" readonly>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Purchasing Org</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="text" id="add_purchasing_org" autocomplete="off" value="{{order.Plant}}" readonly>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Cost Element</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="text" id="add_cost_element" autocomplete="off" value="51202101" readonly>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Material Group</strong></label>
                      <div class="col-md-8">
                        <select class="form-control form-control-sm" id="add_mat_group">
                          {% for materialGroup in materialGroupList %}
                          {% if materialGroup.Code.strip == 'ZEXTERNAL' %}
                          <option value="{{materialGroup.Code}}">{{materialGroup.Code}} | {{materialGroup.Description}}</option>
                          {% endif %}
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Purchasing Group</strong></label>
                      <div class="col-md-8">
                        <select class="form-control form-control-sm" id="add_purchasing_group">
                          {% for purchaseGroup in purchaseGroupList %}
                          <option value="{{purchaseGroup.ID}}" {% if purchaseGroup.IsDefault %}selected{% endif %}>{{purchaseGroup.ID}} | {{purchaseGroup.Name}}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Price Unit</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="number" id="add_price_unit" autocomplete="off" readonly>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Price</strong></label>
                      <div class="col-md-5">
                        <input class="form-control form-control-sm" type="number" id="add_price" autocomplete="off" readonly>
                      </div>
                      <div class="col-md-3">
                        <select class="form-control form-control-sm" id="add_currency" readonly>
                          {% for currency in currencyList %}
                          <option value="{{currency.Name}}" {% if currency.IsDefault %}selected{% endif %}>{{currency.Name}}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="text-danger text-center small" id="add_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <small>Permission: Section Chief+</small>
              <button class="btn btn-success text-white" type="button" id="add_confirm_button" onclick="add()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="change_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-xl modal-warning" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-transfer"></i> Change Operation</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br>
              <div class="row">
                <div class="col-6">
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Employee ID</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="text" id="change_emp_id" autocomplete="off">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm my-password" type="text" id="change_password" autocomplete="off">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Work Center</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="text" id="change_work_center_no" autocomplete="off" value="" oninput="let p=this.selectionStart;this.value=this.value.toUpperCase();this.setSelectionRange(p, p);">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Plan Start Date</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="date" id="change_plan_start_date" autocomplete="off">
                    </div>
                  </div>
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small"><strong>Plan Finish Date</strong></label>
                    <div class="col-md-8">
                      <input class="form-control form-control-sm" type="date" id="change_plan_finish_date" autocomplete="off">
                    </div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group row">
                    <label class="col-md-4 col-form-label text-right small">
                      <strong>Control Key</strong>
                      <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title="Conditions"
                      data-content="
                      PP01 - Internal Work Center<br>
                      PP02 - External Process
                      ">!
                      </a>
                    </label>
                    <div class="col-md-8">
                      <select class="form-control form-control-sm" id="change_control_key">
                        <option value="PP01" selected>(PP01) Routing/Ref. op. set - internal proc.</option>
                        <option value="PP02">(PP02) Routing/Ref. op. set - external proc.</option>
                      </select>
                    </div>
                  </div>
                  <div id="change_pp01">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Est. Setup Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="number" id="change_est_setup_time" autocomplete="off">
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Est. Operation Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="number" id="change_est_operate_time" autocomplete="off">
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Est. Labor Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="number" id="change_est_labor_time" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div id="change_pp02" hidden>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Planned Delivery Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="text" id="change_pdt" autocomplete="off" value="7" readonly>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Purchasing Org</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="text" id="change_purchasing_org" autocomplete="off" value="{{order.Plant}}" readonly>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Cost Element</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="text" id="change_cost_element" autocomplete="off" value="51202101" readonly>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Material Group</strong></label>
                      <div class="col-md-8">
                        <select class="form-control form-control-sm" id="change_mat_group">
                          {% for materialGroup in materialGroupList %}
                          {% if materialGroup.Code.strip == 'ZEXTERNAL' %}
                          <option value="{{materialGroup.Code}}">{{materialGroup.Code}} | {{materialGroup.Description}}</option>
                          {% endif %}
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Purchasing Group</strong></label>
                      <div class="col-md-8">
                        <select class="form-control form-control-sm" id="change_purchasing_group">
                          {% for purchaseGroup in purchaseGroupList %}
                          <option value="{{purchaseGroup.ID}}" {% if purchaseGroup.IsDefault %}selected{% endif %}>{{purchaseGroup.ID}} | {{purchaseGroup.Name}}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Price Unit</strong></label>
                      <div class="col-md-8">
                        <input class="form-control form-control-sm" type="number" id="change_price_unit" autocomplete="off" readonly>
                      </div>
                    </div>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right small"><strong>Price</strong></label>
                      <div class="col-md-5">
                        <input class="form-control form-control-sm" type="number" id="change_price" autocomplete="off" readonly>
                      </div>
                      <div class="col-md-3">
                        <select class="form-control form-control-sm" id="change_currency" readonly>
                          {% for currency in currencyList %}
                          <option value="{{currency.Name}}" {% if currency.IsDefault %}selected{% endif %}>{{currency.Name}}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="text-danger text-center small" id="change_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <small>Permission: Section Chief+</small>
              <button class="btn btn-warning text-white" type="button" id="change_confirm_button" onclick="change()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="delete_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-danger" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-trash"></i> Delete Operation</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br><h3 class="text-center">Are you sure to delete this operation ?</h3><br>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Employee ID</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="text" id="del_emp_id" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm my-password" type="text" id="del_password" autocomplete="off">
                </div>
              </div>
              <div class="text-danger text-center small" id="del_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <small>Permission: Section Chief+</small>
              <button class="btn btn-danger" type="button" id="trash_confirm_button" onclick="trash()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="break_join_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-danger" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-fullscreen"></i> Break Join</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br><h3 class="text-center">Are you sure to break join activity ?</h3><br>
            </div>
            <div class="modal-footer">
              <button class="btn btn-danger" type="button" onclick="break_join()" id="break_now_button">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="join_list_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-primary" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-list"></i> Join List ({{joinList|length}})</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <table class="table table-sm table-responsive-sm table-outline text-center">
                <thead class="bg-darkslategray">
                  <tr>
                    <th>No</th>
                    <th>Prod. Order - Oper. No</th>
                  </tr>
                </thead>
                <tbody>
                  {% for join in joinList %}
                  <tr>
                    <td>{{forloop.counter}}</td>
                    <td><a href="/transaction/{{join.OrderNo}}{{join.OperationNo}}">{{join.OrderNo}} - {{join.OperationNo}}</a></td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="confirm_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg modal-primary" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-star"></i> Confirm</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <input type="text" id="confirm_id" hidden>
              <div class="col-md-12">
                <div class="form-group row">
                  <label class="col-md-3 col-form-label text-right"><strong>Operator</strong></label>
                  <div class="col-md-7">
                    <input class="form-control" type="text" id="confirm_operator" readonly>
                  </div>
                </div>
                {% if operation.WorkCenterType == 'Machine' %}
                <div class="form-group row">
                  <label class="col-md-3 col-form-label text-right"><strong>Work Center</strong></label>
                  <div class="col-md-7">
                    <input class="form-control" type="text" id="confirm_workcenter" readonly>
                  </div>
                </div>
                {% endif %}
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Start Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="confirm_start_time" readonly>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Stop Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="confirm_stop_time" readonly>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right text-success"><strong>Good Qty</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="good_qty" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right text-danger"><strong>Reject Qty</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="reject_qty" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-group row">
                      <label class="col-md-2 col-form-label text-right">
                        <strong>Reason</strong>
                        <a class="badge badge-pill badge-secondary" tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-html="true" title=""data-content="<u>SCRAP FROM PREVIOUS PROCESS</u><br>Rejected quantity will not be reported to SAP.">!</a>
                      </label>
                      <div class="col-md-10">
                        <select class="form-control" id="reject_reason">
                          <option value="-1" selected>-</option>
                          {% for rejectReason in rejectReasonList %}
                          <option value="{{rejectReason.Name.strip}}">{{rejectReason.Name}}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Other</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="other_reason" autocomplete="off" readonly>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" id="scrap_at_group" hidden>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Scrap At</strong></label>
                      <div class="col-md-8">
                        <select class="form-control" id="scrap_at">
                          {% for opr in operationList %}
                            {% if opr.OperationNo <= operation.OperationNo %}
                            <option value="{{opr.OperationNo}}" {% if opr.OperationNo == operation.OperationNo %}selected{% endif %}>{{opr.OperationNo}} | {{opr.WorkCenterNo}}</option>
                            {% endif %}
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="text-danger text-center small" id="confirm_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" type="button" id="confirm_button" onclick="confirm()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="manual_report_modal" tabindex="-1" role="dialog">
       <div class="modal-dialog modal-xl modal-primary" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-clipboard"></i> Manual Report</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <div class="col-md-12">
                <div class="row">
                  <div class="col-md-5"><hr></div><div class="col-md-2 text-center"><strong>Work Time</strong></div><div class="col-md-5"><hr></div>
                  <div class="col-md-6"  {% if operation.WorkCenterType == 'Labor' %}hidden{% endif %}>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Work Center</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="mp_workcenter_no" autocomplete="off" oninput="let p=this.selectionStart;this.value=this.value.toUpperCase();this.setSelectionRange(p, p);" {% if operation.WorkCenterType.strip == 'Labor' %}value="{{operation.WorkCenterNo}}" readonly{% endif %}>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" {% if operation.WorkCenterType == 'Labor' %}hidden{% endif %}>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Setup (min)</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="mp_setup_time" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" {% if operation.WorkCenterType == 'Labor' %}hidden{% endif %}></div>
                  <div class="col-md-6" {% if operation.WorkCenterType == 'Labor' %}hidden{% endif %}>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Operate (min)</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="mp_operate_time" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Employee ID</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="mp_emp_id" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" {% if operation.IsExternalProcess %}hidden{% endif %}>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Labor (min)</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="mp_labor_time" autocomplete="off">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" {% if operation.IsExternalProcess == False %}hidden{% endif %}></div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Start Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="datetime-local" id="mp_start_time" onkeydown="return false">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Stop Time</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="datetime-local" id="mp_stop_time" onkeydown="return false">
                      </div>
                    </div>
                  </div>
                  <div class="col-md-5"><hr></div><div class="col-md-2 text-center"><strong>Quantity</strong></div><div class="col-md-5"><hr></div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right text-success"><strong>Good Qty</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="mp_good_qty" autocomplete="off" {% if operation.ProcessStop != None and remainQty == 0 %}readonly{% endif %}>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right text-danger"><strong>Reject Qty</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="number" id="mp_reject_qty" autocomplete="off" {% if operation.ProcessStop != None and remainQty == 0 %}readonly{% endif %}>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <div class="form-group row">
                      <label class="col-md-2 col-form-label text-right">
                        <strong>Reason</strong>
                      </label>
                      <div class="col-md-10">
                        <select class="form-control" id="mp_reject_reason" {% if operation.ProcessStop != None and remainQty == 0 %}readonly{% endif %}>
                          <option value="-1" selected>-</option>
                          {% for rejectReason in rejectReasonList %}
                          <option value="{{rejectReason.Name.strip}}">{{rejectReason.Name}}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Other</strong></label>
                      <div class="col-md-8">
                        <input class="form-control" type="text" id="mp_other_reason" autocomplete="off" readonly>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6" id="mp_scrap_at_group" hidden>
                    <div class="form-group row">
                      <label class="col-md-4 col-form-label text-right"><strong>Scrap At</strong></label>
                      <div class="col-md-8">
                        <select class="form-control" id="mp_scrap_at">
                          {% for opr in operationList %}
                            {% if opr.OperationNo <= operation.OperationNo %}
                            <option value="{{opr.OperationNo}}" {% if opr.OperationNo == operation.OperationNo %}selected{% endif %}>{{opr.OperationNo}} | {{opr.WorkCenterNo}}</option>
                            {% endif %}
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="text-danger text-center small" id="mp_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" type="button" id="mp_button" onclick="manual_report()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="reset_order_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-danger" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title"><i class="c-icon cil-loop-circular"></i> Reset Order</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm my-password" type="text" id="rso_password" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Start Operation</strong></label>
                <div class="col-md-8">
                  <select class="form-control form-control-sm" id="rso_start_operation_no">
                    {% for opr in operationList %}
                    <option value="{{opr.OperationNo}}">{{opr.OperationNo}} | {{opr.WorkCenterNo}}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="text-danger text-center small" id="rso_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <small>Permission: Administrator+</small>
              <button class="btn btn-danger" type="button" id="rso_confirm_button" onclick="reset_order()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="cancel_order_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header bg-darkslategray">
              <h4 class="modal-title"><i class="c-icon cil-x-circle"></i> Cancel Order</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm my-password" type="text" id="cc_password" autocomplete="off">
                </div>
              </div>
              <div class="text-danger text-center small" id="cc_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <small>Permission: Administrator+</small>
              <button class="btn bg-darkslategray text-white" type="button" id="cc_confirm_button" onclick="cancel_order()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal" id="set_qty_modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header bg-darkslategray">
              <h4 class="modal-title"><i class="c-icon cil-pen"></i> Set Operation Qty</h4>
              <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
              <br>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small"><strong>Password</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm my-password" type="text" id="sqty_password" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small text-info"><strong>Process Qty</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="number" id="sqty_process_qty" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small text-success"><strong>Accepeted Qty</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="number" id="sqty_accepted_qty" autocomplete="off">
                </div>
              </div>
              <div class="form-group row">
                <label class="col-md-4 col-form-label text-right small text-danger"><strong>Rejected Qty</strong></label>
                <div class="col-md-8">
                  <input class="form-control form-control-sm" type="number" id="sqty_rejected_qty" autocomplete="off">
                </div>
              </div>
              <div class="text-danger text-center small" id="sqty_invalid_text"></div>
            </div>
            <div class="modal-footer">
              <small>Permission: Administrator+</small>
              <button class="btn bg-darkslategray text-white" type="button" id="sqty_confirm_button" onclick="sqty_operation()">Confirm</button>
              <button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- CoreUI and necessary plugins-->
    <script src="{% static "vendors/@coreui/coreui-pro/js/coreui.bundle.min.js" %}"></script>
    <!--[if IE]><!-->
    <script src="{% static "vendors/@coreui/icons/js/svgxuse.min.js" %}"></script>
    <!--<![endif]-->
    <script src="{% static "vendors/jquery/js/jquery.min.js" %}"></script>
    <!-- SELECT JS -->
    <script src="{% static "vendors/select2/js/select2.min.js" %}"></script>
    <!-- Popover JS -->
    <script src="{% static "js/popovers.js" %}"></script>
    <!-- Tooltips JS -->
    <script src="{% static "js/tooltips.js" %}"></script>
    <!-- Custom JS -->
    <script src="{% static "customize/js/custom-function.js" %}"></script>
    <script src="{% static "customize/js/clock.js" %}"></script>
    <!-- MAIN -->
    <script>
      document.addEventListener("DOMContentLoaded", function(event) {
        setTimeout(function() {
          document.body.classList.remove('c-no-layout-transition')
        }, 2000);
      });

      var refresh_second = $("#refresh_second").val();
      var refresh_second_left = refresh_second;
      var downloadTimer = setInterval(function(){
        document.getElementById("progressBar").value = 300 - refresh_second_left;
        refresh_second_left -= ($("#has_data").val() == "True")?1:0;
        if(refresh_second_left == 0) window.location.href = '/transaction/0';
      }, 1000);

      window.addEventListener( "pageshow", function (event) {
        if (event.persisted || (typeof window.performance != "undefined" && window.performance.navigation.type === 2)) window.location.reload();
      });

      //-- INITIALIZE
      var isSearchingWorkCenter = false;
      var isSearchingOperator = false;
      var currentWorkCenterNo = null;
      var currentOperatorId = null;
      var operationListLength = parseInt('{{operationList|length}}');

      $(document).ready(function() {
        showTime();
        if($("#has_data").val() == "True" && $("#remain_qty").val() > 0){
          if($("#workcenter_type").val() == 'Machine') reload_workcenter_table();
          reload_operator_table();
        }
        dynamic_join();
      });
    </script>
    <!-- MAIN TABLE -->
    <script>
      $("#workcenter_no").on("change keyup", function() {
        var work_center_group = $('#work_center_group').val();
        $('#workcenter_name').val('');
        $('#workcenter_add_button').prop('disabled', true);
        remove_valid('workcenter_name');
        $('#workcenter_name').removeClass('text-danger');
        var workcenter_no = $('#workcenter_no').val();
        if(isSearchingWorkCenter == false && workcenter_no.length >= 3){
          isSearchingWorkCenter = true;
          $.ajax({
            url: '/get_workcenter_data/',
            data: {
              'workcenter_no': workcenter_no,
              'work_center_group' : work_center_group,
            },
            dataType: 'json',
            success: function (data) {
              if (data.canAdd) {
                currentWorkCenterNo = data.WorkCenterNo;
                $('#workcenter_name').val(data.WorkCenterNo+" | "+data.WorkCenterName);
                $('#workcenter_add_button').prop('disabled', false);
                valid('workcenter_name');
                $('#workcenter_name').addClass('text-success');
              } else {
                $('#workcenter_name').val(data.invalid_text);
                invalid('workcenter_name');
                $('#workcenter_name').addClass('text-danger');
              }
              isSearchingWorkCenter = false;
            }
          });
        }
      });

      $("#operator_id").on("change keyup", function() {
        $('#operator_name').val('');
        $('#operator_work_button').prop('disabled', true);
        $('#operator_setup_button').prop('disabled', true);
        remove_valid('operator_name');
        $('#operator_name').removeClass('text-danger');
        var operator_id = $('#operator_id').val();
        if(isSearchingOperator == false && operator_id.length >= 4){
          isSearchingOperator = true;
          $.ajax({
            url: '/get_operator_data/',
            data: {
              'operator_id': operator_id,
            },
            dataType: 'json',
            success: function (data) {
              if (data.canAdd) {
                $('#operator_work_button').prop('disabled', false);
                $('#operator_setup_button').prop('disabled', false);
                currentOperatorId = data.EmpID;
                currentOperatorName = data.EmpName;
                $('#operator_name').val(data.EmpID+" | "+data.EmpName+" ("+data.Section+")");
                valid('operator_name');
                $('#operator_name').addClass('text-success');
              } else {
                $('#operator_name').val(data.invalid_text);
                invalid('operator_name');
                $('#operator_name').addClass('text-danger');
              }
              isSearchingOperator = false;
            }
          });
        }
      });

      function create_workcenter_table(){
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        $.ajax({
          url: '/get_operating_workcenter_list/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
          },
          dataType: 'json',
          success: function (data) {
            var completed_count = 0;
            if(data.OWCList.length == 0){
              var row = "<tr><td colspan='5'>Please add workcenter above.</td></tr>";
              $("#workcenter_table_body").append(row);
            } else {
              for(var i = 0;i < data.OWCList.length;i++){
                var owc = data.OWCList[i];
                var row = "";
                // console.log(owc);
                for(var j = 0;j < owc.length;j++){
                  var owc_id = owc[0];
                  // var owc_workcenter_name = owc[1]+" | "+owc[2];
                  var owc_workcenter_name = owc[1];
                  var owc_startdatetime = owc[3];
                  var startdatetime = (owc_startdatetime == null)?"-":getFullDateTimeFromString(owc_startdatetime);
                  var owc_stopdatetime = owc[4];
                  var stopdatetime = (owc_stopdatetime == null)?"-":getFullDateTimeFromString(owc_stopdatetime);
                  var owc_status = $.trim(owc[5]);
                  var mc_type = $.trim(owc[6]);
                  if(owc_status == "COMPLETE") {
                    completed_count++;
                    break;
                  }
                  row = "";
                  row += "<tr id='workcenter_row_"+owc_id+"'>";
                  row += "<td>";
                  if(owc_status != "SETUP"){
                    row += "<input type='radio' class='my-radio' name='workcenter_radio' value='"+owc_id+"' checked>";
                  }
                  row += "</td>";
                  row += "<td class='small'>"+owc_workcenter_name+"</td>";
                  row += (owc_status == "WAITING")?"<td class='font-weight-bold'>":"<td class='blink font-weight-bold'>";
                  row += owc_status;
                  row += "<input type='text' id='workcenter_status_"+owc_id+"' value='"+owc_status+"' hidden>";
                  row += "</td>";
                  row += "<td class='small'>";
                  if(owc_status == "WAITING"){
                    row += "<div></div>";
                  } else {
                    row += "<div> <i class='c-icon c-icon-sm cil-power-standby text-success font-weight-bold'></i> "+startdatetime+"</div>";
                  }
                  row += "</td>";
                  row += "<td>";
                  if(owc_status == "WAITING"){
                    row += "<button type='button' class='btn btn-sm btn-pill btn-dark small' id='delete_operating_workcenter_"+owc_id+"' onclick='delete_operating_workcenter("+owc_id+")'>Delete</button>";
                  } else if (owc_status == "WORKING" && mc_type == "Auto" && data.hasOperatorOperatingList[i] == false){
                    row += "<button type='button' class='btn btn-sm btn-pill btn-danger small' id='stop_operating_workcenter_"+owc_id+"' onclick='stop_operating_workcenter("+owc_id+")'>Stop Machine</button>";
                  }
                  row += "</td>";
                  row += "</tr>";
                }
                $("#workcenter_table_body").append(row);
                dynamic_operator_setup();
              }
              if(completed_count == data.OWCList.length){
                var row = "<tr><td colspan='5'>Please add workcenter above.</td></tr>";
                $("#workcenter_table_body").append(row);
              }
            }
            dynamic_operator_id();
          }
        });
      }

      function create_operator_table(){
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        var workcenter_type = $("#workcenter_type").val();
        $.ajax({
          url: '/get_operating_operator_list/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
          },
          dataType: 'json',
          success: function (data) {
            if(data.OOPRList.length == 0){
              var row = "<tr><td colspan='"+((workcenter_type == 'Machine')?5:4)+"'>Please add operator above.</td></tr>";
              $("#operator_table_body").append(row);
            } else {
              for(var i = 0;i < data.OOPRList.length;i++){
                var oopr = data.OOPRList[i];
                var row = "";
                // console.log(oopr);
                for(var j = 0;j < oopr.length;j++){
                  var oopr_id = oopr[0];
                  // var oopr_workcenter_name = (oopr[1] == null)?null:oopr[1]+" | "+oopr[2];
                  var oopr_workcenter_name = (oopr[1] == null)?null:oopr[1];
                  var oopr_operator_id = oopr[3];
                  var oopr_operator_name = oopr[4];
                  var oopr_startdatetime = oopr[5];
                  var startdatetime = (oopr_startdatetime == null)?"-":getFullDateTimeFromString(oopr_startdatetime);
                  var oopr_stopdatetime = oopr[6];
                  var stopdatetime = (oopr_stopdatetime == null)?"-":getFullDateTimeFromString(oopr_stopdatetime);
                  var oopr_status = $.trim(oopr[7]);
                  row = "";
                  row += "<tr id='operator_row_"+oopr_id+"'>";
                  row += "<td class='small'><b>"+oopr_operator_id+"</b><br>"+oopr_operator_name+"</td>";
                  row += (oopr_workcenter_name == null)? "":"<td class='small'>"+oopr_workcenter_name+"</td>";
                  row += (oopr_status == 'COMPLETE')?"<td class='text-success font-weight-bold'>":"<td class='blink font-weight-bold'>";
                  row += oopr_status+"</td>";
                  row += "<td class='small'>";
                  row += "<div> <i class='c-icon c-icon-sm cil-power-standby text-success font-weight-bold'></i> "+startdatetime+"</div>";
                  if(stopdatetime != "-"){
                    row += "<div> <i class='c-icon c-icon-sm cil-power-standby text-danger font-weight-bold'></i> "+stopdatetime+"</div>";
                  }
                  row += "</td>";
                  row += "<td>";
                  if(oopr_status == "WORKING" || oopr_status == "EXT-WORK"){
                    row += "<button type='button' class='btn btn-sm btn-pill btn-danger small' id='stop_work_operating_operator_"+oopr_id+"' onclick='stop_work_operating_operator("+oopr_id+")'>Stop Working</button>";
                  } else if (oopr_status == "SETUP"){
                    row += "<button type='button' class='btn btn-sm btn-pill btn-success small' id='start_work_operating_operator_"+oopr_id+"' onclick='start_work_operating_operator("+oopr_id+")'>Start Working</button><br>";
                    row += "<button type='button' class='btn btn-sm btn-pill btn-warning text-white small' id='stop_setup_operating_operator_"+oopr_id+"' onclick='stop_setup_operating_operator("+oopr_id+")'>Stop Setup & Exit</button>";
                  } else if (oopr_status == "COMPLETE" && $('#remain_qty').val() > 0){
                    if($('#join_list_length').val() == 0) {
                      row += "<button type='button' class='btn btn-sm btn-pill btn-primary small' onclick='prepare_confirm("+oopr_id+")' data-toggle='modal' data-target='#confirm_modal'>Confirm</button>";
                    } else {
                      row += "<small class='text-danger'>BREAK JOIN TO CONFIRM</small>";
                    }
                  }
                  row += "</td>";
                  row += "</tr>";
                }
                $("#operator_table_body").append(row);
              }
            }
          }
        });
      }

      function reload_workcenter_table(){
        $("#workcenter_table > tbody").empty();
        create_workcenter_table();
        refresh_second_left = refresh_second;
      }

      function reload_operator_table(){
        $("#operator_table > tbody").empty();
        create_operator_table();
        refresh_second_left = refresh_second;
      }

      function add_operating_workcenter(){
        $('#workcenter_add_button').prop('disabled', true);
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        $.ajax({
          url: '/add_operating_workcenter/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
            'workcenter_no': currentWorkCenterNo,
          },
          dataType: 'json',
          success: function (data) {
            $('#workcenter_no').val("");
            $('#workcenter_name').val("");
            remove_valid('workcenter_name');
            reload_workcenter_table();
          }
        });
      }

      function delete_operating_workcenter(id){
        $('#delete_operating_workcenter_' + id).prop('disabled', true);
        $.ajax({
          url: '/delete_operating_workcenter/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            reload_workcenter_table();
            $('#operator_work_button').prop('disabled', true);
            $('#operator_setup_button').prop('disabled', true);
            $('#operator_id').val("");
            $('#operator_name').val("");
            remove_valid('operator_name');
          }
        });
      }

      function stop_operating_workcenter(id){
        $('#stop_operating_workcenter_' + id).prop('disabled', true);
        $.ajax({
          url: '/stop_operating_workcenter/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            $("#is_operating").val(capitalizeFirstLetter(data.IsOperating.toString()));
            dynamic_join();
            reload_workcenter_table();
          }
        });
      }

      function add_operating_operator(status){
        $('#operator_work_button').prop('disabled', true);
        $('#operator_setup_button').prop('disabled', true);
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        var owc_id = -1;
        if ($('input[name="workcenter_radio"]').length > 0){
          owc_id = document.querySelector('input[name="workcenter_radio"]:checked').value;
        }
        $.ajax({
          url: '/add_operating_operator/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
            'operator_id': currentOperatorId,
            'owc_id': owc_id,
            'status': status,
          },
          dataType: 'json',
          success: function (data) {
            if(data.refresh) location.reload();
            $("#is_operating").val("True");
            dynamic_join();
            $('#operator_id').val("");
            $('#operator_name').val("");
            remove_valid('operator_name');
            if($("#workcenter_type").val() == 'Machine') reload_workcenter_table();
            reload_operator_table();
          }
        });
      }

      function start_work_operating_operator(id){
        $('#start_work_operating_operator_' + id).prop('disabled', true);
        $.ajax({
          url: '/start_work_operating_operator/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            $("#is_operating").val("True");
            dynamic_join();
            if($("#workcenter_type").val() == 'Machine') reload_workcenter_table();
            reload_operator_table();
          }
        });
      }

      function stop_setup_operating_operator(id){
        $('#stop_setup_operating_operator_' + id).prop('disabled', true);
        $.ajax({
          url: '/stop_setup_operating_operator/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            $("#is_operating").val(capitalizeFirstLetter(data.IsOperating.toString()));
            dynamic_join();
            if($("#workcenter_type").val() == 'Machine') reload_workcenter_table();
            reload_operator_table();
          }
        });
      }

      function stop_work_operating_operator(id){
        $('#stop_work_operating_operator_' + id).prop('disabled', true);
        $.ajax({
          url: '/stop_work_operating_operator/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            $("#is_operating").val(capitalizeFirstLetter(data.IsOperating.toString()));
            dynamic_join();
            if($("#workcenter_type").val() == 'Machine') reload_workcenter_table();
            reload_operator_table();
          }
        });
      }

      function break_join(){
        var order_no = $('#order_no').val();
        var operation_no = $('#operation_no').val();
        $.ajax({
          url: '/break_join/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
          },
          dataType: 'json',
          success: function (data) {
            location.reload();
          }
        });
      }
    </script>
    <!-- CONFIRM & MANUAL REPORT & FIX OVERTIME -->
    <script>
      function prepare_confirm(id){
        remove_valid_many(["good_qty","reject_qty","reject_reason","other_reason"]);
        $('#good_qty').val("");
        $('#reject_qty').val("");
        $('#reject_reason').val(-1);
        $('#other_reason').val("");
        $('#confirm_id').val(id);
        $("#scrap_at_group").prop("hidden", true);
        $('#confirm_button').prop('disabled', true);
        $.ajax({
          url: '/get_data_for_confirm/',
          data: {
            'id': id,
          },
          dataType: 'json',
          success: function (data) {
            $('#confirm_operator').val(data.operator_text);
            $('#confirm_workcenter').val(data.workcenter_text);
            $('#confirm_start_time').val(data.start_time);
            $('#confirm_stop_time').val(data.stop_time);
            $('#confirm_button').prop('disabled', false);
            $('#good_qty').focus();
            refresh_second_left = refresh_second;
          }
        });
      }

      function prepare_mp(){
        remove_valid_many(["mp_emp_id","mp_workcenter_no","mp_labor_time","mp_operate_time","mp_setup_time","mp_start_time","mp_stop_time","mp_good_qty","mp_reject_qty","mp_reject_reason","mp_other_reason"]);
        $('#mp_emp_id').val("");
        if ($("#work_center_type") == 'Machine') $('#mp_workcenter_no').val("");
        $('#mp_labor_time').val("");
        $('#mp_operate_time').val("");
        $('#mp_setup_time').val("");
        $('#mp_start_time').val("");
        $('#mp_stop_time').val("");
        $('#mp_good_qty').val("");
        $('#mp_reject_qty').val("");
        $('#mp_reject_reason').val(-1);
        $('#mp_other_reason').val("");
        $("#mp_scrap_at_group").prop("hidden", true);
        $("#mp_invalid_text").text("");
        $('#mp_workcenter_no').focus();
        refresh_second_left = refresh_second;
      }

      function confirm(){
        $("#confirm_invalid_text").text("");
        if($('#good_qty').val() == "") $('#good_qty').val("0");
        if($('#reject_qty').val() == "") $('#reject_qty').val("0");
        var confirm_id = $('#confirm_id').val();
        var remain_qty = parseFloat($('#remain_qty').val());
        var good_qty = parseFloat($('#good_qty').val());
        var reject_qty = parseFloat($('#reject_qty').val());
        var reject_reason = $('#reject_reason').val();
        var other_reason = $('#other_reason').val();
        var scrap_at = $('#scrap_at').val();
        var canConfirm = false;
        remove_valid_many(["good_qty","reject_qty","reject_reason","other_reason"]);
        if(good_qty <= 0 && reject_qty <= 0){
          invalid("good_qty");
          invalid("reject_qty");
          $("#confirm_invalid_text").text("Good Qty + Reject Qty can not be 0.");
        } else {
          valid("good_qty");
          valid("reject_qty");
          if(remain_qty < good_qty + reject_qty) {
            invalid("good_qty");
            invalid("reject_qty");
            $("#confirm_invalid_text").text("Good Qty + Reject Qty can not be more than Remaining Qty.");
          } else {
            valid("good_qty");
            valid("reject_qty");
            if(reject_qty > 0 && reject_reason == -1) {
              invalid("reject_reason");
              $("#confirm_invalid_text").text("Please select reject reason.");
            } else {
              valid("reject_reason");
              if(reject_reason == "OTHER" && other_reason == "") {
                invalid("other_reason");
                $("#confirm_invalid_text").text("Please fill reason in other reason field.");
              } else {
                valid("other_reason");
                if(other_reason.includes("|")) {
                  invalid("other_reason");
                  $("#confirm_invalid_text").text("character | is not allow to use.");
                } else {
                  valid("other_reason");
                  canConfirm = true;
                }
              }
            }
          }
        }
        if(canConfirm) {
          $('#confirm_button').prop('disabled', true);
          $.ajax({
            url: '/confirm/',
            data: {
              'confirm_id': confirm_id,
              'good_qty': good_qty,
              'reject_qty': reject_qty,
              'reject_reason': reject_reason,
              'other_reason': other_reason,
              'scrap_at': scrap_at,
            },
            dataType: 'json',
            success: function (data) {
              location.reload();
            }
          });
        }
      }

      function manual_report(){
        //a
        if($('#mp_labor_time').val() == "") $('#mp_labor_time').val("0");
        if($('#mp_setup_time').val() == "") $('#mp_setup_time').val("0");
        if($('#mp_operate_time').val() == "") $('#mp_operate_time').val("0");
        if($('#mp_good_qty').val() == "") $('#mp_good_qty').val("0");
        if($('#mp_reject_qty').val() == "") $('#mp_reject_qty').val("0");
        //b
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        var workcenter_type = $('#workcenter_type').val();
        var emp_id = $('#mp_emp_id').val();
        var workcenter_no = $('#mp_workcenter_no').val();
        var labor_time = parseFloat($('#mp_labor_time').val());
        var operate_time = parseFloat($('#mp_operate_time').val());
        var setup_time = parseFloat($('#mp_setup_time').val());
        var start_time = new Date($('#mp_start_time').val());
        var stop_time = new Date($('#mp_stop_time').val());
        var remain_qty = parseFloat($('#remain_qty').val());
        var good_qty = parseFloat($('#mp_good_qty').val());
        var reject_qty = parseFloat($('#mp_reject_qty').val());
        var reject_reason = $('#mp_reject_reason').val();
        var other_reason = $('#mp_other_reason').val();
        var scrap_at = $('#mp_scrap_at').val();
        var isReportable = false;
        $("#mp_invalid_text").text("");
        remove_valid_many(["mp_emp_id","mp_workcenter_no","mp_labor_time","mp_operate_time","mp_setup_time","mp_start_time","mp_stop_time","mp_good_qty","mp_reject_qty","mp_reject_reason","mp_other_reason"]);
        //c
        validate_operator(emp_id, function(isExist, invalid_text2) {
          if(!isExist){
            invalid("mp_emp_id");
            $("#mp_invalid_text").text(invalid_text2);
          } else{
            valid("mp_emp_id");
            validate_work_center(workcenter_no, function(canUse, invalid_text3) {
              if(!canUse && workcenter_type != "Labor"){
                invalid("mp_workcenter_no");
                $("#mp_invalid_text").text(invalid_text3);
              } else{
                valid("mp_workcenter_no");
                if($('#mp_start_time').val() == ""){
                  invalid("mp_start_time");
                  $("#mp_invalid_text").text("Please fill Start Time.");
                } else {
                  valid("mp_start_time");
                  if($('#mp_stop_time').val() == ""){
                    invalid("mp_stop_time");
                    $("#mp_invalid_text").text("Please fill Stop Time.");
                  } else {
                    valid("mp_stop_time");
                    if(start_time >= stop_time){
                      invalid_many(["mp_start_time","mp_stop_time"]);
                      $("#mp_invalid_text").text("Start Time >= Stop Time.");
                    } else {
                      valid_many(["mp_start_time","mp_stop_time"]);
                      if(stop_time > Date.now()){
                        invalid_many(["mp_stop_time"]);
                        $("#mp_invalid_text").text("Stop Time > Present.");
                      } else {
                        valid_many(["mp_stop_time"]);
                        if(remain_qty < good_qty + reject_qty){
                          invalid_many(["mp_good_qty","mp_reject_qty"]);
                          $("#mp_invalid_text").text("Good Qty + Reject Qty can not be more than Remaining Qty.");
                        } else {
                          valid_many(["mp_good_qty","mp_reject_qty"]);
                          if(reject_qty > 0 && reject_reason == -1){
                            invalid("mp_reject_reason");
                            $("#mp_invalid_text").text("Please select reject reason.");
                          } else {
                            valid("mp_reject_reason");
                            if(reject_reason == "OTHER" && other_reason == ""){
                              invalid("mp_other_reason");
                              $("#mp_invalid_text").text("Please fill reason in other reason field.");
                            } else {
                              valid("mp_other_reason");
                              if(other_reason.includes("|")){
                                invalid("mp_other_reason");
                                $("#mp_invalid_text").text("character | is not allow to use.");
                              } else {
                                valid("mp_other_reason");
                                if(labor_time == 0 && operate_time == 0 && setup_time == 0 && good_qty == 0 && reject_qty == 0){
                                  invalid_many(["mp_labor_time","mp_operate_time","mp_setup_time","mp_good_qty","mp_reject_qty"]);
                                  $("#mp_invalid_text").text("At least one value need to be more than 0.");
                                } else {
                                  valid_many(["mp_labor_time","mp_operate_time","mp_setup_time","mp_good_qty","mp_reject_qty"]);
                                  if(labor_time > 9999){
                                    invalid("mp_labor_time");
                                    $("#mp_invalid_text").text("Labor Time is too large.");
                                  } else {
                                    valid("mp_labor_time");
                                    if(setup_time > 9999){
                                      invalid("mp_setup_time");
                                      $("#mp_invalid_text").text("Setup Time is too large.");
                                    } else {
                                      valid("mp_setup_time");
                                      if(operate_time > 9999){
                                        invalid("mp_operate_time");
                                        $("#mp_invalid_text").text("Operate Time is too large.");
                                      } else {
                                        valid("mp_operate_time");
                                        isReportable = true;
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
              if(isReportable){
                $('#mp_button').prop('disabled', true);
                $.ajax({
                  url: '/manual_report/',
                  data: {
                    'order_no': order_no,
                    'operation_no': operation_no,
                    'emp_id': emp_id,
                    'workcenter_no': workcenter_no,
                    'labor_time': labor_time,
                    'operate_time': operate_time,
                    'setup_time': setup_time,
                    'start_time': new Date(start_time).addHours(7).toISOString(),
                    'stop_time': new Date(stop_time).addHours(7).toISOString(),
                    'good_qty': good_qty,
                    'reject_qty': reject_qty,
                    'reject_reason': reject_reason,
                    'other_reason': other_reason,
                    'scrap_at': scrap_at,
                  },
                  dataType: 'json',
                  success: function (data) {
                    location.reload();
                  }
                });
              }
            });
          }
        });
      }

      function fix_overtime(){
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        $('#fix_overtime_button').prop('disabled', true);
        $.ajax({
          url: '/fix_overtime/',
          data: {
            'order_no': order_no,
            'operation_no': operation_no,
          },
          dataType: 'json',
          success: function (data) {
            location.reload();
          }
        });
      }
    </script>
    <!-- MODIFIER -->
    <script>
      function clear_validate_inc_qty(){
        $("#inc_qty_invalid_text").text("");
        remove_valid_many(["inc_qty_emp_id","inc_qty_password","inc_qty_amount"]);
      }

      function clear_validate_dec_qty(){
        $("#dec_qty_invalid_text").text("");
        remove_valid_many(["dec_qty_emp_id","dec_qty_password","dec_qty_amount"]);
      }

      function clear_validate_add(){
        $("#add_invalid_text").text("");
        remove_valid_many(["add_emp_id","add_password","add_new_operation_no","add_work_center_no","add_plan_start_date","add_plan_finish_date","add_est_setup_time","add_est_operate_time","add_est_labor_time","add_price_unit","add_price"]);
      }

      function clear_validate_change(){
        $("#change_invalid_text").text("");
        remove_valid_many(["change_emp_id","change_password","change_work_center_no","change_plan_start_date","change_plan_finish_date","change_est_setup_time","change_est_operate_time","change_est_labor_time","change_price_unit","change_price"]);
      }

      function clear_validate_delete(){
        $("#del_invalid_text").text("");
        remove_valid_many(["del_emp_id","del_password"]);
      }

      function prepare_inc_qty(){
        clear_validate_inc_qty();
        emptyInputs(["inc_qty_emp_id","inc_qty_password","inc_qty_amount"]);
        $("#inc_qty_emp_id").focus();
        refresh_second_left = refresh_second;
      }

      function prepare_dec_qty(){
        clear_validate_dec_qty();
        emptyInputs(["dec_qty_emp_id","dec_qty_password","dec_qty_amount"]);
        $("#dec_qty_emp_id").focus();
        refresh_second_left = refresh_second;
      }

      function prepare_add(){
        clear_validate_add();
        emptyInputs(["add_emp_id","add_password","add_new_operation_no","add_work_center_no","add_plan_start_date","add_plan_finish_date","add_est_setup_time","add_est_operate_time","add_est_labor_time","add_price_unit","add_price"]);
        $("#add_price_unit").val("1");
        $("#add_price").val("1");
        $("#add_emp_id").focus();
        refresh_second_left = refresh_second;
      }

      function prepare_change(){
        clear_validate_change();
        emptyInputs(["change_emp_id","change_password","change_new_operation_no","change_work_center_no","change_plan_start_date","change_plan_finish_date","change_est_setup_time","change_est_operate_time","change_est_labor_time","change_price_unit","change_price"]);
        $("#change_price_unit").val("1");
        $("#change_price").val("1");
        $("#change_emp_id").focus();
        refresh_second_left = refresh_second;
      }

      function prepare_delete(){
        clear_validate_delete();
        emptyInputs(["del_emp_id","del_password"]);
        $("#del_emp_id").focus();
        refresh_second_left = refresh_second;
      }

      function add(){
        // a
        $("#add_new_operation_no").val(frontZero($("#add_new_operation_no").val(), 4));
        setZeroInputs(['add_est_setup_time','add_est_operate_time','add_est_labor_time','add_price_unit','add_price']);
        $('#add_price').val(roundToTwo($('#add_price').val()));
        // b
        var order_no = $("#order_no").val();
        var new_operation_no = $("#add_new_operation_no").val();
        var emp_id = $("#add_emp_id").val();
        var password = $("#add_password").val();
        var work_center_no = $("#add_work_center_no").val();
        var plan_start_date = $("#add_plan_start_date").val();
        var plan_finish_date = $("#add_plan_finish_date").val();
        var control_key = $("#add_control_key").val();
        var est_setup_time = parseFloat($('#add_est_setup_time').val());
        var est_operate_time = parseFloat($('#add_est_operate_time').val());
        var est_labor_time = parseFloat($('#add_est_labor_time').val());
        var pdt = $("#add_pdt").val();
        var purchasing_org = $("#add_purchasing_org").val();
        var cost_element = $("#add_cost_element").val();
        var mat_group = $("#add_mat_group").val();
        var purchasing_group = $("#add_purchasing_group").val();
        var price_unit = parseFloat($('#add_price_unit').val());
        var price = parseFloat($('#add_price').val());
        var currency = $('#add_currency').val();
        var isAddable = false;
        var isExternalProcess = false;
        clear_validate_add();
        // c
        validate_operator(emp_id, function(isCorrect, invalid_text) {
          if(!isCorrect){
            invalid("add_emp_id");
            $("#add_invalid_text").text(invalid_text);
          } else {
            valid("add_emp_id");
            validate_section_chief_password(password, function(isCorrect, invalid_text) {
              if(!isCorrect){
                invalid("add_password");
                $("#add_invalid_text").text(invalid_text);
              } else {
                valid("add_password");
                validate_new_operation(new_operation_no, function(canAdd, invalid_text) {
                  if(!canAdd) {
                    invalid("add_new_operation_no");
                    $("#add_invalid_text").text(invalid_text);
                  } else {
                    valid("add_new_operation_no");
                    validate_routing(work_center_no, function(canUse, invalid_text, isExt) {
                      isExternalProcess = isExt;
                      if(!canUse) {
                        invalid("add_work_center_no");
                        $("#add_invalid_text").text(invalid_text);
                      } else {
                        valid("add_work_center_no");
                        if(plan_start_date == ""){
                          invalid("add_plan_start_date");
                          $("#add_invalid_text").text("Please fill plant start date.");
                        } else {
                          valid("add_plan_start_date");
                          if(plan_finish_date == ""){
                            invalid("add_plan_finish_date");
                            $("#add_invalid_text").text("Please fill plant start date.");
                          } else {
                            valid("add_plan_finish_date");
                            if(plan_start_date > plan_finish_date){
                              invalid_many(["add_plan_start_date","add_plan_finish_date"]);
                              $("#add_invalid_text").text("Plan start date > plan finish date");
                            } else {
                              valid_many(["add_plan_start_date","add_plan_finish_date"]);
                              if(control_key == "PP01" && isExternalProcess){
                                invalid("add_control_key");
                                $("#add_invalid_text").text("This Work Center is an external process please choose PP02");
                              } else if(control_key == "PP02" && !isExternalProcess){
                                invalid("add_control_key");
                                $("#add_invalid_text").text("This Work Center is an internal process please choose PP01");
                              } else {
                                valid("add_control_key");
                                if(control_key == "PP01"){
                                  if($('#add_est_setup_time').val().split(".")[0].length > 6){
                                    invalid("add_est_setup_time");
                                    $("#add_invalid_text").text("Estimate setup time is too large.");
                                  } else {
                                    valid("add_est_setup_time");
                                    if($('#add_est_operate_time').val().split(".")[0].length > 6){
                                      invalid("add_est_operate_time");
                                      $("#add_invalid_text").text("Estimate operation time is too large.");
                                    } else {
                                      valid("add_est_operate_time");
                                      if($('#add_est_labor_time').val().split(".")[0].length > 6){
                                        invalid("add_est_labor_time");
                                        $("#add_invalid_text").text("Estimate labor time is too large.");
                                      }
                                      else {
                                        valid("add_est_labor_time");
                                        if(est_setup_time == 0 && est_operate_time == 0 && est_labor_time == 0){
                                          invalid_many(["add_est_setup_time","add_est_operate_time","add_est_labor_time"]);
                                          $("#add_invalid_text").text("Estimate Setup/Operate/Labor can not be all 0.");
                                        }
                                        else {
                                          valid_many(["add_est_setup_time","add_est_operate_time","add_est_labor_time"]);
                                          isAddable = true;
                                        }
                                      }
                                    }
                                  }
                                } else if(control_key == "PP02"){
                                  if(price_unit <= 0){
                                    invalid("add_price_unit");
                                    $("#add_invalid_text").text("Price unit can not be 0.");
                                  } else if($('#add_price_unit').val().length > 6){
                                    invalid("add_price_unit");
                                    $("#add_invalid_text").text("Price unit is too large.");
                                  } else {
                                    valid("add_price_unit");
                                    if(price <= 0){
                                      invalid("add_price");
                                      $("#add_invalid_text").text("Price can not be 0.");
                                    } else if($('#add_price').val().split(".")[0].length > 9){
                                      invalid("add_price");
                                      $("#add_invalid_text").text("Price is too large.");
                                    } else {
                                      valid("add_price");
                                      isAddable = true;
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                        if(isAddable){
                          $('#add_confirm_button').prop('disabled', true);
                          $.ajax({
                            url: '/add_operation/',
                            data: {
                              'order_no': order_no,
                              'new_operation_no': new_operation_no,
                              'emp_id': emp_id,
                              'password': password,
                              'work_center_no': work_center_no,
                              'control_key': control_key,
                              'plan_start_date': plan_start_date,
                              'plan_finish_date': plan_finish_date,
                              'est_setup_time': est_setup_time,
                              'est_operate_time': est_operate_time,
                              'est_labor_time': est_labor_time,
                              'pdt': pdt,
                              'purchasing_org': purchasing_org,
                              'cost_element': cost_element,
                              'mat_group': mat_group,
                              'purchasing_group': purchasing_group,
                              'price_unit': price_unit,
                              'price': price,
                              'currency': currency,
                            },
                            dataType: 'json',
                            success: function (data) {
                              window.location.href = "/transaction/" + order_no + new_operation_no;
                            }
                          });
                        } else {
                        }
                      }
                    });
                  }
                });
              }
            });
          }
        });
      }

      function change(){
        // a
        setZeroInputs(['change_est_setup_time','change_est_operate_time','change_est_labor_time','change_price_unit','change_price']);
        $('#change_price').val(roundToTwo($('#change_price').val()));
        // b
        var order_no = $("#order_no").val();
        var operation_no = $("#operation_no").val();
        var emp_id = $("#change_emp_id").val();
        var password = $("#change_password").val();
        var work_center_no = $("#change_work_center_no").val();
        var plan_start_date = $("#change_plan_start_date").val();
        var plan_finish_date = $("#change_plan_finish_date").val();
        var control_key = $("#change_control_key").val();
        var est_setup_time = parseFloat($('#change_est_setup_time').val());
        var est_operate_time = parseFloat($('#change_est_operate_time').val());
        var est_labor_time = parseFloat($('#change_est_labor_time').val());
        var pdt = $("#change_pdt").val();
        var purchasing_org = $("#change_purchasing_org").val();
        var cost_element = $("#change_cost_element").val();
        var mat_group = $("#change_mat_group").val();
        var purchasing_group = $("#change_purchasing_group").val();
        var price_unit = parseFloat($('#change_price_unit').val());
        var price = parseFloat($('#change_price').val());
        var currency = $('#change_currency').val();
        var isChangable = false;
        clear_validate_change();
        // c
        validate_operator(emp_id, function(isCorrect, invalid_text) {
          if(!isCorrect){
            invalid("add_emp_id");
            $("#change_invalid_text").text(invalid_text);
          } else {
            valid("change_emp_id");
            validate_section_chief_password(password, function(isCorrect, invalid_text) {
              if(!isCorrect){
                invalid("change_password");
                $("#change_invalid_text").text(invalid_text);
              } else {
                valid("change_password");
                validate_routing(work_center_no, function(canUse, invalid_text, isExt) {
                  isExternalProcess = isExt;
                  if(!canUse) {
                    invalid("change_work_center_no");
                    $("#change_invalid_text").text(invalid_text);
                  } else {
                    valid("change_work_center_no");
                    if(plan_start_date == ""){
                      invalid("change_plan_start_date");
                      $("#change_invalid_text").text("Please fill plant start date.");
                    } else {
                      valid("change_plan_start_date");
                      if(plan_finish_date == ""){
                        invalid("change_plan_finish_date");
                        $("#change_invalid_text").text("Please fill plant start date.");
                      } else {
                        valid("change_plan_finish_date");
                        if(plan_start_date > plan_finish_date){
                          invalid_many(["change_plan_start_date","change_plan_finish_date"]);
                          $("#change_invalid_text").text("Plan start date > plan finish date");
                        } else {
                          valid_many(["change_plan_start_date","change_plan_finish_date"]);
                          if(control_key == "PP01" && isExternalProcess){
                            invalid("change_control_key");
                            $("#change_invalid_text").text("This Work Center is an external process please choose PP02");
                          } else if(control_key == "PP02" && !isExternalProcess){
                            invalid("change_control_key");
                            $("#change_invalid_text").text("This Work Center is an internal process please choose PP01");
                          } else {
                            valid("change_control_key");
                            if(control_key == "PP01"){
                              if($('#change_est_setup_time').val().split(".")[0].length > 6){
                                invalid("change_est_setup_time");
                                $("#change_invalid_text").text("Estimate setup time is too large.");
                              } else {
                                valid("change_est_setup_time");
                                if($('#change_est_operate_time').val().split(".")[0].length > 6){
                                  invalid("change_est_operate_time");
                                  $("#change_invalid_text").text("Estimate operation time is too large.");
                                } else {
                                  valid("change_est_operate_time");
                                  if($('#change_est_labor_time').val().split(".")[0].length > 6){
                                    invalid("change_est_labor_time");
                                    $("#change_invalid_text").text("Estimate labor time is too large.");
                                  }
                                  else {
                                    valid("change_est_labor_time");
                                    if(est_setup_time == 0 && est_operate_time == 0 && est_labor_time == 0){
                                      invalid_many(["change_est_setup_time","change_est_operate_time","change_est_labor_time"]);
                                      $("#change_invalid_text").text("Estimate Setup/Operate/Labor can not be all 0.");
                                    }
                                    else {
                                      valid_many(["change_est_setup_time","change_est_operate_time","change_est_labor_time"]);
                                      isChangable = true;
                                    }
                                  }
                                }
                              }
                            } else if(control_key == "PP02"){
                              if(price_unit <= 0){
                                invalid("change_price_unit");
                                $("#change_invalid_text").text("Price unit can not be 0.");
                              } else if($('#change_price_unit').val().length > 6){
                                invalid("change_price_unit");
                                $("#change_invalid_text").text("Price unit is too large.");
                              } else {
                                valid("change_price_unit");
                                if(price <= 0){
                                  invalid("change_price");
                                  $("#change_invalid_text").text("Price can not be 0.");
                                } else if($('#change_price').val().split(".")[0].length > 9){
                                  invalid("change_price");
                                  $("#change_invalid_text").text("Price is too large.");
                                } else {
                                  valid("change_price");
                                  isChangable = true;
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                    if(isChangable){
                      $('#change_confirm_button').prop('disabled', true);
                      $.ajax({
                        url: '/change_operation/',
                        data: {
                          'order_no': order_no,
                          'operation_no': operation_no,
                          'emp_id': emp_id,
                          'password': password,
                          'work_center_no': work_center_no,
                          'control_key': control_key,
                          'plan_start_date': plan_start_date,
                          'plan_finish_date': plan_finish_date,
                          'est_setup_time': est_setup_time,
                          'est_operate_time': est_operate_time,
                          'est_labor_time': est_labor_time,
                          'pdt': pdt,
                          'purchasing_org': purchasing_org,
                          'cost_element': cost_element,
                          'mat_group': mat_group,
                          'purchasing_group': purchasing_group,
                          'price_unit': price_unit,
                          'price': price,
                          'currency': currency,
                        },
                        dataType: 'json',
                        success: function (data) {
                          location.reload();
                        }
                      });
                    } else {
                    }
                  }
                });
              }
            });
          }
        });
      }

      function trash(){
        var order_no = $('#order_no').val();
        var operation_no = $('#operation_no').val();
        var emp_id = $("#del_emp_id").val();
        var password = $("#del_password").val();
        clear_validate_delete();
        validate_operator(emp_id, function(isCorrect, invalid_text) {
          if(!isCorrect){
            invalid("del_emp_id");
            $("#del_invalid_text").text(invalid_text);
          } else {
            valid("del_emp_id");
            validate_section_chief_password(password, function(isCorrect, invalid_text) {
              if(!isCorrect){
                invalid("del_password");
                $("#del_invalid_text").text(invalid_text);
              } else {
                valid("del_password");
                $('#trash_confirm_button').prop('disabled', true);
                $.ajax({
                  url: '/delete_operation/',
                  data: {
                    'order_no': order_no,
                    'operation_no': operation_no,
                    'emp_id' : emp_id,
                    'password': password,
                  },
                  dataType: 'json',
                  success: function (data) {
                    window.location.href = '/transaction/' + data.nextlink;
                  }
                });
              }
            });
          }
        });
      }

      function inc_qty(){
        var order_no = $('#order_no').val();
        var operation_no = $('#operation_no').val();
        var emp_id = $("#inc_qty_emp_id").val();
        var password = $("#inc_qty_password").val();
        var amount = $("#inc_qty_amount").val();
        clear_validate_inc_qty();
        validate_operator(emp_id, function(isCorrect, invalid_text) {
          if(!isCorrect){
            invalid("inc_qty_emp_id");
            $("#inc_qty_invalid_text").text(invalid_text);
          } else {
            valid("inc_qty_emp_id");
            validate_section_chief_password(password, function(isCorrect, invalid_text) {
              if(!isCorrect){
                invalid("inc_qty_password");
                $("#inc_qty_invalid_text").text(invalid_text);
              } else {
                valid("inc_qty_password");
                if(amount == "" || amount == 0){
                  invalid("inc_qty_amount");
                  $("#inc_qty_invalid_text").text("Please fill amount correctly.");
                } else {
                  valid("inc_qty_amount");
                  $('#inc_qty_confirm_button').prop('disabled', true);
                  $.ajax({
                    url: '/inc_qty/',
                    data: {
                      'order_no': order_no,
                      'operation_no': operation_no,
                      'emp_id' : emp_id,
                      'password': password,
                      'amount' : amount,
                    },
                    dataType: 'json',
                    success: function (data) {
                      location.reload();
                    }
                  });
                }
              }
            });
          }
        });
      }

      function dec_qty(){
        var order_no = $('#order_no').val();
        var operation_no = $('#operation_no').val();
        var emp_id = $("#dec_qty_emp_id").val();
        var password = $("#dec_qty_password").val();
        var amount = $("#dec_qty_amount").val();
        clear_validate_dec_qty();
        validate_operator(emp_id, function(isCorrect, invalid_text) {
          if(!isCorrect){
            invalid("dec_qty_emp_id");
            $("#dec_qty_invalid_text").text(invalid_text);
          } else {
            valid("dec_qty_emp_id");
            validate_section_chief_password(password, function(isCorrect, invalid_text) {
              if(!isCorrect){
                invalid("dec_qty_password");
                $("#dec_qty_invalid_text").text(invalid_text);
              } else {
                valid("dec_qty_password");
                if(amount == "" || amount == 0){
                  invalid("dec_qty_amount");
                  $("#dec_qty_invalid_text").text("Please fill amount correctly.");
                } else {
                  valid("dec_qty_amount");
                  $('#dec_qty_confirm_button').prop('disabled', true);
                  $.ajax({
                    url: '/dec_qty/',
                    data: {
                      'order_no': order_no,
                      'operation_no': operation_no,
                      'emp_id' : emp_id,
                      'password': password,
                      'amount' : amount,
                    },
                    dataType: 'json',
                    success: function (data) {
                      location.reload();
                    }
                  });
                }
              }
            });
          }
        });
      }
    </script>
    <!-- NOTE -->
    <script>
      function open_note(){
        for(var i = 0;i <= operationListLength;i++){
          $("#note_" + i).prop("readonly", false);
        }
        $("#save_note_button").prop("hidden", false);
        $("#close_note_button").prop("hidden", false);
        $("#open_note_button").prop("hidden", true);
      }

      function close_note(){
        for(var i = 0;i <= operationListLength;i++){
          $("#note_" + i).prop("readonly", true);
        }
        $("#save_note_button").prop("hidden", true);
        $("#close_note_button").prop("hidden", true);
        $("#open_note_button").prop("hidden", false);
      }

      function save_note(){
        $("#save_note_button").prop("hidden", true);
        $("#close_note_button").prop("hidden", true);
        var order_no = $("#order_no").val();
        var order_note = $("#note_0").val();
        var operation_note_list = [];
        for(var i = 1;i <= operationListLength;i++){
          operation_note_list.push($("#note_" + i).val());
        }
        $.ajax({
          url: '/save_note/',
          data: {
            'order_no': order_no,
            'order_note': order_note,
            'operation_note_list': operation_note_list,
          },
          dataType: 'json',
          success: function (data) {
            location.reload();
          }
        });
      }
    </script>
    <!-- VALIDATION -->
    <script>
      //-- VALIDATION
      function validate_new_operation(new_operation_no, _callback){
        var order_no = $("#order_no").val();
        if(new_operation_no == "0000") _callback(false, "This Operation No is not available.");
        else {
          $.ajax({
            url: '/validate_new_operation/',
            data: {
              'order_no': order_no,
              'new_operation_no': new_operation_no,
            },
            dataType: 'json',
            success: function (data) {
              (data.canAdd)? _callback(true, ""):_callback(false, "This Operation No is not available.");
            }
          });
        }
      }

      function validate_routing(work_center_no, _callback){
        if(work_center_no.length < 2) _callback(false, "Routing not found.", false);
        else {
          $.ajax({
            url: '/validate_routing/',
            data: {
              'work_center_no': work_center_no,
            },
            dataType: 'json',
            success: function (data) {
              (data.canUse)? _callback(true, "", data.isExt):_callback(false, data.invalidText, false);
            }
          });
        }
      }

      function validate_work_center(work_center_no, _callback){
        var work_center_group = $("#work_center_group").val();
        if(work_center_no.length == 0) _callback(false, "Please fill Work Center.");
        else if(work_center_no.length < 2) _callback(false, "WorkCenter Not Found.");
        else {
          $.ajax({
            url: '/validate_work_center/',
            data: {
              'work_center_no': work_center_no,
              'work_center_group': work_center_group,
            },
            dataType: 'json',
            success: function (data) {
              (data.canUse)? _callback(true, ""):_callback(false, data.invalidText);
            }
          });
        }
      }

      function validate_operator(emp_id, _callback){
        if(emp_id.length == 0) _callback(false, "Please fill Emplyee ID.");
        else if(emp_id.length < 4) _callback(false, "Employee Not Found.");
        else {
          $.ajax({
            url: '/validate_operator/',
            data: {
              'emp_id': emp_id,
            },
            dataType: 'json',
            success: function (data) {
              (data.isExist)? _callback(true, ""):_callback(false, "Employee Not Found.");
            }
          });
        }
      }

      function validate_password(password, _callback){
        if(password.length == 0) _callback(false, "Please fill Password.");
        else if(password.length < 4) _callback(false, "Password is not correct.");
        else {
          $.ajax({
            url: '/validate_password/',
            data: {
              'password': password,
            },
            dataType: 'json',
            success: function (data) {
              (data.isCorrect)? _callback(true, ""):_callback(false, "Password is not correct.");
            }
          });
        }
      }

      function validate_section_chief_password(password, _callback){
        if(password.length == 0) _callback(false, "Please fill Password.");
        else if(password.length < 4) _callback(false, "Password is not correct.");
        else {
          $.ajax({
            url: '/validate_section_chief_password/',
            data: {
              'password': password,
            },
            dataType: 'json',
            success: function (data) {
              (data.isCorrect)? _callback(true, ""):_callback(false, "Password is not correct.");
            }
          });
        }
      }
    </script>
    <!-- SHORTCUT SEARCH -->
    <script>
      document.getElementById("sc_order_no").addEventListener("keydown", function (e) {
        if (e.code === "Enter" || e.code == "NumpadEnter") shortcut_search();
      });

      document.getElementById("sc_order_no").addEventListener("keyup", function (e) {
        if ($("#sc_order_no").val().length == 12) $("#sc_operation_no").focus();
      });

      document.getElementById("sc_operation_no").addEventListener("keydown", function (e) {
        if (e.code === "Enter" || e.code == "NumpadEnter") shortcut_search();
      });

      function shortcut_search(){
          var order_no =  $("#sc_order_no").val();
          var operation_no =  frontZero($("#sc_operation_no").val(), 4);
          (order_no.length < 6)? invalid("sc_order_no"): valid("sc_order_no");
          (operation_no.length < 4)? invalid("sc_operation_no"): valid("sc_operation_no");
          if(order_no.length >= 6 && operation_no.length == 4){
            remove_valid_many(["sc_order_no","sc_operation_no"]);
            window.open('/transaction/' + order_no + operation_no, '_self');
          }
        }

      document.getElementById("fp_operator_id").addEventListener("keydown", function (e) {
        if (e.code === "Enter" || e.code == "NumpadEnter") fp_emp_search();
      });

      function fp_emp_search(){
          remove_valid_many(["fp_operator_id"]);
          var operator_id =  $("#fp_operator_id").val();
          if (operator_id.length < 4){
            invalid("fp_operator_id");
          } else {
            $.ajax({
              url: '/fp_emp_search/',
              data: {
                'operator_id': operator_id,
              },
              dataType: 'json',
              success: function (data) {
                if(data.path == ""){
                  invalid("fp_operator_id");
                } else {
                  valid("fp_operator_id");
                  window.open('/transaction/' + data.path, '_self');
                }
              }
            });
          }
      }
    </script>
    <!-- DYNAMIC INPUT -->
    <script>
      $(document).on('change', 'input[type=radio][name=workcenter_radio]', function (event) {
          dynamic_operator_setup();
      });

      function dynamic_operator_setup(){
        if ($('input[name="workcenter_radio"]').length > 0){
          owc_id = document.querySelector('input[name="workcenter_radio"]:checked').value;
          var owc_status = $('#workcenter_status_' + owc_id).val();
          if(owc_status == "WORKING"){
            $("#operator_setup_button").prop('hidden', true);
          } else {
            $("#operator_setup_button").prop('hidden', false);
          }
        }
      }

      function dynamic_operator_id(){
        if($('#workcenter_type').val() == 'Labor'){
          $("#operator_id").prop('readonly', false);
        } else if($('#workcenter_type').val() == 'Machine' && $('input[name="workcenter_radio"]').length > 0){
          $("#operator_id").prop('readonly', false);
        } else {
          $("#operator_id").prop('readonly', true);
        }
      }

      function dynamic_join(){
        if($("#join_list_length").val() > 0 && $("#is_operating").val() == "False"){
          $("#break_join_main_button").prop("hidden", false);
        } else {
          $("#break_join_main_button").prop("hidden", true);
        }
        if($("#join_list_length").val() == 0 && $("#is_operating").val() == "False" && $("#workcenter_type").val() == 'Machine' && $("#remain_qty").val() > 0 && $("#is_joining").val() == "False"){
          $("#join_main_button").prop("hidden", false);
        } else {
          $("#join_main_button").prop("hidden", true);
        }
        if($("#join_list_length").val() == 0){
          $("#mp_main_button").removeClass("disabled");
        } else {
          $("#mp_main_button").addClass("disabled");
        }
      }

      $('#mp_setup_checkbox').change(function() {
          (this.checked)? $("#mp_setup_start_time_group").prop("hidden", false):$("#mp_setup_start_time_group").prop("hidden", true);
          (this.checked)? $("#mp_setup_stop_time_group").prop("hidden", false):$("#mp_setup_stop_time_group").prop("hidden", true);
      });

      $('#reject_reason').on("change", function() {
        var reason = $('#reject_reason').val();
        if(reason == "OTHER"){
          $("#other_reason").prop("readonly", false);
          $("#scrap_at_group").prop("hidden", true);
        } else if (reason == "SCRAP FROM PREVIOUS PROCESS"){
          $("#other_reason").prop("readonly", true);
          $("#scrap_at_group").prop("hidden", false);
        } else {
          $("#other_reason").prop("readonly", true);
          $("#scrap_at_group").prop("hidden", true);
          $("#other_reason").val("");
        }
      });

      $('#mp_reject_reason').on("change", function() {
        var reason = $('#mp_reject_reason').val();
        if(reason == "OTHER"){
          $("#mp_other_reason").prop("readonly", false);
          $("#mp_scrap_at_group").prop("hidden", true);
        } else if (reason == "SCRAP FROM PREVIOUS PROCESS"){
          $("#mp_other_reason").prop("readonly", true);
          $("#mp_scrap_at_group").prop("hidden", false);
        } else {
          $("#mp_other_reason").prop("readonly", true);
          $("#mp_scrap_at_group").prop("hidden", true);
          $("#mp_other_reason").val("");
        }
      });

      $('#add_control_key').on("change", function() {
        ($('#add_control_key').val() == "PP01")? $("#add_pp01").prop("hidden", false): $("#add_pp01").prop("hidden", true);
        ($('#add_control_key').val() == "PP01")? $("#add_pp02").prop("hidden", true): $("#add_pp02").prop("hidden", false);
      });

      $('#change_control_key').on("change", function() {
        ($('#change_control_key').val() == "PP01")? $("#change_pp01").prop("hidden", false): $("#change_pp01").prop("hidden", true);
        ($('#change_control_key').val() == "PP01")? $("#change_pp02").prop("hidden", true): $("#change_pp02").prop("hidden", false);
      });
    </script>
    <!-- KET RESTRICT -->
    <script>
      $("#sqty_process_qty").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#sqty_accepted_qty").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#sqty_rejected_qty").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#inc_qty_amount").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#inc_qty_emp_id").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#add_emp_id").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#add_new_operation_no").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#add_est_setup_time").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#add_est_operate_time").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#add_est_labor_time").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#add_pdt").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#add_price_unit").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#change_emp_id").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#change_est_setup_time").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#change_est_operate_time").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#change_est_labor_time").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#change_pdt").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#del_emp_id").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#operator_id").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#good_qty").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#reject_qty").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_emp_id").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_labor_time").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_setup_time").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_operate_time").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_good_qty").on("keypress keyup blur",function (event) {
          $(this).val($(this).val().replace(/[^\d].+/, ""));
          if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#mp_reject_qty").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#sc_order_no").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#sc_operation_no").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });

      $("#fp_operator_id").on("keypress keyup blur",function (event) {
         $(this).val($(this).val().replace(/[^\d].+/, ""));
         if((event.which < 48 || event.which > 57)) event.preventDefault();
      });
    </script>
    <!-- ADMIN -->
    <script>
    function validate_admin_password(password, _callback){
      if(password.length < 4) _callback(false);
      else {
        $.ajax({
          url: '/validate_admin_password/',
          data: {
            'password': password,
          },
          dataType: 'json',
          success: function (data) {
            if(data.isCorrect) _callback(true);
            else _callback(false);
          }
        });
      }
    }

    function clear_validate_reset_order(){
      $("#rso_invalid_text").text("");
      remove_valid_many(["rso_password"]);
    }

    function reset_order(){
      var order_no = $('#order_no').val();
      var start_operation_no = $('#rso_start_operation_no').val();
      var password = $('#rso_password').val();
      validate_admin_password(password, function(isCorrect, invalid_text) {
        if(!isCorrect){
          invalid("rso_password");
          $("#rso_invalid_text").text(invalid_text);
        } else {
          valid("rso_password");
          $('#rso_confirm_button').prop('disabled', true);
          $.ajax({
            url: '/reset_order/',
            data: {
              'order_no': order_no,
              'start_operation_no' : start_operation_no,
            },
            dataType: 'json',
            success: function (data) {
              location.reload();
            }
          });
        }
      });
    }

    function clear_validate_cancel_order(){
      $("#cc_invalid_text").text("");
      remove_valid_many(["cc_password"]);
    }

    function cancel_order(){
      var order_no = $('#order_no').val();
      var password = $('#cc_password').val();
      validate_admin_password(password, function(isCorrect, invalid_text) {
        if(!isCorrect){
          invalid("cc_password");
          $("#cc_invalid_text").text(invalid_text);
        } else {
          valid("cc_password");
          $('#cc_confirm_button').prop('disabled', true);
          $.ajax({
            url: '/cancel_order/',
            data: {
              'order_no': order_no,
            },
            dataType: 'json',
            success: function (data) {
              location.reload();
            }
          });
        }
      });
    }

    function sqty_operation(){
      var order_no = $('#order_no').val();
      var operation_no = $('#operation_no').val();
      var password = $('#sqty_password').val();
      if($('#sqty_process_qty').val() == "") $('#sqty_process_qty').val("0");
      if($('#sqty_accepted_qty').val() == "") $('#sqty_accepted_qty').val("0");
      if($('#sqty_rejected_qty').val() == "") $('#sqty_rejected_qty').val("0");
      var confirm_id = $('#confirm_id').val();
      var process_qty = parseFloat($('#sqty_process_qty').val());
      var accepted_qty = parseFloat($('#sqty_accepted_qty').val());
      var rejected_qty = parseFloat($('#sqty_rejected_qty').val());
      validate_admin_password(password, function(isCorrect, invalid_text) {
        if(!isCorrect){
          invalid("sqty_password");
          $("#sqty_invalid_text").text(invalid_text);
        } else {
          valid("sqty_password");
          $('#sqty_confirm_button').prop('disabled', true);
          $.ajax({
            url: '/sqty_operation/',
            data: {
              'order_no': order_no,
              'operation_no': operation_no,
              'process_qty': process_qty,
              'accepted_qty': accepted_qty,
              'rejected_qty': rejected_qty,
            },
            dataType: 'json',
            success: function (data) {
              location.reload();
            }
          });
        }
      });
    }
    </script>
  </body>
</html>
