<!DOCTYPE html>
{% load static %}
<!--
* CoreUI Pro based Bootstrap Admin Template
* @version v3.2.0
* @link https://coreui.io/pro/
* Copyright (c) 2020 creativeLabs Łukasz Holeczek
* License (https://coreui.io/pro/license)
-->
<html lang="en">
  <head>
    <base href="./">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description" content="CoreUI - Open Source Bootstrap Admin Template">
    <meta name="author" content="Łukasz Holeczek">
    <meta name="keyword" content="Bootstrap,Admin,Template,Open,Source,jQuery,CSS,HTML,RWD,Dashboard">
    <title>SAP Report | Shopfloor Reporting Application</title>
    <!-- Main styles for this application-->
    <link rel="stylesheet" href="{% static "css/style.css" %}">
    <!-- Icon CSS -->
    <link href="{% static "vendors/@coreui/icons/css/free.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/@coreui/icons/css/brand.min.css" %}" rel="stylesheet">
    <!-- Select CSS -->
    <link href="{% static "vendors/select2/css/select2.min.css" %}" rel="stylesheet">
    <link href="{% static "vendors/select2/css/select2-coreui.min.css" %}" rel="stylesheet">
    <!-- Data Table CSS -->
    <link href="{% static "vendors/datatables.net-bs4/css/dataTables.bootstrap4.css" %}" rel="stylesheet">
  </head>
  <body class="c-app c-no-layout-transition">
    <!-- *** LEFT SIDE BAR *** -->
    {% include 'sidebar.html' %}
    <!-- *** RIGHT SIDE BAR *** -->
    <div class="c-wrapper">
      <!-- *** HEADER *** -->
      <header class="c-header c-header-light c-header-fixed">
        {% include 'header.html' %}
        <div class="c-subheader justify-content-between px-3">
          <!-- Breadcrumb-->
          <ol class="breadcrumb border-0 m-0 px-0 px-md-3">
            <li class="breadcrumb-item">SAP Report ({{sapReportList|length}})</li>
            <!-- Breadcrumb Menu-->
          </ol>
          <div class="c-subheader-nav d-md-down-none mfe-2">
            <a href="/sap_mod/{{fdate}}&{{fhour}}"><i class="c-icon c-icon-sm cil-swap-horizontal"></i></a>&nbsp;&nbsp;&nbsp;
            <select class="form-control" id="fhour">
              <option value="ALLDAY" {% if fhour == 'ALLDAY' %}selected{% endif %}>All Day</option>
              <option value="00" {% if fhour == '00' %}selected{% endif %}>00:00 - 01:59</option>
              <option value="01" {% if fhour == '01' %}selected{% endif %}>01:00 - 01:59</option>
              <option value="02" {% if fhour == '02' %}selected{% endif %}>02:00 - 02:59</option>
              <option value="03" {% if fhour == '03' %}selected{% endif %}>03:00 - 03:59</option>
              <option value="04" {% if fhour == '04' %}selected{% endif %}>04:00 - 04:59</option>
              <option value="05" {% if fhour == '05' %}selected{% endif %}>05:00 - 05:59</option>
              <option value="06" {% if fhour == '06' %}selected{% endif %}>06:00 - 06:59</option>
              <option value="07" {% if fhour == '07' %}selected{% endif %}>07:00 - 07:59</option>
              <option value="08" {% if fhour == '08' %}selected{% endif %}>08:00 - 08:59</option>
              <option value="09" {% if fhour == '09' %}selected{% endif %}>09:00 - 09:59</option>
              <option value="10" {% if fhour == '10' %}selected{% endif %}>10:00 - 10:59</option>
              <option value="11" {% if fhour == '11' %}selected{% endif %}>11:00 - 11:59</option>
              <option value="12" {% if fhour == '12' %}selected{% endif %}>12:00 - 12:59</option>
              <option value="13" {% if fhour == '13' %}selected{% endif %}>13:00 - 13:59</option>
              <option value="14" {% if fhour == '14' %}selected{% endif %}>14:00 - 14:59</option>
              <option value="15" {% if fhour == '15' %}selected{% endif %}>15:00 - 15:59</option>
              <option value="16" {% if fhour == '16' %}selected{% endif %}>16:00 - 16:59</option>
              <option value="17" {% if fhour == '17' %}selected{% endif %}>17:00 - 17:59</option>
              <option value="18" {% if fhour == '18' %}selected{% endif %}>18:00 - 18:59</option>
              <option value="19" {% if fhour == '19' %}selected{% endif %}>19:00 - 19:59</option>
              <option value="20" {% if fhour == '20' %}selected{% endif %}>20:00 - 20:59</option>
              <option value="21" {% if fhour == '21' %}selected{% endif %}>21:00 - 21:59</option>
              <option value="22" {% if fhour == '22' %}selected{% endif %}>22:00 - 22:59</option>
              <option value="23" {% if fhour == '23' %}selected{% endif %}>23:00 - 23:59</option>
            </select>&nbsp;
            <input type="date" class="form-control" id="fdate" value="{{fdate}}" onkeydown="return false">
            <button type="button" class="btn btn-sm btn-link text-primary" style="padding-top: 3px;" onclick="window.scrollTo(0,0);"><i class="c-icon c-icon-sm cil-chevron-double-up"></i></a>
            <button type="button" class="btn btn-sm btn-link text-primary" style="padding-top: 3px;" onclick="window.scrollTo(0,document.body.scrollHeight);"><i class="c-icon c-icon-sm cil-chevron-double-down"></i></a>
          </div>
        </div>
      </header>
      <!-- *** BODY *** -->
      <div class="c-body">
        <main class="c-main">
          <div class="container-fluid">
            <div class="fade-in">
              <div class="row">
                <div class="col-md-12">
                  <div class="card">
                    <div class="card-body">
                      <div class="text-center">
                          <a class="toggle-vis small text-primary" data-column="0">DateTimeStamp</a> |
                          <a class="toggle-vis small text-primary" data-column="1">WorkCenter</a> |
                          <a class="toggle-vis small text-primary" data-column="2">ProductionOrderNo</a> |
                          <a class="toggle-vis small text-primary" data-column="3">OperationNumber</a> |
                          <a class="toggle-vis small text-primary" data-column="4">Yiled</a> |
                          <a class="toggle-vis small text-primary" data-column="5">Scrap</a> |
                          <a class="toggle-vis small text-primary" data-column="6">SetupTime</a> |
                          <a class="toggle-vis small text-primary" data-column="7">OperTime</a> |
                          <a class="toggle-vis small text-primary" data-column="8">LaborTime</a> |
                          <a class="toggle-vis small text-primary" data-column="9">StartDate</a> |
                          <a class="toggle-vis small text-primary" data-column="10">StartTime</a> |
                          <a class="toggle-vis small text-primary" data-column="11">FinishDate</a> |
                          <a class="toggle-vis small text-primary" data-column="12">FinishTime</a> |
                          <a class="toggle-vis small text-primary" data-column="13">EmployeeID</a>
                      </div>
                      <br>
                      <table class="table table-sm table-outline small" id="sap_report_table" style="width: 100%">
                        <thead class="thead-light">
                          <tr>
                            <th>DateTimeStamp</th>
                            <th>WorkCenter</th>
                            <th>ProductionOrderNo</th>
                            <th>OperationNumber</th>
                            <th>Yiled</th>
                            <th>Scrap</th>
                            <th>SetupTime</th>
                            <th>OperTime</th>
                            <th>LaborTime</th>
                            <th>StartDate</th>
                            <th>StartTime</th>
                            <th>FinishDate</th>
                            <th>FinishTime</th>
                            <th>EmployeeID</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for report in sapReportList %}
                          <tr>
                            <td data-order="{{report.DateTimeStamp|date:"U"}}">{{report.DateTimeStamp|default_if_none:""}}</td>
                            <td><a href="/wc/{{report.WorkCenter}}&NOW">{{report.WorkCenter|default_if_none:""}}</a></td>
                            <td>{{report.ProductionOrderNo|default_if_none:""}}</td>
                            <td>{{report.OperationNumber|default_if_none:""}}</td>
                            <td>{{report.Yiled|default_if_none:""}}</td>
                            <td>{{report.Scrap|default_if_none:""}}</td>
                            <td>{{report.SetupTime|default_if_none:""}}</td>
                            <td>{{report.OperTime|default_if_none:""}}</td>
                            <td>{{report.LaborTime|default_if_none:""}}</td>
                            <td>{{report.StartDate|default_if_none:""}}</td>
                            <td>{{report.StartTime|default_if_none:""}}</td>
                            <td>{{report.FinishDate|default_if_none:""}}</td>
                            <td>{{report.FinishTime|default_if_none:""}}</td>
                            <td>
                              {% if report.EmployeeID.strip != '9999' %}
                              <a href="/emp/{{report.EmployeeID}}&NOW">{{report.EmployeeID|default_if_none:""}}</a>
                              {% else %}
                              {{report.EmployeeID|default_if_none:""}}
                              {% endif %}
                            </td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                      {% if sapReportList|length > 0 %}
                      <br>
                      <div class="accordion" id="accordion" role="tablist">
                        <div class="card border-danger mb-0">
                          <div class="card-header" role="tab">
                            <a data-toggle="collapse" class="text-danger" href="#collapse-1">SFR2SAP_CON.txt</a>
                            <div class="card-header-actions">
                              <button class="btn btn-sm btn-danger" onclick="download_txt()"><i class="c-icon c-icon-sm cil-arrow-thick-to-bottom"></i></button>
                            </div>
                          </div>
                          <div class="collapse" id="collapse-1" role="tabpanel">
                            <div class="card-body">
                              <p class="mb-3 small" id="text_area">
                                {% for report in sapReportList reversed %}
                                  {{report.WorkCenter.strip|default_if_none:""}}|{{report.ProductionOrderNo.strip|default_if_none:""}}|{{report.OperationNumber.strip|default_if_none:""}}|{{report.Yiled|default_if_none:""}}|{{report.Scrap|default_if_none:""}}|{{report.SetupTime|default_if_none:""}}|{{report.OperTime|default_if_none:""}}|{{report.LaborTime|default_if_none:""}}|{{report.StartDate|default_if_none:""}}|{{report.StartTime|default_if_none:""}}|{{report.FinishDate|default_if_none:""}}|{{report.FinishTime|default_if_none:""}}|<br>
                                {% endfor %}
                              </p>
                            </div>
                          </div>
                        </div>
                      </div>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
      <!-- *** FOOTER *** -->
      {% include 'footer.html' %}
    </div>
    <!-- CoreUI and necessary plugins-->
    <script src="{% static "vendors/@coreui/coreui-pro/js/coreui.bundle.min.js" %}"></script>
    <!--[if IE]><!-->
    <script src="{% static "vendors/@coreui/icons/js/svgxuse.min.js" %}"></script>
    <!--<![endif]-->
    <script src="{% static "vendors/jquery/js/jquery.min.js" %}"></script>
    <script src="{% static "vendors/select2/js/select2.min.js" %}"></script>
    <!-- Data Table JS -->
    <script src="{% static "vendors/datatables.net/js/jquery.dataTables.js" %}"></script>
    <script src="{% static "vendors/datatables.net-bs4/js/dataTables.bootstrap4.min.js" %}"></script>
    <script src="https://cdn.datatables.net/buttons/2.0.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.print.min.js"></script>
    <!-- Custom -->
    <script src="{% static "customize/js/clock.js" %}"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function(event) {
        setTimeout(function() {
          document.body.classList.remove('c-no-layout-transition')
        }, 2000);
      });

      var table;
      $(document).ready(function() {
        table = $('#sap_report_table').DataTable( {
            "order": [[ 0, "desc" ]],
            'iDisplayLength': 100,
            "scrollX": true,
            dom: 'Bfrtip',
            buttons: [
              'excelHtml5',
              'csvHtml5',
            ]
        });
        var button_list = document.getElementsByClassName("buttons-html5");
        for (var i = 0; i < button_list.length; i++) {
          button_list[i].classList.add("btn");
          button_list[i].classList.add("btn-sm");
          button_list[i].classList.add("btn-outline-success");
        }
      });

      $('a.toggle-vis').on( 'click', function (e) {
        e.preventDefault();
        var column = table.column( $(this).attr('data-column') );
        column.visible( ! column.visible() );
        (column.visible())? $(this).removeClass("text-danger"): $(this).addClass("text-danger");
      });

      function download_txt(){
        var blob = new Blob([$("#text_area").text().replace(/^(?=\n)$|^\s*|\s*$|\n\n+/gm, "").trim()], {type: "text/plain;charset=utf-8"});
        saveAs(blob, "SFR2SAP_CON.txt");
      }

      $('#fdate').change(function() {
        window.location.href =  "/sap_report/" + ($("#fdate").val() + "&" + $("#fhour").val());
      });

      $('#fhour').change(function() {
        window.location.href =  "/sap_report/" + ($("#fdate").val() + "&" + $("#fhour").val());
      });
    </script>
  </body>
</html>
